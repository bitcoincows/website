import{e as Jo}from"../app.4bdd8d54.js";import{t as Et,s as Zi,f as es,d as ts,e as dt,a as Xo,i as Fs,c as Qo,b as Zo,g as rs,p as ec,J as Nr,h as is,j as ss,k as Rt,l as Tt,m as ta,n as ns,H as ii}from"./http.cf42bdb6.js";import{r as tc,c as Wt,g as rc}from"../reservation2.md.d4d0605d.js";var as={},si={},re={},ra={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});function e(h,l){var w=h>>>16&65535,m=h&65535,_=l>>>16&65535,N=l&65535;return m*N+(w*N+m*_<<16>>>0)|0}r.mul=Math.imul||e;function t(h,l){return h+l|0}r.add=t;function i(h,l){return h-l|0}r.sub=i;function s(h,l){return h<<l|h>>>32-l}r.rotl=s;function c(h,l){return h<<32-l|h>>>l}r.rotr=c;function y(h){return typeof h=="number"&&isFinite(h)&&Math.floor(h)===h}r.isInteger=Number.isInteger||y,r.MAX_SAFE_INTEGER=9007199254740991,r.isSafeInteger=function(h){return r.isInteger(h)&&h>=-r.MAX_SAFE_INTEGER&&h<=r.MAX_SAFE_INTEGER}})(ra);Object.defineProperty(re,"__esModule",{value:!0});var ia=ra;function ic(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}re.readInt16BE=ic;function sc(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}re.readUint16BE=sc;function nc(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}re.readInt16LE=nc;function ac(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}re.readUint16LE=ac;function sa(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}re.writeUint16BE=sa;re.writeInt16BE=sa;function na(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}re.writeUint16LE=na;re.writeInt16LE=na;function Fi(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}re.readInt32BE=Fi;function Ri(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}re.readUint32BE=Ri;function $i(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}re.readInt32LE=$i;function Li(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}re.readUint32LE=Li;function Xr(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}re.writeUint32BE=Xr;re.writeInt32BE=Xr;function Qr(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}re.writeUint32LE=Qr;re.writeInt32LE=Qr;function oc(r,e){e===void 0&&(e=0);var t=Fi(r,e),i=Fi(r,e+4);return t*4294967296+i-(i>>31)*4294967296}re.readInt64BE=oc;function cc(r,e){e===void 0&&(e=0);var t=Ri(r,e),i=Ri(r,e+4);return t*4294967296+i}re.readUint64BE=cc;function hc(r,e){e===void 0&&(e=0);var t=$i(r,e),i=$i(r,e+4);return i*4294967296+t-(t>>31)*4294967296}re.readInt64LE=hc;function uc(r,e){e===void 0&&(e=0);var t=Li(r,e),i=Li(r,e+4);return i*4294967296+t}re.readUint64LE=uc;function aa(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Xr(r/4294967296>>>0,e,t),Xr(r>>>0,e,t+4),e}re.writeUint64BE=aa;re.writeInt64BE=aa;function oa(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Qr(r>>>0,e,t),Qr(r/4294967296>>>0,e,t+4),e}re.writeUint64LE=oa;re.writeInt64LE=oa;function lc(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,s=1,c=r/8+t-1;c>=t;c--)i+=e[c]*s,s*=256;return i}re.readUintBE=lc;function fc(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,s=1,c=t;c<t+r/8;c++)i+=e[c]*s,s*=256;return i}re.readUintLE=fc;function dc(r,e,t,i){if(t===void 0&&(t=new Uint8Array(r/8)),i===void 0&&(i=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!ia.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,c=r/8+i-1;c>=i;c--)t[c]=e/s&255,s*=256;return t}re.writeUintBE=dc;function pc(r,e,t,i){if(t===void 0&&(t=new Uint8Array(r/8)),i===void 0&&(i=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!ia.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,c=i;c<i+r/8;c++)t[c]=e/s&255,s*=256;return t}re.writeUintLE=pc;function gc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}re.readFloat32BE=gc;function yc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}re.readFloat32LE=yc;function mc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}re.readFloat64BE=mc;function bc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}re.readFloat64LE=bc;function wc(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(t,r),e}re.writeFloat32BE=wc;function _c(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(t,r,!0),e}re.writeFloat32LE=_c;function Ec(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(t,r),e}re.writeFloat64BE=Ec;function vc(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(t,r,!0),e}re.writeFloat64LE=vc;var pt={};Object.defineProperty(pt,"__esModule",{value:!0});function Dc(r){for(var e=0;e<r.length;e++)r[e]=0;return r}pt.wipe=Dc;Object.defineProperty(si,"__esModule",{value:!0});var st=re,Mi=pt,Sc=20;function Ic(r,e,t){for(var i=1634760805,s=857760878,c=2036477234,y=1797285236,h=t[3]<<24|t[2]<<16|t[1]<<8|t[0],l=t[7]<<24|t[6]<<16|t[5]<<8|t[4],w=t[11]<<24|t[10]<<16|t[9]<<8|t[8],m=t[15]<<24|t[14]<<16|t[13]<<8|t[12],_=t[19]<<24|t[18]<<16|t[17]<<8|t[16],N=t[23]<<24|t[22]<<16|t[21]<<8|t[20],v=t[27]<<24|t[26]<<16|t[25]<<8|t[24],D=t[31]<<24|t[30]<<16|t[29]<<8|t[28],P=e[3]<<24|e[2]<<16|e[1]<<8|e[0],O=e[7]<<24|e[6]<<16|e[5]<<8|e[4],F=e[11]<<24|e[10]<<16|e[9]<<8|e[8],o=e[15]<<24|e[14]<<16|e[13]<<8|e[12],d=i,u=s,f=c,g=y,n=h,p=l,U=w,j=m,Y=_,J=N,X=v,A=D,T=P,k=O,H=F,$=o,L=0;L<Sc;L+=2)d=d+n|0,T^=d,T=T>>>32-16|T<<16,Y=Y+T|0,n^=Y,n=n>>>32-12|n<<12,u=u+p|0,k^=u,k=k>>>32-16|k<<16,J=J+k|0,p^=J,p=p>>>32-12|p<<12,f=f+U|0,H^=f,H=H>>>32-16|H<<16,X=X+H|0,U^=X,U=U>>>32-12|U<<12,g=g+j|0,$^=g,$=$>>>32-16|$<<16,A=A+$|0,j^=A,j=j>>>32-12|j<<12,f=f+U|0,H^=f,H=H>>>32-8|H<<8,X=X+H|0,U^=X,U=U>>>32-7|U<<7,g=g+j|0,$^=g,$=$>>>32-8|$<<8,A=A+$|0,j^=A,j=j>>>32-7|j<<7,u=u+p|0,k^=u,k=k>>>32-8|k<<8,J=J+k|0,p^=J,p=p>>>32-7|p<<7,d=d+n|0,T^=d,T=T>>>32-8|T<<8,Y=Y+T|0,n^=Y,n=n>>>32-7|n<<7,d=d+p|0,$^=d,$=$>>>32-16|$<<16,X=X+$|0,p^=X,p=p>>>32-12|p<<12,u=u+U|0,T^=u,T=T>>>32-16|T<<16,A=A+T|0,U^=A,U=U>>>32-12|U<<12,f=f+j|0,k^=f,k=k>>>32-16|k<<16,Y=Y+k|0,j^=Y,j=j>>>32-12|j<<12,g=g+n|0,H^=g,H=H>>>32-16|H<<16,J=J+H|0,n^=J,n=n>>>32-12|n<<12,f=f+j|0,k^=f,k=k>>>32-8|k<<8,Y=Y+k|0,j^=Y,j=j>>>32-7|j<<7,g=g+n|0,H^=g,H=H>>>32-8|H<<8,J=J+H|0,n^=J,n=n>>>32-7|n<<7,u=u+U|0,T^=u,T=T>>>32-8|T<<8,A=A+T|0,U^=A,U=U>>>32-7|U<<7,d=d+p|0,$^=d,$=$>>>32-8|$<<8,X=X+$|0,p^=X,p=p>>>32-7|p<<7;st.writeUint32LE(d+i|0,r,0),st.writeUint32LE(u+s|0,r,4),st.writeUint32LE(f+c|0,r,8),st.writeUint32LE(g+y|0,r,12),st.writeUint32LE(n+h|0,r,16),st.writeUint32LE(p+l|0,r,20),st.writeUint32LE(U+w|0,r,24),st.writeUint32LE(j+m|0,r,28),st.writeUint32LE(Y+_|0,r,32),st.writeUint32LE(J+N|0,r,36),st.writeUint32LE(X+v|0,r,40),st.writeUint32LE(A+D|0,r,44),st.writeUint32LE(T+P|0,r,48),st.writeUint32LE(k+O|0,r,52),st.writeUint32LE(H+F|0,r,56),st.writeUint32LE($+o|0,r,60)}function ca(r,e,t,i,s){if(s===void 0&&(s=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<t.length)throw new Error("ChaCha: destination is shorter than source");var c,y;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");c=new Uint8Array(16),y=c.length-e.length,c.set(e,y)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");c=e,y=s}for(var h=new Uint8Array(64),l=0;l<t.length;l+=64){Ic(h,c,r);for(var w=l;w<l+64&&w<t.length;w++)i[w]=t[w]^h[w-l];xc(c,0,y)}return Mi.wipe(h),s===0&&Mi.wipe(c),i}si.streamXOR=ca;function Oc(r,e,t,i){return i===void 0&&(i=0),Mi.wipe(t),ca(r,e,t,t,i)}si.stream=Oc;function xc(r,e,t){for(var i=1;t--;)i=i+(r[e]&255)|0,r[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var ha={},Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});function Cc(r,e,t){return~(r-1)&e|r-1&t}Mt.select=Cc;function Nc(r,e){return(r|0)-(e|0)-1>>>31&1}Mt.lessOrEqual=Nc;function ua(r,e){if(r.length!==e.length)return 0;for(var t=0,i=0;i<r.length;i++)t|=r[i]^e[i];return 1&t-1>>>8}Mt.compare=ua;function Tc(r,e){return r.length===0||e.length===0?!1:ua(r,e)!==0}Mt.equal=Tc;(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Mt,t=pt;r.DIGEST_LENGTH=16;var i=function(){function y(h){this.digestLength=r.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var l=h[0]|h[1]<<8;this._r[0]=l&8191;var w=h[2]|h[3]<<8;this._r[1]=(l>>>13|w<<3)&8191;var m=h[4]|h[5]<<8;this._r[2]=(w>>>10|m<<6)&7939;var _=h[6]|h[7]<<8;this._r[3]=(m>>>7|_<<9)&8191;var N=h[8]|h[9]<<8;this._r[4]=(_>>>4|N<<12)&255,this._r[5]=N>>>1&8190;var v=h[10]|h[11]<<8;this._r[6]=(N>>>14|v<<2)&8191;var D=h[12]|h[13]<<8;this._r[7]=(v>>>11|D<<5)&8065;var P=h[14]|h[15]<<8;this._r[8]=(D>>>8|P<<8)&8191,this._r[9]=P>>>5&127,this._pad[0]=h[16]|h[17]<<8,this._pad[1]=h[18]|h[19]<<8,this._pad[2]=h[20]|h[21]<<8,this._pad[3]=h[22]|h[23]<<8,this._pad[4]=h[24]|h[25]<<8,this._pad[5]=h[26]|h[27]<<8,this._pad[6]=h[28]|h[29]<<8,this._pad[7]=h[30]|h[31]<<8}return y.prototype._blocks=function(h,l,w){for(var m=this._fin?0:2048,_=this._h[0],N=this._h[1],v=this._h[2],D=this._h[3],P=this._h[4],O=this._h[5],F=this._h[6],o=this._h[7],d=this._h[8],u=this._h[9],f=this._r[0],g=this._r[1],n=this._r[2],p=this._r[3],U=this._r[4],j=this._r[5],Y=this._r[6],J=this._r[7],X=this._r[8],A=this._r[9];w>=16;){var T=h[l+0]|h[l+1]<<8;_+=T&8191;var k=h[l+2]|h[l+3]<<8;N+=(T>>>13|k<<3)&8191;var H=h[l+4]|h[l+5]<<8;v+=(k>>>10|H<<6)&8191;var $=h[l+6]|h[l+7]<<8;D+=(H>>>7|$<<9)&8191;var L=h[l+8]|h[l+9]<<8;P+=($>>>4|L<<12)&8191,O+=L>>>1&8191;var M=h[l+10]|h[l+11]<<8;F+=(L>>>14|M<<2)&8191;var q=h[l+12]|h[l+13]<<8;o+=(M>>>11|q<<5)&8191;var ie=h[l+14]|h[l+15]<<8;d+=(q>>>8|ie<<8)&8191,u+=ie>>>5|m;var z=0,Z=z;Z+=_*f,Z+=N*(5*A),Z+=v*(5*X),Z+=D*(5*J),Z+=P*(5*Y),z=Z>>>13,Z&=8191,Z+=O*(5*j),Z+=F*(5*U),Z+=o*(5*p),Z+=d*(5*n),Z+=u*(5*g),z+=Z>>>13,Z&=8191;var W=z;W+=_*g,W+=N*f,W+=v*(5*A),W+=D*(5*X),W+=P*(5*J),z=W>>>13,W&=8191,W+=O*(5*Y),W+=F*(5*j),W+=o*(5*U),W+=d*(5*p),W+=u*(5*n),z+=W>>>13,W&=8191;var oe=z;oe+=_*n,oe+=N*g,oe+=v*f,oe+=D*(5*A),oe+=P*(5*X),z=oe>>>13,oe&=8191,oe+=O*(5*J),oe+=F*(5*Y),oe+=o*(5*j),oe+=d*(5*U),oe+=u*(5*p),z+=oe>>>13,oe&=8191;var C=z;C+=_*p,C+=N*n,C+=v*g,C+=D*f,C+=P*(5*A),z=C>>>13,C&=8191,C+=O*(5*X),C+=F*(5*J),C+=o*(5*Y),C+=d*(5*j),C+=u*(5*U),z+=C>>>13,C&=8191;var x=z;x+=_*U,x+=N*p,x+=v*n,x+=D*g,x+=P*f,z=x>>>13,x&=8191,x+=O*(5*A),x+=F*(5*X),x+=o*(5*J),x+=d*(5*Y),x+=u*(5*j),z+=x>>>13,x&=8191;var S=z;S+=_*j,S+=N*U,S+=v*p,S+=D*n,S+=P*g,z=S>>>13,S&=8191,S+=O*f,S+=F*(5*A),S+=o*(5*X),S+=d*(5*J),S+=u*(5*Y),z+=S>>>13,S&=8191;var a=z;a+=_*Y,a+=N*j,a+=v*U,a+=D*p,a+=P*n,z=a>>>13,a&=8191,a+=O*g,a+=F*f,a+=o*(5*A),a+=d*(5*X),a+=u*(5*J),z+=a>>>13,a&=8191;var E=z;E+=_*J,E+=N*Y,E+=v*j,E+=D*U,E+=P*p,z=E>>>13,E&=8191,E+=O*n,E+=F*g,E+=o*f,E+=d*(5*A),E+=u*(5*X),z+=E>>>13,E&=8191;var K=z;K+=_*X,K+=N*J,K+=v*Y,K+=D*j,K+=P*U,z=K>>>13,K&=8191,K+=O*p,K+=F*n,K+=o*g,K+=d*f,K+=u*(5*A),z+=K>>>13,K&=8191;var V=z;V+=_*A,V+=N*X,V+=v*J,V+=D*Y,V+=P*j,z=V>>>13,V&=8191,V+=O*U,V+=F*p,V+=o*n,V+=d*g,V+=u*f,z+=V>>>13,V&=8191,z=(z<<2)+z|0,z=z+Z|0,Z=z&8191,z=z>>>13,W+=z,_=Z,N=W,v=oe,D=C,P=x,O=S,F=a,o=E,d=K,u=V,l+=16,w-=16}this._h[0]=_,this._h[1]=N,this._h[2]=v,this._h[3]=D,this._h[4]=P,this._h[5]=O,this._h[6]=F,this._h[7]=o,this._h[8]=d,this._h[9]=u},y.prototype.finish=function(h,l){l===void 0&&(l=0);var w=new Uint16Array(10),m,_,N,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(m=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=m,m=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=m*5,m=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=m,m=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=m,w[0]=this._h[0]+5,m=w[0]>>>13,w[0]&=8191,v=1;v<10;v++)w[v]=this._h[v]+m,m=w[v]>>>13,w[v]&=8191;for(w[9]-=1<<13,_=(m^1)-1,v=0;v<10;v++)w[v]&=_;for(_=~_,v=0;v<10;v++)this._h[v]=this._h[v]&_|w[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,N=this._h[0]+this._pad[0],this._h[0]=N&65535,v=1;v<8;v++)N=(this._h[v]+this._pad[v]|0)+(N>>>16)|0,this._h[v]=N&65535;return h[l+0]=this._h[0]>>>0,h[l+1]=this._h[0]>>>8,h[l+2]=this._h[1]>>>0,h[l+3]=this._h[1]>>>8,h[l+4]=this._h[2]>>>0,h[l+5]=this._h[2]>>>8,h[l+6]=this._h[3]>>>0,h[l+7]=this._h[3]>>>8,h[l+8]=this._h[4]>>>0,h[l+9]=this._h[4]>>>8,h[l+10]=this._h[5]>>>0,h[l+11]=this._h[5]>>>8,h[l+12]=this._h[6]>>>0,h[l+13]=this._h[6]>>>8,h[l+14]=this._h[7]>>>0,h[l+15]=this._h[7]>>>8,this._finished=!0,this},y.prototype.update=function(h){var l=0,w=h.length,m;if(this._leftover){m=16-this._leftover,m>w&&(m=w);for(var _=0;_<m;_++)this._buffer[this._leftover+_]=h[l+_];if(w-=m,l+=m,this._leftover+=m,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(w>=16&&(m=w-w%16,this._blocks(h,l,m),l+=m,w-=m),w){for(var _=0;_<w;_++)this._buffer[this._leftover+_]=h[l+_];this._leftover+=w}return this},y.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var h=new Uint8Array(16);return this.finish(h),h},y.prototype.clean=function(){return t.wipe(this._buffer),t.wipe(this._r),t.wipe(this._h),t.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},y}();r.Poly1305=i;function s(y,h){var l=new i(y);l.update(h);var w=l.digest();return l.clean(),w}r.oneTimeAuth=s;function c(y,h){return y.length!==r.DIGEST_LENGTH||h.length!==r.DIGEST_LENGTH?!1:e.equal(y,h)}r.equal=c})(ha);(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=si,t=ha,i=pt,s=re,c=Mt;r.KEY_LENGTH=32,r.NONCE_LENGTH=12,r.TAG_LENGTH=16;var y=new Uint8Array(16),h=function(){function l(w){if(this.nonceLength=r.NONCE_LENGTH,this.tagLength=r.TAG_LENGTH,w.length!==r.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(w)}return l.prototype.seal=function(w,m,_,N){if(w.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(w,v.length-w.length);var D=new Uint8Array(32);e.stream(this._key,v,D,4);var P=m.length+this.tagLength,O;if(N){if(N.length!==P)throw new Error("ChaCha20Poly1305: incorrect destination length");O=N}else O=new Uint8Array(P);return e.streamXOR(this._key,v,m,O,4),this._authenticate(O.subarray(O.length-this.tagLength,O.length),D,O.subarray(0,O.length-this.tagLength),_),i.wipe(v),O},l.prototype.open=function(w,m,_,N){if(w.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(m.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(w,v.length-w.length);var D=new Uint8Array(32);e.stream(this._key,v,D,4);var P=new Uint8Array(this.tagLength);if(this._authenticate(P,D,m.subarray(0,m.length-this.tagLength),_),!c.equal(P,m.subarray(m.length-this.tagLength,m.length)))return null;var O=m.length-this.tagLength,F;if(N){if(N.length!==O)throw new Error("ChaCha20Poly1305: incorrect destination length");F=N}else F=new Uint8Array(O);return e.streamXOR(this._key,v,m.subarray(0,m.length-this.tagLength),F,4),i.wipe(v),F},l.prototype.clean=function(){return i.wipe(this._key),this},l.prototype._authenticate=function(w,m,_,N){var v=new t.Poly1305(m);N&&(v.update(N),N.length%16>0&&v.update(y.subarray(N.length%16))),v.update(_),_.length%16>0&&v.update(y.subarray(_.length%16));var D=new Uint8Array(8);N&&s.writeUint64LE(N.length,D),v.update(D),s.writeUint64LE(_.length,D),v.update(D);for(var P=v.digest(),O=0;O<P.length;O++)w[O]=P[O];v.clean(),i.wipe(P),i.wipe(D)},l}();r.ChaCha20Poly1305=h})(as);var la={},Tr={},os={};Object.defineProperty(os,"__esModule",{value:!0});function Ac(r){return typeof r.saveState<"u"&&typeof r.restoreState<"u"&&typeof r.cleanSavedState<"u"}os.isSerializableHash=Ac;Object.defineProperty(Tr,"__esModule",{value:!0});var Dt=os,Pc=Mt,Uc=pt,fa=function(){function r(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(i).clean():i.set(t);for(var s=0;s<i.length;s++)i[s]^=54;this._inner.update(i);for(var s=0;s<i.length;s++)i[s]^=106;this._outer.update(i),Dt.isSerializableHash(this._inner)&&Dt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Uc.wipe(i)}return r.prototype.reset=function(){if(!Dt.isSerializableHash(this._inner)||!Dt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.clean=function(){Dt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Dt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},r.prototype.update=function(e){return this._inner.update(e),this},r.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(!Dt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},r.prototype.restoreState=function(e){if(!Dt.isSerializableHash(this._inner)||!Dt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.cleanSavedState=function(e){if(!Dt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},r}();Tr.HMAC=fa;function Fc(r,e,t){var i=new fa(r,e);i.update(t);var s=i.digest();return i.clean(),s}Tr.hmac=Fc;Tr.equal=Pc.equal;Object.defineProperty(la,"__esModule",{value:!0});var Rs=Tr,$s=pt,Rc=function(){function r(e,t,i,s){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var c=Rs.hmac(this._hash,i,t);this._hmac=new Rs.HMAC(e,c),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return r.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},r.prototype.expand=function(e){for(var t=new Uint8Array(e),i=0;i<t.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[i]=this._buffer[this._bufpos++];return t},r.prototype.clean=function(){this._hmac.clean(),$s.wipe(this._buffer),$s.wipe(this._counter),this._bufpos=0},r}(),$c=la.HKDF=Rc,or={},ni={},ai={};Object.defineProperty(ai,"__esModule",{value:!0});ai.BrowserRandomSource=void 0;const Ls=65536;class Lc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let i=0;i<t.length;i+=Ls)this._crypto.getRandomValues(t.subarray(i,i+Math.min(t.length-i,Ls)));return t}}ai.BrowserRandomSource=Lc;function Mc(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var oi={};Object.defineProperty(oi,"__esModule",{value:!0});oi.NodeRandomSource=void 0;const jc=pt;class Hc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Mc<"u"){const e=tc;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let s=0;s<i.length;s++)i[s]=t[s];return(0,jc.wipe)(t),i}}oi.NodeRandomSource=Hc;Object.defineProperty(ni,"__esModule",{value:!0});ni.SystemRandomSource=void 0;const qc=ai,zc=oi;class Kc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new qc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new zc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}ni.SystemRandomSource=Kc;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.randomStringForEntropy=r.randomString=r.randomUint32=r.randomBytes=r.defaultRandomSource=void 0;const e=ni,t=re,i=pt;r.defaultRandomSource=new e.SystemRandomSource;function s(w,m=r.defaultRandomSource){return m.randomBytes(w)}r.randomBytes=s;function c(w=r.defaultRandomSource){const m=s(4,w),_=(0,t.readUint32LE)(m);return(0,i.wipe)(m),_}r.randomUint32=c;const y="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function h(w,m=y,_=r.defaultRandomSource){if(m.length<2)throw new Error("randomString charset is too short");if(m.length>256)throw new Error("randomString charset is too long");let N="";const v=m.length,D=256-256%v;for(;w>0;){const P=s(Math.ceil(w*256/D),_);for(let O=0;O<P.length&&w>0;O++){const F=P[O];F<D&&(N+=m.charAt(F%v),w--)}(0,i.wipe)(P)}return N}r.randomString=h;function l(w,m=y,_=r.defaultRandomSource){const N=Math.ceil(w/(Math.log(m.length)/Math.LN2));return h(N,m,_)}r.randomStringForEntropy=l})(or);var ci={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=re,t=pt;r.DIGEST_LENGTH=32,r.BLOCK_SIZE=64;var i=function(){function h(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return h.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},h.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},h.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._temp),this.reset()},h.prototype.update=function(l,w){if(w===void 0&&(w=l.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var m=0;if(this._bytesHashed+=w,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&w>0;)this._buffer[this._bufferLength++]=l[m++],w--;this._bufferLength===this.blockSize&&(c(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(w>=this.blockSize&&(m=c(this._temp,this._state,l,m,w),w%=this.blockSize);w>0;)this._buffer[this._bufferLength++]=l[m++],w--;return this},h.prototype.finish=function(l){if(!this._finished){var w=this._bytesHashed,m=this._bufferLength,_=w/536870912|0,N=w<<3,v=w%64<56?64:128;this._buffer[m]=128;for(var D=m+1;D<v-8;D++)this._buffer[D]=0;e.writeUint32BE(_,this._buffer,v-8),e.writeUint32BE(N,this._buffer,v-4),c(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var D=0;D<this.digestLength/4;D++)e.writeUint32BE(this._state[D],l,D*4);return this},h.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},h.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},h.prototype.restoreState=function(l){return this._state.set(l.state),this._bufferLength=l.bufferLength,l.buffer&&this._buffer.set(l.buffer),this._bytesHashed=l.bytesHashed,this._finished=!1,this},h.prototype.cleanSavedState=function(l){t.wipe(l.state),l.buffer&&t.wipe(l.buffer),l.bufferLength=0,l.bytesHashed=0},h}();r.SHA256=i;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function c(h,l,w,m,_){for(;_>=64;){for(var N=l[0],v=l[1],D=l[2],P=l[3],O=l[4],F=l[5],o=l[6],d=l[7],u=0;u<16;u++){var f=m+u*4;h[u]=e.readUint32BE(w,f)}for(var u=16;u<64;u++){var g=h[u-2],n=(g>>>17|g<<32-17)^(g>>>19|g<<32-19)^g>>>10;g=h[u-15];var p=(g>>>7|g<<32-7)^(g>>>18|g<<32-18)^g>>>3;h[u]=(n+h[u-7]|0)+(p+h[u-16]|0)}for(var u=0;u<64;u++){var n=(((O>>>6|O<<26)^(O>>>11|O<<21)^(O>>>25|O<<7))+(O&F^~O&o)|0)+(d+(s[u]+h[u]|0)|0)|0,p=((N>>>2|N<<32-2)^(N>>>13|N<<32-13)^(N>>>22|N<<32-22))+(N&v^N&D^v&D)|0;d=o,o=F,F=O,O=P+n|0,P=D,D=v,v=N,N=n+p|0}l[0]+=N,l[1]+=v,l[2]+=D,l[3]+=P,l[4]+=O,l[5]+=F,l[6]+=o,l[7]+=d,m+=64,_-=64}return m}function y(h){var l=new i;l.update(h);var w=l.digest();return l.clean(),w}r.hash=y})(ci);var cs={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.sharedKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.scalarMultBase=r.scalarMult=r.SHARED_KEY_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=void 0;const e=or,t=pt;r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=32,r.SHARED_KEY_LENGTH=32;function i(u){const f=new Float64Array(16);if(u)for(let g=0;g<u.length;g++)f[g]=u[g];return f}const s=new Uint8Array(32);s[0]=9;const c=i([56129,1]);function y(u){let f=1;for(let g=0;g<16;g++){let n=u[g]+f+65535;f=Math.floor(n/65536),u[g]=n-f*65536}u[0]+=f-1+37*(f-1)}function h(u,f,g){const n=~(g-1);for(let p=0;p<16;p++){const U=n&(u[p]^f[p]);u[p]^=U,f[p]^=U}}function l(u,f){const g=i(),n=i();for(let p=0;p<16;p++)n[p]=f[p];y(n),y(n),y(n);for(let p=0;p<2;p++){g[0]=n[0]-65517;for(let j=1;j<15;j++)g[j]=n[j]-65535-(g[j-1]>>16&1),g[j-1]&=65535;g[15]=n[15]-32767-(g[14]>>16&1);const U=g[15]>>16&1;g[14]&=65535,h(n,g,1-U)}for(let p=0;p<16;p++)u[2*p]=n[p]&255,u[2*p+1]=n[p]>>8}function w(u,f){for(let g=0;g<16;g++)u[g]=f[2*g]+(f[2*g+1]<<8);u[15]&=32767}function m(u,f,g){for(let n=0;n<16;n++)u[n]=f[n]+g[n]}function _(u,f,g){for(let n=0;n<16;n++)u[n]=f[n]-g[n]}function N(u,f,g){let n,p,U=0,j=0,Y=0,J=0,X=0,A=0,T=0,k=0,H=0,$=0,L=0,M=0,q=0,ie=0,z=0,Z=0,W=0,oe=0,C=0,x=0,S=0,a=0,E=0,K=0,V=0,le=0,me=0,de=0,_e=0,Re=0,Ae=0,ye=g[0],pe=g[1],fe=g[2],he=g[3],ce=g[4],ae=g[5],ne=g[6],ee=g[7],ue=g[8],ge=g[9],te=g[10],be=g[11],we=g[12],ve=g[13],De=g[14],Ee=g[15];n=f[0],U+=n*ye,j+=n*pe,Y+=n*fe,J+=n*he,X+=n*ce,A+=n*ae,T+=n*ne,k+=n*ee,H+=n*ue,$+=n*ge,L+=n*te,M+=n*be,q+=n*we,ie+=n*ve,z+=n*De,Z+=n*Ee,n=f[1],j+=n*ye,Y+=n*pe,J+=n*fe,X+=n*he,A+=n*ce,T+=n*ae,k+=n*ne,H+=n*ee,$+=n*ue,L+=n*ge,M+=n*te,q+=n*be,ie+=n*we,z+=n*ve,Z+=n*De,W+=n*Ee,n=f[2],Y+=n*ye,J+=n*pe,X+=n*fe,A+=n*he,T+=n*ce,k+=n*ae,H+=n*ne,$+=n*ee,L+=n*ue,M+=n*ge,q+=n*te,ie+=n*be,z+=n*we,Z+=n*ve,W+=n*De,oe+=n*Ee,n=f[3],J+=n*ye,X+=n*pe,A+=n*fe,T+=n*he,k+=n*ce,H+=n*ae,$+=n*ne,L+=n*ee,M+=n*ue,q+=n*ge,ie+=n*te,z+=n*be,Z+=n*we,W+=n*ve,oe+=n*De,C+=n*Ee,n=f[4],X+=n*ye,A+=n*pe,T+=n*fe,k+=n*he,H+=n*ce,$+=n*ae,L+=n*ne,M+=n*ee,q+=n*ue,ie+=n*ge,z+=n*te,Z+=n*be,W+=n*we,oe+=n*ve,C+=n*De,x+=n*Ee,n=f[5],A+=n*ye,T+=n*pe,k+=n*fe,H+=n*he,$+=n*ce,L+=n*ae,M+=n*ne,q+=n*ee,ie+=n*ue,z+=n*ge,Z+=n*te,W+=n*be,oe+=n*we,C+=n*ve,x+=n*De,S+=n*Ee,n=f[6],T+=n*ye,k+=n*pe,H+=n*fe,$+=n*he,L+=n*ce,M+=n*ae,q+=n*ne,ie+=n*ee,z+=n*ue,Z+=n*ge,W+=n*te,oe+=n*be,C+=n*we,x+=n*ve,S+=n*De,a+=n*Ee,n=f[7],k+=n*ye,H+=n*pe,$+=n*fe,L+=n*he,M+=n*ce,q+=n*ae,ie+=n*ne,z+=n*ee,Z+=n*ue,W+=n*ge,oe+=n*te,C+=n*be,x+=n*we,S+=n*ve,a+=n*De,E+=n*Ee,n=f[8],H+=n*ye,$+=n*pe,L+=n*fe,M+=n*he,q+=n*ce,ie+=n*ae,z+=n*ne,Z+=n*ee,W+=n*ue,oe+=n*ge,C+=n*te,x+=n*be,S+=n*we,a+=n*ve,E+=n*De,K+=n*Ee,n=f[9],$+=n*ye,L+=n*pe,M+=n*fe,q+=n*he,ie+=n*ce,z+=n*ae,Z+=n*ne,W+=n*ee,oe+=n*ue,C+=n*ge,x+=n*te,S+=n*be,a+=n*we,E+=n*ve,K+=n*De,V+=n*Ee,n=f[10],L+=n*ye,M+=n*pe,q+=n*fe,ie+=n*he,z+=n*ce,Z+=n*ae,W+=n*ne,oe+=n*ee,C+=n*ue,x+=n*ge,S+=n*te,a+=n*be,E+=n*we,K+=n*ve,V+=n*De,le+=n*Ee,n=f[11],M+=n*ye,q+=n*pe,ie+=n*fe,z+=n*he,Z+=n*ce,W+=n*ae,oe+=n*ne,C+=n*ee,x+=n*ue,S+=n*ge,a+=n*te,E+=n*be,K+=n*we,V+=n*ve,le+=n*De,me+=n*Ee,n=f[12],q+=n*ye,ie+=n*pe,z+=n*fe,Z+=n*he,W+=n*ce,oe+=n*ae,C+=n*ne,x+=n*ee,S+=n*ue,a+=n*ge,E+=n*te,K+=n*be,V+=n*we,le+=n*ve,me+=n*De,de+=n*Ee,n=f[13],ie+=n*ye,z+=n*pe,Z+=n*fe,W+=n*he,oe+=n*ce,C+=n*ae,x+=n*ne,S+=n*ee,a+=n*ue,E+=n*ge,K+=n*te,V+=n*be,le+=n*we,me+=n*ve,de+=n*De,_e+=n*Ee,n=f[14],z+=n*ye,Z+=n*pe,W+=n*fe,oe+=n*he,C+=n*ce,x+=n*ae,S+=n*ne,a+=n*ee,E+=n*ue,K+=n*ge,V+=n*te,le+=n*be,me+=n*we,de+=n*ve,_e+=n*De,Re+=n*Ee,n=f[15],Z+=n*ye,W+=n*pe,oe+=n*fe,C+=n*he,x+=n*ce,S+=n*ae,a+=n*ne,E+=n*ee,K+=n*ue,V+=n*ge,le+=n*te,me+=n*be,de+=n*we,_e+=n*ve,Re+=n*De,Ae+=n*Ee,U+=38*W,j+=38*oe,Y+=38*C,J+=38*x,X+=38*S,A+=38*a,T+=38*E,k+=38*K,H+=38*V,$+=38*le,L+=38*me,M+=38*de,q+=38*_e,ie+=38*Re,z+=38*Ae,p=1,n=U+p+65535,p=Math.floor(n/65536),U=n-p*65536,n=j+p+65535,p=Math.floor(n/65536),j=n-p*65536,n=Y+p+65535,p=Math.floor(n/65536),Y=n-p*65536,n=J+p+65535,p=Math.floor(n/65536),J=n-p*65536,n=X+p+65535,p=Math.floor(n/65536),X=n-p*65536,n=A+p+65535,p=Math.floor(n/65536),A=n-p*65536,n=T+p+65535,p=Math.floor(n/65536),T=n-p*65536,n=k+p+65535,p=Math.floor(n/65536),k=n-p*65536,n=H+p+65535,p=Math.floor(n/65536),H=n-p*65536,n=$+p+65535,p=Math.floor(n/65536),$=n-p*65536,n=L+p+65535,p=Math.floor(n/65536),L=n-p*65536,n=M+p+65535,p=Math.floor(n/65536),M=n-p*65536,n=q+p+65535,p=Math.floor(n/65536),q=n-p*65536,n=ie+p+65535,p=Math.floor(n/65536),ie=n-p*65536,n=z+p+65535,p=Math.floor(n/65536),z=n-p*65536,n=Z+p+65535,p=Math.floor(n/65536),Z=n-p*65536,U+=p-1+37*(p-1),p=1,n=U+p+65535,p=Math.floor(n/65536),U=n-p*65536,n=j+p+65535,p=Math.floor(n/65536),j=n-p*65536,n=Y+p+65535,p=Math.floor(n/65536),Y=n-p*65536,n=J+p+65535,p=Math.floor(n/65536),J=n-p*65536,n=X+p+65535,p=Math.floor(n/65536),X=n-p*65536,n=A+p+65535,p=Math.floor(n/65536),A=n-p*65536,n=T+p+65535,p=Math.floor(n/65536),T=n-p*65536,n=k+p+65535,p=Math.floor(n/65536),k=n-p*65536,n=H+p+65535,p=Math.floor(n/65536),H=n-p*65536,n=$+p+65535,p=Math.floor(n/65536),$=n-p*65536,n=L+p+65535,p=Math.floor(n/65536),L=n-p*65536,n=M+p+65535,p=Math.floor(n/65536),M=n-p*65536,n=q+p+65535,p=Math.floor(n/65536),q=n-p*65536,n=ie+p+65535,p=Math.floor(n/65536),ie=n-p*65536,n=z+p+65535,p=Math.floor(n/65536),z=n-p*65536,n=Z+p+65535,p=Math.floor(n/65536),Z=n-p*65536,U+=p-1+37*(p-1),u[0]=U,u[1]=j,u[2]=Y,u[3]=J,u[4]=X,u[5]=A,u[6]=T,u[7]=k,u[8]=H,u[9]=$,u[10]=L,u[11]=M,u[12]=q,u[13]=ie,u[14]=z,u[15]=Z}function v(u,f){N(u,f,f)}function D(u,f){const g=i();for(let n=0;n<16;n++)g[n]=f[n];for(let n=253;n>=0;n--)v(g,g),n!==2&&n!==4&&N(g,g,f);for(let n=0;n<16;n++)u[n]=g[n]}function P(u,f){const g=new Uint8Array(32),n=new Float64Array(80),p=i(),U=i(),j=i(),Y=i(),J=i(),X=i();for(let H=0;H<31;H++)g[H]=u[H];g[31]=u[31]&127|64,g[0]&=248,w(n,f);for(let H=0;H<16;H++)U[H]=n[H];p[0]=Y[0]=1;for(let H=254;H>=0;--H){const $=g[H>>>3]>>>(H&7)&1;h(p,U,$),h(j,Y,$),m(J,p,j),_(p,p,j),m(j,U,Y),_(U,U,Y),v(Y,J),v(X,p),N(p,j,p),N(j,U,J),m(J,p,j),_(p,p,j),v(U,p),_(j,Y,X),N(p,j,c),m(p,p,Y),N(j,j,p),N(p,Y,X),N(Y,U,n),v(U,J),h(p,U,$),h(j,Y,$)}for(let H=0;H<16;H++)n[H+16]=p[H],n[H+32]=j[H],n[H+48]=U[H],n[H+64]=Y[H];const A=n.subarray(32),T=n.subarray(16);D(A,A),N(T,T,A);const k=new Uint8Array(32);return l(k,T),k}r.scalarMult=P;function O(u){return P(u,s)}r.scalarMultBase=O;function F(u){if(u.length!==r.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${r.SECRET_KEY_LENGTH} bytes`);const f=new Uint8Array(u);return{publicKey:O(f),secretKey:f}}r.generateKeyPairFromSeed=F;function o(u){const f=(0,e.randomBytes)(32,u),g=F(f);return(0,t.wipe)(f),g}r.generateKeyPair=o;function d(u,f,g=!1){if(u.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(f.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=P(u,f);if(g){let p=0;for(let U=0;U<n.length;U++)p|=n[U];if(p===0)throw new Error("X25519: invalid shared key")}return n}r.sharedKey=d})(cs);function hs(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function da(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?hs(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function ji(r,e){e||(e=r.reduce((s,c)=>s+c.length,0));const t=da(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return hs(t)}function Bc(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var c=r.charAt(s),y=c.charCodeAt(0);if(t[y]!==255)throw new TypeError(c+" is ambiguous");t[y]=s}var h=r.length,l=r.charAt(0),w=Math.log(h)/Math.log(256),m=Math.log(256)/Math.log(h);function _(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var P=0,O=0,F=0,o=D.length;F!==o&&D[F]===0;)F++,P++;for(var d=(o-F)*m+1>>>0,u=new Uint8Array(d);F!==o;){for(var f=D[F],g=0,n=d-1;(f!==0||g<O)&&n!==-1;n--,g++)f+=256*u[n]>>>0,u[n]=f%h>>>0,f=f/h>>>0;if(f!==0)throw new Error("Non-zero carry");O=g,F++}for(var p=d-O;p!==d&&u[p]===0;)p++;for(var U=l.repeat(P);p<d;++p)U+=r.charAt(u[p]);return U}function N(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var P=0;if(D[P]!==" "){for(var O=0,F=0;D[P]===l;)O++,P++;for(var o=(D.length-P)*w+1>>>0,d=new Uint8Array(o);D[P];){var u=t[D.charCodeAt(P)];if(u===255)return;for(var f=0,g=o-1;(u!==0||f<F)&&g!==-1;g--,f++)u+=h*d[g]>>>0,d[g]=u%256>>>0,u=u/256>>>0;if(u!==0)throw new Error("Non-zero carry");F=f,P++}if(D[P]!==" "){for(var n=o-F;n!==o&&d[n]===0;)n++;for(var p=new Uint8Array(O+(o-n)),U=O;n!==o;)p[U++]=d[n++];return p}}}function v(D){var P=N(D);if(P)return P;throw new Error(`Non-${e} character`)}return{encode:_,decodeUnsafe:N,decode:v}}var Vc=Bc,Gc=Vc;const kc=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Wc=r=>new TextEncoder().encode(r),Yc=r=>new TextDecoder().decode(r);class Jc{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Xc{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return pa(this,e)}}class Qc{constructor(e){this.decoders=e}or(e){return pa(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const pa=(r,e)=>new Qc({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Zc{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Jc(e,t,i),this.decoder=new Xc(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const hi=({name:r,prefix:e,encode:t,decode:i})=>new Zc(r,e,t,i),Ar=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Gc(t,e);return hi({prefix:r,name:e,encode:i,decode:c=>kc(s(c))})},eh=(r,e,t,i)=>{const s={};for(let m=0;m<e.length;++m)s[e[m]]=m;let c=r.length;for(;r[c-1]==="=";)--c;const y=new Uint8Array(c*t/8|0);let h=0,l=0,w=0;for(let m=0;m<c;++m){const _=s[r[m]];if(_===void 0)throw new SyntaxError(`Non-${i} character`);l=l<<t|_,h+=t,h>=8&&(h-=8,y[w++]=255&l>>h)}if(h>=t||255&l<<8-h)throw new SyntaxError("Unexpected end of data");return y},th=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let c="",y=0,h=0;for(let l=0;l<r.length;++l)for(h=h<<8|r[l],y+=8;y>t;)y-=t,c+=e[s&h>>y];if(y&&(c+=e[s&h<<t-y]),i)for(;c.length*t&7;)c+="=";return c},tt=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>hi({prefix:e,name:r,encode(s){return th(s,i,t)},decode(s){return eh(s,i,t,r)}}),rh=hi({prefix:"\0",name:"identity",encode:r=>Yc(r),decode:r=>Wc(r)}),ih=Object.freeze(Object.defineProperty({__proto__:null,identity:rh},Symbol.toStringTag,{value:"Module"})),sh=tt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),nh=Object.freeze(Object.defineProperty({__proto__:null,base2:sh},Symbol.toStringTag,{value:"Module"})),ah=tt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),oh=Object.freeze(Object.defineProperty({__proto__:null,base8:ah},Symbol.toStringTag,{value:"Module"})),ch=Ar({prefix:"9",name:"base10",alphabet:"0123456789"}),hh=Object.freeze(Object.defineProperty({__proto__:null,base10:ch},Symbol.toStringTag,{value:"Module"})),uh=tt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),lh=tt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),fh=Object.freeze(Object.defineProperty({__proto__:null,base16:uh,base16upper:lh},Symbol.toStringTag,{value:"Module"})),dh=tt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ph=tt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),gh=tt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),yh=tt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),mh=tt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),bh=tt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),wh=tt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),_h=tt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Eh=tt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),vh=Object.freeze(Object.defineProperty({__proto__:null,base32:dh,base32hex:mh,base32hexpad:wh,base32hexpadupper:_h,base32hexupper:bh,base32pad:gh,base32padupper:yh,base32upper:ph,base32z:Eh},Symbol.toStringTag,{value:"Module"})),Dh=Ar({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Sh=Ar({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ih=Object.freeze(Object.defineProperty({__proto__:null,base36:Dh,base36upper:Sh},Symbol.toStringTag,{value:"Module"})),Oh=Ar({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),xh=Ar({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ch=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Oh,base58flickr:xh},Symbol.toStringTag,{value:"Module"})),Nh=tt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Th=tt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ah=tt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ph=tt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Uh=Object.freeze(Object.defineProperty({__proto__:null,base64:Nh,base64pad:Th,base64url:Ah,base64urlpad:Ph},Symbol.toStringTag,{value:"Module"})),ga=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),Fh=ga.reduce((r,e,t)=>(r[t]=e,r),[]),Rh=ga.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function $h(r){return r.reduce((e,t)=>(e+=Fh[t],e),"")}function Lh(r){const e=[];for(const t of r){const i=Rh[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Mh=hi({prefix:"ðŸš€",name:"base256emoji",encode:$h,decode:Lh}),jh=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Mh},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Ms={...ih,...nh,...oh,...hh,...fh,...vh,...Ih,...Ch,...Uh,...jh};function ya(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const js=ya("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),mi=ya("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=da(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),ma={utf8:js,"utf-8":js,hex:Ms.base16,latin1:mi,ascii:mi,binary:mi,...Ms};function ct(r,e="utf8"){const t=ma[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?hs(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function ut(r,e="utf8"){const t=ma[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var Q={},bi={},gr={},Hs;function Hh(){if(Hs)return gr;Hs=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return gr.delay=r,gr}var Kt={},wi={},Bt={},qs;function qh(){return qs||(qs=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.ONE_THOUSAND=Bt.ONE_HUNDRED=void 0,Bt.ONE_HUNDRED=100,Bt.ONE_THOUSAND=1e3),Bt}var _i={},zs;function zh(){return zs||(zs=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365}(_i)),_i}var Ks;function ba(){return Ks||(Ks=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Et;e.__exportStar(qh(),r),e.__exportStar(zh(),r)}(wi)),wi}var Bs;function Kh(){if(Bs)return Kt;Bs=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.fromMiliseconds=Kt.toMiliseconds=void 0;const r=ba();function e(i){return i*r.ONE_THOUSAND}Kt.toMiliseconds=e;function t(i){return Math.floor(i/r.ONE_THOUSAND)}return Kt.fromMiliseconds=t,Kt}var Vs;function Bh(){return Vs||(Vs=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Et;e.__exportStar(Hh(),r),e.__exportStar(Kh(),r)}(bi)),bi}var rr={},Gs;function Vh(){if(Gs)return rr;Gs=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const i=this.get(t);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-i.started;this.timestamps.set(t,{started:i.started,elapsed:s})}get(t){const i=this.timestamps.get(t);if(typeof i>"u")throw new Error(`No timestamp found for label: ${t}`);return i}elapsed(t){const i=this.get(t);return i.elapsed||Date.now()-i.started}}return rr.Watch=r,rr.default=r,rr}var Ei={},yr={},ks;function Gh(){if(ks)return yr;ks=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.IWatch=void 0;class r{}return yr.IWatch=r,yr}var Ws;function kh(){return Ws||(Ws=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),Et.__exportStar(Gh(),r)}(Ei)),Ei}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Et;e.__exportStar(Bh(),r),e.__exportStar(Vh(),r),e.__exportStar(kh(),r),e.__exportStar(ba(),r)})(Q);var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.getLocalStorage=Ie.getLocalStorageOrThrow=Ie.getCrypto=Ie.getCryptoOrThrow=Ie.getLocation=Ie.getLocationOrThrow=Ie.getNavigator=Ie.getNavigatorOrThrow=Ie.getDocument=Ie.getDocumentOrThrow=Ie.getFromWindowOrThrow=Ie.getFromWindow=void 0;function Jt(r){let e;return typeof window<"u"&&typeof window[r]<"u"&&(e=window[r]),e}Ie.getFromWindow=Jt;function cr(r){const e=Jt(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}Ie.getFromWindowOrThrow=cr;function Wh(){return cr("document")}Ie.getDocumentOrThrow=Wh;function Yh(){return Jt("document")}Ie.getDocument=Yh;function Jh(){return cr("navigator")}Ie.getNavigatorOrThrow=Jh;function Xh(){return Jt("navigator")}Ie.getNavigator=Xh;function Qh(){return cr("location")}Ie.getLocationOrThrow=Qh;function Zh(){return Jt("location")}Ie.getLocation=Zh;function eu(){return cr("crypto")}Ie.getCryptoOrThrow=eu;function tu(){return Jt("crypto")}Ie.getCrypto=tu;function ru(){return cr("localStorage")}Ie.getLocalStorageOrThrow=ru;function iu(){return Jt("localStorage")}Ie.getLocalStorage=iu;var us={};Object.defineProperty(us,"__esModule",{value:!0});us.getWindowMetadata=void 0;const Ys=Ie;function su(){let r,e;try{r=Ys.getDocumentOrThrow(),e=Ys.getLocationOrThrow()}catch{return null}function t(){const _=r.getElementsByTagName("link"),N=[];for(let v=0;v<_.length;v++){const D=_[v],P=D.getAttribute("rel");if(P&&P.toLowerCase().indexOf("icon")>-1){const O=D.getAttribute("href");if(O)if(O.toLowerCase().indexOf("https:")===-1&&O.toLowerCase().indexOf("http:")===-1&&O.indexOf("//")!==0){let F=e.protocol+"//"+e.host;if(O.indexOf("/")===0)F+=O;else{const o=e.pathname.split("/");o.pop();const d=o.join("/");F+=d+"/"+O}N.push(F)}else if(O.indexOf("//")===0){const F=e.protocol+O;N.push(F)}else N.push(O)}}return N}function i(..._){const N=r.getElementsByTagName("meta");for(let v=0;v<N.length;v++){const D=N[v],P=["itemprop","property","name"].map(O=>D.getAttribute(O)).filter(O=>O?_.includes(O):!1);if(P.length&&P){const O=D.getAttribute("content");if(O)return O}}return""}function s(){let _=i("name","og:site_name","og:title","twitter:title");return _||(_=r.title),_}function c(){return i("description","og:description","twitter:description","keywords")}const y=s(),h=c(),l=e.origin,w=t();return{description:h,url:l,icons:w,name:y}}us.getWindowMetadata=su;var nu={},au=r=>encodeURIComponent(r).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`);(function(r){const e=au,t=ts,i=Zi,s=es,c=o=>o==null,y=Symbol("encodeFragmentIdentifier");function h(o){switch(o.arrayFormat){case"index":return d=>(u,f)=>{const g=u.length;return f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,[m(d,o),"[",g,"]"].join("")]:[...u,[m(d,o),"[",m(g,o),"]=",m(f,o)].join("")]};case"bracket":return d=>(u,f)=>f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,[m(d,o),"[]"].join("")]:[...u,[m(d,o),"[]=",m(f,o)].join("")];case"colon-list-separator":return d=>(u,f)=>f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,[m(d,o),":list="].join("")]:[...u,[m(d,o),":list=",m(f,o)].join("")];case"comma":case"separator":case"bracket-separator":{const d=o.arrayFormat==="bracket-separator"?"[]=":"=";return u=>(f,g)=>g===void 0||o.skipNull&&g===null||o.skipEmptyString&&g===""?f:(g=g===null?"":g,f.length===0?[[m(u,o),d,m(g,o)].join("")]:[[f,m(g,o)].join(o.arrayFormatSeparator)])}default:return d=>(u,f)=>f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,m(d,o)]:[...u,[m(d,o),"=",m(f,o)].join("")]}}function l(o){let d;switch(o.arrayFormat){case"index":return(u,f,g)=>{if(d=/\[(\d*)\]$/.exec(u),u=u.replace(/\[\d*\]$/,""),!d){g[u]=f;return}g[u]===void 0&&(g[u]={}),g[u][d[1]]=f};case"bracket":return(u,f,g)=>{if(d=/(\[\])$/.exec(u),u=u.replace(/\[\]$/,""),!d){g[u]=f;return}if(g[u]===void 0){g[u]=[f];return}g[u]=[].concat(g[u],f)};case"colon-list-separator":return(u,f,g)=>{if(d=/(:list)$/.exec(u),u=u.replace(/:list$/,""),!d){g[u]=f;return}if(g[u]===void 0){g[u]=[f];return}g[u]=[].concat(g[u],f)};case"comma":case"separator":return(u,f,g)=>{const n=typeof f=="string"&&f.includes(o.arrayFormatSeparator),p=typeof f=="string"&&!n&&_(f,o).includes(o.arrayFormatSeparator);f=p?_(f,o):f;const U=n||p?f.split(o.arrayFormatSeparator).map(j=>_(j,o)):f===null?f:_(f,o);g[u]=U};case"bracket-separator":return(u,f,g)=>{const n=/(\[\])$/.test(u);if(u=u.replace(/\[\]$/,""),!n){g[u]=f&&_(f,o);return}const p=f===null?[]:f.split(o.arrayFormatSeparator).map(U=>_(U,o));if(g[u]===void 0){g[u]=p;return}g[u]=[].concat(g[u],p)};default:return(u,f,g)=>{if(g[u]===void 0){g[u]=f;return}g[u]=[].concat(g[u],f)}}}function w(o){if(typeof o!="string"||o.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(o,d){return d.encode?d.strict?e(o):encodeURIComponent(o):o}function _(o,d){return d.decode?t(o):o}function N(o){return Array.isArray(o)?o.sort():typeof o=="object"?N(Object.keys(o)).sort((d,u)=>Number(d)-Number(u)).map(d=>o[d]):o}function v(o){const d=o.indexOf("#");return d!==-1&&(o=o.slice(0,d)),o}function D(o){let d="";const u=o.indexOf("#");return u!==-1&&(d=o.slice(u)),d}function P(o){o=v(o);const d=o.indexOf("?");return d===-1?"":o.slice(d+1)}function O(o,d){return d.parseNumbers&&!Number.isNaN(Number(o))&&typeof o=="string"&&o.trim()!==""?o=Number(o):d.parseBooleans&&o!==null&&(o.toLowerCase()==="true"||o.toLowerCase()==="false")&&(o=o.toLowerCase()==="true"),o}function F(o,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),w(d.arrayFormatSeparator);const u=l(d),f=Object.create(null);if(typeof o!="string"||(o=o.trim().replace(/^[?#&]/,""),!o))return f;for(const g of o.split("&")){if(g==="")continue;let[n,p]=i(d.decode?g.replace(/\+/g," "):g,"=");p=p===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?p:_(p,d),u(_(n,d),p,f)}for(const g of Object.keys(f)){const n=f[g];if(typeof n=="object"&&n!==null)for(const p of Object.keys(n))n[p]=O(n[p],d);else f[g]=O(n,d)}return d.sort===!1?f:(d.sort===!0?Object.keys(f).sort():Object.keys(f).sort(d.sort)).reduce((g,n)=>{const p=f[n];return Boolean(p)&&typeof p=="object"&&!Array.isArray(p)?g[n]=N(p):g[n]=p,g},Object.create(null))}r.extract=P,r.parse=F,r.stringify=(o,d)=>{if(!o)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),w(d.arrayFormatSeparator);const u=p=>d.skipNull&&c(o[p])||d.skipEmptyString&&o[p]==="",f=h(d),g={};for(const p of Object.keys(o))u(p)||(g[p]=o[p]);const n=Object.keys(g);return d.sort!==!1&&n.sort(d.sort),n.map(p=>{const U=o[p];return U===void 0?"":U===null?m(p,d):Array.isArray(U)?U.length===0&&d.arrayFormat==="bracket-separator"?m(p,d)+"[]":U.reduce(f(p),[]).join("&"):m(p,d)+"="+m(U,d)}).filter(p=>p.length>0).join("&")},r.parseUrl=(o,d)=>{d=Object.assign({decode:!0},d);const[u,f]=i(o,"#");return Object.assign({url:u.split("?")[0]||"",query:F(P(o),d)},d&&d.parseFragmentIdentifier&&f?{fragmentIdentifier:_(f,d)}:{})},r.stringifyUrl=(o,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const u=v(o.url).split("?")[0]||"",f=r.extract(o.url),g=r.parse(f,{sort:!1}),n=Object.assign(g,o.query);let p=r.stringify(n,d);p&&(p=`?${p}`);let U=D(o.url);return o.fragmentIdentifier&&(U=`#${d[y]?m(o.fragmentIdentifier,d):o.fragmentIdentifier}`),`${u}${p}${U}`},r.pick=(o,d,u)=>{u=Object.assign({parseFragmentIdentifier:!0,[y]:!1},u);const{url:f,query:g,fragmentIdentifier:n}=r.parseUrl(o,u);return r.stringifyUrl({url:f,query:s(g,d),fragmentIdentifier:n},u)},r.exclude=(o,d,u)=>{const f=Array.isArray(d)?g=>!d.includes(g):(g,n)=>!d(g,n);return r.pick(o,f,u)}})(nu);const ou={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function cu(r,e=[]){const t=[];return Object.keys(r).forEach(i=>{if(e.length&&!e.includes(i))return;const s=r[i];t.push(...s.accounts)}),t}const hu={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function uu(r,e){const{message:t,code:i}=hu[r];return{message:e?`${t} ${e}`:t,code:i}}function Hi(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}function lu(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}var fu=du;function du(r,e,t){var i=t&&t.stringify||lu,s=1;if(typeof r=="object"&&r!==null){var c=e.length+s;if(c===1)return r;var y=new Array(c);y[0]=i(r);for(var h=1;h<c;h++)y[h]=i(e[h]);return y.join(" ")}if(typeof r!="string")return r;var l=e.length;if(l===0)return r;for(var w="",m=1-s,_=-1,N=r&&r.length||0,v=0;v<N;){if(r.charCodeAt(v)===37&&v+1<N){switch(_=_>-1?_:0,r.charCodeAt(v+1)){case 100:case 102:if(m>=l||e[m]==null)break;_<v&&(w+=r.slice(_,v)),w+=Number(e[m]),_=v+2,v++;break;case 105:if(m>=l||e[m]==null)break;_<v&&(w+=r.slice(_,v)),w+=Math.floor(Number(e[m])),_=v+2,v++;break;case 79:case 111:case 106:if(m>=l||e[m]===void 0)break;_<v&&(w+=r.slice(_,v));var D=typeof e[m];if(D==="string"){w+="'"+e[m]+"'",_=v+2,v++;break}if(D==="function"){w+=e[m].name||"<anonymous>",_=v+2,v++;break}w+=i(e[m]),_=v+2,v++;break;case 115:if(m>=l)break;_<v&&(w+=r.slice(_,v)),w+=String(e[m]),_=v+2,v++;break;case 37:_<v&&(w+=r.slice(_,v)),w+="%",_=v+2,v++,m--;break}++m}++v}return _===-1?r:(_<N&&(w+=r.slice(_)),w)}const Js=fu;var Pr=xt;const Or=Du().console||{},pu={mapHttpRequest:Vr,mapHttpResponse:Vr,wrapRequestSerializer:vi,wrapResponseSerializer:vi,wrapErrorSerializer:vi,req:Vr,res:Vr,err:wu};function gu(r,e){return Array.isArray(r)?r.filter(function(i){return i!=="!stdSerializers.err"}):r===!0?Object.keys(e):!1}function xt(r){r=r||{},r.browser=r.browser||{};const e=r.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const t=r.browser.write||Or;r.browser.write&&(r.browser.asObject=!0);const i=r.serializers||{},s=gu(r.browser.serialize,i);let c=r.browser.serialize;Array.isArray(r.browser.serialize)&&r.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const y=["error","fatal","warn","info","debug","trace"];typeof t=="function"&&(t.error=t.fatal=t.warn=t.info=t.debug=t.trace=t),r.enabled===!1&&(r.level="silent");const h=r.level||"info",l=Object.create(t);l.log||(l.log=xr),Object.defineProperty(l,"levelVal",{get:m}),Object.defineProperty(l,"level",{get:_,set:N});const w={transmit:e,serialize:s,asObject:r.browser.asObject,levels:y,timestamp:_u(r)};l.levels=xt.levels,l.level=h,l.setMaxListeners=l.getMaxListeners=l.emit=l.addListener=l.on=l.prependListener=l.once=l.prependOnceListener=l.removeListener=l.removeAllListeners=l.listeners=l.listenerCount=l.eventNames=l.write=l.flush=xr,l.serializers=i,l._serialize=s,l._stdErrSerialize=c,l.child=v,e&&(l._logEvent=qi());function m(){return this.level==="silent"?1/0:this.levels.values[this.level]}function _(){return this._level}function N(D){if(D!=="silent"&&!this.levels.values[D])throw Error("unknown level "+D);this._level=D,ir(w,l,"error","log"),ir(w,l,"fatal","error"),ir(w,l,"warn","error"),ir(w,l,"info","log"),ir(w,l,"debug","log"),ir(w,l,"trace","log")}function v(D,P){if(!D)throw new Error("missing bindings for child Pino");P=P||{},s&&D.serializers&&(P.serializers=D.serializers);const O=P.serializers;if(s&&O){var F=Object.assign({},i,O),o=r.browser.serialize===!0?Object.keys(F):s;delete D.serializers,ui([D],o,F,this._stdErrSerialize)}function d(u){this._childLevel=(u._childLevel|0)+1,this.error=sr(u,D,"error"),this.fatal=sr(u,D,"fatal"),this.warn=sr(u,D,"warn"),this.info=sr(u,D,"info"),this.debug=sr(u,D,"debug"),this.trace=sr(u,D,"trace"),F&&(this.serializers=F,this._serialize=o),e&&(this._logEvent=qi([].concat(u._logEvent.bindings,D)))}return d.prototype=this,new d(this)}return l}xt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};xt.stdSerializers=pu;xt.stdTimeFunctions=Object.assign({},{nullTime:wa,epochTime:_a,unixTime:Eu,isoTime:vu});function ir(r,e,t,i){const s=Object.getPrototypeOf(e);e[t]=e.levelVal>e.levels.values[t]?xr:s[t]?s[t]:Or[t]||Or[i]||xr,yu(r,e,t)}function yu(r,e,t){!r.transmit&&e[t]===xr||(e[t]=function(i){return function(){const c=r.timestamp(),y=new Array(arguments.length),h=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Or?Or:this;for(var l=0;l<y.length;l++)y[l]=arguments[l];if(r.serialize&&!r.asObject&&ui(y,this._serialize,this.serializers,this._stdErrSerialize),r.asObject?i.call(h,mu(this,t,y,c)):i.apply(h,y),r.transmit){const w=r.transmit.level||e.level,m=xt.levels.values[w],_=xt.levels.values[t];if(_<m)return;bu(this,{ts:c,methodLevel:t,methodValue:_,transmitLevel:w,transmitValue:xt.levels.values[r.transmit.level||e.level],send:r.transmit.send,val:e.levelVal},y)}}}(e[t]))}function mu(r,e,t,i){r._serialize&&ui(t,r._serialize,r.serializers,r._stdErrSerialize);const s=t.slice();let c=s[0];const y={};i&&(y.time=i),y.level=xt.levels.values[e];let h=(r._childLevel|0)+1;if(h<1&&(h=1),c!==null&&typeof c=="object"){for(;h--&&typeof s[0]=="object";)Object.assign(y,s.shift());c=s.length?Js(s.shift(),s):void 0}else typeof c=="string"&&(c=Js(s.shift(),s));return c!==void 0&&(y.msg=c),y}function ui(r,e,t,i){for(const s in r)if(i&&r[s]instanceof Error)r[s]=xt.stdSerializers.err(r[s]);else if(typeof r[s]=="object"&&!Array.isArray(r[s]))for(const c in r[s])e&&e.indexOf(c)>-1&&c in t&&(r[s][c]=t[c](r[s][c]))}function sr(r,e,t){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var s=1;s<i.length;s++)i[s]=arguments[s-1];return r[t].apply(this,i)}}function bu(r,e,t){const i=e.send,s=e.ts,c=e.methodLevel,y=e.methodValue,h=e.val,l=r._logEvent.bindings;ui(t,r._serialize||Object.keys(r.serializers),r.serializers,r._stdErrSerialize===void 0?!0:r._stdErrSerialize),r._logEvent.ts=s,r._logEvent.messages=t.filter(function(w){return l.indexOf(w)===-1}),r._logEvent.level.label=c,r._logEvent.level.value=y,i(c,r._logEvent,h),r._logEvent=qi(l)}function qi(r){return{ts:0,messages:[],bindings:r||[],level:{label:"",value:0}}}function wu(r){const e={type:r.constructor.name,msg:r.message,stack:r.stack};for(const t in r)e[t]===void 0&&(e[t]=r[t]);return e}function _u(r){return typeof r.timestamp=="function"?r.timestamp:r.timestamp===!1?wa:_a}function Vr(){return{}}function vi(r){return r}function xr(){}function wa(){return!1}function _a(){return Date.now()}function Eu(){return Math.round(Date.now()/1e3)}function vu(){return new Date(Date.now()).toISOString()}function Du(){function r(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return r(self)||r(window)||r(this)||{}}}var li={},Ur={};Object.defineProperty(Ur,"__esModule",{value:!0});function Su(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return JSON.parse(r)}catch{return r}}Ur.safeJsonParse=Su;function Iu(r){return typeof r=="string"?r:JSON.stringify(r,(e,t)=>typeof t>"u"?null:t)}Ur.safeJsonStringify=Iu;var Zr={},Di={get exports(){return Zr},set exports(r){Zr=r}},Xs;function Ou(){return Xs||(Xs=1,function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Wt<"u"&&Wt.localStorage?Di.exports=Wt.localStorage:typeof window<"u"&&window.localStorage?Di.exports=window.localStorage:Di.exports=new e}()),Zr}var Si={},mr={},Qs;function xu(){if(Qs)return mr;Qs=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.IKeyValueStorage=void 0;class r{}return mr.IKeyValueStorage=r,mr}var br={},Zs;function Cu(){if(Zs)return br;Zs=1,Object.defineProperty(br,"__esModule",{value:!0}),br.parseEntry=void 0;const r=Ur;function e(t){var i;return[t[0],r.safeJsonParse((i=t[1])!==null&&i!==void 0?i:"")]}return br.parseEntry=e,br}var en;function Nu(){return en||(en=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Et;e.__exportStar(xu(),r),e.__exportStar(Cu(),r)}(Si)),Si}Object.defineProperty(li,"__esModule",{value:!0});li.KeyValueStorage=void 0;const nr=Et,tn=Ur,Tu=nr.__importDefault(Ou()),Au=Nu();class Ea{constructor(){this.localStorage=Tu.default}getKeys(){return nr.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return nr.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(Au.parseEntry)})}getItem(e){return nr.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(e);if(t!==null)return tn.safeJsonParse(t)})}setItem(e,t){return nr.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,tn.safeJsonStringify(t))})}removeItem(e){return nr.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}li.KeyValueStorage=Ea;var Pu=li.default=Ea,Fr={},wr={},Ii={},_r={};class Xt{}const Uu=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Xt},Symbol.toStringTag,{value:"Module"})),Fu=rc(Uu);var rn;function Ru(){if(rn)return _r;rn=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.IHeartBeat=void 0;const r=Fu;class e extends r.IEvents{constructor(i){super()}}return _r.IHeartBeat=e,_r}var sn;function va(){return sn||(sn=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),Et.__exportStar(Ru(),r)}(Ii)),Ii}var Oi={},Vt={},nn;function $u(){if(nn)return Vt;nn=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.HEARTBEAT_EVENTS=Vt.HEARTBEAT_INTERVAL=void 0;const r=Q;return Vt.HEARTBEAT_INTERVAL=r.FIVE_SECONDS,Vt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Vt}var an;function Da(){return an||(an=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),Et.__exportStar($u(),r)}(Oi)),Oi}var on;function Lu(){if(on)return wr;on=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.HeartBeat=void 0;const r=Et,e=dt,t=Q,i=va(),s=Da();class c extends i.IHeartBeat{constructor(h){super(h),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(h==null?void 0:h.interval)||s.HEARTBEAT_INTERVAL}static init(h){return r.__awaiter(this,void 0,void 0,function*(){const l=new c(h);return yield l.init(),l})}init(){return r.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(h,l){this.events.on(h,l)}once(h,l){this.events.once(h,l)}off(h,l){this.events.off(h,l)}removeListener(h,l){this.events.removeListener(h,l)}initialize(){return r.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return wr.HeartBeat=c,wr}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Et;e.__exportStar(Lu(),r),e.__exportStar(va(),r),e.__exportStar(Da(),r)})(Fr);var Se={},Gt={},cn;function Sa(){return cn||(cn=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.PINO_CUSTOM_CONTEXT_KEY=Gt.PINO_LOGGER_DEFAULTS=void 0,Gt.PINO_LOGGER_DEFAULTS={level:"info"},Gt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Gt}var nt={},hn;function Mu(){if(hn)return nt;hn=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.generateChildLogger=nt.formatChildLoggerContext=nt.getLoggerContext=nt.setBrowserLoggerContext=nt.getBrowserLoggerContext=nt.getDefaultLoggerOptions=void 0;const r=Sa();function e(h){return Object.assign(Object.assign({},h),{level:(h==null?void 0:h.level)||r.PINO_LOGGER_DEFAULTS.level})}nt.getDefaultLoggerOptions=e;function t(h,l=r.PINO_CUSTOM_CONTEXT_KEY){return h[l]||""}nt.getBrowserLoggerContext=t;function i(h,l,w=r.PINO_CUSTOM_CONTEXT_KEY){return h[w]=l,h}nt.setBrowserLoggerContext=i;function s(h,l=r.PINO_CUSTOM_CONTEXT_KEY){let w="";return typeof h.bindings>"u"?w=t(h,l):w=h.bindings().context||"",w}nt.getLoggerContext=s;function c(h,l,w=r.PINO_CUSTOM_CONTEXT_KEY){const m=s(h,w);return m.trim()?`${m}/${l}`:l}nt.formatChildLoggerContext=c;function y(h,l,w=r.PINO_CUSTOM_CONTEXT_KEY){const m=c(h,l,w),_=h.child({context:m});return i(_,m,w)}return nt.generateChildLogger=y,nt}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.pino=void 0;const e=Et,t=e.__importDefault(Pr);Object.defineProperty(r,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(Sa(),r),e.__exportStar(Mu(),r)})(Se);class ju extends Xt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let Hu=class extends Xt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}},qu=class{constructor(e,t){this.logger=e,this.core=t}},zu=class extends Xt{constructor(e,t){super(),this.relayer=e,this.logger=t}},Ku=class extends Xt{constructor(e){super()}},Bu=class{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}},Vu=class extends Xt{constructor(e,t){super(),this.relayer=e,this.logger=t}},Gu=class extends Xt{constructor(e,t){super(),this.core=e,this.logger=t}},ku=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},Wu=class{constructor(e){this.client=e}};function Yu(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return JSON.parse(r)}catch{return r}}function Ju(r){return typeof r=="string"?r:JSON.stringify(r)}var ls={},Ia={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=re,t=pt;r.DIGEST_LENGTH=64,r.BLOCK_SIZE=128;var i=function(){function h(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return h.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},h.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},h.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},h.prototype.update=function(l,w){if(w===void 0&&(w=l.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var m=0;if(this._bytesHashed+=w,this._bufferLength>0){for(;this._bufferLength<r.BLOCK_SIZE&&w>0;)this._buffer[this._bufferLength++]=l[m++],w--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(w>=this.blockSize&&(m=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,l,m,w),w%=this.blockSize);w>0;)this._buffer[this._bufferLength++]=l[m++],w--;return this},h.prototype.finish=function(l){if(!this._finished){var w=this._bytesHashed,m=this._bufferLength,_=w/536870912|0,N=w<<3,v=w%128<112?128:256;this._buffer[m]=128;for(var D=m+1;D<v-8;D++)this._buffer[D]=0;e.writeUint32BE(_,this._buffer,v-8),e.writeUint32BE(N,this._buffer,v-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var D=0;D<this.digestLength/8;D++)e.writeUint32BE(this._stateHi[D],l,D*8),e.writeUint32BE(this._stateLo[D],l,D*8+4);return this},h.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},h.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},h.prototype.restoreState=function(l){return this._stateHi.set(l.stateHi),this._stateLo.set(l.stateLo),this._bufferLength=l.bufferLength,l.buffer&&this._buffer.set(l.buffer),this._bytesHashed=l.bytesHashed,this._finished=!1,this},h.prototype.cleanSavedState=function(l){t.wipe(l.stateHi),t.wipe(l.stateLo),l.buffer&&t.wipe(l.buffer),l.bufferLength=0,l.bytesHashed=0},h}();r.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(h,l,w,m,_,N,v){for(var D=w[0],P=w[1],O=w[2],F=w[3],o=w[4],d=w[5],u=w[6],f=w[7],g=m[0],n=m[1],p=m[2],U=m[3],j=m[4],Y=m[5],J=m[6],X=m[7],A,T,k,H,$,L,M,q;v>=128;){for(var ie=0;ie<16;ie++){var z=8*ie+N;h[ie]=e.readUint32BE(_,z),l[ie]=e.readUint32BE(_,z+4)}for(var ie=0;ie<80;ie++){var Z=D,W=P,oe=O,C=F,x=o,S=d,a=u,E=f,K=g,V=n,le=p,me=U,de=j,_e=Y,Re=J,Ae=X;if(A=f,T=X,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=(o>>>14|j<<32-14)^(o>>>18|j<<32-18)^(j>>>41-32|o<<32-(41-32)),T=(j>>>14|o<<32-14)^(j>>>18|o<<32-18)^(o>>>41-32|j<<32-(41-32)),$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,A=o&d^~o&u,T=j&Y^~j&J,$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,A=s[ie*2],T=s[ie*2+1],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,A=h[ie%16],T=l[ie%16],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,k=M&65535|q<<16,H=$&65535|L<<16,A=k,T=H,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=(D>>>28|g<<32-28)^(g>>>34-32|D<<32-(34-32))^(g>>>39-32|D<<32-(39-32)),T=(g>>>28|D<<32-28)^(D>>>34-32|g<<32-(34-32))^(D>>>39-32|g<<32-(39-32)),$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,A=D&P^D&O^P&O,T=g&n^g&p^n&p,$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,E=M&65535|q<<16,Ae=$&65535|L<<16,A=C,T=me,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=k,T=H,$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,C=M&65535|q<<16,me=$&65535|L<<16,P=Z,O=W,F=oe,o=C,d=x,u=S,f=a,D=E,n=K,p=V,U=le,j=me,Y=de,J=_e,X=Re,g=Ae,ie%16===15)for(var z=0;z<16;z++)A=h[z],T=l[z],$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=h[(z+9)%16],T=l[(z+9)%16],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,k=h[(z+1)%16],H=l[(z+1)%16],A=(k>>>1|H<<32-1)^(k>>>8|H<<32-8)^k>>>7,T=(H>>>1|k<<32-1)^(H>>>8|k<<32-8)^(H>>>7|k<<32-7),$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,k=h[(z+14)%16],H=l[(z+14)%16],A=(k>>>19|H<<32-19)^(H>>>61-32|k<<32-(61-32))^k>>>6,T=(H>>>19|k<<32-19)^(k>>>61-32|H<<32-(61-32))^(H>>>6|k<<32-6),$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,h[z]=M&65535|q<<16,l[z]=$&65535|L<<16}A=D,T=g,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=w[0],T=m[0],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,w[0]=D=M&65535|q<<16,m[0]=g=$&65535|L<<16,A=P,T=n,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=w[1],T=m[1],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,w[1]=P=M&65535|q<<16,m[1]=n=$&65535|L<<16,A=O,T=p,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=w[2],T=m[2],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,w[2]=O=M&65535|q<<16,m[2]=p=$&65535|L<<16,A=F,T=U,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=w[3],T=m[3],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,w[3]=F=M&65535|q<<16,m[3]=U=$&65535|L<<16,A=o,T=j,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=w[4],T=m[4],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,w[4]=o=M&65535|q<<16,m[4]=j=$&65535|L<<16,A=d,T=Y,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=w[5],T=m[5],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,w[5]=d=M&65535|q<<16,m[5]=Y=$&65535|L<<16,A=u,T=J,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=w[6],T=m[6],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,w[6]=u=M&65535|q<<16,m[6]=J=$&65535|L<<16,A=f,T=X,$=T&65535,L=T>>>16,M=A&65535,q=A>>>16,A=w[7],T=m[7],$+=T&65535,L+=T>>>16,M+=A&65535,q+=A>>>16,L+=$>>>16,M+=L>>>16,q+=M>>>16,w[7]=f=M&65535|q<<16,m[7]=X=$&65535|L<<16,N+=128,v-=128}return N}function y(h){var l=new i;l.update(h);var w=l.digest();return l.clean(),w}r.hash=y})(Ia);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.convertSecretKeyToX25519=r.convertPublicKeyToX25519=r.verify=r.sign=r.extractPublicKeyFromSecretKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.SEED_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=r.SIGNATURE_LENGTH=void 0;const e=or,t=Ia,i=pt;r.SIGNATURE_LENGTH=64,r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=64,r.SEED_LENGTH=32;function s(C){const x=new Float64Array(16);if(C)for(let S=0;S<C.length;S++)x[S]=C[S];return x}const c=new Uint8Array(32);c[0]=9;const y=s(),h=s([1]),l=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),w=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),m=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),_=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(C,x){for(let S=0;S<16;S++)C[S]=x[S]|0}function D(C){let x=1;for(let S=0;S<16;S++){let a=C[S]+x+65535;x=Math.floor(a/65536),C[S]=a-x*65536}C[0]+=x-1+37*(x-1)}function P(C,x,S){const a=~(S-1);for(let E=0;E<16;E++){const K=a&(C[E]^x[E]);C[E]^=K,x[E]^=K}}function O(C,x){const S=s(),a=s();for(let E=0;E<16;E++)a[E]=x[E];D(a),D(a),D(a);for(let E=0;E<2;E++){S[0]=a[0]-65517;for(let V=1;V<15;V++)S[V]=a[V]-65535-(S[V-1]>>16&1),S[V-1]&=65535;S[15]=a[15]-32767-(S[14]>>16&1);const K=S[15]>>16&1;S[14]&=65535,P(a,S,1-K)}for(let E=0;E<16;E++)C[2*E]=a[E]&255,C[2*E+1]=a[E]>>8}function F(C,x){let S=0;for(let a=0;a<32;a++)S|=C[a]^x[a];return(1&S-1>>>8)-1}function o(C,x){const S=new Uint8Array(32),a=new Uint8Array(32);return O(S,C),O(a,x),F(S,a)}function d(C){const x=new Uint8Array(32);return O(x,C),x[0]&1}function u(C,x){for(let S=0;S<16;S++)C[S]=x[2*S]+(x[2*S+1]<<8);C[15]&=32767}function f(C,x,S){for(let a=0;a<16;a++)C[a]=x[a]+S[a]}function g(C,x,S){for(let a=0;a<16;a++)C[a]=x[a]-S[a]}function n(C,x,S){let a,E,K=0,V=0,le=0,me=0,de=0,_e=0,Re=0,Ae=0,ye=0,pe=0,fe=0,he=0,ce=0,ae=0,ne=0,ee=0,ue=0,ge=0,te=0,be=0,we=0,ve=0,De=0,Ee=0,wt=0,vt=0,At=0,lt=0,jt=0,fr=0,Mr=0,Le=S[0],Pe=S[1],Me=S[2],je=S[3],He=S[4],Ue=S[5],Ke=S[6],Be=S[7],Ve=S[8],Ge=S[9],ke=S[10],ze=S[11],qe=S[12],Ne=S[13],We=S[14],Ye=S[15];a=x[0],K+=a*Le,V+=a*Pe,le+=a*Me,me+=a*je,de+=a*He,_e+=a*Ue,Re+=a*Ke,Ae+=a*Be,ye+=a*Ve,pe+=a*Ge,fe+=a*ke,he+=a*ze,ce+=a*qe,ae+=a*Ne,ne+=a*We,ee+=a*Ye,a=x[1],V+=a*Le,le+=a*Pe,me+=a*Me,de+=a*je,_e+=a*He,Re+=a*Ue,Ae+=a*Ke,ye+=a*Be,pe+=a*Ve,fe+=a*Ge,he+=a*ke,ce+=a*ze,ae+=a*qe,ne+=a*Ne,ee+=a*We,ue+=a*Ye,a=x[2],le+=a*Le,me+=a*Pe,de+=a*Me,_e+=a*je,Re+=a*He,Ae+=a*Ue,ye+=a*Ke,pe+=a*Be,fe+=a*Ve,he+=a*Ge,ce+=a*ke,ae+=a*ze,ne+=a*qe,ee+=a*Ne,ue+=a*We,ge+=a*Ye,a=x[3],me+=a*Le,de+=a*Pe,_e+=a*Me,Re+=a*je,Ae+=a*He,ye+=a*Ue,pe+=a*Ke,fe+=a*Be,he+=a*Ve,ce+=a*Ge,ae+=a*ke,ne+=a*ze,ee+=a*qe,ue+=a*Ne,ge+=a*We,te+=a*Ye,a=x[4],de+=a*Le,_e+=a*Pe,Re+=a*Me,Ae+=a*je,ye+=a*He,pe+=a*Ue,fe+=a*Ke,he+=a*Be,ce+=a*Ve,ae+=a*Ge,ne+=a*ke,ee+=a*ze,ue+=a*qe,ge+=a*Ne,te+=a*We,be+=a*Ye,a=x[5],_e+=a*Le,Re+=a*Pe,Ae+=a*Me,ye+=a*je,pe+=a*He,fe+=a*Ue,he+=a*Ke,ce+=a*Be,ae+=a*Ve,ne+=a*Ge,ee+=a*ke,ue+=a*ze,ge+=a*qe,te+=a*Ne,be+=a*We,we+=a*Ye,a=x[6],Re+=a*Le,Ae+=a*Pe,ye+=a*Me,pe+=a*je,fe+=a*He,he+=a*Ue,ce+=a*Ke,ae+=a*Be,ne+=a*Ve,ee+=a*Ge,ue+=a*ke,ge+=a*ze,te+=a*qe,be+=a*Ne,we+=a*We,ve+=a*Ye,a=x[7],Ae+=a*Le,ye+=a*Pe,pe+=a*Me,fe+=a*je,he+=a*He,ce+=a*Ue,ae+=a*Ke,ne+=a*Be,ee+=a*Ve,ue+=a*Ge,ge+=a*ke,te+=a*ze,be+=a*qe,we+=a*Ne,ve+=a*We,De+=a*Ye,a=x[8],ye+=a*Le,pe+=a*Pe,fe+=a*Me,he+=a*je,ce+=a*He,ae+=a*Ue,ne+=a*Ke,ee+=a*Be,ue+=a*Ve,ge+=a*Ge,te+=a*ke,be+=a*ze,we+=a*qe,ve+=a*Ne,De+=a*We,Ee+=a*Ye,a=x[9],pe+=a*Le,fe+=a*Pe,he+=a*Me,ce+=a*je,ae+=a*He,ne+=a*Ue,ee+=a*Ke,ue+=a*Be,ge+=a*Ve,te+=a*Ge,be+=a*ke,we+=a*ze,ve+=a*qe,De+=a*Ne,Ee+=a*We,wt+=a*Ye,a=x[10],fe+=a*Le,he+=a*Pe,ce+=a*Me,ae+=a*je,ne+=a*He,ee+=a*Ue,ue+=a*Ke,ge+=a*Be,te+=a*Ve,be+=a*Ge,we+=a*ke,ve+=a*ze,De+=a*qe,Ee+=a*Ne,wt+=a*We,vt+=a*Ye,a=x[11],he+=a*Le,ce+=a*Pe,ae+=a*Me,ne+=a*je,ee+=a*He,ue+=a*Ue,ge+=a*Ke,te+=a*Be,be+=a*Ve,we+=a*Ge,ve+=a*ke,De+=a*ze,Ee+=a*qe,wt+=a*Ne,vt+=a*We,At+=a*Ye,a=x[12],ce+=a*Le,ae+=a*Pe,ne+=a*Me,ee+=a*je,ue+=a*He,ge+=a*Ue,te+=a*Ke,be+=a*Be,we+=a*Ve,ve+=a*Ge,De+=a*ke,Ee+=a*ze,wt+=a*qe,vt+=a*Ne,At+=a*We,lt+=a*Ye,a=x[13],ae+=a*Le,ne+=a*Pe,ee+=a*Me,ue+=a*je,ge+=a*He,te+=a*Ue,be+=a*Ke,we+=a*Be,ve+=a*Ve,De+=a*Ge,Ee+=a*ke,wt+=a*ze,vt+=a*qe,At+=a*Ne,lt+=a*We,jt+=a*Ye,a=x[14],ne+=a*Le,ee+=a*Pe,ue+=a*Me,ge+=a*je,te+=a*He,be+=a*Ue,we+=a*Ke,ve+=a*Be,De+=a*Ve,Ee+=a*Ge,wt+=a*ke,vt+=a*ze,At+=a*qe,lt+=a*Ne,jt+=a*We,fr+=a*Ye,a=x[15],ee+=a*Le,ue+=a*Pe,ge+=a*Me,te+=a*je,be+=a*He,we+=a*Ue,ve+=a*Ke,De+=a*Be,Ee+=a*Ve,wt+=a*Ge,vt+=a*ke,At+=a*ze,lt+=a*qe,jt+=a*Ne,fr+=a*We,Mr+=a*Ye,K+=38*ue,V+=38*ge,le+=38*te,me+=38*be,de+=38*we,_e+=38*ve,Re+=38*De,Ae+=38*Ee,ye+=38*wt,pe+=38*vt,fe+=38*At,he+=38*lt,ce+=38*jt,ae+=38*fr,ne+=38*Mr,E=1,a=K+E+65535,E=Math.floor(a/65536),K=a-E*65536,a=V+E+65535,E=Math.floor(a/65536),V=a-E*65536,a=le+E+65535,E=Math.floor(a/65536),le=a-E*65536,a=me+E+65535,E=Math.floor(a/65536),me=a-E*65536,a=de+E+65535,E=Math.floor(a/65536),de=a-E*65536,a=_e+E+65535,E=Math.floor(a/65536),_e=a-E*65536,a=Re+E+65535,E=Math.floor(a/65536),Re=a-E*65536,a=Ae+E+65535,E=Math.floor(a/65536),Ae=a-E*65536,a=ye+E+65535,E=Math.floor(a/65536),ye=a-E*65536,a=pe+E+65535,E=Math.floor(a/65536),pe=a-E*65536,a=fe+E+65535,E=Math.floor(a/65536),fe=a-E*65536,a=he+E+65535,E=Math.floor(a/65536),he=a-E*65536,a=ce+E+65535,E=Math.floor(a/65536),ce=a-E*65536,a=ae+E+65535,E=Math.floor(a/65536),ae=a-E*65536,a=ne+E+65535,E=Math.floor(a/65536),ne=a-E*65536,a=ee+E+65535,E=Math.floor(a/65536),ee=a-E*65536,K+=E-1+37*(E-1),E=1,a=K+E+65535,E=Math.floor(a/65536),K=a-E*65536,a=V+E+65535,E=Math.floor(a/65536),V=a-E*65536,a=le+E+65535,E=Math.floor(a/65536),le=a-E*65536,a=me+E+65535,E=Math.floor(a/65536),me=a-E*65536,a=de+E+65535,E=Math.floor(a/65536),de=a-E*65536,a=_e+E+65535,E=Math.floor(a/65536),_e=a-E*65536,a=Re+E+65535,E=Math.floor(a/65536),Re=a-E*65536,a=Ae+E+65535,E=Math.floor(a/65536),Ae=a-E*65536,a=ye+E+65535,E=Math.floor(a/65536),ye=a-E*65536,a=pe+E+65535,E=Math.floor(a/65536),pe=a-E*65536,a=fe+E+65535,E=Math.floor(a/65536),fe=a-E*65536,a=he+E+65535,E=Math.floor(a/65536),he=a-E*65536,a=ce+E+65535,E=Math.floor(a/65536),ce=a-E*65536,a=ae+E+65535,E=Math.floor(a/65536),ae=a-E*65536,a=ne+E+65535,E=Math.floor(a/65536),ne=a-E*65536,a=ee+E+65535,E=Math.floor(a/65536),ee=a-E*65536,K+=E-1+37*(E-1),C[0]=K,C[1]=V,C[2]=le,C[3]=me,C[4]=de,C[5]=_e,C[6]=Re,C[7]=Ae,C[8]=ye,C[9]=pe,C[10]=fe,C[11]=he,C[12]=ce,C[13]=ae,C[14]=ne,C[15]=ee}function p(C,x){n(C,x,x)}function U(C,x){const S=s();let a;for(a=0;a<16;a++)S[a]=x[a];for(a=253;a>=0;a--)p(S,S),a!==2&&a!==4&&n(S,S,x);for(a=0;a<16;a++)C[a]=S[a]}function j(C,x){const S=s();let a;for(a=0;a<16;a++)S[a]=x[a];for(a=250;a>=0;a--)p(S,S),a!==1&&n(S,S,x);for(a=0;a<16;a++)C[a]=S[a]}function Y(C,x){const S=s(),a=s(),E=s(),K=s(),V=s(),le=s(),me=s(),de=s(),_e=s();g(S,C[1],C[0]),g(_e,x[1],x[0]),n(S,S,_e),f(a,C[0],C[1]),f(_e,x[0],x[1]),n(a,a,_e),n(E,C[3],x[3]),n(E,E,w),n(K,C[2],x[2]),f(K,K,K),g(V,a,S),g(le,K,E),f(me,K,E),f(de,a,S),n(C[0],V,le),n(C[1],de,me),n(C[2],me,le),n(C[3],V,de)}function J(C,x,S){for(let a=0;a<4;a++)P(C[a],x[a],S)}function X(C,x){const S=s(),a=s(),E=s();U(E,x[2]),n(S,x[0],E),n(a,x[1],E),O(C,a),C[31]^=d(S)<<7}function A(C,x,S){v(C[0],y),v(C[1],h),v(C[2],h),v(C[3],y);for(let a=255;a>=0;--a){const E=S[a/8|0]>>(a&7)&1;J(C,x,E),Y(x,C),Y(C,C),J(C,x,E)}}function T(C,x){const S=[s(),s(),s(),s()];v(S[0],m),v(S[1],_),v(S[2],h),n(S[3],m,_),A(C,S,x)}function k(C){if(C.length!==r.SEED_LENGTH)throw new Error(`ed25519: seed must be ${r.SEED_LENGTH} bytes`);const x=(0,t.hash)(C);x[0]&=248,x[31]&=127,x[31]|=64;const S=new Uint8Array(32),a=[s(),s(),s(),s()];T(a,x),X(S,a);const E=new Uint8Array(64);return E.set(C),E.set(S,32),{publicKey:S,secretKey:E}}r.generateKeyPairFromSeed=k;function H(C){const x=(0,e.randomBytes)(32,C),S=k(x);return(0,i.wipe)(x),S}r.generateKeyPair=H;function $(C){if(C.length!==r.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${r.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(C.subarray(32))}r.extractPublicKeyFromSecretKey=$;const L=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function M(C,x){let S,a,E,K;for(a=63;a>=32;--a){for(S=0,E=a-32,K=a-12;E<K;++E)x[E]+=S-16*x[a]*L[E-(a-32)],S=Math.floor((x[E]+128)/256),x[E]-=S*256;x[E]+=S,x[a]=0}for(S=0,E=0;E<32;E++)x[E]+=S-(x[31]>>4)*L[E],S=x[E]>>8,x[E]&=255;for(E=0;E<32;E++)x[E]-=S*L[E];for(a=0;a<32;a++)x[a+1]+=x[a]>>8,C[a]=x[a]&255}function q(C){const x=new Float64Array(64);for(let S=0;S<64;S++)x[S]=C[S];for(let S=0;S<64;S++)C[S]=0;M(C,x)}function ie(C,x){const S=new Float64Array(64),a=[s(),s(),s(),s()],E=(0,t.hash)(C.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const K=new Uint8Array(64);K.set(E.subarray(32),32);const V=new t.SHA512;V.update(K.subarray(32)),V.update(x);const le=V.digest();V.clean(),q(le),T(a,le),X(K,a),V.reset(),V.update(K.subarray(0,32)),V.update(C.subarray(32)),V.update(x);const me=V.digest();q(me);for(let de=0;de<32;de++)S[de]=le[de];for(let de=0;de<32;de++)for(let _e=0;_e<32;_e++)S[de+_e]+=me[de]*E[_e];return M(K.subarray(32),S),K}r.sign=ie;function z(C,x){const S=s(),a=s(),E=s(),K=s(),V=s(),le=s(),me=s();return v(C[2],h),u(C[1],x),p(E,C[1]),n(K,E,l),g(E,E,C[2]),f(K,C[2],K),p(V,K),p(le,V),n(me,le,V),n(S,me,E),n(S,S,K),j(S,S),n(S,S,E),n(S,S,K),n(S,S,K),n(C[0],S,K),p(a,C[0]),n(a,a,K),o(a,E)&&n(C[0],C[0],N),p(a,C[0]),n(a,a,K),o(a,E)?-1:(d(C[0])===x[31]>>7&&g(C[0],y,C[0]),n(C[3],C[0],C[1]),0)}function Z(C,x,S){const a=new Uint8Array(32),E=[s(),s(),s(),s()],K=[s(),s(),s(),s()];if(S.length!==r.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${r.SIGNATURE_LENGTH} bytes`);if(z(K,C))return!1;const V=new t.SHA512;V.update(S.subarray(0,32)),V.update(C),V.update(x);const le=V.digest();return q(le),A(E,K,le),T(K,S.subarray(32)),Y(E,K),X(a,E),!F(S,a)}r.verify=Z;function W(C){let x=[s(),s(),s(),s()];if(z(x,C))throw new Error("Ed25519: invalid public key");let S=s(),a=s(),E=x[1];f(S,h,E),g(a,h,E),U(a,a),n(S,S,a);let K=new Uint8Array(32);return O(K,S),K}r.convertPublicKeyToX25519=W;function oe(C){const x=(0,t.hash)(C.subarray(0,32));x[0]&=248,x[31]&=127,x[31]|=64;const S=new Uint8Array(x.subarray(0,32));return(0,i.wipe)(x),S}r.convertSecretKeyToX25519=oe})(ls);const Xu="EdDSA",Qu="JWT",Oa=".",xa="base64url",Zu="utf8",el="utf8",tl=":",rl="did",il="key",un="base58btc",sl="z",nl="K36",al=32;function ol(r){return typeof r=="string"?r:JSON.stringify(r)}function ei(r){return ut(ct(ol(r),Zu),xa)}function Ca(r){const e=ct(nl,un),t=sl+ut(ji([e,r]),un);return[rl,il,t].join(tl)}function cl(r){return ut(r,xa)}function hl(r){return ct([ei(r.header),ei(r.payload)].join(Oa),el)}function ul(r){return[ei(r.header),ei(r.payload),cl(r.signature)].join(Oa)}function ln(r=or.randomBytes(al)){return ls.generateKeyPairFromSeed(r)}async function ll(r,e,t,i,s=Q.fromMiliseconds(Date.now())){const c={alg:Xu,typ:Qu},y=Ca(i.publicKey),h=s+t,l={iss:y,sub:r,aud:e,iat:s,exp:h},w=hl({header:c,payload:l}),m=ls.sign(i.secretKey,w);return ul({header:c,payload:l,signature:m})}var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.getLocalStorage=Oe.getLocalStorageOrThrow=Oe.getCrypto=Oe.getCryptoOrThrow=Ta=Oe.getLocation=Oe.getLocationOrThrow=fs=Oe.getNavigator=Oe.getNavigatorOrThrow=Na=Oe.getDocument=Oe.getDocumentOrThrow=Oe.getFromWindowOrThrow=Oe.getFromWindow=void 0;function Qt(r){let e;return typeof window<"u"&&typeof window[r]<"u"&&(e=window[r]),e}Oe.getFromWindow=Qt;function hr(r){const e=Qt(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}Oe.getFromWindowOrThrow=hr;function fl(){return hr("document")}Oe.getDocumentOrThrow=fl;function dl(){return Qt("document")}var Na=Oe.getDocument=dl;function pl(){return hr("navigator")}Oe.getNavigatorOrThrow=pl;function gl(){return Qt("navigator")}var fs=Oe.getNavigator=gl;function yl(){return hr("location")}Oe.getLocationOrThrow=yl;function ml(){return Qt("location")}var Ta=Oe.getLocation=ml;function bl(){return hr("crypto")}Oe.getCryptoOrThrow=bl;function wl(){return Qt("crypto")}Oe.getCrypto=wl;function _l(){return hr("localStorage")}Oe.getLocalStorageOrThrow=_l;function El(){return Qt("localStorage")}Oe.getLocalStorage=El;var ds={};Object.defineProperty(ds,"__esModule",{value:!0});var Aa=ds.getWindowMetadata=void 0;const fn=Oe;function vl(){let r,e;try{r=fn.getDocumentOrThrow(),e=fn.getLocationOrThrow()}catch{return null}function t(){const _=r.getElementsByTagName("link"),N=[];for(let v=0;v<_.length;v++){const D=_[v],P=D.getAttribute("rel");if(P&&P.toLowerCase().indexOf("icon")>-1){const O=D.getAttribute("href");if(O)if(O.toLowerCase().indexOf("https:")===-1&&O.toLowerCase().indexOf("http:")===-1&&O.indexOf("//")!==0){let F=e.protocol+"//"+e.host;if(O.indexOf("/")===0)F+=O;else{const o=e.pathname.split("/");o.pop();const d=o.join("/");F+=d+"/"+O}N.push(F)}else if(O.indexOf("//")===0){const F=e.protocol+O;N.push(F)}else N.push(O)}}return N}function i(..._){const N=r.getElementsByTagName("meta");for(let v=0;v<N.length;v++){const D=N[v],P=["itemprop","property","name"].map(O=>D.getAttribute(O)).filter(O=>O?_.includes(O):!1);if(P.length&&P){const O=D.getAttribute("content");if(O)return O}}return""}function s(){let _=i("name","og:site_name","og:title","twitter:title");return _||(_=r.title),_}function c(){return i("description","og:description","twitter:description","keywords")}const y=s(),h=c(),l=e.origin,w=t();return{description:h,url:l,icons:w,name:y}}Aa=ds.getWindowMetadata=vl;var Cr={},Dl=r=>encodeURIComponent(r).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`);(function(r){const e=Dl,t=ts,i=Zi,s=es,c=o=>o==null,y=Symbol("encodeFragmentIdentifier");function h(o){switch(o.arrayFormat){case"index":return d=>(u,f)=>{const g=u.length;return f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,[m(d,o),"[",g,"]"].join("")]:[...u,[m(d,o),"[",m(g,o),"]=",m(f,o)].join("")]};case"bracket":return d=>(u,f)=>f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,[m(d,o),"[]"].join("")]:[...u,[m(d,o),"[]=",m(f,o)].join("")];case"colon-list-separator":return d=>(u,f)=>f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,[m(d,o),":list="].join("")]:[...u,[m(d,o),":list=",m(f,o)].join("")];case"comma":case"separator":case"bracket-separator":{const d=o.arrayFormat==="bracket-separator"?"[]=":"=";return u=>(f,g)=>g===void 0||o.skipNull&&g===null||o.skipEmptyString&&g===""?f:(g=g===null?"":g,f.length===0?[[m(u,o),d,m(g,o)].join("")]:[[f,m(g,o)].join(o.arrayFormatSeparator)])}default:return d=>(u,f)=>f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,m(d,o)]:[...u,[m(d,o),"=",m(f,o)].join("")]}}function l(o){let d;switch(o.arrayFormat){case"index":return(u,f,g)=>{if(d=/\[(\d*)\]$/.exec(u),u=u.replace(/\[\d*\]$/,""),!d){g[u]=f;return}g[u]===void 0&&(g[u]={}),g[u][d[1]]=f};case"bracket":return(u,f,g)=>{if(d=/(\[\])$/.exec(u),u=u.replace(/\[\]$/,""),!d){g[u]=f;return}if(g[u]===void 0){g[u]=[f];return}g[u]=[].concat(g[u],f)};case"colon-list-separator":return(u,f,g)=>{if(d=/(:list)$/.exec(u),u=u.replace(/:list$/,""),!d){g[u]=f;return}if(g[u]===void 0){g[u]=[f];return}g[u]=[].concat(g[u],f)};case"comma":case"separator":return(u,f,g)=>{const n=typeof f=="string"&&f.includes(o.arrayFormatSeparator),p=typeof f=="string"&&!n&&_(f,o).includes(o.arrayFormatSeparator);f=p?_(f,o):f;const U=n||p?f.split(o.arrayFormatSeparator).map(j=>_(j,o)):f===null?f:_(f,o);g[u]=U};case"bracket-separator":return(u,f,g)=>{const n=/(\[\])$/.test(u);if(u=u.replace(/\[\]$/,""),!n){g[u]=f&&_(f,o);return}const p=f===null?[]:f.split(o.arrayFormatSeparator).map(U=>_(U,o));if(g[u]===void 0){g[u]=p;return}g[u]=[].concat(g[u],p)};default:return(u,f,g)=>{if(g[u]===void 0){g[u]=f;return}g[u]=[].concat(g[u],f)}}}function w(o){if(typeof o!="string"||o.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(o,d){return d.encode?d.strict?e(o):encodeURIComponent(o):o}function _(o,d){return d.decode?t(o):o}function N(o){return Array.isArray(o)?o.sort():typeof o=="object"?N(Object.keys(o)).sort((d,u)=>Number(d)-Number(u)).map(d=>o[d]):o}function v(o){const d=o.indexOf("#");return d!==-1&&(o=o.slice(0,d)),o}function D(o){let d="";const u=o.indexOf("#");return u!==-1&&(d=o.slice(u)),d}function P(o){o=v(o);const d=o.indexOf("?");return d===-1?"":o.slice(d+1)}function O(o,d){return d.parseNumbers&&!Number.isNaN(Number(o))&&typeof o=="string"&&o.trim()!==""?o=Number(o):d.parseBooleans&&o!==null&&(o.toLowerCase()==="true"||o.toLowerCase()==="false")&&(o=o.toLowerCase()==="true"),o}function F(o,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),w(d.arrayFormatSeparator);const u=l(d),f=Object.create(null);if(typeof o!="string"||(o=o.trim().replace(/^[?#&]/,""),!o))return f;for(const g of o.split("&")){if(g==="")continue;let[n,p]=i(d.decode?g.replace(/\+/g," "):g,"=");p=p===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?p:_(p,d),u(_(n,d),p,f)}for(const g of Object.keys(f)){const n=f[g];if(typeof n=="object"&&n!==null)for(const p of Object.keys(n))n[p]=O(n[p],d);else f[g]=O(n,d)}return d.sort===!1?f:(d.sort===!0?Object.keys(f).sort():Object.keys(f).sort(d.sort)).reduce((g,n)=>{const p=f[n];return Boolean(p)&&typeof p=="object"&&!Array.isArray(p)?g[n]=N(p):g[n]=p,g},Object.create(null))}r.extract=P,r.parse=F,r.stringify=(o,d)=>{if(!o)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),w(d.arrayFormatSeparator);const u=p=>d.skipNull&&c(o[p])||d.skipEmptyString&&o[p]==="",f=h(d),g={};for(const p of Object.keys(o))u(p)||(g[p]=o[p]);const n=Object.keys(g);return d.sort!==!1&&n.sort(d.sort),n.map(p=>{const U=o[p];return U===void 0?"":U===null?m(p,d):Array.isArray(U)?U.length===0&&d.arrayFormat==="bracket-separator"?m(p,d)+"[]":U.reduce(f(p),[]).join("&"):m(p,d)+"="+m(U,d)}).filter(p=>p.length>0).join("&")},r.parseUrl=(o,d)=>{d=Object.assign({decode:!0},d);const[u,f]=i(o,"#");return Object.assign({url:u.split("?")[0]||"",query:F(P(o),d)},d&&d.parseFragmentIdentifier&&f?{fragmentIdentifier:_(f,d)}:{})},r.stringifyUrl=(o,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const u=v(o.url).split("?")[0]||"",f=r.extract(o.url),g=r.parse(f,{sort:!1}),n=Object.assign(g,o.query);let p=r.stringify(n,d);p&&(p=`?${p}`);let U=D(o.url);return o.fragmentIdentifier&&(U=`#${d[y]?m(o.fragmentIdentifier,d):o.fragmentIdentifier}`),`${u}${p}${U}`},r.pick=(o,d,u)=>{u=Object.assign({parseFragmentIdentifier:!0,[y]:!1},u);const{url:f,query:g,fragmentIdentifier:n}=r.parseUrl(o,u);return r.stringifyUrl({url:f,query:s(g,d),fragmentIdentifier:n},u)},r.exclude=(o,d,u)=>{const f=Array.isArray(d)?g=>!d.includes(g):(g,n)=>!d(g,n);return r.pick(o,f,u)}})(Cr);function Pa(r,e){return r.includes(":")?[r]:e.chains||[]}const Ua="base10",ht="base16",zi="base64pad",ps="utf8",Fa=0,Zt=1,Sl=0,dn=1,Ki=12,gs=32;function Il(){const r=cs.generateKeyPair();return{privateKey:ut(r.secretKey,ht),publicKey:ut(r.publicKey,ht)}}function Bi(){const r=or.randomBytes(gs);return ut(r,ht)}function Ol(r,e){const t=cs.sharedKey(ct(r,ht),ct(e,ht)),i=new $c(ci.SHA256,t).expand(gs);return ut(i,ht)}function xl(r){const e=ci.hash(ct(r,ht));return ut(e,ht)}function ti(r){const e=ci.hash(ct(r,ps));return ut(e,ht)}function Cl(r){return ct(`${r}`,Ua)}function Rr(r){return Number(ut(r,Ua))}function Nl(r){const e=Cl(typeof r.type<"u"?r.type:Fa);if(Rr(e)===Zt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?ct(r.senderPublicKey,ht):void 0,i=typeof r.iv<"u"?ct(r.iv,ht):or.randomBytes(Ki),s=new as.ChaCha20Poly1305(ct(r.symKey,ht)).seal(i,ct(r.message,ps));return Al({type:e,sealed:s,iv:i,senderPublicKey:t})}function Tl(r){const e=new as.ChaCha20Poly1305(ct(r.symKey,ht)),{sealed:t,iv:i}=ys(r.encoded),s=e.open(i,t);if(s===null)throw new Error("Failed to decrypt");return ut(s,ps)}function Al(r){if(Rr(r.type)===Zt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ut(ji([r.type,r.senderPublicKey,r.iv,r.sealed]),zi)}return ut(ji([r.type,r.iv,r.sealed]),zi)}function ys(r){const e=ct(r,zi),t=e.slice(Sl,dn),i=dn;if(Rr(t)===Zt){const h=i+gs,l=h+Ki,w=e.slice(i,h),m=e.slice(h,l),_=e.slice(l);return{type:t,sealed:_,iv:m,senderPublicKey:w}}const s=i+Ki,c=e.slice(i,s),y=e.slice(s);return{type:t,sealed:y,iv:c}}function Pl(r,e){const t=ys(r);return Ra({type:Rr(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?ut(t.senderPublicKey,ht):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Ra(r){const e=(r==null?void 0:r.type)||Fa;if(e===Zt){if(typeof(r==null?void 0:r.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(r==null?void 0:r.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r==null?void 0:r.senderPublicKey,receiverPublicKey:r==null?void 0:r.receiverPublicKey}}function pn(r){return r.type===Zt&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}var Ul=Object.defineProperty,gn=Object.getOwnPropertySymbols,Fl=Object.prototype.hasOwnProperty,Rl=Object.prototype.propertyIsEnumerable,yn=(r,e,t)=>e in r?Ul(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mn=(r,e)=>{for(var t in e||(e={}))Fl.call(e,t)&&yn(r,t,e[t]);if(gn)for(var t of gn(e))Rl.call(e,t)&&yn(r,t,e[t]);return r};const $l="ReactNative",Sr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Ll="js";function $a(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ml(){return!Na()&&!!fs()&&navigator.product===$l}function jl(){return!$a()&&!!fs()}function Hl(){return Ml()?Sr.reactNative:$a()?Sr.node:jl()?Sr.browser:Sr.unknown}function ql(r,e){let t=Cr.parse(r);return t=mn(mn({},t),e),r=Cr.stringify(t),r}function zl(){return Aa()||{name:"",description:"",url:"",icons:[""]}}function Kl(){const r=Xo();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function Bl(){var r;const e=Hl();return e===Sr.browser?[e,((r=Ta())==null?void 0:r.host)||"unknown"].join(":"):e}function Vl(r,e,t){const i=Kl(),s=Bl();return[[r,e].join("-"),[Ll,t].join("-"),i,s].join("/")}function Gl({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:s,projectId:c}){const y=t.split("?"),h=Vl(r,e,i),l={auth:s,ua:h,projectId:c},w=ql(y[1]||"",l);return y[0]+"?"+w}function Yt(r,e){return r.filter(t=>e.includes(t)).length===r.length}function La(r){return Object.fromEntries(r.entries())}function Ma(r){return new Map(Object.entries(r))}function kt(r=Q.FIVE_MINUTES,e){const t=Q.toMiliseconds(r||Q.FIVE_MINUTES);let i,s,c;return{resolve:y=>{c&&i&&(clearTimeout(c),i(y))},reject:y=>{c&&s&&(clearTimeout(c),s(y))},done:()=>new Promise((y,h)=>{c=setTimeout(()=>{h(new Error(e))},t),i=y,s=h})}}function Vi(r,e){return new Promise(async(t,i)=>{const s=setTimeout(()=>i(),e),c=await r;clearTimeout(s),t(c)})}function ja(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function kl(r){return ja("topic",r)}function Wl(r){return ja("id",r)}function Ha(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function Ot(r,e){return Q.fromMiliseconds((e||Date.now())+Q.toMiliseconds(r))}function $t(r){return Date.now()>=Q.toMiliseconds(r)}function $e(r,e){return`${r}${e?`:${e}`:""}`}const Yl="irn";function Gi(r){return(r==null?void 0:r.relay)||{protocol:Yl}}function Yr(r){const e=ou[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}var Jl=Object.defineProperty,bn=Object.getOwnPropertySymbols,Xl=Object.prototype.hasOwnProperty,Ql=Object.prototype.propertyIsEnumerable,wn=(r,e,t)=>e in r?Jl(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Zl=(r,e)=>{for(var t in e||(e={}))Xl.call(e,t)&&wn(r,t,e[t]);if(bn)for(var t of bn(e))Ql.call(e,t)&&wn(r,t,e[t]);return r};function ef(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(i)){const c=s.replace(i,""),y=r[s];t[c]=y}}),t}function tf(r){const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),s=r.substring(e+1,t).split("@"),c=typeof t<"u"?r.substring(t):"",y=Cr.parse(c);return{protocol:i,topic:s[0],version:parseInt(s[1],10),symKey:y.symKey,relay:ef(y)}}function rf(r,e="-"){const t="relay",i={};return Object.keys(r).forEach(s=>{const c=t+e+s;r[s]&&(i[c]=r[s])}),i}function sf(r){return`${r.protocol}:${r.topic}@${r.version}?`+Cr.stringify(Zl({symKey:r.symKey},rf(r.relay)))}function ur(r){const e=[];return r.forEach(t=>{const[i,s]=t.split(":");e.push(`${i}:${s}`)}),e}function nf(r){const e=[];return Object.values(r).forEach(t=>{e.push(...ur(t.accounts))}),e}function af(r,e){const t=[];return Object.values(r).forEach(i=>{ur(i.accounts).includes(e)&&t.push(...i.methods)}),t}function of(r,e){const t=[];return Object.values(r).forEach(i=>{ur(i.accounts).includes(e)&&t.push(...i.events)}),t}function cf(r,e){const t=Jr(r,e);if(t)throw new Error(t.message);const i={};for(const[s,c]of Object.entries(r))i[s]={methods:c.methods,events:c.events,chains:c.accounts.map(y=>`${y.split(":")[0]}:${y.split(":")[1]}`)};return i}const hf={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},uf={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function B(r,e){const{message:t,code:i}=uf[r];return{message:e?`${t} ${e}`:t,code:i}}function Qe(r,e){const{message:t,code:i}=hf[r];return{message:e?`${t} ${e}`:t,code:i}}function fi(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}function Ir(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function at(r){return typeof r>"u"}function Ze(r,e){return e&&at(r)?!0:typeof r=="string"&&Boolean(r.trim().length)}function ms(r,e){return e&&at(r)?!0:typeof r=="number"&&!isNaN(r)}function lf(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),s=Object.keys(t);let c=!0;return Yt(s,i)?(i.forEach(y=>{const{accounts:h,methods:l,events:w}=r.namespaces[y],m=ur(h),_=t[y];(!Yt(Pa(y,_),m)||!Yt(_.methods,l)||!Yt(_.events,w))&&(c=!1)}),c):!1}function bs(r){return Ze(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function ff(r){if(Ze(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&bs(t)}}return!1}function df(r){if(Ze(r,!1))try{return typeof new URL(r)<"u"}catch{return!1}return!1}function pf(r){var e;return(e=r==null?void 0:r.proposer)==null?void 0:e.publicKey}function gf(r){return r==null?void 0:r.topic}function yf(r,e){let t=null;return Ze(r==null?void 0:r.publicKey,!1)||(t=B("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function _n(r){let e=!0;return fi(r)?r.length&&(e=r.every(t=>Ze(t,!1))):e=!1,e}function mf(r,e,t){let i=null;return fi(e)?e.forEach(s=>{i||(!bs(s)||!s.includes(r))&&(i=Qe("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):i=Qe("UNSUPPORTED_CHAINS",`${t}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function bf(r,e){let t=null;return Object.entries(r).forEach(([i,s])=>{if(t)return;const c=mf(i,Pa(i,s),`${e} requiredNamespace`);c&&(t=c)}),t}function wf(r,e){let t=null;return fi(r)?r.forEach(i=>{t||ff(i)||(t=Qe("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=Qe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function _f(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=wf(i==null?void 0:i.accounts,`${e} namespace`);s&&(t=s)}),t}function Ef(r,e){let t=null;return _n(r==null?void 0:r.methods)?_n(r==null?void 0:r.events)||(t=Qe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=Qe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function qa(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=Ef(i,`${e}, namespace`);s&&(t=s)}),t}function vf(r,e,t){let i=null;if(r&&Ir(r)){const s=qa(r,e);s&&(i=s);const c=bf(r,e);c&&(i=c)}else i=B("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return i}function Jr(r,e){let t=null;if(r&&Ir(r)){const i=qa(r,e);i&&(t=i);const s=_f(r,e);s&&(t=s)}else t=B("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function za(r){return Ze(r.protocol,!0)}function Df(r,e){let t=!1;return e&&!r?t=!0:r&&fi(r)&&r.length&&r.forEach(i=>{t=za(i)}),t}function Sf(r){return typeof r=="number"}function ot(r){return typeof r<"u"&&typeof r!==null}function If(r){return!(!r||typeof r!="object"||!r.code||!ms(r.code,!1)||!r.message||!Ze(r.message,!1))}function Of(r){return!(at(r)||!Ze(r.method,!1))}function xf(r){return!(at(r)||at(r.result)&&at(r.error)||!ms(r.id,!1)||!Ze(r.jsonrpc,!1))}function Cf(r){return!(at(r)||!Ze(r.name,!1))}function En(r,e){return!(!bs(e)||!nf(r).includes(e))}function Nf(r,e,t){return Ze(t,!1)?af(r,e).includes(t):!1}function Tf(r,e,t){return Ze(t,!1)?of(r,e).includes(t):!1}function vn(r,e,t){let i=null;const s=Af(r),c=Pf(e),y=Object.keys(s),h=Object.keys(c),l=Dn(Object.keys(r)),w=Dn(Object.keys(e)),m=l.filter(_=>!w.includes(_));return m.length&&(i=B("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${m.toString()}
      Received: ${Object.keys(e).toString()}`)),Yt(y,h)||(i=B("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${y.toString()}
      Approved: ${h.toString()}`)),Object.keys(e).forEach(_=>{if(!_.includes(":")||i)return;const N=ur(e[_].accounts);N.includes(_)||(i=B("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${_}
        Required: ${_}
        Approved: ${N.toString()}`))}),y.forEach(_=>{i||(Yt(s[_].methods,c[_].methods)?Yt(s[_].events,c[_].events)||(i=B("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${_}`)):i=B("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${_}`))}),i}function Af(r){const e={};return Object.keys(r).forEach(t=>{var i;t.includes(":")?e[t]=r[t]:(i=r[t].chains)==null||i.forEach(s=>{e[s]={methods:r[t].methods,events:r[t].events}})}),e}function Dn(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Pf(r){const e={};return Object.keys(r).forEach(t=>{if(t.includes(":"))e[t]=r[t];else{const i=ur(r[t].accounts);i==null||i.forEach(s=>{e[s]={accounts:r[t].accounts.filter(c=>c.includes(`${s}:`)),methods:r[t].methods,events:r[t].events}})}}),e}function Uf(r,e){return ms(r,!1)&&r<=e.max&&r>=e.min}function Ff(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return JSON.parse(r)}catch{return r}}function Rf(r){return typeof r=="string"?r:JSON.stringify(r)}const Sn=10,$f=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),Lf=()=>typeof window<"u",Mf=$f();class jf{constructor(e){if(this.url=e,this.events=new dt.EventEmitter,this.registering=!1,!Fs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e,t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Rf(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!Fs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const s=Qo.isReactNative()?void 0:{rejectUnauthorized:!Zo(e)},c=new Mf(e,[],s);Lf()?c.onerror=y=>{const h=y;i(this.emitError(h.error))}:c.on("error",y=>{i(this.emitError(y))}),c.onopen=()=>{this.onOpen(c),t(c)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Ff(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),c=rs(e,s);this.events.emit("payload",c)}parseError(e,t=this.url){return ec(e,t,"WS")}resetMaxListeners(){this.events.getMaxListeners()>Sn&&this.events.setMaxListeners(Sn)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",t),t}}var ri={},Hf={get exports(){return ri},set exports(r){ri=r}};(function(r,e){var t=200,i="__lodash_hash_undefined__",s=1,c=2,y=9007199254740991,h="[object Arguments]",l="[object Array]",w="[object AsyncFunction]",m="[object Boolean]",_="[object Date]",N="[object Error]",v="[object Function]",D="[object GeneratorFunction]",P="[object Map]",O="[object Number]",F="[object Null]",o="[object Object]",d="[object Promise]",u="[object Proxy]",f="[object RegExp]",g="[object Set]",n="[object String]",p="[object Symbol]",U="[object Undefined]",j="[object WeakMap]",Y="[object ArrayBuffer]",J="[object DataView]",X="[object Float32Array]",A="[object Float64Array]",T="[object Int8Array]",k="[object Int16Array]",H="[object Int32Array]",$="[object Uint8Array]",L="[object Uint8ClampedArray]",M="[object Uint16Array]",q="[object Uint32Array]",ie=/[\\^$.*+?()[\]{}|]/g,z=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,W={};W[X]=W[A]=W[T]=W[k]=W[H]=W[$]=W[L]=W[M]=W[q]=!0,W[h]=W[l]=W[Y]=W[m]=W[J]=W[_]=W[N]=W[v]=W[P]=W[O]=W[o]=W[f]=W[g]=W[n]=W[j]=!1;var oe=typeof Wt=="object"&&Wt&&Wt.Object===Object&&Wt,C=typeof self=="object"&&self&&self.Object===Object&&self,x=oe||C||Function("return this")(),S=e&&!e.nodeType&&e,a=S&&!0&&r&&!r.nodeType&&r,E=a&&a.exports===S,K=E&&oe.process,V=function(){try{return K&&K.binding&&K.binding("util")}catch{}}(),le=V&&V.isTypedArray;function me(b,I){for(var R=-1,G=b==null?0:b.length,Ce=0,se=[];++R<G;){var Fe=b[R];I(Fe,R,b)&&(se[Ce++]=Fe)}return se}function de(b,I){for(var R=-1,G=I.length,Ce=b.length;++R<G;)b[Ce+R]=I[R];return b}function _e(b,I){for(var R=-1,G=b==null?0:b.length;++R<G;)if(I(b[R],R,b))return!0;return!1}function Re(b,I){for(var R=-1,G=Array(b);++R<b;)G[R]=I(R);return G}function Ae(b){return function(I){return b(I)}}function ye(b,I){return b.has(I)}function pe(b,I){return b==null?void 0:b[I]}function fe(b){var I=-1,R=Array(b.size);return b.forEach(function(G,Ce){R[++I]=[Ce,G]}),R}function he(b,I){return function(R){return b(I(R))}}function ce(b){var I=-1,R=Array(b.size);return b.forEach(function(G){R[++I]=G}),R}var ae=Array.prototype,ne=Function.prototype,ee=Object.prototype,ue=x["__core-js_shared__"],ge=ne.toString,te=ee.hasOwnProperty,be=function(){var b=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),we=ee.toString,ve=RegExp("^"+ge.call(te).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=E?x.Buffer:void 0,Ee=x.Symbol,wt=x.Uint8Array,vt=ee.propertyIsEnumerable,At=ae.splice,lt=Ee?Ee.toStringTag:void 0,jt=Object.getOwnPropertySymbols,fr=De?De.isBuffer:void 0,Mr=he(Object.keys,Object),Le=tr(x,"DataView"),Pe=tr(x,"Map"),Me=tr(x,"Promise"),je=tr(x,"Set"),He=tr(x,"WeakMap"),Ue=tr(Object,"create"),Ke=qt(Le),Be=qt(Pe),Ve=qt(Me),Ge=qt(je),ke=qt(He),ze=Ee?Ee.prototype:void 0,qe=ze?ze.valueOf:void 0;function Ne(b){var I=-1,R=b==null?0:b.length;for(this.clear();++I<R;){var G=b[I];this.set(G[0],G[1])}}function We(){this.__data__=Ue?Ue(null):{},this.size=0}function Ye(b){var I=this.has(b)&&delete this.__data__[b];return this.size-=I?1:0,I}function co(b){var I=this.__data__;if(Ue){var R=I[b];return R===i?void 0:R}return te.call(I,b)?I[b]:void 0}function ho(b){var I=this.__data__;return Ue?I[b]!==void 0:te.call(I,b)}function uo(b,I){var R=this.__data__;return this.size+=this.has(b)?0:1,R[b]=Ue&&I===void 0?i:I,this}Ne.prototype.clear=We,Ne.prototype.delete=Ye,Ne.prototype.get=co,Ne.prototype.has=ho,Ne.prototype.set=uo;function Ct(b){var I=-1,R=b==null?0:b.length;for(this.clear();++I<R;){var G=b[I];this.set(G[0],G[1])}}function lo(){this.__data__=[],this.size=0}function fo(b){var I=this.__data__,R=Hr(I,b);if(R<0)return!1;var G=I.length-1;return R==G?I.pop():At.call(I,R,1),--this.size,!0}function po(b){var I=this.__data__,R=Hr(I,b);return R<0?void 0:I[R][1]}function go(b){return Hr(this.__data__,b)>-1}function yo(b,I){var R=this.__data__,G=Hr(R,b);return G<0?(++this.size,R.push([b,I])):R[G][1]=I,this}Ct.prototype.clear=lo,Ct.prototype.delete=fo,Ct.prototype.get=po,Ct.prototype.has=go,Ct.prototype.set=yo;function Ht(b){var I=-1,R=b==null?0:b.length;for(this.clear();++I<R;){var G=b[I];this.set(G[0],G[1])}}function mo(){this.size=0,this.__data__={hash:new Ne,map:new(Pe||Ct),string:new Ne}}function bo(b){var I=qr(this,b).delete(b);return this.size-=I?1:0,I}function wo(b){return qr(this,b).get(b)}function _o(b){return qr(this,b).has(b)}function Eo(b,I){var R=qr(this,b),G=R.size;return R.set(b,I),this.size+=R.size==G?0:1,this}Ht.prototype.clear=mo,Ht.prototype.delete=bo,Ht.prototype.get=wo,Ht.prototype.has=_o,Ht.prototype.set=Eo;function jr(b){var I=-1,R=b==null?0:b.length;for(this.__data__=new Ht;++I<R;)this.add(b[I])}function vo(b){return this.__data__.set(b,i),this}function Do(b){return this.__data__.has(b)}jr.prototype.add=jr.prototype.push=vo,jr.prototype.has=Do;function Pt(b){var I=this.__data__=new Ct(b);this.size=I.size}function So(){this.__data__=new Ct,this.size=0}function Io(b){var I=this.__data__,R=I.delete(b);return this.size=I.size,R}function Oo(b){return this.__data__.get(b)}function xo(b){return this.__data__.has(b)}function Co(b,I){var R=this.__data__;if(R instanceof Ct){var G=R.__data__;if(!Pe||G.length<t-1)return G.push([b,I]),this.size=++R.size,this;R=this.__data__=new Ht(G)}return R.set(b,I),this.size=R.size,this}Pt.prototype.clear=So,Pt.prototype.delete=Io,Pt.prototype.get=Oo,Pt.prototype.has=xo,Pt.prototype.set=Co;function No(b,I){var R=zr(b),G=!R&&Bo(b),Ce=!R&&!G&&yi(b),se=!R&&!G&&!Ce&&Ps(b),Fe=R||G||Ce||se,Je=Fe?Re(b.length,String):[],et=Je.length;for(var Te in b)(I||te.call(b,Te))&&!(Fe&&(Te=="length"||Ce&&(Te=="offset"||Te=="parent")||se&&(Te=="buffer"||Te=="byteLength"||Te=="byteOffset")||jo(Te,et)))&&Je.push(Te);return Je}function Hr(b,I){for(var R=b.length;R--;)if(Cs(b[R][0],I))return R;return-1}function To(b,I,R){var G=I(b);return zr(b)?G:de(G,R(b))}function dr(b){return b==null?b===void 0?U:F:lt&&lt in Object(b)?Lo(b):Ko(b)}function Ss(b){return pr(b)&&dr(b)==h}function Is(b,I,R,G,Ce){return b===I?!0:b==null||I==null||!pr(b)&&!pr(I)?b!==b&&I!==I:Ao(b,I,R,G,Is,Ce)}function Ao(b,I,R,G,Ce,se){var Fe=zr(b),Je=zr(I),et=Fe?l:Ut(b),Te=Je?l:Ut(I);et=et==h?o:et,Te=Te==h?o:Te;var ft=et==o,_t=Te==o,it=et==Te;if(it&&yi(b)){if(!yi(I))return!1;Fe=!0,ft=!1}if(it&&!ft)return se||(se=new Pt),Fe||Ps(b)?Os(b,I,R,G,Ce,se):Ro(b,I,et,R,G,Ce,se);if(!(R&s)){var gt=ft&&te.call(b,"__wrapped__"),yt=_t&&te.call(I,"__wrapped__");if(gt||yt){var Ft=gt?b.value():b,Nt=yt?I.value():I;return se||(se=new Pt),Ce(Ft,Nt,R,G,se)}}return it?(se||(se=new Pt),$o(b,I,R,G,Ce,se)):!1}function Po(b){if(!As(b)||qo(b))return!1;var I=Ns(b)?ve:z;return I.test(qt(b))}function Uo(b){return pr(b)&&Ts(b.length)&&!!W[dr(b)]}function Fo(b){if(!zo(b))return Mr(b);var I=[];for(var R in Object(b))te.call(b,R)&&R!="constructor"&&I.push(R);return I}function Os(b,I,R,G,Ce,se){var Fe=R&s,Je=b.length,et=I.length;if(Je!=et&&!(Fe&&et>Je))return!1;var Te=se.get(b);if(Te&&se.get(I))return Te==I;var ft=-1,_t=!0,it=R&c?new jr:void 0;for(se.set(b,I),se.set(I,b);++ft<Je;){var gt=b[ft],yt=I[ft];if(G)var Ft=Fe?G(yt,gt,ft,I,b,se):G(gt,yt,ft,b,I,se);if(Ft!==void 0){if(Ft)continue;_t=!1;break}if(it){if(!_e(I,function(Nt,zt){if(!ye(it,zt)&&(gt===Nt||Ce(gt,Nt,R,G,se)))return it.push(zt)})){_t=!1;break}}else if(!(gt===yt||Ce(gt,yt,R,G,se))){_t=!1;break}}return se.delete(b),se.delete(I),_t}function Ro(b,I,R,G,Ce,se,Fe){switch(R){case J:if(b.byteLength!=I.byteLength||b.byteOffset!=I.byteOffset)return!1;b=b.buffer,I=I.buffer;case Y:return!(b.byteLength!=I.byteLength||!se(new wt(b),new wt(I)));case m:case _:case O:return Cs(+b,+I);case N:return b.name==I.name&&b.message==I.message;case f:case n:return b==I+"";case P:var Je=fe;case g:var et=G&s;if(Je||(Je=ce),b.size!=I.size&&!et)return!1;var Te=Fe.get(b);if(Te)return Te==I;G|=c,Fe.set(b,I);var ft=Os(Je(b),Je(I),G,Ce,se,Fe);return Fe.delete(b),ft;case p:if(qe)return qe.call(b)==qe.call(I)}return!1}function $o(b,I,R,G,Ce,se){var Fe=R&s,Je=xs(b),et=Je.length,Te=xs(I),ft=Te.length;if(et!=ft&&!Fe)return!1;for(var _t=et;_t--;){var it=Je[_t];if(!(Fe?it in I:te.call(I,it)))return!1}var gt=se.get(b);if(gt&&se.get(I))return gt==I;var yt=!0;se.set(b,I),se.set(I,b);for(var Ft=Fe;++_t<et;){it=Je[_t];var Nt=b[it],zt=I[it];if(G)var Us=Fe?G(zt,Nt,it,I,b,se):G(Nt,zt,it,b,I,se);if(!(Us===void 0?Nt===zt||Ce(Nt,zt,R,G,se):Us)){yt=!1;break}Ft||(Ft=it=="constructor")}if(yt&&!Ft){var Kr=b.constructor,Br=I.constructor;Kr!=Br&&"constructor"in b&&"constructor"in I&&!(typeof Kr=="function"&&Kr instanceof Kr&&typeof Br=="function"&&Br instanceof Br)&&(yt=!1)}return se.delete(b),se.delete(I),yt}function xs(b){return To(b,ko,Mo)}function qr(b,I){var R=b.__data__;return Ho(I)?R[typeof I=="string"?"string":"hash"]:R.map}function tr(b,I){var R=pe(b,I);return Po(R)?R:void 0}function Lo(b){var I=te.call(b,lt),R=b[lt];try{b[lt]=void 0;var G=!0}catch{}var Ce=we.call(b);return G&&(I?b[lt]=R:delete b[lt]),Ce}var Mo=jt?function(b){return b==null?[]:(b=Object(b),me(jt(b),function(I){return vt.call(b,I)}))}:Wo,Ut=dr;(Le&&Ut(new Le(new ArrayBuffer(1)))!=J||Pe&&Ut(new Pe)!=P||Me&&Ut(Me.resolve())!=d||je&&Ut(new je)!=g||He&&Ut(new He)!=j)&&(Ut=function(b){var I=dr(b),R=I==o?b.constructor:void 0,G=R?qt(R):"";if(G)switch(G){case Ke:return J;case Be:return P;case Ve:return d;case Ge:return g;case ke:return j}return I});function jo(b,I){return I=I??y,!!I&&(typeof b=="number"||Z.test(b))&&b>-1&&b%1==0&&b<I}function Ho(b){var I=typeof b;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?b!=="__proto__":b===null}function qo(b){return!!be&&be in b}function zo(b){var I=b&&b.constructor,R=typeof I=="function"&&I.prototype||ee;return b===R}function Ko(b){return we.call(b)}function qt(b){if(b!=null){try{return ge.call(b)}catch{}try{return b+""}catch{}}return""}function Cs(b,I){return b===I||b!==b&&I!==I}var Bo=Ss(function(){return arguments}())?Ss:function(b){return pr(b)&&te.call(b,"callee")&&!vt.call(b,"callee")},zr=Array.isArray;function Vo(b){return b!=null&&Ts(b.length)&&!Ns(b)}var yi=fr||Yo;function Go(b,I){return Is(b,I)}function Ns(b){if(!As(b))return!1;var I=dr(b);return I==v||I==D||I==w||I==u}function Ts(b){return typeof b=="number"&&b>-1&&b%1==0&&b<=y}function As(b){var I=typeof b;return b!=null&&(I=="object"||I=="function")}function pr(b){return b!=null&&typeof b=="object"}var Ps=le?Ae(le):Uo;function ko(b){return Vo(b)?No(b):Fo(b)}function Wo(){return[]}function Yo(){return!1}r.exports=Go})(Hf,ri);function qf(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var c=r.charAt(s),y=c.charCodeAt(0);if(t[y]!==255)throw new TypeError(c+" is ambiguous");t[y]=s}var h=r.length,l=r.charAt(0),w=Math.log(h)/Math.log(256),m=Math.log(256)/Math.log(h);function _(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var P=0,O=0,F=0,o=D.length;F!==o&&D[F]===0;)F++,P++;for(var d=(o-F)*m+1>>>0,u=new Uint8Array(d);F!==o;){for(var f=D[F],g=0,n=d-1;(f!==0||g<O)&&n!==-1;n--,g++)f+=256*u[n]>>>0,u[n]=f%h>>>0,f=f/h>>>0;if(f!==0)throw new Error("Non-zero carry");O=g,F++}for(var p=d-O;p!==d&&u[p]===0;)p++;for(var U=l.repeat(P);p<d;++p)U+=r.charAt(u[p]);return U}function N(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var P=0;if(D[P]!==" "){for(var O=0,F=0;D[P]===l;)O++,P++;for(var o=(D.length-P)*w+1>>>0,d=new Uint8Array(o);D[P];){var u=t[D.charCodeAt(P)];if(u===255)return;for(var f=0,g=o-1;(u!==0||f<F)&&g!==-1;g--,f++)u+=h*d[g]>>>0,d[g]=u%256>>>0,u=u/256>>>0;if(u!==0)throw new Error("Non-zero carry");F=f,P++}if(D[P]!==" "){for(var n=o-F;n!==o&&d[n]===0;)n++;for(var p=new Uint8Array(O+(o-n)),U=O;n!==o;)p[U++]=d[n++];return p}}}function v(D){var P=N(D);if(P)return P;throw new Error(`Non-${e} character`)}return{encode:_,decodeUnsafe:N,decode:v}}var zf=qf,Kf=zf;const Ka=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Bf=r=>new TextEncoder().encode(r),Vf=r=>new TextDecoder().decode(r);class Gf{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class kf{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ba(this,e)}}class Wf{constructor(e){this.decoders=e}or(e){return Ba(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ba=(r,e)=>new Wf({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Yf{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Gf(e,t,i),this.decoder=new kf(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const di=({name:r,prefix:e,encode:t,decode:i})=>new Yf(r,e,t,i),$r=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Kf(t,e);return di({prefix:r,name:e,encode:i,decode:c=>Ka(s(c))})},Jf=(r,e,t,i)=>{const s={};for(let m=0;m<e.length;++m)s[e[m]]=m;let c=r.length;for(;r[c-1]==="=";)--c;const y=new Uint8Array(c*t/8|0);let h=0,l=0,w=0;for(let m=0;m<c;++m){const _=s[r[m]];if(_===void 0)throw new SyntaxError(`Non-${i} character`);l=l<<t|_,h+=t,h>=8&&(h-=8,y[w++]=255&l>>h)}if(h>=t||255&l<<8-h)throw new SyntaxError("Unexpected end of data");return y},Xf=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let c="",y=0,h=0;for(let l=0;l<r.length;++l)for(h=h<<8|r[l],y+=8;y>t;)y-=t,c+=e[s&h>>y];if(y&&(c+=e[s&h<<t-y]),i)for(;c.length*t&7;)c+="=";return c},rt=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>di({prefix:e,name:r,encode(s){return Xf(s,i,t)},decode(s){return Jf(s,i,t,r)}}),Qf=di({prefix:"\0",name:"identity",encode:r=>Vf(r),decode:r=>Bf(r)});var Zf=Object.freeze({__proto__:null,identity:Qf});const ed=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var td=Object.freeze({__proto__:null,base2:ed});const rd=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var id=Object.freeze({__proto__:null,base8:rd});const sd=$r({prefix:"9",name:"base10",alphabet:"0123456789"});var nd=Object.freeze({__proto__:null,base10:sd});const ad=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),od=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var cd=Object.freeze({__proto__:null,base16:ad,base16upper:od});const hd=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ud=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ld=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),fd=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),dd=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),pd=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),gd=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),yd=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),md=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var bd=Object.freeze({__proto__:null,base32:hd,base32upper:ud,base32pad:ld,base32padupper:fd,base32hex:dd,base32hexupper:pd,base32hexpad:gd,base32hexpadupper:yd,base32z:md});const wd=$r({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_d=$r({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ed=Object.freeze({__proto__:null,base36:wd,base36upper:_d});const vd=$r({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Dd=$r({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Sd=Object.freeze({__proto__:null,base58btc:vd,base58flickr:Dd});const Id=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Od=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),xd=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Cd=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Nd=Object.freeze({__proto__:null,base64:Id,base64pad:Od,base64url:xd,base64urlpad:Cd});const Va=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),Td=Va.reduce((r,e,t)=>(r[t]=e,r),[]),Ad=Va.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Pd(r){return r.reduce((e,t)=>(e+=Td[t],e),"")}function Ud(r){const e=[];for(const t of r){const i=Ad[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Fd=di({prefix:"ðŸš€",name:"base256emoji",encode:Pd,decode:Ud});var Rd=Object.freeze({__proto__:null,base256emoji:Fd}),$d=Ga,In=128,Ld=127,Md=~Ld,jd=Math.pow(2,31);function Ga(r,e,t){e=e||[],t=t||0;for(var i=t;r>=jd;)e[t++]=r&255|In,r/=128;for(;r&Md;)e[t++]=r&255|In,r>>>=7;return e[t]=r|0,Ga.bytes=t-i+1,e}var Hd=ki,qd=128,On=127;function ki(r,i){var t=0,i=i||0,s=0,c=i,y,h=r.length;do{if(c>=h)throw ki.bytes=0,new RangeError("Could not decode varint");y=r[c++],t+=s<28?(y&On)<<s:(y&On)*Math.pow(2,s),s+=7}while(y>=qd);return ki.bytes=c-i,t}var zd=Math.pow(2,7),Kd=Math.pow(2,14),Bd=Math.pow(2,21),Vd=Math.pow(2,28),Gd=Math.pow(2,35),kd=Math.pow(2,42),Wd=Math.pow(2,49),Yd=Math.pow(2,56),Jd=Math.pow(2,63),Xd=function(r){return r<zd?1:r<Kd?2:r<Bd?3:r<Vd?4:r<Gd?5:r<kd?6:r<Wd?7:r<Yd?8:r<Jd?9:10},Qd={encode:$d,decode:Hd,encodingLength:Xd},ka=Qd;const xn=(r,e,t=0)=>(ka.encode(r,e,t),e),Cn=r=>ka.encodingLength(r),Wi=(r,e)=>{const t=e.byteLength,i=Cn(r),s=i+Cn(t),c=new Uint8Array(s+t);return xn(r,c,0),xn(t,c,i),c.set(e,s),new Zd(r,t,e,c)};class Zd{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const Wa=({name:r,code:e,encode:t})=>new ep(r,e,t);class ep{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Wi(this.code,t):t.then(i=>Wi(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Ya=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),tp=Wa({name:"sha2-256",code:18,encode:Ya("SHA-256")}),rp=Wa({name:"sha2-512",code:19,encode:Ya("SHA-512")});var ip=Object.freeze({__proto__:null,sha256:tp,sha512:rp});const Ja=0,sp="identity",Xa=Ka,np=r=>Wi(Ja,Xa(r)),ap={code:Ja,name:sp,encode:Xa,digest:np};var op=Object.freeze({__proto__:null,identity:ap});new TextEncoder,new TextDecoder;const Nn={...Zf,...td,...id,...nd,...cd,...bd,...Ed,...Sd,...Nd,...Rd};({...ip,...op});function cp(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function Qa(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Tn=Qa("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),xi=Qa("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=cp(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),hp={utf8:Tn,"utf-8":Tn,hex:Nn.base16,latin1:xi,ascii:xi,binary:xi,...Nn};function up(r,e="utf8"){const t=hp[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}const Za="wc",lp=2,ws="core",Lt=`${Za}@${2}:${ws}:`,fp={name:ws,logger:"error"},dp={database:":memory:"},pp="crypto",An="client_ed25519_seed",gp=Q.ONE_DAY,yp="keychain",mp="0.3",bp="messages",wp="0.3",_p=Q.SIX_HOURS,Ep="publisher",eo="irn",vp="error",to="wss://relay.walletconnect.com",Dp="relayer",Xe={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Sp="_subscription",Gr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Pn=Q.ONE_SECOND,Ip="2.4.9",Op="0.3",It={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},xp="subscription",Cp="0.3",Np=Q.FIVE_SECONDS*1e3,Tp="pairing",Ap="0.3",Er={wc_pairingDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:0},res:{ttl:Q.ONE_DAY,prompt:!1,tag:0}}},St={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Pp="history",Up="0.3",Fp="expirer",bt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Rp="0.3";class $p{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=yp,this.version=mp,this.initialized=!1,this.storagePrefix=Lt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:c}=B("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(c)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,La(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ma(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Lp{constructor(e,t,i){this.core=e,this.logger=t,this.name=pp,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),c=ln(s);return Ca(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Il();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const c=await this.getClientSeed(),y=ln(c),h=Bi();return await ll(h,s,gp,y)},this.generateSharedKey=(s,c,y)=>{this.isInitialized();const h=this.getPrivateKey(s),l=Ol(h,c);return this.setSymKey(l,y)},this.setSymKey=async(s,c)=>{this.isInitialized();const y=c||xl(s);return await this.keychain.set(y,s),y},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,c,y)=>{this.isInitialized();const h=Ra(y),l=Ju(c);if(pn(h)){const N=h.senderPublicKey,v=h.receiverPublicKey;s=await this.generateSharedKey(N,v)}const w=this.getSymKey(s),{type:m,senderPublicKey:_}=h;return Nl({type:m,symKey:w,message:l,senderPublicKey:_})},this.decode=async(s,c,y)=>{this.isInitialized();const h=Pl(c,y);if(pn(h)){const m=h.receiverPublicKey,_=h.senderPublicKey;s=await this.generateSharedKey(m,_)}const l=this.getSymKey(s),w=Tl({symKey:l,encoded:c});return Yu(w)},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.keychain=i||new $p(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const t=ys(e);return Rr(t.type)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(An)}catch{e=Bi(),await this.keychain.set(An,e)}return up(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Mp extends qu{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=bp,this.version=wp,this.initialized=!1,this.storagePrefix=Lt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const c=ti(s);let y=this.messages.get(i);return typeof y>"u"&&(y={}),typeof y[c]<"u"||(y[c]=s,this.messages.set(i,y),await this.persist()),c},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const c=this.get(i),y=ti(s);return typeof c[y]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=t}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,La(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ma(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class jp extends zu{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new dt.EventEmitter,this.name=Ep,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,s,c)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}});try{const y=(c==null?void 0:c.ttl)||_p,h=Gi(c),l=(c==null?void 0:c.prompt)||!1,w=(c==null?void 0:c.tag)||0,m={topic:i,message:s,opts:{ttl:y,relay:h,prompt:l,tag:w}},_=ti(s);this.queue.set(_,m);try{await await Vi(this.rpcPublish(i,s,y,h,l,w),this.publishTimeout),this.relayer.events.emit(Xe.publish,m)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(Xe.connection_stalled);return}this.onPublish(_,m),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,t,i,s,c,y){var h,l,w,m;const _={method:Yr(s.protocol).publish,params:{topic:e,message:t,ttl:i,prompt:c,tag:y}};return at((h=_.params)==null?void 0:h.prompt)&&((l=_.params)==null||delete l.prompt),at((w=_.params)==null?void 0:w.tag)&&((m=_.params)==null||delete m.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:_}),this.relayer.provider.request(_)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:i,opts:s}=e;await this.publish(t,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(Fr.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Hp{constructor(){this.map=new Map,this.set=(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(c=>c!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var qp=Object.defineProperty,zp=Object.defineProperties,Kp=Object.getOwnPropertyDescriptors,Un=Object.getOwnPropertySymbols,Bp=Object.prototype.hasOwnProperty,Vp=Object.prototype.propertyIsEnumerable,Fn=(r,e,t)=>e in r?qp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vr=(r,e)=>{for(var t in e||(e={}))Bp.call(e,t)&&Fn(r,t,e[t]);if(Un)for(var t of Un(e))Vp.call(e,t)&&Fn(r,t,e[t]);return r},Ci=(r,e)=>zp(r,Kp(e));class Gp extends Vu{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Hp,this.events=new dt.EventEmitter,this.name=xp,this.version=Cp,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Lt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const c=Gi(s),y={topic:i,relay:c};this.pending.set(i,y);const h=await this.rpcSubscribe(i,c);return this.onSubscribe(h,y),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),h}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,c)=>{const y=new Q.Watch;y.start(this.pendingSubscriptionWatchLabel);const h=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(h),y.stop(this.pendingSubscriptionWatchLabel),s(!0)),y.elapsed(this.pendingSubscriptionWatchLabel)>=Np&&(clearInterval(h),y.stop(this.pendingSubscriptionWatchLabel),c(!1))},this.pollingInterval)}),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name),this.clientId=""}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=Gi(i);await this.rpcUnsubscribe(e,t,s);const c=Qe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t){const i={method:Yr(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Vi(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Xe.connection_stalled)}return ti(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,i={method:Yr(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await Vi(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Xe.connection_stalled)}}rpcUnsubscribe(e,t,i){const s={method:Yr(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.provider.request(s)}onSubscribe(e,t){this.setSubscription(e,Ci(vr({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,vr({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,vr({},t)),this.topicMap.set(t.topic,e),this.events.emit(It.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(It.deleted,Ci(vr({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(It.sync)}async reset(){if(!this.cached.length)return;const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}this.events.emit(It.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);this.onBatchSubscribe(t.map((i,s)=>Ci(vr({},e[s]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Fr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Xe.connect,async()=>{await this.onConnect()}),this.relayer.on(Xe.disconnect,()=>{this.onDisconnect()}),this.events.on(It.created,async e=>{const t=It.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(It.deleted,async e=>{const t=It.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),e())},this.pollingInterval)})}}var kp=Object.defineProperty,Rn=Object.getOwnPropertySymbols,Wp=Object.prototype.hasOwnProperty,Yp=Object.prototype.propertyIsEnumerable,$n=(r,e,t)=>e in r?kp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Jp=(r,e)=>{for(var t in e||(e={}))Wp.call(e,t)&&$n(r,t,e[t]);if(Rn)for(var t of Rn(e))Yp.call(e,t)&&$n(r,t,e[t]);return r};class Xp extends Ku{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new dt.EventEmitter,this.name=Dp,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):Pr(Se.getDefaultLoggerOptions({level:e.logger||vp})),this.messages=new Mp(this.logger,e.core),this.subscriber=new Gp(this,this.logger),this.publisher=new jp(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||to,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){this.isInitialized();let i="";return await Promise.all([new Promise(s=>{this.subscriber.once(It.created,c=>{c.topic===e&&s()})}),new Promise(async s=>{i=await this.subscriber.subscribe(e,t),s()})]),i}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(Xe.transport_closed))}async transportOpen(e){if(!this.reconnecting){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1,this.reconnecting=!0;try{await Promise.all([new Promise(t=>{this.initialized||t(),this.subscriber.once(It.resubscribed,()=>{t()})}),await Promise.race([new Promise(async t=>{await this.provider.connect(),this.removeListener(Xe.transport_closed,this.rejectTransportOpen),t()}),new Promise(t=>this.once(Xe.transport_closed,this.rejectTransportOpen))])])}catch(t){const i=t;if(!/socket hang up/i.test(i.message))throw t;this.logger.error(t),this.events.emit(Xe.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(e){this.transportExplicitlyClosed||(await this.transportClose(),await new Promise(t=>setTimeout(t,Pn)),await this.transportOpen(e))}rejectTransportOpen(){throw new Error("closeTransport called before connection was established")}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new Nr(new jf(Gl({sdkVersion:Ip,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),is(e)){if(!e.method.endsWith(Sp))return;const t=e.params,{topic:i,message:s,publishedAt:c}=t.data,y={topic:i,message:s,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Jp({type:"event",event:t.id},y)),this.events.emit(t.id,y),await this.acknowledgePayload(e),await this.onMessageEvent(y)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Xe.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=ss(e.id,!0);await this.provider.connection.send(t)}registerEventListeners(){this.provider.on(Gr.payload,e=>this.onProviderPayload(e)),this.provider.on(Gr.connect,()=>{this.events.emit(Xe.connect)}),this.provider.on(Gr.disconnect,()=>{this.events.emit(Xe.disconnect),this.attemptToReconnect()}),this.provider.on(Gr.error,e=>this.events.emit(Xe.error,e)),this.events.on(Xe.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},Q.toMiliseconds(Pn))}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Qp=Object.defineProperty,Ln=Object.getOwnPropertySymbols,Zp=Object.prototype.hasOwnProperty,eg=Object.prototype.propertyIsEnumerable,Mn=(r,e,t)=>e in r?Qp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,jn=(r,e)=>{for(var t in e||(e={}))Zp.call(e,t)&&Mn(r,t,e[t]);if(Ln)for(var t of Ln(e))eg.call(e,t)&&Mn(r,t,e[t]);return r};class pi extends Bu{constructor(e,t,i,s=Lt,c=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,this.map=new Map,this.version=Op,this.cached=[],this.initialized=!1,this.storagePrefix=Lt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(y=>{pf(y)?this.map.set(y.id,y):gf(y)?this.map.set(y.topic,y):this.getKey&&y!==null&&!at(y)&&this.map.set(this.getKey(y),y)}),this.cached=[],this.initialized=!0)},this.set=async(y,h)=>{this.isInitialized(),this.map.has(y)?await this.update(y,h):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:y,value:h}),this.map.set(y,h),await this.persist())},this.get=y=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:y}),this.getData(y)),this.getAll=y=>(this.isInitialized(),y?this.values.filter(h=>Object.keys(y).every(l=>ri(h[l],y[l]))):this.values),this.update=async(y,h)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:y,update:h});const l=jn(jn({},this.getData(y)),h);this.map.set(y,l),await this.persist()},this.delete=async(y,h)=>{this.isInitialized(),this.map.has(y)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:y,reason:h}),this.map.delete(y),await this.persist())},this.logger=Se.generateChildLogger(t,this.name),this.storagePrefix=s,this.getKey=c}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:i}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class tg{constructor(e,t){this.core=e,this.logger=t,this.name=Tp,this.version=Ap,this.events=new dt,this.initialized=!1,this.storagePrefix=Lt,this.ignoredPayloadTypes=[Zt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Bi(),s=await this.core.crypto.setSymKey(i),c=Ot(Q.FIVE_MINUTES),y={protocol:eo},h={topic:s,expiry:c,relay:y,active:!1},l=sf({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:y});return await this.pairings.set(s,h),await this.core.relayer.subscribe(s),this.core.expirer.set(s,c),{topic:s,uri:l}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:c,relay:y}=tf(i.uri);if(this.pairings.keys.includes(s))throw new Error(`Pairing already exists: ${s}`);if(this.core.crypto.hasKeys(s))throw new Error(`Keychain already exists: ${s}`);const h=Ot(Q.FIVE_MINUTES),l={topic:s,relay:y,expiry:h,active:!1};return await this.pairings.set(s,l),await this.core.crypto.setSymKey(c,s),await this.core.relayer.subscribe(s,{relay:y}),this.core.expirer.set(s,h),i.activatePairing&&await this.activate({topic:s}),l},this.activate=async({topic:i})=>{this.isInitialized();const s=Ot(Q.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const c=await this.sendRequest(s,"wc_pairingPing",{}),{done:y,resolve:h,reject:l}=kt();this.events.once($e("pairing_ping",c),({error:w})=>{w?l(w):h()}),await y()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Qe("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,c)=>{const y=ns(s,c),h=await this.core.crypto.encode(i,y),l=Er[s].req;return this.core.history.set(i,y),await this.core.relayer.publish(i,h,l),y.id},this.sendResult=async(i,s,c)=>{const y=ss(i,c),h=await this.core.crypto.encode(s,y),l=await this.core.history.get(s,i),w=Er[l.request.method].res;await this.core.relayer.publish(s,h,w),await this.core.history.resolve(y)},this.sendError=async(i,s,c)=>{const y=rs(i,c),h=await this.core.crypto.encode(s,y),l=await this.core.history.get(s,i),w=Er[l.request.method]?Er[l.request.method].res:Er.unregistered_method.res;await this.core.relayer.publish(s,h,w),await this.core.history.resolve(y)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Qe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>$t(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:c}=i,y=c.method;if(this.pairings.keys.includes(s))switch(y){case"wc_pairingPing":return this.onPairingPingRequest(s,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,c);default:return this.onUnknownRpcMethodRequest(s,c)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:c}=i,y=(await this.core.history.get(s,c.id)).request.method;if(this.pairings.keys.includes(s))switch(y){case"wc_pairingPing":return this.onPairingPingResponse(s,c);default:return this.onUnknownRpcMethodResponse(y)}},this.onPairingPingRequest=async(i,s)=>{const{id:c}=s;try{this.isValidPing({topic:i}),await this.sendResult(c,i,!0),this.events.emit("pairing_ping",{id:c,topic:i})}catch(y){await this.sendError(c,i,y),this.logger.error(y)}},this.onPairingPingResponse=(i,s)=>{const{id:c}=s;setTimeout(()=>{Rt(s)?this.events.emit($e("pairing_ping",c),{}):Tt(s)&&this.events.emit($e("pairing_ping",c),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:c}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit("pairing_delete",{id:c,topic:i})}catch(y){await this.sendError(c,i,y),this.logger.error(y)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:c,method:y}=s;try{if(this.registeredMethods.includes(y))return;const h=Qe("WC_METHOD_UNSUPPORTED",y);await this.sendError(c,i,h),this.logger.error(h)}catch(h){await this.sendError(c,i,h),this.logger.error(h)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Qe("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!ot(i)){const{message:s}=B("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(s)}if(!df(i.uri)){const{message:s}=B("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!ot(i)){const{message:c}=B("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!ot(i)){const{message:c}=B("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!Ze(i,!1)){const{message:s}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if($t(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=B("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.pairings=new pi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Xe.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(t,i);is(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):ta(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(bt.expired,async e=>{const{topic:t}=Ha(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}class rg extends Hu{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new dt.EventEmitter,this.name=Pp,this.version=Up,this.cached=[],this.initialized=!1,this.storagePrefix=Lt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:c}),this.records.has(s.id))return;const y={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:c};this.records.set(y.id,y),this.events.emit(St.created,y)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Tt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(St.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(c=>{if(c.topic===i){if(typeof s<"u"&&c.id!==s)return;this.records.delete(c.id),this.events.emit(St.deleted,c)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:ns(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(St.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(St.created,e=>{const t=St.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(St.updated,e=>{const t=St.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(St.deleted,e=>{const t=St.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ig extends Gu{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new dt.EventEmitter,this.name=Fp,this.version=Rp,this.cached=[],this.initialized=!1,this.storagePrefix=Lt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const c=this.formatTarget(i),y={target:c,expiry:s};this.expirations.set(c,y),this.checkExpiry(c,y),this.events.emit(bt.created,{target:c,expiration:y})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),c=this.getExpiration(s);this.expirations.delete(s),this.events.emit(bt.deleted,{target:s,expiration:c})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return kl(e);if(typeof e=="number")return Wl(e);const{message:t}=B("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(bt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;Q.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(bt.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Fr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(bt.created,e=>{const t=bt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(bt.expired,e=>{const t=bt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(bt.deleted,e=>{const t=bt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var sg=Object.defineProperty,Hn=Object.getOwnPropertySymbols,ng=Object.prototype.hasOwnProperty,ag=Object.prototype.propertyIsEnumerable,qn=(r,e,t)=>e in r?sg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,zn=(r,e)=>{for(var t in e||(e={}))ng.call(e,t)&&qn(r,t,e[t]);if(Hn)for(var t of Hn(e))ag.call(e,t)&&qn(r,t,e[t]);return r};let og=class ro extends ju{constructor(e){super(e),this.protocol=Za,this.version=lp,this.name=ws,this.events=new dt.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||to;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Pr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||fp.logger}));this.logger=Se.generateChildLogger(t,this.name),this.heartbeat=new Fr.HeartBeat,this.crypto=new Lp(this,this.logger,e==null?void 0:e.keychain),this.history=new rg(this,this.logger),this.expirer=new ig(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Pu(zn(zn({},dp),e==null?void 0:e.storageOptions)),this.relayer=new Xp({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new tg(this,this.logger)}static async init(e){const t=new ro(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const cg=og,io="wc",so=2,no="client",_s=`${io}@${so}:${no}:`,Ni={name:no,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},hg="proposal",ao="Proposal expired",ug="session",kr=Q.SEVEN_DAYS,lg="engine",Dr={wc_sessionPropose:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ti={min:Q.FIVE_MINUTES,max:Q.SEVEN_DAYS},fg="request";var dg=Object.defineProperty,pg=Object.defineProperties,gg=Object.getOwnPropertyDescriptors,Kn=Object.getOwnPropertySymbols,yg=Object.prototype.hasOwnProperty,mg=Object.prototype.propertyIsEnumerable,Bn=(r,e,t)=>e in r?dg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mt=(r,e)=>{for(var t in e||(e={}))yg.call(e,t)&&Bn(r,t,e[t]);if(Kn)for(var t of Kn(e))mg.call(e,t)&&Bn(r,t,e[t]);return r},Ai=(r,e)=>pg(r,gg(e));class bg extends Wu{constructor(e){super(e),this.name=lg,this.events=new dt,this.initialized=!1,this.ignoredPayloadTypes=[Zt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(Dr)}),this.initialized=!0)},this.connect=async t=>{this.isInitialized();const i=Ai(mt({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:s,requiredNamespaces:c,optionalNamespaces:y,sessionProperties:h,relays:l}=i;let w=s,m,_=!1;if(w&&(_=this.client.core.pairing.pairings.get(w).active),!w||!_){const{topic:d,uri:u}=await this.client.core.pairing.create();w=d,m=u}const N=await this.client.core.crypto.generateKeyPair(),v=mt({requiredNamespaces:c,optionalNamespaces:y,relays:l??[{protocol:eo}],proposer:{publicKey:N,metadata:this.client.metadata}},h&&{sessionProperties:h}),{reject:D,resolve:P,done:O}=kt(Q.FIVE_MINUTES,ao);if(this.events.once($e("session_connect"),async({error:d,session:u})=>{if(d)D(d);else if(u){u.self.publicKey=N;const f=Ai(mt({},u),{requiredNamespaces:u.requiredNamespaces,optionalNamespaces:u.optionalNamespaces});await this.client.session.set(u.topic,f),await this.setExpiry(u.topic,u.expiry),w&&await this.client.core.pairing.updateMetadata({topic:w,metadata:u.peer.metadata}),P(f)}}),!w){const{message:d}=B("NO_MATCHING_KEY",`connect() pairing topic: ${w}`);throw new Error(d)}const F=await this.sendRequest(w,"wc_sessionPropose",v),o=Ot(Q.FIVE_MINUTES);return await this.setProposal(F,mt({id:F,expiry:o},v)),{uri:m,approval:O}},this.pair=async t=>(this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{this.isInitialized(),await this.isValidApprove(t);const{id:i,relayProtocol:s,namespaces:c,sessionProperties:y}=t,h=this.client.proposal.get(i);let{pairingTopic:l,proposer:w,requiredNamespaces:m,optionalNamespaces:_}=h;Ir(m)||(m=cf(c,"approve()"));const N=await this.client.core.crypto.generateKeyPair(),v=w.publicKey,D=await this.client.core.crypto.generateSharedKey(N,v);l&&i&&(await this.client.core.pairing.updateMetadata({topic:l,metadata:w.metadata}),await this.sendResult(i,l,{relay:{protocol:s??"irn"},responderPublicKey:N}),await this.client.proposal.delete(i,Qe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:l}));const P=mt({relay:{protocol:s??"irn"},namespaces:c,requiredNamespaces:m,optionalNamespaces:_,controller:{publicKey:N,metadata:this.client.metadata},expiry:Ot(kr)},y&&{sessionProperties:y});await this.client.core.relayer.subscribe(D);const O=await this.sendRequest(D,"wc_sessionSettle",P),{done:F,resolve:o,reject:d}=kt();this.events.once($e("session_approve",O),({error:f})=>{f?d(f):o(this.client.session.get(D))});const u=Ai(mt({},P),{topic:D,acknowledged:!1,self:P.controller,peer:{publicKey:w.publicKey,metadata:w.metadata},controller:N});return await this.client.session.set(D,u),await this.setExpiry(D,Ot(kr)),{topic:D,acknowledged:F}},this.reject=async t=>{this.isInitialized(),await this.isValidReject(t);const{id:i,reason:s}=t,{pairingTopic:c}=this.client.proposal.get(i);c&&(await this.sendError(i,c,s),await this.client.proposal.delete(i,Qe("USER_DISCONNECTED")))},this.update=async t=>{this.isInitialized(),await this.isValidUpdate(t);const{topic:i,namespaces:s}=t,c=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:s}),{done:y,resolve:h,reject:l}=kt();return this.events.once($e("session_update",c),({error:w})=>{w?l(w):h()}),await this.client.session.update(i,{namespaces:s}),{acknowledged:y}},this.extend=async t=>{this.isInitialized(),await this.isValidExtend(t);const{topic:i}=t,s=await this.sendRequest(i,"wc_sessionExtend",{}),{done:c,resolve:y,reject:h}=kt();return this.events.once($e("session_extend",s),({error:l})=>{l?h(l):y()}),await this.setExpiry(i,Ot(kr)),{acknowledged:c}},this.request=async t=>{this.isInitialized(),await this.isValidRequest(t);const{chainId:i,request:s,topic:c,expiry:y}=t,h=await this.sendRequest(c,"wc_sessionRequest",{request:s,chainId:i},y),{done:l,resolve:w,reject:m}=kt(y);return this.events.once($e("session_request",h),({error:_,result:N})=>{_?m(_):w(N)}),this.client.events.emit("session_request_sent",{topic:c,request:s,chainId:i}),await l()},this.respond=async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:s}=t,{id:c}=s;Rt(s)?await this.sendResult(c,i,s.result):Tt(s)&&await this.sendError(c,i,s.error),this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0})},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:i}=t;if(this.client.session.keys.includes(i)){const s=await this.sendRequest(i,"wc_sessionPing",{}),{done:c,resolve:y,reject:h}=kt();this.events.once($e("session_ping",s),({error:l})=>{l?h(l):y()}),await c()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async t=>{this.isInitialized(),await this.isValidEmit(t);const{topic:i,event:s,chainId:c}=t;await this.sendRequest(i,"wc_sessionEvent",{event:s,chainId:c})},this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:i}=t;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",Qe("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(i=>lf(i,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(t,i)=>{const{self:s}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await Promise.all([this.client.session.delete(t,Qe("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(t),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deleteProposal=async(t,i)=>{await Promise.all([this.client.proposal.delete(t,Qe("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)])},this.setExpiry=async(t,i)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:i}),this.client.core.expirer.set(t,i)},this.setProposal=async(t,i)=>{await this.client.proposal.set(t,i),this.client.core.expirer.set(t,i.expiry)},this.setPendingSessionRequest=async t=>{const i=Dr.wc_sessionRequest.req.ttl,{id:s,topic:c,params:y}=t;await this.client.pendingRequest.set(s,{id:s,topic:c,params:y}),i&&this.client.core.expirer.set(s,Ot(i))},this.sendRequest=async(t,i,s,c)=>{const y=ns(i,s),h=await this.client.core.crypto.encode(t,y),l=Dr[i].req;return c&&(l.ttl=c),this.client.core.history.set(t,y),this.client.core.relayer.publish(t,h,l),y.id},this.sendResult=async(t,i,s)=>{const c=ss(t,s),y=await this.client.core.crypto.encode(i,c),h=await this.client.core.history.get(i,t),l=Dr[h.request.method].res;this.client.core.relayer.publish(i,y,l),await this.client.core.history.resolve(c)},this.sendError=async(t,i,s)=>{const c=rs(t,s),y=await this.client.core.crypto.encode(i,c),h=await this.client.core.history.get(i,t),l=Dr[h.request.method].res;this.client.core.relayer.publish(i,y,l),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const t=[],i=[];this.client.session.getAll().forEach(s=>{$t(s.expiry)&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{$t(s.expiry)&&i.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession(s)),...i.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=t=>{const{topic:i,payload:s}=t,c=s.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(i,s);case"wc_sessionSettle":return this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return this.onSessionExtendRequest(i,s);case"wc_sessionPing":return this.onSessionPingRequest(i,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return this.onSessionRequest(i,s);case"wc_sessionEvent":return this.onSessionEventRequest(i,s);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async t=>{const{topic:i,payload:s}=t,c=(await this.client.core.history.get(i,s.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onSessionProposeRequest=async(t,i)=>{const{params:s,id:c}=i;try{this.isValidConnect(mt({},i.params));const y=Ot(Q.FIVE_MINUTES),h=mt({id:c,pairingTopic:t,expiry:y},s);await this.setProposal(c,h),this.client.events.emit("session_proposal",{id:c,params:h})}catch(y){await this.sendError(c,t,y),this.client.logger.error(y)}},this.onSessionProposeResponse=async(t,i)=>{const{id:s}=i;if(Rt(i)){const{result:c}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const y=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:y});const h=y.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:h});const l=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const w=await this.client.core.crypto.generateSharedKey(h,l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:w});const m=await this.client.core.relayer.subscribe(w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:m}),await this.client.core.pairing.activate({topic:t})}else Tt(i)&&(await this.client.proposal.delete(s,Qe("USER_DISCONNECTED")),this.events.emit($e("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(t,i)=>{const{id:s,params:c}=i;try{this.isValidSessionSettleRequest(c);const{relay:y,controller:h,expiry:l,namespaces:w,requiredNamespaces:m,optionalNamespaces:_,sessionProperties:N}=i.params,v=mt({topic:t,relay:y,expiry:l,namespaces:w,acknowledged:!0,requiredNamespaces:m,optionalNamespaces:_,controller:h.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:h.publicKey,metadata:h.metadata}},N&&{sessionProperties:N});await this.sendResult(i.id,t,!0),this.events.emit($e("session_connect"),{session:v})}catch(y){await this.sendError(s,t,y),this.client.logger.error(y)}},this.onSessionSettleResponse=async(t,i)=>{const{id:s}=i;Rt(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit($e("session_approve",s),{})):Tt(i)&&(await this.client.session.delete(t,Qe("USER_DISCONNECTED")),this.events.emit($e("session_approve",s),{error:i.error}))},this.onSessionUpdateRequest=async(t,i)=>{const{params:s,id:c}=i;try{this.isValidUpdate(mt({topic:t},s)),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult(c,t,!0),this.client.events.emit("session_update",{id:c,topic:t,params:s})}catch(y){await this.sendError(c,t,y),this.client.logger.error(y)}},this.onSessionUpdateResponse=(t,i)=>{const{id:s}=i;Rt(i)?this.events.emit($e("session_update",s),{}):Tt(i)&&this.events.emit($e("session_update",s),{error:i.error})},this.onSessionExtendRequest=async(t,i)=>{const{id:s}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Ot(kr)),await this.sendResult(s,t,!0),this.client.events.emit("session_extend",{id:s,topic:t})}catch(c){await this.sendError(s,t,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(t,i)=>{const{id:s}=i;Rt(i)?this.events.emit($e("session_extend",s),{}):Tt(i)&&this.events.emit($e("session_extend",s),{error:i.error})},this.onSessionPingRequest=async(t,i)=>{const{id:s}=i;try{this.isValidPing({topic:t}),await this.sendResult(s,t,!0),this.client.events.emit("session_ping",{id:s,topic:t})}catch(c){await this.sendError(s,t,c),this.client.logger.error(c)}},this.onSessionPingResponse=(t,i)=>{const{id:s}=i;setTimeout(()=>{Rt(i)?this.events.emit($e("session_ping",s),{}):Tt(i)&&this.events.emit($e("session_ping",s),{error:i.error})},500)},this.onSessionDeleteRequest=async(t,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),this.client.core.relayer.once(Xe.publish,async()=>{await this.deleteSession(t)}),await this.sendResult(s,t,!0),this.client.events.emit("session_delete",{id:s,topic:t})}catch(c){await this.sendError(s,t,c),this.client.logger.error(c)}},this.onSessionRequest=async(t,i)=>{const{id:s,params:c}=i;try{this.isValidRequest(mt({topic:t},c)),await this.setPendingSessionRequest({id:s,topic:t,params:c}),this.client.events.emit("session_request",{id:s,topic:t,params:c})}catch(y){await this.sendError(s,t,y),this.client.logger.error(y)}},this.onSessionRequestResponse=(t,i)=>{const{id:s}=i;Rt(i)?this.events.emit($e("session_request",s),{result:i.result}):Tt(i)&&this.events.emit($e("session_request",s),{error:i.error})},this.onSessionEventRequest=async(t,i)=>{const{id:s,params:c}=i;try{this.isValidEmit(mt({topic:t},c)),this.client.events.emit("session_event",{id:s,topic:t,params:c})}catch(y){await this.sendError(s,t,y),this.client.logger.error(y)}},this.isValidConnect=async t=>{if(!ot(t)){const{message:l}=B("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:c,sessionProperties:y,relays:h}=t;if(at(i)||await this.isValidPairingTopic(i),!Df(h,!0)){const{message:l}=B("MISSING_OR_INVALID",`connect() relays: ${h}`);throw new Error(l)}!at(s)&&Ir(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!at(c)&&Ir(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),at(y)||this.validateSessionProps(y,"sessionProperties")},this.validateNamespaces=(t,i)=>{const s=vf(t,"connect()",i);if(s)throw new Error(s.message)},this.isValidApprove=async t=>{if(!ot(t))throw new Error(B("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:s,relayProtocol:c,sessionProperties:y}=t;await this.isValidProposalId(i);const h=this.client.proposal.get(i),l=Jr(s,"approve()");if(l)throw new Error(l.message);const w=vn(h.requiredNamespaces,s,"approve()");if(w)throw new Error(w.message);if(!Ze(c,!0)){const{message:m}=B("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(m)}at(y)||this.validateSessionProps(y,"sessionProperties")},this.isValidReject=async t=>{if(!ot(t)){const{message:c}=B("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(c)}const{id:i,reason:s}=t;if(await this.isValidProposalId(i),!If(s)){const{message:c}=B("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidSessionSettleRequest=t=>{if(!ot(t)){const{message:w}=B("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(w)}const{relay:i,controller:s,namespaces:c,expiry:y}=t;if(!za(i)){const{message:w}=B("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(w)}const h=yf(s,"onSessionSettleRequest()");if(h)throw new Error(h.message);const l=Jr(c,"onSessionSettleRequest()");if(l)throw new Error(l.message);if($t(y)){const{message:w}=B("EXPIRED","onSessionSettleRequest()");throw new Error(w)}},this.isValidUpdate=async t=>{if(!ot(t)){const{message:l}=B("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(l)}const{topic:i,namespaces:s}=t;await this.isValidSessionTopic(i);const c=this.client.session.get(i),y=Jr(s,"update()");if(y)throw new Error(y.message);const h=vn(c.requiredNamespaces,s,"update()");if(h)throw new Error(h.message)},this.isValidExtend=async t=>{if(!ot(t)){const{message:s}=B("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionTopic(i)},this.isValidRequest=async t=>{if(!ot(t)){const{message:l}=B("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(l)}const{topic:i,request:s,chainId:c,expiry:y}=t;await this.isValidSessionTopic(i);const{namespaces:h}=this.client.session.get(i);if(!En(h,c)){const{message:l}=B("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(l)}if(!Of(s)){const{message:l}=B("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(l)}if(!Nf(h,c,s.method)){const{message:l}=B("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(l)}if(y&&!Uf(y,Ti)){const{message:l}=B("MISSING_OR_INVALID",`request() expiry: ${y}. Expiry must be a number (in seconds) between ${Ti.min} and ${Ti.max}`);throw new Error(l)}},this.isValidRespond=async t=>{if(!ot(t)){const{message:c}=B("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(c)}const{topic:i,response:s}=t;if(await this.isValidSessionTopic(i),!xf(s)){const{message:c}=B("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidPing=async t=>{if(!ot(t)){const{message:s}=B("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async t=>{if(!ot(t)){const{message:h}=B("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(h)}const{topic:i,event:s,chainId:c}=t;await this.isValidSessionTopic(i);const{namespaces:y}=this.client.session.get(i);if(!En(y,c)){const{message:h}=B("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(h)}if(!Cf(s)){const{message:h}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(h)}if(!Tf(y,c,s.name)){const{message:h}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(h)}},this.isValidDisconnect=async t=>{if(!ot(t)){const{message:s}=B("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)},this.validateSessionProps=(t,i)=>{Object.values(t).forEach(s=>{if(!Ze(s,!1)){const{message:c}=B("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(c)}})}}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(Xe.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const s=await this.client.core.crypto.decode(t,i);is(s)?(this.client.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):ta(s)&&(await this.client.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.client.core.expirer.on(bt.expired,async e=>{const{topic:t,id:i}=Ha(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,B("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!Ze(e,!1)){const{message:t}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if($t(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=B("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Ze(e,!1)){const{message:t}=B("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=B("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if($t(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=B("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ze(e,!1)){const{message:t}=B("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=B("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Sf(e)){const{message:t}=B("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=B("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if($t(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=B("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class wg extends pi{constructor(e,t){super(e,t,hg,_s),this.core=e,this.logger=t}}class _g extends pi{constructor(e,t){super(e,t,ug,_s),this.core=e,this.logger=t}}class Eg extends pi{constructor(e,t){super(e,t,fg,_s),this.core=e,this.logger=t}}let vg=class oo extends ku{constructor(e){super(e),this.protocol=io,this.version=so,this.name=Ni.name,this.events=new dt.EventEmitter,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}},this.update=async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}},this.request=async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}},this.find=i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||Ni.name,this.metadata=(e==null?void 0:e.metadata)||zl();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Pr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ni.logger}));this.core=(e==null?void 0:e.core)||new cg(e),this.logger=Se.generateChildLogger(t,this.name),this.session=new _g(this.core,this.logger),this.proposal=new wg(this.core,this.logger),this.pendingRequest=new Eg(this.core,this.logger),this.engine=new bg(this)}static async init(e){const t=new oo(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.getLocalStorage=xe.getLocalStorageOrThrow=xe.getCrypto=xe.getCryptoOrThrow=xe.getLocation=xe.getLocationOrThrow=xe.getNavigator=xe.getNavigatorOrThrow=xe.getDocument=xe.getDocumentOrThrow=xe.getFromWindowOrThrow=xe.getFromWindow=void 0;function er(r){let e;return typeof window<"u"&&typeof window[r]<"u"&&(e=window[r]),e}xe.getFromWindow=er;function lr(r){const e=er(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}xe.getFromWindowOrThrow=lr;function Dg(){return lr("document")}xe.getDocumentOrThrow=Dg;function Sg(){return er("document")}xe.getDocument=Sg;function Ig(){return lr("navigator")}xe.getNavigatorOrThrow=Ig;function Og(){return er("navigator")}xe.getNavigator=Og;function xg(){return lr("location")}xe.getLocationOrThrow=xg;function Cg(){return er("location")}xe.getLocation=Cg;function Ng(){return lr("crypto")}xe.getCryptoOrThrow=Ng;function Tg(){return er("crypto")}xe.getCrypto=Tg;function Ag(){return lr("localStorage")}xe.getLocalStorageOrThrow=Ag;function Pg(){return er("localStorage")}xe.getLocalStorage=Pg;var Es={};Object.defineProperty(Es,"__esModule",{value:!0});Es.getWindowMetadata=void 0;const Vn=xe;function Ug(){let r,e;try{r=Vn.getDocumentOrThrow(),e=Vn.getLocationOrThrow()}catch{return null}function t(){const _=r.getElementsByTagName("link"),N=[];for(let v=0;v<_.length;v++){const D=_[v],P=D.getAttribute("rel");if(P&&P.toLowerCase().indexOf("icon")>-1){const O=D.getAttribute("href");if(O)if(O.toLowerCase().indexOf("https:")===-1&&O.toLowerCase().indexOf("http:")===-1&&O.indexOf("//")!==0){let F=e.protocol+"//"+e.host;if(O.indexOf("/")===0)F+=O;else{const o=e.pathname.split("/");o.pop();const d=o.join("/");F+=d+"/"+O}N.push(F)}else if(O.indexOf("//")===0){const F=e.protocol+O;N.push(F)}else N.push(O)}}return N}function i(..._){const N=r.getElementsByTagName("meta");for(let v=0;v<N.length;v++){const D=N[v],P=["itemprop","property","name"].map(O=>D.getAttribute(O)).filter(O=>O?_.includes(O):!1);if(P.length&&P){const O=D.getAttribute("content");if(O)return O}}return""}function s(){let _=i("name","og:site_name","og:title","twitter:title");return _||(_=r.title),_}function c(){return i("description","og:description","twitter:description","keywords")}const y=s(),h=c(),l=e.origin,w=t();return{description:h,url:l,icons:w,name:y}}Es.getWindowMetadata=Ug;var Fg={},Rg=r=>encodeURIComponent(r).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`);(function(r){const e=Rg,t=ts,i=Zi,s=es,c=o=>o==null,y=Symbol("encodeFragmentIdentifier");function h(o){switch(o.arrayFormat){case"index":return d=>(u,f)=>{const g=u.length;return f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,[m(d,o),"[",g,"]"].join("")]:[...u,[m(d,o),"[",m(g,o),"]=",m(f,o)].join("")]};case"bracket":return d=>(u,f)=>f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,[m(d,o),"[]"].join("")]:[...u,[m(d,o),"[]=",m(f,o)].join("")];case"colon-list-separator":return d=>(u,f)=>f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,[m(d,o),":list="].join("")]:[...u,[m(d,o),":list=",m(f,o)].join("")];case"comma":case"separator":case"bracket-separator":{const d=o.arrayFormat==="bracket-separator"?"[]=":"=";return u=>(f,g)=>g===void 0||o.skipNull&&g===null||o.skipEmptyString&&g===""?f:(g=g===null?"":g,f.length===0?[[m(u,o),d,m(g,o)].join("")]:[[f,m(g,o)].join(o.arrayFormatSeparator)])}default:return d=>(u,f)=>f===void 0||o.skipNull&&f===null||o.skipEmptyString&&f===""?u:f===null?[...u,m(d,o)]:[...u,[m(d,o),"=",m(f,o)].join("")]}}function l(o){let d;switch(o.arrayFormat){case"index":return(u,f,g)=>{if(d=/\[(\d*)\]$/.exec(u),u=u.replace(/\[\d*\]$/,""),!d){g[u]=f;return}g[u]===void 0&&(g[u]={}),g[u][d[1]]=f};case"bracket":return(u,f,g)=>{if(d=/(\[\])$/.exec(u),u=u.replace(/\[\]$/,""),!d){g[u]=f;return}if(g[u]===void 0){g[u]=[f];return}g[u]=[].concat(g[u],f)};case"colon-list-separator":return(u,f,g)=>{if(d=/(:list)$/.exec(u),u=u.replace(/:list$/,""),!d){g[u]=f;return}if(g[u]===void 0){g[u]=[f];return}g[u]=[].concat(g[u],f)};case"comma":case"separator":return(u,f,g)=>{const n=typeof f=="string"&&f.includes(o.arrayFormatSeparator),p=typeof f=="string"&&!n&&_(f,o).includes(o.arrayFormatSeparator);f=p?_(f,o):f;const U=n||p?f.split(o.arrayFormatSeparator).map(j=>_(j,o)):f===null?f:_(f,o);g[u]=U};case"bracket-separator":return(u,f,g)=>{const n=/(\[\])$/.test(u);if(u=u.replace(/\[\]$/,""),!n){g[u]=f&&_(f,o);return}const p=f===null?[]:f.split(o.arrayFormatSeparator).map(U=>_(U,o));if(g[u]===void 0){g[u]=p;return}g[u]=[].concat(g[u],p)};default:return(u,f,g)=>{if(g[u]===void 0){g[u]=f;return}g[u]=[].concat(g[u],f)}}}function w(o){if(typeof o!="string"||o.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(o,d){return d.encode?d.strict?e(o):encodeURIComponent(o):o}function _(o,d){return d.decode?t(o):o}function N(o){return Array.isArray(o)?o.sort():typeof o=="object"?N(Object.keys(o)).sort((d,u)=>Number(d)-Number(u)).map(d=>o[d]):o}function v(o){const d=o.indexOf("#");return d!==-1&&(o=o.slice(0,d)),o}function D(o){let d="";const u=o.indexOf("#");return u!==-1&&(d=o.slice(u)),d}function P(o){o=v(o);const d=o.indexOf("?");return d===-1?"":o.slice(d+1)}function O(o,d){return d.parseNumbers&&!Number.isNaN(Number(o))&&typeof o=="string"&&o.trim()!==""?o=Number(o):d.parseBooleans&&o!==null&&(o.toLowerCase()==="true"||o.toLowerCase()==="false")&&(o=o.toLowerCase()==="true"),o}function F(o,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),w(d.arrayFormatSeparator);const u=l(d),f=Object.create(null);if(typeof o!="string"||(o=o.trim().replace(/^[?#&]/,""),!o))return f;for(const g of o.split("&")){if(g==="")continue;let[n,p]=i(d.decode?g.replace(/\+/g," "):g,"=");p=p===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?p:_(p,d),u(_(n,d),p,f)}for(const g of Object.keys(f)){const n=f[g];if(typeof n=="object"&&n!==null)for(const p of Object.keys(n))n[p]=O(n[p],d);else f[g]=O(n,d)}return d.sort===!1?f:(d.sort===!0?Object.keys(f).sort():Object.keys(f).sort(d.sort)).reduce((g,n)=>{const p=f[n];return Boolean(p)&&typeof p=="object"&&!Array.isArray(p)?g[n]=N(p):g[n]=p,g},Object.create(null))}r.extract=P,r.parse=F,r.stringify=(o,d)=>{if(!o)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),w(d.arrayFormatSeparator);const u=p=>d.skipNull&&c(o[p])||d.skipEmptyString&&o[p]==="",f=h(d),g={};for(const p of Object.keys(o))u(p)||(g[p]=o[p]);const n=Object.keys(g);return d.sort!==!1&&n.sort(d.sort),n.map(p=>{const U=o[p];return U===void 0?"":U===null?m(p,d):Array.isArray(U)?U.length===0&&d.arrayFormat==="bracket-separator"?m(p,d)+"[]":U.reduce(f(p),[]).join("&"):m(p,d)+"="+m(U,d)}).filter(p=>p.length>0).join("&")},r.parseUrl=(o,d)=>{d=Object.assign({decode:!0},d);const[u,f]=i(o,"#");return Object.assign({url:u.split("?")[0]||"",query:F(P(o),d)},d&&d.parseFragmentIdentifier&&f?{fragmentIdentifier:_(f,d)}:{})},r.stringifyUrl=(o,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const u=v(o.url).split("?")[0]||"",f=r.extract(o.url),g=r.parse(f,{sort:!1}),n=Object.assign(g,o.query);let p=r.stringify(n,d);p&&(p=`?${p}`);let U=D(o.url);return o.fragmentIdentifier&&(U=`#${d[y]?m(o.fragmentIdentifier,d):o.fragmentIdentifier}`),`${u}${p}${U}`},r.pick=(o,d,u)=>{u=Object.assign({parseFragmentIdentifier:!0,[y]:!1},u);const{url:f,query:g,fragmentIdentifier:n}=r.parseUrl(o,u);return r.stringifyUrl({url:f,query:s(g,d),fragmentIdentifier:n},u)},r.exclude=(o,d,u)=>{const f=Array.isArray(d)?g=>!d.includes(g):(g,n)=>!d(g,n);return r.pick(o,f,u)}})(Fg);const $g={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Gn(r,e){const{message:t,code:i}=$g[r];return{message:e?`${t} ${e}`:t,code:i}}function Lg(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}const kn="error",Mg="wss://relay.walletconnect.com",jg="wc",Hg="universal_provider",Wn=`${jg}@${2}:${Hg}:`,qg="https://rpc.walletconnect.com/v1",Lr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function ar(r,e,t){let i;const s=Yi(r);return e.rpcMap&&(i=e.rpcMap[s]),i||(i=`${qg}?chainId=eip155:${s}&projectId=${t}`),i}function Yi(r){return r.includes("eip155")?Number(r.split(":")[1]):Number(r)}function zg(r,e){if(!e.includes(r))throw new Error(`Chain '${r}' not approved. Please use one of the following: ${e.toString()}`)}function Kg(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}const gi=(r,e)=>{const t=i=>{i.request!==e.request||i.topic!==e.topic||(r.events.removeListener("session_request_sent",t),Bg())};r.on("session_request_sent",t)};function Bg(){if(typeof window<"u")try{const r=window.localStorage.getItem("WALLETCONNECT_DEEPLINK_CHOICE");if(r){const e=JSON.parse(r);window.open(e.href,"_self","noreferrer noopener")}}catch(r){console.error(r)}}let Vg=class{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){var t;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return this.handleSwitchChain(e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0"),null;case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(e.request.method)?(gi(this.client,e),await this.client.request(e)):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){const i=Yi(e);if(!this.httpProviders[i]){const s=t||ar(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,s)}this.chainId=i,this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||ar(`${this.name}:${e}`,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new Nr(new ii(i))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=Yi(t);e[i]=this.createHttpProvider(i)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}handleSwitchChain(e){const t=parseInt(e,16),i=`${this.name}:${t}`;zg(i,this.namespace.chains),this.setDefaultChain(`${t}`)}},Gg=class{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?(gi(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||ar(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ar(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new Nr(new ii(i))}};class kg{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?(gi(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||ar(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ar(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new Nr(new ii(i))}}class Wg{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?(gi(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Lr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t);e[t]=this.createHttpProvider(t,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);return typeof i>"u"?void 0:new Nr(new ii(i))}}var Yg=Object.defineProperty,Jg=Object.defineProperties,Xg=Object.getOwnPropertyDescriptors,Yn=Object.getOwnPropertySymbols,Qg=Object.prototype.hasOwnProperty,Zg=Object.prototype.propertyIsEnumerable,Jn=(r,e,t)=>e in r?Yg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wr=(r,e)=>{for(var t in e||(e={}))Qg.call(e,t)&&Jn(r,t,e[t]);if(Yn)for(var t of Yn(e))Zg.call(e,t)&&Jn(r,t,e[t]);return r},Pi=(r,e)=>Jg(r,Xg(e));class vs{constructor(e){this.events=new dt,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Pr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||kn}))}static async init(e){const t=new vs(e);return await t.initialize(),t}async request(e,t){const[i,s]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Wr({},e),chainId:`${i}:${s}`,topic:this.session.topic})}sendAsync(e,t,i){this.request(e,i).then(s=>t(null,s)).catch(s=>t(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Gn("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:i,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});i&&(this.uri=i,this.events.emit("display_uri",i)),await s().then(c=>{this.session=c}).catch(c=>{if(c.message!==ao)throw c;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,t){try{const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Lg(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await vg.init({logger:this.providerOpts.logger||kn,relayUrl:this.providerOpts.relayUrl||Mg,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{var t,i,s;const c=((t=this.session)==null?void 0:t.namespaces[e].accounts)||[],y=Kg(c),h=Pi(Wr({},Object.assign(this.namespaces[e],(s=(i=this.optionalNamespaces)==null?void 0:i[e])!=null?s:{})),{accounts:c,chains:y});switch(e){case"eip155":this.rpcProviders[e]=new Vg({client:this.client,namespace:h,events:this.events});break;case"solana":this.rpcProviders[e]=new Gg({client:this.client,namespace:h,events:this.events});break;case"cosmos":this.rpcProviders[e]=new kg({client:this.client,namespace:h,events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new Wg({client:this.client,namespace:h,events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:i}=t;i.name==="accountsChanged"?this.events.emit("accountsChanged",i.data):i.name==="chainChanged"?this.onChainChanged(t.chainId):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i;const{namespaces:s}=t,c=(i=this.client)==null?void 0:i.session.get(e);this.session=Pi(Wr({},c),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Pi(Wr({},Gn("USER_DISCONNECTED")),{data:e.topic}))}),this.on(Lr.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:i,sessionProperties:s}=e;if(!t||!Object.keys(t).length)throw new Error("Namespaces must be not empty");this.namespaces=t,this.optionalNamespaces=i,this.sessionProperties=s,this.persist("namespaces",t),this.persist("optionalNamespaces",i)}validateChain(e){const[t,i]=(e==null?void 0:e.split(":"))||["",""];if(t&&!Object.keys(this.namespaces).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=Object.keys(this.namespaces)[0],c=this.rpcProviders[s].getDefaultChain();return[s,c]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){const[i,s]=this.validateChain(e);t||this.getProvider(i).setDefaultChain(s),this.namespaces[i].defaultChain=s,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",s)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${Wn}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${Wn}/${e}`)}}const e0=vs,t0="wc",r0="ethereum_provider",i0=`${t0}@${2}:${r0}:`,s0="https://rpc.walletconnect.com/v1/",Ji=["eth_sendTransaction","personal_sign"],I0=["eth_accounts","eth_requestAccounts","eth_call","eth_getBalance","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Xi=["chainChanged","accountsChanged"],O0=["message","disconnect","connect"];var n0=Object.defineProperty,a0=Object.defineProperties,o0=Object.getOwnPropertyDescriptors,Xn=Object.getOwnPropertySymbols,c0=Object.prototype.hasOwnProperty,h0=Object.prototype.propertyIsEnumerable,Qn=(r,e,t)=>e in r?n0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Zn=(r,e)=>{for(var t in e||(e={}))c0.call(e,t)&&Qn(r,t,e[t]);if(Xn)for(var t of Xn(e))h0.call(e,t)&&Qn(r,t,e[t]);return r},ea=(r,e)=>a0(r,o0(e));function Qi(r){return Number(r[0].split(":")[1])}function Ui(r){return`0x${r.toString(16)}`}function u0(r){const{chains:e,optionalChains:t,methods:i,optionalMethods:s,events:c,optionalEvents:y,rpcMap:h}=r;if(!Hi(e))throw new Error("Invalid chains");const l=e,w=i||Ji,m=c||Xi,_={[Qi(l)]:h[Qi(l)]},N={chains:l,methods:w,events:m,rpcMap:_},v=c==null?void 0:c.filter(F=>!Xi.includes(F)),D=i==null?void 0:i.filter(F=>!Ji.includes(F));if(!t&&!y&&!s&&!(v!=null&&v.length)&&!(D!=null&&D.length))return{required:N};const P=(v==null?void 0:v.length)&&(D==null?void 0:D.length)||!t,O={chains:[...new Set(P?l.concat(t||[]):t)],methods:[...new Set(w.concat(s||[]))],events:[...new Set(m.concat(y||[]))],rpcMap:h};return{required:N,optional:O}}class Ds{constructor(){this.events=new dt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=i0,this.on=(e,t)=>(this.events.on(e,t),this),this.once=(e,t)=>(this.events.once(e,t),this),this.removeListener=(e,t)=>(this.events.removeListener(e,t),this),this.off=(e,t)=>(this.events.off(e,t),this),this.parseAccount=e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e,this.signer={},this.rpc={}}static async init(e){const t=new Ds;return await t.initialize(e),t}async request(e){return await this.signer.request(e,this.formatChainId(this.chainId))}sendAsync(e,t){this.signer.sendAsync(e,t,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:t,optional:i}=u0(this.rpc);try{const s=await new Promise(async(y,h)=>{var l;this.rpc.showQrModal&&((l=this.modal)==null||l.subscribeModal(w=>{!w.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),h(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(ea(Zn({namespaces:{[this.namespace]:t}},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e==null?void 0:e.pairingTopic})).then(w=>{y(w)}).catch(w=>{h(new Error(w.message))})});if(!s)return;this.setChainIds(this.rpc.chains);const c=cu(s.namespaces,[this.namespace]);this.setAccounts(c),this.events.emit("connect",{chainId:Ui(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:i}=t;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",Ui(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",ea(Zn({},uu("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var t,i;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(i=this.modal)==null||i.openModal({uri:e})),this.events.emit("display_uri",e)})}setHttpProvider(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",Ui(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.setHttpProvider(t)}}parseAccountId(e){const[t,i,s]=e.split(":");return{chainId:`${t}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,i;return{chains:((t=e.chains)==null?void 0:t.map(s=>this.formatChainId(s)))||[`${this.namespace}:1`],optionalChains:e.optionalChains?e.optionalChains.map(s=>this.formatChainId(s)):void 0,methods:(e==null?void 0:e.methods)||Ji,events:(e==null?void 0:e.events)||Xi,optionalMethods:(e==null?void 0:e.optionalMethods)||[],optionalEvents:(e==null?void 0:e.optionalEvents)||[],rpcMap:(e==null?void 0:e.rpcMap)||this.buildRpcMap(e.chains.concat(e.optionalChains||[]),e.projectId),showQrModal:(i=e==null?void 0:e.showQrModal)!=null?i:!0,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,t)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=Qi(this.rpc.chains),this.signer=await e0.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){const{Web3Modal:t}=await Jo(()=>import("./index.7f4746d8.js"),["assets/chunks/index.7f4746d8.js","assets/app.4bdd8d54.js","assets/reservation2.md.d4d0605d.js"]);this.modal=new t({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains})}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:i,rpcMap:s}=e;t&&Hi(t)&&(this.rpc.chains=t.map(c=>this.formatChainId(c)),t.forEach(c=>{this.rpc.rpcMap[c]=(s==null?void 0:s[c])||this.getRpcUrl(c)})),i&&Hi(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i==null?void 0:i.map(c=>this.formatChainId(c)),i.forEach(c=>{this.rpc.rpcMap[c]=(s==null?void 0:s[c])||this.getRpcUrl(c)}))}getRpcUrl(e,t){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${s0}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`);this.setChainIds(e?[this.formatChainId(e)]:this.session.namespaces[this.namespace].accounts),this.setAccounts(this.session.namespaces[this.namespace].accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const x0=Ds;export{x0 as EthereumProvider,O0 as OPTIONAL_EVENTS,I0 as OPTIONAL_METHODS,Xi as REQUIRED_EVENTS,Ji as REQUIRED_METHODS,Ds as default};
