import{a1 as Eo}from"./framework.3ce015e4.js";import{t as mt,s as Do,f as So,a as Io,d as xo,g as Co,b as Oo,c as Po,e as Ao,h as An,i as ct,j as $r,I as No,k as zi,l as Dt,m as Mr,n as fs,o as To,p as Ro,q as Nn,r as jr,u as Fo,v as qr,w as zr,x as Nt,J as Hi,H as Ki}from"./http.95fb23d5.js";import{r as Uo,a as Lo,c as Vt,b as $o}from"../app.77d96e20.js";import"./theme.334f1899.js";var Hr={},Bi={},se={},Tn={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});function e(c,h){var p=c>>>16&65535,y=c&65535,I=h>>>16&65535,A=h&65535;return y*A+(p*A+y*I<<16>>>0)|0}i.mul=Math.imul||e;function t(c,h){return c+h|0}i.add=t;function r(c,h){return c-h|0}i.sub=r;function s(c,h){return c<<h|c>>>32-h}i.rotl=s;function o(c,h){return c<<32-h|c>>>h}i.rotr=o;function l(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}i.isInteger=Number.isInteger||l,i.MAX_SAFE_INTEGER=9007199254740991,i.isSafeInteger=function(c){return i.isInteger(c)&&c>=-i.MAX_SAFE_INTEGER&&c<=i.MAX_SAFE_INTEGER}})(Tn);Object.defineProperty(se,"__esModule",{value:!0});var Rn=Tn;function Mo(i,e){return e===void 0&&(e=0),(i[e+0]<<8|i[e+1])<<16>>16}se.readInt16BE=Mo;function jo(i,e){return e===void 0&&(e=0),(i[e+0]<<8|i[e+1])>>>0}se.readUint16BE=jo;function qo(i,e){return e===void 0&&(e=0),(i[e+1]<<8|i[e])<<16>>16}se.readInt16LE=qo;function zo(i,e){return e===void 0&&(e=0),(i[e+1]<<8|i[e])>>>0}se.readUint16LE=zo;function Fn(i,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=i>>>8,e[t+1]=i>>>0,e}se.writeUint16BE=Fn;se.writeInt16BE=Fn;function Un(i,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=i>>>0,e[t+1]=i>>>8,e}se.writeUint16LE=Un;se.writeInt16LE=Un;function wr(i,e){return e===void 0&&(e=0),i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}se.readInt32BE=wr;function vr(i,e){return e===void 0&&(e=0),(i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3])>>>0}se.readUint32BE=vr;function Er(i,e){return e===void 0&&(e=0),i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e]}se.readInt32LE=Er;function Dr(i,e){return e===void 0&&(e=0),(i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e])>>>0}se.readUint32LE=Dr;function Ui(i,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=i>>>24,e[t+1]=i>>>16,e[t+2]=i>>>8,e[t+3]=i>>>0,e}se.writeUint32BE=Ui;se.writeInt32BE=Ui;function Li(i,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=i>>>0,e[t+1]=i>>>8,e[t+2]=i>>>16,e[t+3]=i>>>24,e}se.writeUint32LE=Li;se.writeInt32LE=Li;function Ho(i,e){e===void 0&&(e=0);var t=wr(i,e),r=wr(i,e+4);return t*4294967296+r-(r>>31)*4294967296}se.readInt64BE=Ho;function Ko(i,e){e===void 0&&(e=0);var t=vr(i,e),r=vr(i,e+4);return t*4294967296+r}se.readUint64BE=Ko;function Bo(i,e){e===void 0&&(e=0);var t=Er(i,e),r=Er(i,e+4);return r*4294967296+t-(t>>31)*4294967296}se.readInt64LE=Bo;function Vo(i,e){e===void 0&&(e=0);var t=Dr(i,e),r=Dr(i,e+4);return r*4294967296+t}se.readUint64LE=Vo;function Ln(i,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Ui(i/4294967296>>>0,e,t),Ui(i>>>0,e,t+4),e}se.writeUint64BE=Ln;se.writeInt64BE=Ln;function $n(i,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Li(i>>>0,e,t),Li(i/4294967296>>>0,e,t+4),e}se.writeUint64LE=$n;se.writeInt64LE=$n;function Go(i,e,t){if(t===void 0&&(t=0),i%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(i/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var r=0,s=1,o=i/8+t-1;o>=t;o--)r+=e[o]*s,s*=256;return r}se.readUintBE=Go;function ko(i,e,t){if(t===void 0&&(t=0),i%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(i/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var r=0,s=1,o=t;o<t+i/8;o++)r+=e[o]*s,s*=256;return r}se.readUintLE=ko;function Yo(i,e,t,r){if(t===void 0&&(t=new Uint8Array(i/8)),r===void 0&&(r=0),i%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!Rn.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,o=i/8+r-1;o>=r;o--)t[o]=e/s&255,s*=256;return t}se.writeUintBE=Yo;function Wo(i,e,t,r){if(t===void 0&&(t=new Uint8Array(i/8)),r===void 0&&(r=0),i%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!Rn.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,o=r;o<r+i/8;o++)t[o]=e/s&255,s*=256;return t}se.writeUintLE=Wo;function Jo(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat32(e)}se.readFloat32BE=Jo;function Xo(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat32(e,!0)}se.readFloat32LE=Xo;function Qo(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat64(e)}se.readFloat64BE=Qo;function Zo(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat64(e,!0)}se.readFloat64LE=Zo;function ec(i,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat32(t,i),e}se.writeFloat32BE=ec;function tc(i,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat32(t,i,!0),e}se.writeFloat32LE=tc;function ic(i,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat64(t,i),e}se.writeFloat64BE=ic;function rc(i,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat64(t,i,!0),e}se.writeFloat64LE=rc;var lt={};Object.defineProperty(lt,"__esModule",{value:!0});function sc(i){for(var e=0;e<i.length;e++)i[e]=0;return i}lt.wipe=sc;Object.defineProperty(Bi,"__esModule",{value:!0});var tt=se,Sr=lt,nc=20;function ac(i,e,t){for(var r=1634760805,s=857760878,o=2036477234,l=1797285236,c=t[3]<<24|t[2]<<16|t[1]<<8|t[0],h=t[7]<<24|t[6]<<16|t[5]<<8|t[4],p=t[11]<<24|t[10]<<16|t[9]<<8|t[8],y=t[15]<<24|t[14]<<16|t[13]<<8|t[12],I=t[19]<<24|t[18]<<16|t[17]<<8|t[16],A=t[23]<<24|t[22]<<16|t[21]<<8|t[20],S=t[27]<<24|t[26]<<16|t[25]<<8|t[24],x=t[31]<<24|t[30]<<16|t[29]<<8|t[28],N=e[3]<<24|e[2]<<16|e[1]<<8|e[0],$=e[7]<<24|e[6]<<16|e[5]<<8|e[4],B=e[11]<<24|e[10]<<16|e[9]<<8|e[8],_=e[15]<<24|e[14]<<16|e[13]<<8|e[12],D=r,g=s,m=o,f=l,n=c,u=h,T=p,R=y,H=I,G=A,X=S,E=x,P=N,k=$,j=B,U=_,M=0;M<nc;M+=2)D=D+n|0,P^=D,P=P>>>32-16|P<<16,H=H+P|0,n^=H,n=n>>>32-12|n<<12,g=g+u|0,k^=g,k=k>>>32-16|k<<16,G=G+k|0,u^=G,u=u>>>32-12|u<<12,m=m+T|0,j^=m,j=j>>>32-16|j<<16,X=X+j|0,T^=X,T=T>>>32-12|T<<12,f=f+R|0,U^=f,U=U>>>32-16|U<<16,E=E+U|0,R^=E,R=R>>>32-12|R<<12,m=m+T|0,j^=m,j=j>>>32-8|j<<8,X=X+j|0,T^=X,T=T>>>32-7|T<<7,f=f+R|0,U^=f,U=U>>>32-8|U<<8,E=E+U|0,R^=E,R=R>>>32-7|R<<7,g=g+u|0,k^=g,k=k>>>32-8|k<<8,G=G+k|0,u^=G,u=u>>>32-7|u<<7,D=D+n|0,P^=D,P=P>>>32-8|P<<8,H=H+P|0,n^=H,n=n>>>32-7|n<<7,D=D+u|0,U^=D,U=U>>>32-16|U<<16,X=X+U|0,u^=X,u=u>>>32-12|u<<12,g=g+T|0,P^=g,P=P>>>32-16|P<<16,E=E+P|0,T^=E,T=T>>>32-12|T<<12,m=m+R|0,k^=m,k=k>>>32-16|k<<16,H=H+k|0,R^=H,R=R>>>32-12|R<<12,f=f+n|0,j^=f,j=j>>>32-16|j<<16,G=G+j|0,n^=G,n=n>>>32-12|n<<12,m=m+R|0,k^=m,k=k>>>32-8|k<<8,H=H+k|0,R^=H,R=R>>>32-7|R<<7,f=f+n|0,j^=f,j=j>>>32-8|j<<8,G=G+j|0,n^=G,n=n>>>32-7|n<<7,g=g+T|0,P^=g,P=P>>>32-8|P<<8,E=E+P|0,T^=E,T=T>>>32-7|T<<7,D=D+u|0,U^=D,U=U>>>32-8|U<<8,X=X+U|0,u^=X,u=u>>>32-7|u<<7;tt.writeUint32LE(D+r|0,i,0),tt.writeUint32LE(g+s|0,i,4),tt.writeUint32LE(m+o|0,i,8),tt.writeUint32LE(f+l|0,i,12),tt.writeUint32LE(n+c|0,i,16),tt.writeUint32LE(u+h|0,i,20),tt.writeUint32LE(T+p|0,i,24),tt.writeUint32LE(R+y|0,i,28),tt.writeUint32LE(H+I|0,i,32),tt.writeUint32LE(G+A|0,i,36),tt.writeUint32LE(X+S|0,i,40),tt.writeUint32LE(E+x|0,i,44),tt.writeUint32LE(P+N|0,i,48),tt.writeUint32LE(k+$|0,i,52),tt.writeUint32LE(j+B|0,i,56),tt.writeUint32LE(U+_|0,i,60)}function Mn(i,e,t,r,s){if(s===void 0&&(s=0),i.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(r.length<t.length)throw new Error("ChaCha: destination is shorter than source");var o,l;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");o=new Uint8Array(16),l=o.length-e.length,o.set(e,l)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");o=e,l=s}for(var c=new Uint8Array(64),h=0;h<t.length;h+=64){ac(c,o,i);for(var p=h;p<h+64&&p<t.length;p++)r[p]=t[p]^c[p-h];cc(o,0,l)}return Sr.wipe(c),s===0&&Sr.wipe(o),r}Bi.streamXOR=Mn;function oc(i,e,t,r){return r===void 0&&(r=0),Sr.wipe(t),Mn(i,e,t,t,r)}Bi.stream=oc;function cc(i,e,t){for(var r=1;t--;)r=r+(i[e]&255)|0,i[e]=r&255,r>>>=8,e++;if(r>0)throw new Error("ChaCha: counter overflow")}var jn={},Ut={};Object.defineProperty(Ut,"__esModule",{value:!0});function hc(i,e,t){return~(i-1)&e|i-1&t}Ut.select=hc;function uc(i,e){return(i|0)-(e|0)-1>>>31&1}Ut.lessOrEqual=uc;function qn(i,e){if(i.length!==e.length)return 0;for(var t=0,r=0;r<i.length;r++)t|=i[r]^e[r];return 1&t-1>>>8}Ut.compare=qn;function lc(i,e){return i.length===0||e.length===0?!1:qn(i,e)!==0}Ut.equal=lc;(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=Ut,t=lt;i.DIGEST_LENGTH=16;var r=function(){function l(c){this.digestLength=i.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=c[0]|c[1]<<8;this._r[0]=h&8191;var p=c[2]|c[3]<<8;this._r[1]=(h>>>13|p<<3)&8191;var y=c[4]|c[5]<<8;this._r[2]=(p>>>10|y<<6)&7939;var I=c[6]|c[7]<<8;this._r[3]=(y>>>7|I<<9)&8191;var A=c[8]|c[9]<<8;this._r[4]=(I>>>4|A<<12)&255,this._r[5]=A>>>1&8190;var S=c[10]|c[11]<<8;this._r[6]=(A>>>14|S<<2)&8191;var x=c[12]|c[13]<<8;this._r[7]=(S>>>11|x<<5)&8065;var N=c[14]|c[15]<<8;this._r[8]=(x>>>8|N<<8)&8191,this._r[9]=N>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return l.prototype._blocks=function(c,h,p){for(var y=this._fin?0:2048,I=this._h[0],A=this._h[1],S=this._h[2],x=this._h[3],N=this._h[4],$=this._h[5],B=this._h[6],_=this._h[7],D=this._h[8],g=this._h[9],m=this._r[0],f=this._r[1],n=this._r[2],u=this._r[3],T=this._r[4],R=this._r[5],H=this._r[6],G=this._r[7],X=this._r[8],E=this._r[9];p>=16;){var P=c[h+0]|c[h+1]<<8;I+=P&8191;var k=c[h+2]|c[h+3]<<8;A+=(P>>>13|k<<3)&8191;var j=c[h+4]|c[h+5]<<8;S+=(k>>>10|j<<6)&8191;var U=c[h+6]|c[h+7]<<8;x+=(j>>>7|U<<9)&8191;var M=c[h+8]|c[h+9]<<8;N+=(U>>>4|M<<12)&8191,$+=M>>>1&8191;var F=c[h+10]|c[h+11]<<8;B+=(M>>>14|F<<2)&8191;var q=c[h+12]|c[h+13]<<8;_+=(F>>>11|q<<5)&8191;var te=c[h+14]|c[h+15]<<8;D+=(q>>>8|te<<8)&8191,g+=te>>>5|y;var z=0,Q=z;Q+=I*m,Q+=A*(5*E),Q+=S*(5*X),Q+=x*(5*G),Q+=N*(5*H),z=Q>>>13,Q&=8191,Q+=$*(5*R),Q+=B*(5*T),Q+=_*(5*u),Q+=D*(5*n),Q+=g*(5*f),z+=Q>>>13,Q&=8191;var W=z;W+=I*f,W+=A*m,W+=S*(5*E),W+=x*(5*X),W+=N*(5*G),z=W>>>13,W&=8191,W+=$*(5*H),W+=B*(5*R),W+=_*(5*T),W+=D*(5*u),W+=g*(5*n),z+=W>>>13,W&=8191;var ee=z;ee+=I*n,ee+=A*f,ee+=S*m,ee+=x*(5*E),ee+=N*(5*X),z=ee>>>13,ee&=8191,ee+=$*(5*G),ee+=B*(5*H),ee+=_*(5*R),ee+=D*(5*T),ee+=g*(5*u),z+=ee>>>13,ee&=8191;var O=z;O+=I*u,O+=A*n,O+=S*f,O+=x*m,O+=N*(5*E),z=O>>>13,O&=8191,O+=$*(5*X),O+=B*(5*G),O+=_*(5*H),O+=D*(5*R),O+=g*(5*T),z+=O>>>13,O&=8191;var C=z;C+=I*T,C+=A*u,C+=S*n,C+=x*f,C+=N*m,z=C>>>13,C&=8191,C+=$*(5*E),C+=B*(5*X),C+=_*(5*G),C+=D*(5*H),C+=g*(5*R),z+=C>>>13,C&=8191;var w=z;w+=I*R,w+=A*T,w+=S*u,w+=x*n,w+=N*f,z=w>>>13,w&=8191,w+=$*m,w+=B*(5*E),w+=_*(5*X),w+=D*(5*G),w+=g*(5*H),z+=w>>>13,w&=8191;var a=z;a+=I*H,a+=A*R,a+=S*T,a+=x*u,a+=N*n,z=a>>>13,a&=8191,a+=$*f,a+=B*m,a+=_*(5*E),a+=D*(5*X),a+=g*(5*G),z+=a>>>13,a&=8191;var b=z;b+=I*G,b+=A*H,b+=S*R,b+=x*T,b+=N*u,z=b>>>13,b&=8191,b+=$*n,b+=B*f,b+=_*m,b+=D*(5*E),b+=g*(5*X),z+=b>>>13,b&=8191;var K=z;K+=I*X,K+=A*G,K+=S*H,K+=x*R,K+=N*T,z=K>>>13,K&=8191,K+=$*u,K+=B*n,K+=_*f,K+=D*m,K+=g*(5*E),z+=K>>>13,K&=8191;var Y=z;Y+=I*E,Y+=A*X,Y+=S*G,Y+=x*H,Y+=N*R,z=Y>>>13,Y&=8191,Y+=$*T,Y+=B*u,Y+=_*n,Y+=D*f,Y+=g*m,z+=Y>>>13,Y&=8191,z=(z<<2)+z|0,z=z+Q|0,Q=z&8191,z=z>>>13,W+=z,I=Q,A=W,S=ee,x=O,N=C,$=w,B=a,_=b,D=K,g=Y,h+=16,p-=16}this._h[0]=I,this._h[1]=A,this._h[2]=S,this._h[3]=x,this._h[4]=N,this._h[5]=$,this._h[6]=B,this._h[7]=_,this._h[8]=D,this._h[9]=g},l.prototype.finish=function(c,h){h===void 0&&(h=0);var p=new Uint16Array(10),y,I,A,S;if(this._leftover){for(S=this._leftover,this._buffer[S++]=1;S<16;S++)this._buffer[S]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(y=this._h[1]>>>13,this._h[1]&=8191,S=2;S<10;S++)this._h[S]+=y,y=this._h[S]>>>13,this._h[S]&=8191;for(this._h[0]+=y*5,y=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=y,y=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=y,p[0]=this._h[0]+5,y=p[0]>>>13,p[0]&=8191,S=1;S<10;S++)p[S]=this._h[S]+y,y=p[S]>>>13,p[S]&=8191;for(p[9]-=1<<13,I=(y^1)-1,S=0;S<10;S++)p[S]&=I;for(I=~I,S=0;S<10;S++)this._h[S]=this._h[S]&I|p[S];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,A=this._h[0]+this._pad[0],this._h[0]=A&65535,S=1;S<8;S++)A=(this._h[S]+this._pad[S]|0)+(A>>>16)|0,this._h[S]=A&65535;return c[h+0]=this._h[0]>>>0,c[h+1]=this._h[0]>>>8,c[h+2]=this._h[1]>>>0,c[h+3]=this._h[1]>>>8,c[h+4]=this._h[2]>>>0,c[h+5]=this._h[2]>>>8,c[h+6]=this._h[3]>>>0,c[h+7]=this._h[3]>>>8,c[h+8]=this._h[4]>>>0,c[h+9]=this._h[4]>>>8,c[h+10]=this._h[5]>>>0,c[h+11]=this._h[5]>>>8,c[h+12]=this._h[6]>>>0,c[h+13]=this._h[6]>>>8,c[h+14]=this._h[7]>>>0,c[h+15]=this._h[7]>>>8,this._finished=!0,this},l.prototype.update=function(c){var h=0,p=c.length,y;if(this._leftover){y=16-this._leftover,y>p&&(y=p);for(var I=0;I<y;I++)this._buffer[this._leftover+I]=c[h+I];if(p-=y,h+=y,this._leftover+=y,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(p>=16&&(y=p-p%16,this._blocks(c,h,y),h+=y,p-=y),p){for(var I=0;I<p;I++)this._buffer[this._leftover+I]=c[h+I];this._leftover+=p}return this},l.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},l.prototype.clean=function(){return t.wipe(this._buffer),t.wipe(this._r),t.wipe(this._h),t.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},l}();i.Poly1305=r;function s(l,c){var h=new r(l);h.update(c);var p=h.digest();return h.clean(),p}i.oneTimeAuth=s;function o(l,c){return l.length!==i.DIGEST_LENGTH||c.length!==i.DIGEST_LENGTH?!1:e.equal(l,c)}i.equal=o})(jn);(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=Bi,t=jn,r=lt,s=se,o=Ut;i.KEY_LENGTH=32,i.NONCE_LENGTH=12,i.TAG_LENGTH=16;var l=new Uint8Array(16),c=function(){function h(p){if(this.nonceLength=i.NONCE_LENGTH,this.tagLength=i.TAG_LENGTH,p.length!==i.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(p)}return h.prototype.seal=function(p,y,I,A){if(p.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var S=new Uint8Array(16);S.set(p,S.length-p.length);var x=new Uint8Array(32);e.stream(this._key,S,x,4);var N=y.length+this.tagLength,$;if(A){if(A.length!==N)throw new Error("ChaCha20Poly1305: incorrect destination length");$=A}else $=new Uint8Array(N);return e.streamXOR(this._key,S,y,$,4),this._authenticate($.subarray($.length-this.tagLength,$.length),x,$.subarray(0,$.length-this.tagLength),I),r.wipe(S),$},h.prototype.open=function(p,y,I,A){if(p.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(y.length<this.tagLength)return null;var S=new Uint8Array(16);S.set(p,S.length-p.length);var x=new Uint8Array(32);e.stream(this._key,S,x,4);var N=new Uint8Array(this.tagLength);if(this._authenticate(N,x,y.subarray(0,y.length-this.tagLength),I),!o.equal(N,y.subarray(y.length-this.tagLength,y.length)))return null;var $=y.length-this.tagLength,B;if(A){if(A.length!==$)throw new Error("ChaCha20Poly1305: incorrect destination length");B=A}else B=new Uint8Array($);return e.streamXOR(this._key,S,y.subarray(0,y.length-this.tagLength),B,4),r.wipe(S),B},h.prototype.clean=function(){return r.wipe(this._key),this},h.prototype._authenticate=function(p,y,I,A){var S=new t.Poly1305(y);A&&(S.update(A),A.length%16>0&&S.update(l.subarray(A.length%16))),S.update(I),I.length%16>0&&S.update(l.subarray(I.length%16));var x=new Uint8Array(8);A&&s.writeUint64LE(A.length,x),S.update(x),s.writeUint64LE(I.length,x),S.update(x);for(var N=S.digest(),$=0;$<N.length;$++)p[$]=N[$];S.clean(),r.wipe(N),r.wipe(x)},h}();i.ChaCha20Poly1305=c})(Hr);var zn={},yi={},Kr={};Object.defineProperty(Kr,"__esModule",{value:!0});function fc(i){return typeof i.saveState<"u"&&typeof i.restoreState<"u"&&typeof i.cleanSavedState<"u"}Kr.isSerializableHash=fc;Object.defineProperty(yi,"__esModule",{value:!0});var wt=Kr,dc=Ut,pc=lt,Hn=function(){function i(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var r=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(r).clean():r.set(t);for(var s=0;s<r.length;s++)r[s]^=54;this._inner.update(r);for(var s=0;s<r.length;s++)r[s]^=106;this._outer.update(r),wt.isSerializableHash(this._inner)&&wt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),pc.wipe(r)}return i.prototype.reset=function(){if(!wt.isSerializableHash(this._inner)||!wt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},i.prototype.clean=function(){wt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),wt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},i.prototype.update=function(e){return this._inner.update(e),this},i.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},i.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},i.prototype.saveState=function(){if(!wt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},i.prototype.restoreState=function(e){if(!wt.isSerializableHash(this._inner)||!wt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},i.prototype.cleanSavedState=function(e){if(!wt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},i}();yi.HMAC=Hn;function gc(i,e,t){var r=new Hn(i,e);r.update(t);var s=r.digest();return r.clean(),s}yi.hmac=gc;yi.equal=dc.equal;Object.defineProperty(zn,"__esModule",{value:!0});var ds=yi,ps=lt,yc=function(){function i(e,t,r,s){r===void 0&&(r=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var o=ds.hmac(this._hash,r,t);this._hmac=new ds.HMAC(e,o),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return i.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},i.prototype.expand=function(e){for(var t=new Uint8Array(e),r=0;r<t.length;r++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[r]=this._buffer[this._bufpos++];return t},i.prototype.clean=function(){this._hmac.clean(),ps.wipe(this._buffer),ps.wipe(this._counter),this._bufpos=0},i}(),bc=zn.HKDF=yc,Zt={},Vi={},Gi={};Object.defineProperty(Gi,"__esModule",{value:!0});Gi.BrowserRandomSource=void 0;const gs=65536;class mc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let r=0;r<t.length;r+=gs)this._crypto.getRandomValues(t.subarray(r,r+Math.min(t.length-r,gs)));return t}}Gi.BrowserRandomSource=mc;function _c(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ki={};Object.defineProperty(ki,"__esModule",{value:!0});ki.NodeRandomSource=void 0;const wc=lt;class vc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof _c<"u"){const e=Uo;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const r=new Uint8Array(e);for(let s=0;s<r.length;s++)r[s]=t[s];return(0,wc.wipe)(t),r}}ki.NodeRandomSource=vc;Object.defineProperty(Vi,"__esModule",{value:!0});Vi.SystemRandomSource=void 0;const Ec=Gi,Dc=ki;class Sc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Ec.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Dc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Vi.SystemRandomSource=Sc;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.randomStringForEntropy=i.randomString=i.randomUint32=i.randomBytes=i.defaultRandomSource=void 0;const e=Vi,t=se,r=lt;i.defaultRandomSource=new e.SystemRandomSource;function s(p,y=i.defaultRandomSource){return y.randomBytes(p)}i.randomBytes=s;function o(p=i.defaultRandomSource){const y=s(4,p),I=(0,t.readUint32LE)(y);return(0,r.wipe)(y),I}i.randomUint32=o;const l="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(p,y=l,I=i.defaultRandomSource){if(y.length<2)throw new Error("randomString charset is too short");if(y.length>256)throw new Error("randomString charset is too long");let A="";const S=y.length,x=256-256%S;for(;p>0;){const N=s(Math.ceil(p*256/x),I);for(let $=0;$<N.length&&p>0;$++){const B=N[$];B<x&&(A+=y.charAt(B%S),p--)}(0,r.wipe)(N)}return A}i.randomString=c;function h(p,y=l,I=i.defaultRandomSource){const A=Math.ceil(p/(Math.log(y.length)/Math.LN2));return c(A,y,I)}i.randomStringForEntropy=h})(Zt);var Yi={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=se,t=lt;i.DIGEST_LENGTH=32,i.BLOCK_SIZE=64;var r=function(){function c(){this.digestLength=i.DIGEST_LENGTH,this.blockSize=i.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._temp),this.reset()},c.prototype.update=function(h,p){if(p===void 0&&(p=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var y=0;if(this._bytesHashed+=p,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&p>0;)this._buffer[this._bufferLength++]=h[y++],p--;this._bufferLength===this.blockSize&&(o(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(p>=this.blockSize&&(y=o(this._temp,this._state,h,y,p),p%=this.blockSize);p>0;)this._buffer[this._bufferLength++]=h[y++],p--;return this},c.prototype.finish=function(h){if(!this._finished){var p=this._bytesHashed,y=this._bufferLength,I=p/536870912|0,A=p<<3,S=p%64<56?64:128;this._buffer[y]=128;for(var x=y+1;x<S-8;x++)this._buffer[x]=0;e.writeUint32BE(I,this._buffer,S-8),e.writeUint32BE(A,this._buffer,S-4),o(this._temp,this._state,this._buffer,0,S),this._finished=!0}for(var x=0;x<this.digestLength/4;x++)e.writeUint32BE(this._state[x],h,x*4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){t.wipe(h.state),h.buffer&&t.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();i.SHA256=r;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function o(c,h,p,y,I){for(;I>=64;){for(var A=h[0],S=h[1],x=h[2],N=h[3],$=h[4],B=h[5],_=h[6],D=h[7],g=0;g<16;g++){var m=y+g*4;c[g]=e.readUint32BE(p,m)}for(var g=16;g<64;g++){var f=c[g-2],n=(f>>>17|f<<32-17)^(f>>>19|f<<32-19)^f>>>10;f=c[g-15];var u=(f>>>7|f<<32-7)^(f>>>18|f<<32-18)^f>>>3;c[g]=(n+c[g-7]|0)+(u+c[g-16]|0)}for(var g=0;g<64;g++){var n=((($>>>6|$<<26)^($>>>11|$<<21)^($>>>25|$<<7))+($&B^~$&_)|0)+(D+(s[g]+c[g]|0)|0)|0,u=((A>>>2|A<<32-2)^(A>>>13|A<<32-13)^(A>>>22|A<<32-22))+(A&S^A&x^S&x)|0;D=_,_=B,B=$,$=N+n|0,N=x,x=S,S=A,A=n+u|0}h[0]+=A,h[1]+=S,h[2]+=x,h[3]+=N,h[4]+=$,h[5]+=B,h[6]+=_,h[7]+=D,y+=64,I-=64}return y}function l(c){var h=new r;h.update(c);var p=h.digest();return h.clean(),p}i.hash=l})(Yi);var Br={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.sharedKey=i.generateKeyPair=i.generateKeyPairFromSeed=i.scalarMultBase=i.scalarMult=i.SHARED_KEY_LENGTH=i.SECRET_KEY_LENGTH=i.PUBLIC_KEY_LENGTH=void 0;const e=Zt,t=lt;i.PUBLIC_KEY_LENGTH=32,i.SECRET_KEY_LENGTH=32,i.SHARED_KEY_LENGTH=32;function r(g){const m=new Float64Array(16);if(g)for(let f=0;f<g.length;f++)m[f]=g[f];return m}const s=new Uint8Array(32);s[0]=9;const o=r([56129,1]);function l(g){let m=1;for(let f=0;f<16;f++){let n=g[f]+m+65535;m=Math.floor(n/65536),g[f]=n-m*65536}g[0]+=m-1+37*(m-1)}function c(g,m,f){const n=~(f-1);for(let u=0;u<16;u++){const T=n&(g[u]^m[u]);g[u]^=T,m[u]^=T}}function h(g,m){const f=r(),n=r();for(let u=0;u<16;u++)n[u]=m[u];l(n),l(n),l(n);for(let u=0;u<2;u++){f[0]=n[0]-65517;for(let R=1;R<15;R++)f[R]=n[R]-65535-(f[R-1]>>16&1),f[R-1]&=65535;f[15]=n[15]-32767-(f[14]>>16&1);const T=f[15]>>16&1;f[14]&=65535,c(n,f,1-T)}for(let u=0;u<16;u++)g[2*u]=n[u]&255,g[2*u+1]=n[u]>>8}function p(g,m){for(let f=0;f<16;f++)g[f]=m[2*f]+(m[2*f+1]<<8);g[15]&=32767}function y(g,m,f){for(let n=0;n<16;n++)g[n]=m[n]+f[n]}function I(g,m,f){for(let n=0;n<16;n++)g[n]=m[n]-f[n]}function A(g,m,f){let n,u,T=0,R=0,H=0,G=0,X=0,E=0,P=0,k=0,j=0,U=0,M=0,F=0,q=0,te=0,z=0,Q=0,W=0,ee=0,O=0,C=0,w=0,a=0,b=0,K=0,Y=0,le=0,be=0,de=0,we=0,Te=0,Oe=0,ye=f[0],pe=f[1],fe=f[2],he=f[3],ce=f[4],oe=f[5],ae=f[6],ie=f[7],ue=f[8],ge=f[9],re=f[10],me=f[11],_e=f[12],Ee=f[13],De=f[14],ve=f[15];n=m[0],T+=n*ye,R+=n*pe,H+=n*fe,G+=n*he,X+=n*ce,E+=n*oe,P+=n*ae,k+=n*ie,j+=n*ue,U+=n*ge,M+=n*re,F+=n*me,q+=n*_e,te+=n*Ee,z+=n*De,Q+=n*ve,n=m[1],R+=n*ye,H+=n*pe,G+=n*fe,X+=n*he,E+=n*ce,P+=n*oe,k+=n*ae,j+=n*ie,U+=n*ue,M+=n*ge,F+=n*re,q+=n*me,te+=n*_e,z+=n*Ee,Q+=n*De,W+=n*ve,n=m[2],H+=n*ye,G+=n*pe,X+=n*fe,E+=n*he,P+=n*ce,k+=n*oe,j+=n*ae,U+=n*ie,M+=n*ue,F+=n*ge,q+=n*re,te+=n*me,z+=n*_e,Q+=n*Ee,W+=n*De,ee+=n*ve,n=m[3],G+=n*ye,X+=n*pe,E+=n*fe,P+=n*he,k+=n*ce,j+=n*oe,U+=n*ae,M+=n*ie,F+=n*ue,q+=n*ge,te+=n*re,z+=n*me,Q+=n*_e,W+=n*Ee,ee+=n*De,O+=n*ve,n=m[4],X+=n*ye,E+=n*pe,P+=n*fe,k+=n*he,j+=n*ce,U+=n*oe,M+=n*ae,F+=n*ie,q+=n*ue,te+=n*ge,z+=n*re,Q+=n*me,W+=n*_e,ee+=n*Ee,O+=n*De,C+=n*ve,n=m[5],E+=n*ye,P+=n*pe,k+=n*fe,j+=n*he,U+=n*ce,M+=n*oe,F+=n*ae,q+=n*ie,te+=n*ue,z+=n*ge,Q+=n*re,W+=n*me,ee+=n*_e,O+=n*Ee,C+=n*De,w+=n*ve,n=m[6],P+=n*ye,k+=n*pe,j+=n*fe,U+=n*he,M+=n*ce,F+=n*oe,q+=n*ae,te+=n*ie,z+=n*ue,Q+=n*ge,W+=n*re,ee+=n*me,O+=n*_e,C+=n*Ee,w+=n*De,a+=n*ve,n=m[7],k+=n*ye,j+=n*pe,U+=n*fe,M+=n*he,F+=n*ce,q+=n*oe,te+=n*ae,z+=n*ie,Q+=n*ue,W+=n*ge,ee+=n*re,O+=n*me,C+=n*_e,w+=n*Ee,a+=n*De,b+=n*ve,n=m[8],j+=n*ye,U+=n*pe,M+=n*fe,F+=n*he,q+=n*ce,te+=n*oe,z+=n*ae,Q+=n*ie,W+=n*ue,ee+=n*ge,O+=n*re,C+=n*me,w+=n*_e,a+=n*Ee,b+=n*De,K+=n*ve,n=m[9],U+=n*ye,M+=n*pe,F+=n*fe,q+=n*he,te+=n*ce,z+=n*oe,Q+=n*ae,W+=n*ie,ee+=n*ue,O+=n*ge,C+=n*re,w+=n*me,a+=n*_e,b+=n*Ee,K+=n*De,Y+=n*ve,n=m[10],M+=n*ye,F+=n*pe,q+=n*fe,te+=n*he,z+=n*ce,Q+=n*oe,W+=n*ae,ee+=n*ie,O+=n*ue,C+=n*ge,w+=n*re,a+=n*me,b+=n*_e,K+=n*Ee,Y+=n*De,le+=n*ve,n=m[11],F+=n*ye,q+=n*pe,te+=n*fe,z+=n*he,Q+=n*ce,W+=n*oe,ee+=n*ae,O+=n*ie,C+=n*ue,w+=n*ge,a+=n*re,b+=n*me,K+=n*_e,Y+=n*Ee,le+=n*De,be+=n*ve,n=m[12],q+=n*ye,te+=n*pe,z+=n*fe,Q+=n*he,W+=n*ce,ee+=n*oe,O+=n*ae,C+=n*ie,w+=n*ue,a+=n*ge,b+=n*re,K+=n*me,Y+=n*_e,le+=n*Ee,be+=n*De,de+=n*ve,n=m[13],te+=n*ye,z+=n*pe,Q+=n*fe,W+=n*he,ee+=n*ce,O+=n*oe,C+=n*ae,w+=n*ie,a+=n*ue,b+=n*ge,K+=n*re,Y+=n*me,le+=n*_e,be+=n*Ee,de+=n*De,we+=n*ve,n=m[14],z+=n*ye,Q+=n*pe,W+=n*fe,ee+=n*he,O+=n*ce,C+=n*oe,w+=n*ae,a+=n*ie,b+=n*ue,K+=n*ge,Y+=n*re,le+=n*me,be+=n*_e,de+=n*Ee,we+=n*De,Te+=n*ve,n=m[15],Q+=n*ye,W+=n*pe,ee+=n*fe,O+=n*he,C+=n*ce,w+=n*oe,a+=n*ae,b+=n*ie,K+=n*ue,Y+=n*ge,le+=n*re,be+=n*me,de+=n*_e,we+=n*Ee,Te+=n*De,Oe+=n*ve,T+=38*W,R+=38*ee,H+=38*O,G+=38*C,X+=38*w,E+=38*a,P+=38*b,k+=38*K,j+=38*Y,U+=38*le,M+=38*be,F+=38*de,q+=38*we,te+=38*Te,z+=38*Oe,u=1,n=T+u+65535,u=Math.floor(n/65536),T=n-u*65536,n=R+u+65535,u=Math.floor(n/65536),R=n-u*65536,n=H+u+65535,u=Math.floor(n/65536),H=n-u*65536,n=G+u+65535,u=Math.floor(n/65536),G=n-u*65536,n=X+u+65535,u=Math.floor(n/65536),X=n-u*65536,n=E+u+65535,u=Math.floor(n/65536),E=n-u*65536,n=P+u+65535,u=Math.floor(n/65536),P=n-u*65536,n=k+u+65535,u=Math.floor(n/65536),k=n-u*65536,n=j+u+65535,u=Math.floor(n/65536),j=n-u*65536,n=U+u+65535,u=Math.floor(n/65536),U=n-u*65536,n=M+u+65535,u=Math.floor(n/65536),M=n-u*65536,n=F+u+65535,u=Math.floor(n/65536),F=n-u*65536,n=q+u+65535,u=Math.floor(n/65536),q=n-u*65536,n=te+u+65535,u=Math.floor(n/65536),te=n-u*65536,n=z+u+65535,u=Math.floor(n/65536),z=n-u*65536,n=Q+u+65535,u=Math.floor(n/65536),Q=n-u*65536,T+=u-1+37*(u-1),u=1,n=T+u+65535,u=Math.floor(n/65536),T=n-u*65536,n=R+u+65535,u=Math.floor(n/65536),R=n-u*65536,n=H+u+65535,u=Math.floor(n/65536),H=n-u*65536,n=G+u+65535,u=Math.floor(n/65536),G=n-u*65536,n=X+u+65535,u=Math.floor(n/65536),X=n-u*65536,n=E+u+65535,u=Math.floor(n/65536),E=n-u*65536,n=P+u+65535,u=Math.floor(n/65536),P=n-u*65536,n=k+u+65535,u=Math.floor(n/65536),k=n-u*65536,n=j+u+65535,u=Math.floor(n/65536),j=n-u*65536,n=U+u+65535,u=Math.floor(n/65536),U=n-u*65536,n=M+u+65535,u=Math.floor(n/65536),M=n-u*65536,n=F+u+65535,u=Math.floor(n/65536),F=n-u*65536,n=q+u+65535,u=Math.floor(n/65536),q=n-u*65536,n=te+u+65535,u=Math.floor(n/65536),te=n-u*65536,n=z+u+65535,u=Math.floor(n/65536),z=n-u*65536,n=Q+u+65535,u=Math.floor(n/65536),Q=n-u*65536,T+=u-1+37*(u-1),g[0]=T,g[1]=R,g[2]=H,g[3]=G,g[4]=X,g[5]=E,g[6]=P,g[7]=k,g[8]=j,g[9]=U,g[10]=M,g[11]=F,g[12]=q,g[13]=te,g[14]=z,g[15]=Q}function S(g,m){A(g,m,m)}function x(g,m){const f=r();for(let n=0;n<16;n++)f[n]=m[n];for(let n=253;n>=0;n--)S(f,f),n!==2&&n!==4&&A(f,f,m);for(let n=0;n<16;n++)g[n]=f[n]}function N(g,m){const f=new Uint8Array(32),n=new Float64Array(80),u=r(),T=r(),R=r(),H=r(),G=r(),X=r();for(let j=0;j<31;j++)f[j]=g[j];f[31]=g[31]&127|64,f[0]&=248,p(n,m);for(let j=0;j<16;j++)T[j]=n[j];u[0]=H[0]=1;for(let j=254;j>=0;--j){const U=f[j>>>3]>>>(j&7)&1;c(u,T,U),c(R,H,U),y(G,u,R),I(u,u,R),y(R,T,H),I(T,T,H),S(H,G),S(X,u),A(u,R,u),A(R,T,G),y(G,u,R),I(u,u,R),S(T,u),I(R,H,X),A(u,R,o),y(u,u,H),A(R,R,u),A(u,H,X),A(H,T,n),S(T,G),c(u,T,U),c(R,H,U)}for(let j=0;j<16;j++)n[j+16]=u[j],n[j+32]=R[j],n[j+48]=T[j],n[j+64]=H[j];const E=n.subarray(32),P=n.subarray(16);x(E,E),A(P,P,E);const k=new Uint8Array(32);return h(k,P),k}i.scalarMult=N;function $(g){return N(g,s)}i.scalarMultBase=$;function B(g){if(g.length!==i.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${i.SECRET_KEY_LENGTH} bytes`);const m=new Uint8Array(g);return{publicKey:$(m),secretKey:m}}i.generateKeyPairFromSeed=B;function _(g){const m=(0,e.randomBytes)(32,g),f=B(m);return(0,t.wipe)(m),f}i.generateKeyPair=_;function D(g,m,f=!1){if(g.length!==i.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(m.length!==i.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=N(g,m);if(f){let u=0;for(let T=0;T<n.length;T++)u|=n[T];if(u===0)throw new Error("X25519: invalid shared key")}return n}i.sharedKey=D})(Br);function Vr(i){return globalThis.Buffer!=null?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i}function Kn(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Vr(globalThis.Buffer.allocUnsafe(i)):new Uint8Array(i)}function Ir(i,e){e||(e=i.reduce((s,o)=>s+o.length,0));const t=Kn(e);let r=0;for(const s of i)t.set(s,r),r+=s.length;return Vr(t)}function Ic(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<i.length;s++){var o=i.charAt(s),l=o.charCodeAt(0);if(t[l]!==255)throw new TypeError(o+" is ambiguous");t[l]=s}var c=i.length,h=i.charAt(0),p=Math.log(c)/Math.log(256),y=Math.log(256)/Math.log(c);function I(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var N=0,$=0,B=0,_=x.length;B!==_&&x[B]===0;)B++,N++;for(var D=(_-B)*y+1>>>0,g=new Uint8Array(D);B!==_;){for(var m=x[B],f=0,n=D-1;(m!==0||f<$)&&n!==-1;n--,f++)m+=256*g[n]>>>0,g[n]=m%c>>>0,m=m/c>>>0;if(m!==0)throw new Error("Non-zero carry");$=f,B++}for(var u=D-$;u!==D&&g[u]===0;)u++;for(var T=h.repeat(N);u<D;++u)T+=i.charAt(g[u]);return T}function A(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var N=0;if(x[N]!==" "){for(var $=0,B=0;x[N]===h;)$++,N++;for(var _=(x.length-N)*p+1>>>0,D=new Uint8Array(_);x[N];){var g=t[x.charCodeAt(N)];if(g===255)return;for(var m=0,f=_-1;(g!==0||m<B)&&f!==-1;f--,m++)g+=c*D[f]>>>0,D[f]=g%256>>>0,g=g/256>>>0;if(g!==0)throw new Error("Non-zero carry");B=m,N++}if(x[N]!==" "){for(var n=_-B;n!==_&&D[n]===0;)n++;for(var u=new Uint8Array($+(_-n)),T=$;n!==_;)u[T++]=D[n++];return u}}}function S(x){var N=A(x);if(N)return N;throw new Error(`Non-${e} character`)}return{encode:I,decodeUnsafe:A,decode:S}}var xc=Ic,Cc=xc;const Oc=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Pc=i=>new TextEncoder().encode(i),Ac=i=>new TextDecoder().decode(i);class Nc{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Tc{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Bn(this,e)}}class Rc{constructor(e){this.decoders=e}or(e){return Bn(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Bn=(i,e)=>new Rc({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class Fc{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new Nc(e,t,r),this.decoder=new Tc(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Wi=({name:i,prefix:e,encode:t,decode:r})=>new Fc(i,e,t,r),bi=({prefix:i,name:e,alphabet:t})=>{const{encode:r,decode:s}=Cc(t,e);return Wi({prefix:i,name:e,encode:r,decode:o=>Oc(s(o))})},Uc=(i,e,t,r)=>{const s={};for(let y=0;y<e.length;++y)s[e[y]]=y;let o=i.length;for(;i[o-1]==="=";)--o;const l=new Uint8Array(o*t/8|0);let c=0,h=0,p=0;for(let y=0;y<o;++y){const I=s[i[y]];if(I===void 0)throw new SyntaxError(`Non-${r} character`);h=h<<t|I,c+=t,c>=8&&(c-=8,l[p++]=255&h>>c)}if(c>=t||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return l},Lc=(i,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",l=0,c=0;for(let h=0;h<i.length;++h)for(c=c<<8|i[h],l+=8;l>t;)l-=t,o+=e[s&c>>l];if(l&&(o+=e[s&c<<t-l]),r)for(;o.length*t&7;)o+="=";return o},Qe=({name:i,prefix:e,bitsPerChar:t,alphabet:r})=>Wi({prefix:e,name:i,encode(s){return Lc(s,r,t)},decode(s){return Uc(s,r,t,i)}}),$c=Wi({prefix:"\0",name:"identity",encode:i=>Ac(i),decode:i=>Pc(i)}),Mc=Object.freeze(Object.defineProperty({__proto__:null,identity:$c},Symbol.toStringTag,{value:"Module"})),jc=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),qc=Object.freeze(Object.defineProperty({__proto__:null,base2:jc},Symbol.toStringTag,{value:"Module"})),zc=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Hc=Object.freeze(Object.defineProperty({__proto__:null,base8:zc},Symbol.toStringTag,{value:"Module"})),Kc=bi({prefix:"9",name:"base10",alphabet:"0123456789"}),Bc=Object.freeze(Object.defineProperty({__proto__:null,base10:Kc},Symbol.toStringTag,{value:"Module"})),Vc=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Gc=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),kc=Object.freeze(Object.defineProperty({__proto__:null,base16:Vc,base16upper:Gc},Symbol.toStringTag,{value:"Module"})),Yc=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Wc=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Jc=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Xc=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Qc=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Zc=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),eh=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),th=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ih=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),rh=Object.freeze(Object.defineProperty({__proto__:null,base32:Yc,base32hex:Qc,base32hexpad:eh,base32hexpadupper:th,base32hexupper:Zc,base32pad:Jc,base32padupper:Xc,base32upper:Wc,base32z:ih},Symbol.toStringTag,{value:"Module"})),sh=bi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),nh=bi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ah=Object.freeze(Object.defineProperty({__proto__:null,base36:sh,base36upper:nh},Symbol.toStringTag,{value:"Module"})),oh=bi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ch=bi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),hh=Object.freeze(Object.defineProperty({__proto__:null,base58btc:oh,base58flickr:ch},Symbol.toStringTag,{value:"Module"})),uh=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),lh=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),fh=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),dh=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ph=Object.freeze(Object.defineProperty({__proto__:null,base64:uh,base64pad:lh,base64url:fh,base64urlpad:dh},Symbol.toStringTag,{value:"Module"})),Vn=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),gh=Vn.reduce((i,e,t)=>(i[t]=e,i),[]),yh=Vn.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function bh(i){return i.reduce((e,t)=>(e+=gh[t],e),"")}function mh(i){const e=[];for(const t of i){const r=yh[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const _h=Wi({prefix:"🚀",name:"base256emoji",encode:bh,decode:mh}),wh=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:_h},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const ys={...Mc,...qc,...Hc,...Bc,...kc,...rh,...ah,...hh,...ph,...wh};function Gn(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const bs=Gn("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),ir=Gn("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=Kn(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),kn={utf8:bs,"utf-8":bs,hex:ys.base16,latin1:ir,ascii:ir,binary:ir,...ys};function nt(i,e="utf8"){const t=kn[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Vr(globalThis.Buffer.from(i,"utf-8")):t.decoder.decode(`${t.prefix}${i}`)}function ot(i,e="utf8"){const t=kn[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}var Z={},rr={},si={},ms;function vh(){if(ms)return si;ms=1,Object.defineProperty(si,"__esModule",{value:!0}),si.delay=void 0;function i(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return si.delay=i,si}var qt={},sr={},zt={},_s;function Eh(){return _s||(_s=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.ONE_THOUSAND=zt.ONE_HUNDRED=void 0,zt.ONE_HUNDRED=100,zt.ONE_THOUSAND=1e3),zt}var nr={},ws;function Dh(){return ws||(ws=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.ONE_YEAR=i.FOUR_WEEKS=i.THREE_WEEKS=i.TWO_WEEKS=i.ONE_WEEK=i.THIRTY_DAYS=i.SEVEN_DAYS=i.FIVE_DAYS=i.THREE_DAYS=i.ONE_DAY=i.TWENTY_FOUR_HOURS=i.TWELVE_HOURS=i.SIX_HOURS=i.THREE_HOURS=i.ONE_HOUR=i.SIXTY_MINUTES=i.THIRTY_MINUTES=i.TEN_MINUTES=i.FIVE_MINUTES=i.ONE_MINUTE=i.SIXTY_SECONDS=i.THIRTY_SECONDS=i.TEN_SECONDS=i.FIVE_SECONDS=i.ONE_SECOND=void 0,i.ONE_SECOND=1,i.FIVE_SECONDS=5,i.TEN_SECONDS=10,i.THIRTY_SECONDS=30,i.SIXTY_SECONDS=60,i.ONE_MINUTE=i.SIXTY_SECONDS,i.FIVE_MINUTES=i.ONE_MINUTE*5,i.TEN_MINUTES=i.ONE_MINUTE*10,i.THIRTY_MINUTES=i.ONE_MINUTE*30,i.SIXTY_MINUTES=i.ONE_MINUTE*60,i.ONE_HOUR=i.SIXTY_MINUTES,i.THREE_HOURS=i.ONE_HOUR*3,i.SIX_HOURS=i.ONE_HOUR*6,i.TWELVE_HOURS=i.ONE_HOUR*12,i.TWENTY_FOUR_HOURS=i.ONE_HOUR*24,i.ONE_DAY=i.TWENTY_FOUR_HOURS,i.THREE_DAYS=i.ONE_DAY*3,i.FIVE_DAYS=i.ONE_DAY*5,i.SEVEN_DAYS=i.ONE_DAY*7,i.THIRTY_DAYS=i.ONE_DAY*30,i.ONE_WEEK=i.SEVEN_DAYS,i.TWO_WEEKS=i.ONE_WEEK*2,i.THREE_WEEKS=i.ONE_WEEK*3,i.FOUR_WEEKS=i.ONE_WEEK*4,i.ONE_YEAR=i.ONE_DAY*365}(nr)),nr}var vs;function Yn(){return vs||(vs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=mt;e.__exportStar(Eh(),i),e.__exportStar(Dh(),i)}(sr)),sr}var Es;function Sh(){if(Es)return qt;Es=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.fromMiliseconds=qt.toMiliseconds=void 0;const i=Yn();function e(r){return r*i.ONE_THOUSAND}qt.toMiliseconds=e;function t(r){return Math.floor(r/i.ONE_THOUSAND)}return qt.fromMiliseconds=t,qt}var Ds;function Ih(){return Ds||(Ds=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=mt;e.__exportStar(vh(),i),e.__exportStar(Sh(),i)}(rr)),rr}var Jt={},Ss;function xh(){if(Ss)return Jt;Ss=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.Watch=void 0;class i{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const r=this.get(t);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-r.started;this.timestamps.set(t,{started:r.started,elapsed:s})}get(t){const r=this.timestamps.get(t);if(typeof r>"u")throw new Error(`No timestamp found for label: ${t}`);return r}elapsed(t){const r=this.get(t);return r.elapsed||Date.now()-r.started}}return Jt.Watch=i,Jt.default=i,Jt}var ar={},ni={},Is;function Ch(){if(Is)return ni;Is=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.IWatch=void 0;class i{}return ni.IWatch=i,ni}var xs;function Oh(){return xs||(xs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),mt.__exportStar(Ch(),i)}(ar)),ar}(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=mt;e.__exportStar(Ih(),i),e.__exportStar(xh(),i),e.__exportStar(Oh(),i),e.__exportStar(Yn(),i)})(Z);var gi={};(function(i){const e=Io,t=xo,r=Do,s=So,o=_=>_==null,l=Symbol("encodeFragmentIdentifier");function c(_){switch(_.arrayFormat){case"index":return D=>(g,m)=>{const f=g.length;return m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?g:m===null?[...g,[y(D,_),"[",f,"]"].join("")]:[...g,[y(D,_),"[",y(f,_),"]=",y(m,_)].join("")]};case"bracket":return D=>(g,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?g:m===null?[...g,[y(D,_),"[]"].join("")]:[...g,[y(D,_),"[]=",y(m,_)].join("")];case"colon-list-separator":return D=>(g,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?g:m===null?[...g,[y(D,_),":list="].join("")]:[...g,[y(D,_),":list=",y(m,_)].join("")];case"comma":case"separator":case"bracket-separator":{const D=_.arrayFormat==="bracket-separator"?"[]=":"=";return g=>(m,f)=>f===void 0||_.skipNull&&f===null||_.skipEmptyString&&f===""?m:(f=f===null?"":f,m.length===0?[[y(g,_),D,y(f,_)].join("")]:[[m,y(f,_)].join(_.arrayFormatSeparator)])}default:return D=>(g,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?g:m===null?[...g,y(D,_)]:[...g,[y(D,_),"=",y(m,_)].join("")]}}function h(_){let D;switch(_.arrayFormat){case"index":return(g,m,f)=>{if(D=/\[(\d*)\]$/.exec(g),g=g.replace(/\[\d*\]$/,""),!D){f[g]=m;return}f[g]===void 0&&(f[g]={}),f[g][D[1]]=m};case"bracket":return(g,m,f)=>{if(D=/(\[\])$/.exec(g),g=g.replace(/\[\]$/,""),!D){f[g]=m;return}if(f[g]===void 0){f[g]=[m];return}f[g]=[].concat(f[g],m)};case"colon-list-separator":return(g,m,f)=>{if(D=/(:list)$/.exec(g),g=g.replace(/:list$/,""),!D){f[g]=m;return}if(f[g]===void 0){f[g]=[m];return}f[g]=[].concat(f[g],m)};case"comma":case"separator":return(g,m,f)=>{const n=typeof m=="string"&&m.includes(_.arrayFormatSeparator),u=typeof m=="string"&&!n&&I(m,_).includes(_.arrayFormatSeparator);m=u?I(m,_):m;const T=n||u?m.split(_.arrayFormatSeparator).map(R=>I(R,_)):m===null?m:I(m,_);f[g]=T};case"bracket-separator":return(g,m,f)=>{const n=/(\[\])$/.test(g);if(g=g.replace(/\[\]$/,""),!n){f[g]=m&&I(m,_);return}const u=m===null?[]:m.split(_.arrayFormatSeparator).map(T=>I(T,_));if(f[g]===void 0){f[g]=u;return}f[g]=[].concat(f[g],u)};default:return(g,m,f)=>{if(f[g]===void 0){f[g]=m;return}f[g]=[].concat(f[g],m)}}}function p(_){if(typeof _!="string"||_.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function y(_,D){return D.encode?D.strict?e(_):encodeURIComponent(_):_}function I(_,D){return D.decode?t(_):_}function A(_){return Array.isArray(_)?_.sort():typeof _=="object"?A(Object.keys(_)).sort((D,g)=>Number(D)-Number(g)).map(D=>_[D]):_}function S(_){const D=_.indexOf("#");return D!==-1&&(_=_.slice(0,D)),_}function x(_){let D="";const g=_.indexOf("#");return g!==-1&&(D=_.slice(g)),D}function N(_){_=S(_);const D=_.indexOf("?");return D===-1?"":_.slice(D+1)}function $(_,D){return D.parseNumbers&&!Number.isNaN(Number(_))&&typeof _=="string"&&_.trim()!==""?_=Number(_):D.parseBooleans&&_!==null&&(_.toLowerCase()==="true"||_.toLowerCase()==="false")&&(_=_.toLowerCase()==="true"),_}function B(_,D){D=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},D),p(D.arrayFormatSeparator);const g=h(D),m=Object.create(null);if(typeof _!="string"||(_=_.trim().replace(/^[?#&]/,""),!_))return m;for(const f of _.split("&")){if(f==="")continue;let[n,u]=r(D.decode?f.replace(/\+/g," "):f,"=");u=u===void 0?null:["comma","separator","bracket-separator"].includes(D.arrayFormat)?u:I(u,D),g(I(n,D),u,m)}for(const f of Object.keys(m)){const n=m[f];if(typeof n=="object"&&n!==null)for(const u of Object.keys(n))n[u]=$(n[u],D);else m[f]=$(n,D)}return D.sort===!1?m:(D.sort===!0?Object.keys(m).sort():Object.keys(m).sort(D.sort)).reduce((f,n)=>{const u=m[n];return u&&typeof u=="object"&&!Array.isArray(u)?f[n]=A(u):f[n]=u,f},Object.create(null))}i.extract=N,i.parse=B,i.stringify=(_,D)=>{if(!_)return"";D=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},D),p(D.arrayFormatSeparator);const g=u=>D.skipNull&&o(_[u])||D.skipEmptyString&&_[u]==="",m=c(D),f={};for(const u of Object.keys(_))g(u)||(f[u]=_[u]);const n=Object.keys(f);return D.sort!==!1&&n.sort(D.sort),n.map(u=>{const T=_[u];return T===void 0?"":T===null?y(u,D):Array.isArray(T)?T.length===0&&D.arrayFormat==="bracket-separator"?y(u,D)+"[]":T.reduce(m(u),[]).join("&"):y(u,D)+"="+y(T,D)}).filter(u=>u.length>0).join("&")},i.parseUrl=(_,D)=>{D=Object.assign({decode:!0},D);const[g,m]=r(_,"#");return Object.assign({url:g.split("?")[0]||"",query:B(N(_),D)},D&&D.parseFragmentIdentifier&&m?{fragmentIdentifier:I(m,D)}:{})},i.stringifyUrl=(_,D)=>{D=Object.assign({encode:!0,strict:!0,[l]:!0},D);const g=S(_.url).split("?")[0]||"",m=i.extract(_.url),f=i.parse(m,{sort:!1}),n=Object.assign(f,_.query);let u=i.stringify(n,D);u&&(u=`?${u}`);let T=x(_.url);return _.fragmentIdentifier&&(T=`#${D[l]?y(_.fragmentIdentifier,D):_.fragmentIdentifier}`),`${g}${u}${T}`},i.pick=(_,D,g)=>{g=Object.assign({parseFragmentIdentifier:!0,[l]:!1},g);const{url:m,query:f,fragmentIdentifier:n}=i.parseUrl(_,g);return i.stringifyUrl({url:m,query:s(f,D),fragmentIdentifier:n},g)},i.exclude=(_,D,g)=>{const m=Array.isArray(D)?f=>!D.includes(f):(f,n)=>!D(f,n);return i.pick(_,m,g)}})(gi);const Ph={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function Ah(i,e=[]){const t=[];return Object.keys(i).forEach(r=>{if(e.length&&!e.includes(r))return;const s=i[r];t.push(...s.accounts)}),t}function Wn(i,e){return i.includes(":")?[i]:e.chains||[]}const Jn="base10",at="base16",xr="base64pad",Gr="utf8",Xn=0,kt=1,Nh=0,Cs=1,Cr=12,kr=32;function Th(){const i=Br.generateKeyPair();return{privateKey:ot(i.secretKey,at),publicKey:ot(i.publicKey,at)}}function Or(){const i=Zt.randomBytes(kr);return ot(i,at)}function Rh(i,e){const t=Br.sharedKey(nt(i,at),nt(e,at)),r=new bc(Yi.SHA256,t).expand(kr);return ot(r,at)}function Fh(i){const e=Yi.hash(nt(i,at));return ot(e,at)}function $i(i){const e=Yi.hash(nt(i,Gr));return ot(e,at)}function Uh(i){return nt(`${i}`,Jn)}function mi(i){return Number(ot(i,Jn))}function Lh(i){const e=Uh(typeof i.type<"u"?i.type:Xn);if(mi(e)===kt&&typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof i.senderPublicKey<"u"?nt(i.senderPublicKey,at):void 0,r=typeof i.iv<"u"?nt(i.iv,at):Zt.randomBytes(Cr),s=new Hr.ChaCha20Poly1305(nt(i.symKey,at)).seal(r,nt(i.message,Gr));return Mh({type:e,sealed:s,iv:r,senderPublicKey:t})}function $h(i){const e=new Hr.ChaCha20Poly1305(nt(i.symKey,at)),{sealed:t,iv:r}=Yr(i.encoded),s=e.open(r,t);if(s===null)throw new Error("Failed to decrypt");return ot(s,Gr)}function Mh(i){if(mi(i.type)===kt){if(typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ot(Ir([i.type,i.senderPublicKey,i.iv,i.sealed]),xr)}return ot(Ir([i.type,i.iv,i.sealed]),xr)}function Yr(i){const e=nt(i,xr),t=e.slice(Nh,Cs),r=Cs;if(mi(t)===kt){const c=r+kr,h=c+Cr,p=e.slice(r,c),y=e.slice(c,h),I=e.slice(h);return{type:t,sealed:I,iv:y,senderPublicKey:p}}const s=r+Cr,o=e.slice(r,s),l=e.slice(s);return{type:t,sealed:l,iv:o}}function jh(i,e){const t=Yr(i);return Qn({type:mi(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?ot(t.senderPublicKey,at):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Qn(i){const e=(i==null?void 0:i.type)||Xn;if(e===kt){if(typeof(i==null?void 0:i.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(i==null?void 0:i.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:i==null?void 0:i.senderPublicKey,receiverPublicKey:i==null?void 0:i.receiverPublicKey}}function Os(i){return i.type===kt&&typeof i.senderPublicKey=="string"&&typeof i.receiverPublicKey=="string"}var qh=Object.defineProperty,Ps=Object.getOwnPropertySymbols,zh=Object.prototype.hasOwnProperty,Hh=Object.prototype.propertyIsEnumerable,As=(i,e,t)=>e in i?qh(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ns=(i,e)=>{for(var t in e||(e={}))zh.call(e,t)&&As(i,t,e[t]);if(Ps)for(var t of Ps(e))Hh.call(e,t)&&As(i,t,e[t]);return i};const Kh="ReactNative",di={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Bh="js";function Zn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Vh(){return!Ao()&&!!An()&&navigator.product===Kh}function Gh(){return!Zn()&&!!An()}function kh(){return Vh()?di.reactNative:Zn()?di.node:Gh()?di.browser:di.unknown}function Yh(i,e){let t=gi.parse(i);return t=Ns(Ns({},t),e),i=gi.stringify(t),i}function Wh(){return Co()||{name:"",description:"",url:"",icons:[""]}}function Jh(){const i=Oo();if(i===null)return"unknown";const e=i.os?i.os.replace(" ","").toLowerCase():"unknown";return i.type==="browser"?[e,i.name,i.version].join("-"):[e,i.version].join("-")}function Xh(){var i;const e=kh();return e===di.browser?[e,((i=Po())==null?void 0:i.host)||"unknown"].join(":"):e}function Qh(i,e,t){const r=Jh(),s=Xh();return[[i,e].join("-"),[Bh,t].join("-"),r,s].join("/")}function Zh({protocol:i,version:e,relayUrl:t,sdkVersion:r,auth:s,projectId:o,useOnCloseEvent:l}){const c=t.split("?"),h=Qh(i,e,r),p={auth:s,ua:h,projectId:o,useOnCloseEvent:l||void 0},y=Yh(c[1]||"",p);return c[0]+"?"+y}function Gt(i,e){return i.filter(t=>e.includes(t)).length===i.length}function ea(i){return Object.fromEntries(i.entries())}function ta(i){return new Map(Object.entries(i))}function Bt(i=Z.FIVE_MINUTES,e){const t=Z.toMiliseconds(i||Z.FIVE_MINUTES);let r,s,o;return{resolve:l=>{o&&r&&(clearTimeout(o),r(l))},reject:l=>{o&&s&&(clearTimeout(o),s(l))},done:()=>new Promise((l,c)=>{o=setTimeout(()=>{c(new Error(e))},t),r=l,s=c})}}function Pr(i,e){return new Promise(async(t,r)=>{const s=setTimeout(()=>r(),e),o=await i;clearTimeout(s),t(o)})}function ia(i,e){if(typeof e=="string"&&e.startsWith(`${i}:`))return e;if(i.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(i.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${i}`)}function eu(i){return ia("topic",i)}function tu(i){return ia("id",i)}function ra(i){const[e,t]=i.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")r.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))r.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return r}function St(i,e){return Z.fromMiliseconds((e||Date.now())+Z.toMiliseconds(i))}function Tt(i){return Date.now()>=Z.toMiliseconds(i)}function Re(i,e){return`${i}${e?`:${e}`:""}`}const iu="irn";function Ar(i){return(i==null?void 0:i.relay)||{protocol:iu}}function Ri(i){const e=Ph[i];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${i}`);return e}var ru=Object.defineProperty,Ts=Object.getOwnPropertySymbols,su=Object.prototype.hasOwnProperty,nu=Object.prototype.propertyIsEnumerable,Rs=(i,e,t)=>e in i?ru(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,au=(i,e)=>{for(var t in e||(e={}))su.call(e,t)&&Rs(i,t,e[t]);if(Ts)for(var t of Ts(e))nu.call(e,t)&&Rs(i,t,e[t]);return i};function ou(i,e="-"){const t={},r="relay"+e;return Object.keys(i).forEach(s=>{if(s.startsWith(r)){const o=s.replace(r,""),l=i[s];t[o]=l}}),t}function cu(i){const e=i.indexOf(":"),t=i.indexOf("?")!==-1?i.indexOf("?"):void 0,r=i.substring(0,e),s=i.substring(e+1,t).split("@"),o=typeof t<"u"?i.substring(t):"",l=gi.parse(o);return{protocol:r,topic:s[0],version:parseInt(s[1],10),symKey:l.symKey,relay:ou(l)}}function hu(i,e="-"){const t="relay",r={};return Object.keys(i).forEach(s=>{const o=t+e+s;i[s]&&(r[o]=i[s])}),r}function uu(i){return`${i.protocol}:${i.topic}@${i.version}?`+gi.stringify(au({symKey:i.symKey},hu(i.relay)))}function ei(i){const e=[];return i.forEach(t=>{const[r,s]=t.split(":");e.push(`${r}:${s}`)}),e}function lu(i){const e=[];return Object.values(i).forEach(t=>{e.push(...ei(t.accounts))}),e}function fu(i,e){const t=[];return Object.values(i).forEach(r=>{ei(r.accounts).includes(e)&&t.push(...r.methods)}),t}function du(i,e){const t=[];return Object.values(i).forEach(r=>{ei(r.accounts).includes(e)&&t.push(...r.events)}),t}function pu(i,e){const t=Fi(i,e);if(t)throw new Error(t.message);const r={};for(const[s,o]of Object.entries(i))r[s]={methods:o.methods,events:o.events,chains:o.accounts.map(l=>`${l.split(":")[0]}:${l.split(":")[1]}`)};return r}const gu={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},yu={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function V(i,e){const{message:t,code:r}=yu[i];return{message:e?`${t} ${e}`:t,code:r}}function Fe(i,e){const{message:t,code:r}=gu[i];return{message:e?`${t} ${e}`:t,code:r}}function Rt(i,e){return Array.isArray(i)?typeof e<"u"&&i.length?i.every(e):!0:!1}function pi(i){return Object.getPrototypeOf(i)===Object.prototype&&Object.keys(i).length}function rt(i){return typeof i>"u"}function Je(i,e){return e&&rt(i)?!0:typeof i=="string"&&!!i.trim().length}function Wr(i,e){return e&&rt(i)?!0:typeof i=="number"&&!isNaN(i)}function bu(i,e){const{requiredNamespaces:t}=e,r=Object.keys(i.namespaces),s=Object.keys(t);let o=!0;return Gt(s,r)?(r.forEach(l=>{const{accounts:c,methods:h,events:p}=i.namespaces[l],y=ei(c),I=t[l];(!Gt(Wn(l,I),y)||!Gt(I.methods,h)||!Gt(I.events,p))&&(o=!1)}),o):!1}function Jr(i){return Je(i,!1)&&i.includes(":")?i.split(":").length===2:!1}function mu(i){if(Je(i,!1)&&i.includes(":")){const e=i.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&Jr(t)}}return!1}function _u(i){if(Je(i,!1))try{return typeof new URL(i)<"u"}catch{return!1}return!1}function wu(i){var e;return(e=i==null?void 0:i.proposer)==null?void 0:e.publicKey}function vu(i){return i==null?void 0:i.topic}function Eu(i,e){let t=null;return Je(i==null?void 0:i.publicKey,!1)||(t=V("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function Fs(i){let e=!0;return Rt(i)?i.length&&(e=i.every(t=>Je(t,!1))):e=!1,e}function Du(i,e,t){let r=null;return Rt(e)?e.forEach(s=>{r||(!Jr(s)||!s.includes(i))&&(r=Fe("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):r=Fe("UNSUPPORTED_CHAINS",`${t}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),r}function Su(i,e){let t=null;return Object.entries(i).forEach(([r,s])=>{if(t)return;const o=Du(r,Wn(r,s),`${e} requiredNamespace`);o&&(t=o)}),t}function Iu(i,e){let t=null;return Rt(i)?i.forEach(r=>{t||mu(r)||(t=Fe("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):t=Fe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function xu(i,e){let t=null;return Object.values(i).forEach(r=>{if(t)return;const s=Iu(r==null?void 0:r.accounts,`${e} namespace`);s&&(t=s)}),t}function Cu(i,e){let t=null;return Fs(i==null?void 0:i.methods)?Fs(i==null?void 0:i.events)||(t=Fe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=Fe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function sa(i,e){let t=null;return Object.values(i).forEach(r=>{if(t)return;const s=Cu(r,`${e}, namespace`);s&&(t=s)}),t}function Ou(i,e,t){let r=null;if(i&&pi(i)){const s=sa(i,e);s&&(r=s);const o=Su(i,e);o&&(r=o)}else r=V("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return r}function Fi(i,e){let t=null;if(i&&pi(i)){const r=sa(i,e);r&&(t=r);const s=xu(i,e);s&&(t=s)}else t=V("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function na(i){return Je(i.protocol,!0)}function Pu(i,e){let t=!1;return e&&!i?t=!0:i&&Rt(i)&&i.length&&i.forEach(r=>{t=na(r)}),t}function Au(i){return typeof i=="number"}function st(i){return typeof i<"u"&&typeof i!==null}function Nu(i){return!(!i||typeof i!="object"||!i.code||!Wr(i.code,!1)||!i.message||!Je(i.message,!1))}function Tu(i){return!(rt(i)||!Je(i.method,!1))}function Ru(i){return!(rt(i)||rt(i.result)&&rt(i.error)||!Wr(i.id,!1)||!Je(i.jsonrpc,!1))}function Fu(i){return!(rt(i)||!Je(i.name,!1))}function Us(i,e){return!(!Jr(e)||!lu(i).includes(e))}function Uu(i,e,t){return Je(t,!1)?fu(i,e).includes(t):!1}function Lu(i,e,t){return Je(t,!1)?du(i,e).includes(t):!1}function Ls(i,e,t){let r=null;const s=$u(i),o=Mu(e),l=Object.keys(s),c=Object.keys(o),h=$s(Object.keys(i)),p=$s(Object.keys(e)),y=h.filter(I=>!p.includes(I));return y.length&&(r=V("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${y.toString()}
      Received: ${Object.keys(e).toString()}`)),Gt(l,c)||(r=V("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${l.toString()}
      Approved: ${c.toString()}`)),Object.keys(e).forEach(I=>{if(!I.includes(":")||r)return;const A=ei(e[I].accounts);A.includes(I)||(r=V("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${I}
        Required: ${I}
        Approved: ${A.toString()}`))}),l.forEach(I=>{r||(Gt(s[I].methods,o[I].methods)?Gt(s[I].events,o[I].events)||(r=V("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${I}`)):r=V("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${I}`))}),r}function $u(i){const e={};return Object.keys(i).forEach(t=>{var r;t.includes(":")?e[t]=i[t]:(r=i[t].chains)==null||r.forEach(s=>{e[s]={methods:i[t].methods,events:i[t].events}})}),e}function $s(i){return[...new Set(i.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Mu(i){const e={};return Object.keys(i).forEach(t=>{if(t.includes(":"))e[t]=i[t];else{const r=ei(i[t].accounts);r==null||r.forEach(s=>{e[s]={accounts:i[t].accounts.filter(o=>o.includes(`${s}:`)),methods:i[t].methods,events:i[t].events}})}}),e}function ju(i,e){return Wr(i,!1)&&i<=e.max&&i>=e.min}var or,Ms;function qu(){if(Ms)return or;Ms=1;function i(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}or=e;function e(t,r,s){var o=s&&s.stringify||i,l=1;if(typeof t=="object"&&t!==null){var c=r.length+l;if(c===1)return t;var h=new Array(c);h[0]=o(t);for(var p=1;p<c;p++)h[p]=o(r[p]);return h.join(" ")}if(typeof t!="string")return t;var y=r.length;if(y===0)return t;for(var I="",A=1-l,S=-1,x=t&&t.length||0,N=0;N<x;){if(t.charCodeAt(N)===37&&N+1<x){switch(S=S>-1?S:0,t.charCodeAt(N+1)){case 100:case 102:if(A>=y||r[A]==null)break;S<N&&(I+=t.slice(S,N)),I+=Number(r[A]),S=N+2,N++;break;case 105:if(A>=y||r[A]==null)break;S<N&&(I+=t.slice(S,N)),I+=Math.floor(Number(r[A])),S=N+2,N++;break;case 79:case 111:case 106:if(A>=y||r[A]===void 0)break;S<N&&(I+=t.slice(S,N));var $=typeof r[A];if($==="string"){I+="'"+r[A]+"'",S=N+2,N++;break}if($==="function"){I+=r[A].name||"<anonymous>",S=N+2,N++;break}I+=o(r[A]),S=N+2,N++;break;case 115:if(A>=y)break;S<N&&(I+=t.slice(S,N)),I+=String(r[A]),S=N+2,N++;break;case 37:S<N&&(I+=t.slice(S,N)),I+="%",S=N+2,N++,A--;break}++A}++N}return S===-1?t:(S<x&&(I+=t.slice(S)),I)}return or}var cr,js;function aa(){if(js)return cr;js=1;const i=qu();cr=s;const e=m().console||{},t={mapHttpRequest:x,mapHttpResponse:x,wrapRequestSerializer:N,wrapResponseSerializer:N,wrapErrorSerializer:N,req:x,res:x,err:A};function r(f,n){return Array.isArray(f)?f.filter(function(T){return T!=="!stdSerializers.err"}):f===!0?Object.keys(n):!1}function s(f){f=f||{},f.browser=f.browser||{};const n=f.browser.transmit;if(n&&typeof n.send!="function")throw Error("pino: transmit option must have a send function");const u=f.browser.write||e;f.browser.write&&(f.browser.asObject=!0);const T=f.serializers||{},R=r(f.browser.serialize,T);let H=f.browser.serialize;Array.isArray(f.browser.serialize)&&f.browser.serialize.indexOf("!stdSerializers.err")>-1&&(H=!1);const G=["error","fatal","warn","info","debug","trace"];typeof u=="function"&&(u.error=u.fatal=u.warn=u.info=u.debug=u.trace=u),f.enabled===!1&&(f.level="silent");const X=f.level||"info",E=Object.create(u);E.log||(E.log=$),Object.defineProperty(E,"levelVal",{get:k}),Object.defineProperty(E,"level",{get:j,set:U});const P={transmit:n,serialize:R,asObject:f.browser.asObject,levels:G,timestamp:S(f)};E.levels=s.levels,E.level=X,E.setMaxListeners=E.getMaxListeners=E.emit=E.addListener=E.on=E.prependListener=E.once=E.prependOnceListener=E.removeListener=E.removeAllListeners=E.listeners=E.listenerCount=E.eventNames=E.write=E.flush=$,E.serializers=T,E._serialize=R,E._stdErrSerialize=H,E.child=M,n&&(E._logEvent=I());function k(){return this.level==="silent"?1/0:this.levels.values[this.level]}function j(){return this._level}function U(F){if(F!=="silent"&&!this.levels.values[F])throw Error("unknown level "+F);this._level=F,o(P,E,"error","log"),o(P,E,"fatal","error"),o(P,E,"warn","error"),o(P,E,"info","log"),o(P,E,"debug","log"),o(P,E,"trace","log")}function M(F,q){if(!F)throw new Error("missing bindings for child Pino");q=q||{},R&&F.serializers&&(q.serializers=F.serializers);const te=q.serializers;if(R&&te){var z=Object.assign({},T,te),Q=f.browser.serialize===!0?Object.keys(z):R;delete F.serializers,h([F],Q,z,this._stdErrSerialize)}function W(ee){this._childLevel=(ee._childLevel|0)+1,this.error=p(ee,F,"error"),this.fatal=p(ee,F,"fatal"),this.warn=p(ee,F,"warn"),this.info=p(ee,F,"info"),this.debug=p(ee,F,"debug"),this.trace=p(ee,F,"trace"),z&&(this.serializers=z,this._serialize=Q),n&&(this._logEvent=I([].concat(ee._logEvent.bindings,F)))}return W.prototype=this,new W(this)}return E}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:B,epochTime:_,unixTime:D,isoTime:g});function o(f,n,u,T){const R=Object.getPrototypeOf(n);n[u]=n.levelVal>n.levels.values[u]?$:R[u]?R[u]:e[u]||e[T]||$,l(f,n,u)}function l(f,n,u){!f.transmit&&n[u]===$||(n[u]=function(T){return function(){const H=f.timestamp(),G=new Array(arguments.length),X=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var E=0;E<G.length;E++)G[E]=arguments[E];if(f.serialize&&!f.asObject&&h(G,this._serialize,this.serializers,this._stdErrSerialize),f.asObject?T.call(X,c(this,u,G,H)):T.apply(X,G),f.transmit){const P=f.transmit.level||n.level,k=s.levels.values[P],j=s.levels.values[u];if(j<k)return;y(this,{ts:H,methodLevel:u,methodValue:j,transmitLevel:P,transmitValue:s.levels.values[f.transmit.level||n.level],send:f.transmit.send,val:n.levelVal},G)}}}(n[u]))}function c(f,n,u,T){f._serialize&&h(u,f._serialize,f.serializers,f._stdErrSerialize);const R=u.slice();let H=R[0];const G={};T&&(G.time=T),G.level=s.levels.values[n];let X=(f._childLevel|0)+1;if(X<1&&(X=1),H!==null&&typeof H=="object"){for(;X--&&typeof R[0]=="object";)Object.assign(G,R.shift());H=R.length?i(R.shift(),R):void 0}else typeof H=="string"&&(H=i(R.shift(),R));return H!==void 0&&(G.msg=H),G}function h(f,n,u,T){for(const R in f)if(T&&f[R]instanceof Error)f[R]=s.stdSerializers.err(f[R]);else if(typeof f[R]=="object"&&!Array.isArray(f[R]))for(const H in f[R])n&&n.indexOf(H)>-1&&H in u&&(f[R][H]=u[H](f[R][H]))}function p(f,n,u){return function(){const T=new Array(1+arguments.length);T[0]=n;for(var R=1;R<T.length;R++)T[R]=arguments[R-1];return f[u].apply(this,T)}}function y(f,n,u){const T=n.send,R=n.ts,H=n.methodLevel,G=n.methodValue,X=n.val,E=f._logEvent.bindings;h(u,f._serialize||Object.keys(f.serializers),f.serializers,f._stdErrSerialize===void 0?!0:f._stdErrSerialize),f._logEvent.ts=R,f._logEvent.messages=u.filter(function(P){return E.indexOf(P)===-1}),f._logEvent.level.label=H,f._logEvent.level.value=G,T(H,f._logEvent,X),f._logEvent=I(E)}function I(f){return{ts:0,messages:[],bindings:f||[],level:{label:"",value:0}}}function A(f){const n={type:f.constructor.name,msg:f.message,stack:f.stack};for(const u in f)n[u]===void 0&&(n[u]=f[u]);return n}function S(f){return typeof f.timestamp=="function"?f.timestamp:f.timestamp===!1?B:_}function x(){return{}}function N(f){return f}function $(){}function B(){return!1}function _(){return Date.now()}function D(){return Math.round(Date.now()/1e3)}function g(){return new Date(Date.now()).toISOString()}function m(){function f(n){return typeof n<"u"&&n}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return f(self)||f(window)||f(this)||{}}}return cr}var zu=aa();const Ji=Lo(zu);var Xi={},_i={};Object.defineProperty(_i,"__esModule",{value:!0});function Hu(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return JSON.parse(i)}catch{return i}}_i.safeJsonParse=Hu;function Ku(i){return typeof i=="string"?i:JSON.stringify(i,(e,t)=>typeof t>"u"?null:t)}_i.safeJsonStringify=Ku;var Mi={},hr={get exports(){return Mi},set exports(i){Mi=i}},qs;function Bu(){return qs||(qs=1,function(){let i;function e(){}i=e,i.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},i.prototype.setItem=function(t,r){this[t]=String(r)},i.prototype.removeItem=function(t){delete this[t]},i.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(r){t[r]=void 0,delete t[r]})},i.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},i.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Vt<"u"&&Vt.localStorage?hr.exports=Vt.localStorage:typeof window<"u"&&window.localStorage?hr.exports=window.localStorage:hr.exports=new e}()),Mi}var ur={},ai={},zs;function Vu(){if(zs)return ai;zs=1,Object.defineProperty(ai,"__esModule",{value:!0}),ai.IKeyValueStorage=void 0;class i{}return ai.IKeyValueStorage=i,ai}var oi={},Hs;function Gu(){if(Hs)return oi;Hs=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.parseEntry=void 0;const i=_i;function e(t){var r;return[t[0],i.safeJsonParse((r=t[1])!==null&&r!==void 0?r:"")]}return oi.parseEntry=e,oi}var Ks;function ku(){return Ks||(Ks=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=mt;e.__exportStar(Vu(),i),e.__exportStar(Gu(),i)}(ur)),ur}Object.defineProperty(Xi,"__esModule",{value:!0});Xi.KeyValueStorage=void 0;const Xt=mt,Bs=_i,Yu=Xt.__importDefault(Bu()),Wu=ku();class oa{constructor(){this.localStorage=Yu.default}getKeys(){return Xt.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return Xt.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(Wu.parseEntry)})}getItem(e){return Xt.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(e);if(t!==null)return Bs.safeJsonParse(t)})}setItem(e,t){return Xt.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,Bs.safeJsonStringify(t))})}removeItem(e){return Xt.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Xi.KeyValueStorage=oa;var Ju=Xi.default=oa,wi={},ci={},lr={},hi={};class Yt{}const Xu=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Yt},Symbol.toStringTag,{value:"Module"})),Qu=$o(Xu);var Vs;function Zu(){if(Vs)return hi;Vs=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.IHeartBeat=void 0;const i=Qu;class e extends i.IEvents{constructor(r){super()}}return hi.IHeartBeat=e,hi}var Gs;function ca(){return Gs||(Gs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),mt.__exportStar(Zu(),i)}(lr)),lr}var fr={},Ht={},ks;function el(){if(ks)return Ht;ks=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.HEARTBEAT_EVENTS=Ht.HEARTBEAT_INTERVAL=void 0;const i=Z;return Ht.HEARTBEAT_INTERVAL=i.FIVE_SECONDS,Ht.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ht}var Ys;function ha(){return Ys||(Ys=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),mt.__exportStar(el(),i)}(fr)),fr}var Ws;function tl(){if(Ws)return ci;Ws=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.HeartBeat=void 0;const i=mt,e=ct,t=Z,r=ca(),s=ha();class o extends r.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(c==null?void 0:c.interval)||s.HEARTBEAT_INTERVAL}static init(c){return i.__awaiter(this,void 0,void 0,function*(){const h=new o(c);return yield h.init(),h})}init(){return i.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,h){this.events.on(c,h)}once(c,h){this.events.once(c,h)}off(c,h){this.events.off(c,h)}removeListener(c,h){this.events.removeListener(c,h)}initialize(){return i.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return ci.HeartBeat=o,ci}(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=mt;e.__exportStar(tl(),i),e.__exportStar(ca(),i),e.__exportStar(ha(),i)})(wi);var Se={},Kt={},Js;function ua(){return Js||(Js=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.PINO_CUSTOM_CONTEXT_KEY=Kt.PINO_LOGGER_DEFAULTS=void 0,Kt.PINO_LOGGER_DEFAULTS={level:"info"},Kt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Kt}var it={},Xs;function il(){if(Xs)return it;Xs=1,Object.defineProperty(it,"__esModule",{value:!0}),it.generateChildLogger=it.formatChildLoggerContext=it.getLoggerContext=it.setBrowserLoggerContext=it.getBrowserLoggerContext=it.getDefaultLoggerOptions=void 0;const i=ua();function e(c){return Object.assign(Object.assign({},c),{level:(c==null?void 0:c.level)||i.PINO_LOGGER_DEFAULTS.level})}it.getDefaultLoggerOptions=e;function t(c,h=i.PINO_CUSTOM_CONTEXT_KEY){return c[h]||""}it.getBrowserLoggerContext=t;function r(c,h,p=i.PINO_CUSTOM_CONTEXT_KEY){return c[p]=h,c}it.setBrowserLoggerContext=r;function s(c,h=i.PINO_CUSTOM_CONTEXT_KEY){let p="";return typeof c.bindings>"u"?p=t(c,h):p=c.bindings().context||"",p}it.getLoggerContext=s;function o(c,h,p=i.PINO_CUSTOM_CONTEXT_KEY){const y=s(c,p);return y.trim()?`${y}/${h}`:h}it.formatChildLoggerContext=o;function l(c,h,p=i.PINO_CUSTOM_CONTEXT_KEY){const y=o(c,h,p),I=c.child({context:y});return r(I,y,p)}return it.generateChildLogger=l,it}(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.pino=void 0;const e=mt,t=e.__importDefault(aa());Object.defineProperty(i,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(ua(),i),e.__exportStar(il(),i)})(Se);class rl extends Yt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class sl extends Yt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}}let nl=class{constructor(e,t){this.logger=e,this.core=t}},al=class extends Yt{constructor(e,t){super(),this.relayer=e,this.logger=t}},ol=class extends Yt{constructor(e){super()}},cl=class{constructor(e,t,r,s){this.core=e,this.logger=t,this.name=r}},hl=class extends Yt{constructor(e,t){super(),this.relayer=e,this.logger=t}},ul=class extends Yt{constructor(e,t){super(),this.core=e,this.logger=t}},ll=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},fl=class{constructor(e){this.client=e}};var Xr={},la={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=se,t=lt;i.DIGEST_LENGTH=64,i.BLOCK_SIZE=128;var r=function(){function c(){this.digestLength=i.DIGEST_LENGTH,this.blockSize=i.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},c.prototype.update=function(h,p){if(p===void 0&&(p=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var y=0;if(this._bytesHashed+=p,this._bufferLength>0){for(;this._bufferLength<i.BLOCK_SIZE&&p>0;)this._buffer[this._bufferLength++]=h[y++],p--;this._bufferLength===this.blockSize&&(o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(p>=this.blockSize&&(y=o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,y,p),p%=this.blockSize);p>0;)this._buffer[this._bufferLength++]=h[y++],p--;return this},c.prototype.finish=function(h){if(!this._finished){var p=this._bytesHashed,y=this._bufferLength,I=p/536870912|0,A=p<<3,S=p%128<112?128:256;this._buffer[y]=128;for(var x=y+1;x<S-8;x++)this._buffer[x]=0;e.writeUint32BE(I,this._buffer,S-8),e.writeUint32BE(A,this._buffer,S-4),o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,S),this._finished=!0}for(var x=0;x<this.digestLength/8;x++)e.writeUint32BE(this._stateHi[x],h,x*8),e.writeUint32BE(this._stateLo[x],h,x*8+4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){t.wipe(h.stateHi),t.wipe(h.stateLo),h.buffer&&t.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();i.SHA512=r;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function o(c,h,p,y,I,A,S){for(var x=p[0],N=p[1],$=p[2],B=p[3],_=p[4],D=p[5],g=p[6],m=p[7],f=y[0],n=y[1],u=y[2],T=y[3],R=y[4],H=y[5],G=y[6],X=y[7],E,P,k,j,U,M,F,q;S>=128;){for(var te=0;te<16;te++){var z=8*te+A;c[te]=e.readUint32BE(I,z),h[te]=e.readUint32BE(I,z+4)}for(var te=0;te<80;te++){var Q=x,W=N,ee=$,O=B,C=_,w=D,a=g,b=m,K=f,Y=n,le=u,be=T,de=R,we=H,Te=G,Oe=X;if(E=m,P=X,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=(_>>>14|R<<32-14)^(_>>>18|R<<32-18)^(R>>>41-32|_<<32-(41-32)),P=(R>>>14|_<<32-14)^(R>>>18|_<<32-18)^(_>>>41-32|R<<32-(41-32)),U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,E=_&D^~_&g,P=R&H^~R&G,U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,E=s[te*2],P=s[te*2+1],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,E=c[te%16],P=h[te%16],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,k=F&65535|q<<16,j=U&65535|M<<16,E=k,P=j,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=(x>>>28|f<<32-28)^(f>>>34-32|x<<32-(34-32))^(f>>>39-32|x<<32-(39-32)),P=(f>>>28|x<<32-28)^(x>>>34-32|f<<32-(34-32))^(x>>>39-32|f<<32-(39-32)),U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,E=x&N^x&$^N&$,P=f&n^f&u^n&u,U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,b=F&65535|q<<16,Oe=U&65535|M<<16,E=O,P=be,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=k,P=j,U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,O=F&65535|q<<16,be=U&65535|M<<16,N=Q,$=W,B=ee,_=O,D=C,g=w,m=a,x=b,n=K,u=Y,T=le,R=be,H=de,G=we,X=Te,f=Oe,te%16===15)for(var z=0;z<16;z++)E=c[z],P=h[z],U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=c[(z+9)%16],P=h[(z+9)%16],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,k=c[(z+1)%16],j=h[(z+1)%16],E=(k>>>1|j<<32-1)^(k>>>8|j<<32-8)^k>>>7,P=(j>>>1|k<<32-1)^(j>>>8|k<<32-8)^(j>>>7|k<<32-7),U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,k=c[(z+14)%16],j=h[(z+14)%16],E=(k>>>19|j<<32-19)^(j>>>61-32|k<<32-(61-32))^k>>>6,P=(j>>>19|k<<32-19)^(k>>>61-32|j<<32-(61-32))^(j>>>6|k<<32-6),U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,c[z]=F&65535|q<<16,h[z]=U&65535|M<<16}E=x,P=f,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=p[0],P=y[0],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,p[0]=x=F&65535|q<<16,y[0]=f=U&65535|M<<16,E=N,P=n,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=p[1],P=y[1],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,p[1]=N=F&65535|q<<16,y[1]=n=U&65535|M<<16,E=$,P=u,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=p[2],P=y[2],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,p[2]=$=F&65535|q<<16,y[2]=u=U&65535|M<<16,E=B,P=T,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=p[3],P=y[3],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,p[3]=B=F&65535|q<<16,y[3]=T=U&65535|M<<16,E=_,P=R,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=p[4],P=y[4],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,p[4]=_=F&65535|q<<16,y[4]=R=U&65535|M<<16,E=D,P=H,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=p[5],P=y[5],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,p[5]=D=F&65535|q<<16,y[5]=H=U&65535|M<<16,E=g,P=G,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=p[6],P=y[6],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,p[6]=g=F&65535|q<<16,y[6]=G=U&65535|M<<16,E=m,P=X,U=P&65535,M=P>>>16,F=E&65535,q=E>>>16,E=p[7],P=y[7],U+=P&65535,M+=P>>>16,F+=E&65535,q+=E>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,p[7]=m=F&65535|q<<16,y[7]=X=U&65535|M<<16,A+=128,S-=128}return A}function l(c){var h=new r;h.update(c);var p=h.digest();return h.clean(),p}i.hash=l})(la);(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.convertSecretKeyToX25519=i.convertPublicKeyToX25519=i.verify=i.sign=i.extractPublicKeyFromSecretKey=i.generateKeyPair=i.generateKeyPairFromSeed=i.SEED_LENGTH=i.SECRET_KEY_LENGTH=i.PUBLIC_KEY_LENGTH=i.SIGNATURE_LENGTH=void 0;const e=Zt,t=la,r=lt;i.SIGNATURE_LENGTH=64,i.PUBLIC_KEY_LENGTH=32,i.SECRET_KEY_LENGTH=64,i.SEED_LENGTH=32;function s(O){const C=new Float64Array(16);if(O)for(let w=0;w<O.length;w++)C[w]=O[w];return C}const o=new Uint8Array(32);o[0]=9;const l=s(),c=s([1]),h=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),p=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),y=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),I=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),A=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function S(O,C){for(let w=0;w<16;w++)O[w]=C[w]|0}function x(O){let C=1;for(let w=0;w<16;w++){let a=O[w]+C+65535;C=Math.floor(a/65536),O[w]=a-C*65536}O[0]+=C-1+37*(C-1)}function N(O,C,w){const a=~(w-1);for(let b=0;b<16;b++){const K=a&(O[b]^C[b]);O[b]^=K,C[b]^=K}}function $(O,C){const w=s(),a=s();for(let b=0;b<16;b++)a[b]=C[b];x(a),x(a),x(a);for(let b=0;b<2;b++){w[0]=a[0]-65517;for(let Y=1;Y<15;Y++)w[Y]=a[Y]-65535-(w[Y-1]>>16&1),w[Y-1]&=65535;w[15]=a[15]-32767-(w[14]>>16&1);const K=w[15]>>16&1;w[14]&=65535,N(a,w,1-K)}for(let b=0;b<16;b++)O[2*b]=a[b]&255,O[2*b+1]=a[b]>>8}function B(O,C){let w=0;for(let a=0;a<32;a++)w|=O[a]^C[a];return(1&w-1>>>8)-1}function _(O,C){const w=new Uint8Array(32),a=new Uint8Array(32);return $(w,O),$(a,C),B(w,a)}function D(O){const C=new Uint8Array(32);return $(C,O),C[0]&1}function g(O,C){for(let w=0;w<16;w++)O[w]=C[2*w]+(C[2*w+1]<<8);O[15]&=32767}function m(O,C,w){for(let a=0;a<16;a++)O[a]=C[a]+w[a]}function f(O,C,w){for(let a=0;a<16;a++)O[a]=C[a]-w[a]}function n(O,C,w){let a,b,K=0,Y=0,le=0,be=0,de=0,we=0,Te=0,Oe=0,ye=0,pe=0,fe=0,he=0,ce=0,oe=0,ae=0,ie=0,ue=0,ge=0,re=0,me=0,_e=0,Ee=0,De=0,ve=0,yt=0,_t=0,Ct=0,ht=0,Lt=0,ti=0,Di=0,Ue=w[0],Pe=w[1],Le=w[2],$e=w[3],Me=w[4],Ae=w[5],ze=w[6],He=w[7],Ke=w[8],Be=w[9],Ve=w[10],qe=w[11],je=w[12],xe=w[13],Ge=w[14],ke=w[15];a=C[0],K+=a*Ue,Y+=a*Pe,le+=a*Le,be+=a*$e,de+=a*Me,we+=a*Ae,Te+=a*ze,Oe+=a*He,ye+=a*Ke,pe+=a*Be,fe+=a*Ve,he+=a*qe,ce+=a*je,oe+=a*xe,ae+=a*Ge,ie+=a*ke,a=C[1],Y+=a*Ue,le+=a*Pe,be+=a*Le,de+=a*$e,we+=a*Me,Te+=a*Ae,Oe+=a*ze,ye+=a*He,pe+=a*Ke,fe+=a*Be,he+=a*Ve,ce+=a*qe,oe+=a*je,ae+=a*xe,ie+=a*Ge,ue+=a*ke,a=C[2],le+=a*Ue,be+=a*Pe,de+=a*Le,we+=a*$e,Te+=a*Me,Oe+=a*Ae,ye+=a*ze,pe+=a*He,fe+=a*Ke,he+=a*Be,ce+=a*Ve,oe+=a*qe,ae+=a*je,ie+=a*xe,ue+=a*Ge,ge+=a*ke,a=C[3],be+=a*Ue,de+=a*Pe,we+=a*Le,Te+=a*$e,Oe+=a*Me,ye+=a*Ae,pe+=a*ze,fe+=a*He,he+=a*Ke,ce+=a*Be,oe+=a*Ve,ae+=a*qe,ie+=a*je,ue+=a*xe,ge+=a*Ge,re+=a*ke,a=C[4],de+=a*Ue,we+=a*Pe,Te+=a*Le,Oe+=a*$e,ye+=a*Me,pe+=a*Ae,fe+=a*ze,he+=a*He,ce+=a*Ke,oe+=a*Be,ae+=a*Ve,ie+=a*qe,ue+=a*je,ge+=a*xe,re+=a*Ge,me+=a*ke,a=C[5],we+=a*Ue,Te+=a*Pe,Oe+=a*Le,ye+=a*$e,pe+=a*Me,fe+=a*Ae,he+=a*ze,ce+=a*He,oe+=a*Ke,ae+=a*Be,ie+=a*Ve,ue+=a*qe,ge+=a*je,re+=a*xe,me+=a*Ge,_e+=a*ke,a=C[6],Te+=a*Ue,Oe+=a*Pe,ye+=a*Le,pe+=a*$e,fe+=a*Me,he+=a*Ae,ce+=a*ze,oe+=a*He,ae+=a*Ke,ie+=a*Be,ue+=a*Ve,ge+=a*qe,re+=a*je,me+=a*xe,_e+=a*Ge,Ee+=a*ke,a=C[7],Oe+=a*Ue,ye+=a*Pe,pe+=a*Le,fe+=a*$e,he+=a*Me,ce+=a*Ae,oe+=a*ze,ae+=a*He,ie+=a*Ke,ue+=a*Be,ge+=a*Ve,re+=a*qe,me+=a*je,_e+=a*xe,Ee+=a*Ge,De+=a*ke,a=C[8],ye+=a*Ue,pe+=a*Pe,fe+=a*Le,he+=a*$e,ce+=a*Me,oe+=a*Ae,ae+=a*ze,ie+=a*He,ue+=a*Ke,ge+=a*Be,re+=a*Ve,me+=a*qe,_e+=a*je,Ee+=a*xe,De+=a*Ge,ve+=a*ke,a=C[9],pe+=a*Ue,fe+=a*Pe,he+=a*Le,ce+=a*$e,oe+=a*Me,ae+=a*Ae,ie+=a*ze,ue+=a*He,ge+=a*Ke,re+=a*Be,me+=a*Ve,_e+=a*qe,Ee+=a*je,De+=a*xe,ve+=a*Ge,yt+=a*ke,a=C[10],fe+=a*Ue,he+=a*Pe,ce+=a*Le,oe+=a*$e,ae+=a*Me,ie+=a*Ae,ue+=a*ze,ge+=a*He,re+=a*Ke,me+=a*Be,_e+=a*Ve,Ee+=a*qe,De+=a*je,ve+=a*xe,yt+=a*Ge,_t+=a*ke,a=C[11],he+=a*Ue,ce+=a*Pe,oe+=a*Le,ae+=a*$e,ie+=a*Me,ue+=a*Ae,ge+=a*ze,re+=a*He,me+=a*Ke,_e+=a*Be,Ee+=a*Ve,De+=a*qe,ve+=a*je,yt+=a*xe,_t+=a*Ge,Ct+=a*ke,a=C[12],ce+=a*Ue,oe+=a*Pe,ae+=a*Le,ie+=a*$e,ue+=a*Me,ge+=a*Ae,re+=a*ze,me+=a*He,_e+=a*Ke,Ee+=a*Be,De+=a*Ve,ve+=a*qe,yt+=a*je,_t+=a*xe,Ct+=a*Ge,ht+=a*ke,a=C[13],oe+=a*Ue,ae+=a*Pe,ie+=a*Le,ue+=a*$e,ge+=a*Me,re+=a*Ae,me+=a*ze,_e+=a*He,Ee+=a*Ke,De+=a*Be,ve+=a*Ve,yt+=a*qe,_t+=a*je,Ct+=a*xe,ht+=a*Ge,Lt+=a*ke,a=C[14],ae+=a*Ue,ie+=a*Pe,ue+=a*Le,ge+=a*$e,re+=a*Me,me+=a*Ae,_e+=a*ze,Ee+=a*He,De+=a*Ke,ve+=a*Be,yt+=a*Ve,_t+=a*qe,Ct+=a*je,ht+=a*xe,Lt+=a*Ge,ti+=a*ke,a=C[15],ie+=a*Ue,ue+=a*Pe,ge+=a*Le,re+=a*$e,me+=a*Me,_e+=a*Ae,Ee+=a*ze,De+=a*He,ve+=a*Ke,yt+=a*Be,_t+=a*Ve,Ct+=a*qe,ht+=a*je,Lt+=a*xe,ti+=a*Ge,Di+=a*ke,K+=38*ue,Y+=38*ge,le+=38*re,be+=38*me,de+=38*_e,we+=38*Ee,Te+=38*De,Oe+=38*ve,ye+=38*yt,pe+=38*_t,fe+=38*Ct,he+=38*ht,ce+=38*Lt,oe+=38*ti,ae+=38*Di,b=1,a=K+b+65535,b=Math.floor(a/65536),K=a-b*65536,a=Y+b+65535,b=Math.floor(a/65536),Y=a-b*65536,a=le+b+65535,b=Math.floor(a/65536),le=a-b*65536,a=be+b+65535,b=Math.floor(a/65536),be=a-b*65536,a=de+b+65535,b=Math.floor(a/65536),de=a-b*65536,a=we+b+65535,b=Math.floor(a/65536),we=a-b*65536,a=Te+b+65535,b=Math.floor(a/65536),Te=a-b*65536,a=Oe+b+65535,b=Math.floor(a/65536),Oe=a-b*65536,a=ye+b+65535,b=Math.floor(a/65536),ye=a-b*65536,a=pe+b+65535,b=Math.floor(a/65536),pe=a-b*65536,a=fe+b+65535,b=Math.floor(a/65536),fe=a-b*65536,a=he+b+65535,b=Math.floor(a/65536),he=a-b*65536,a=ce+b+65535,b=Math.floor(a/65536),ce=a-b*65536,a=oe+b+65535,b=Math.floor(a/65536),oe=a-b*65536,a=ae+b+65535,b=Math.floor(a/65536),ae=a-b*65536,a=ie+b+65535,b=Math.floor(a/65536),ie=a-b*65536,K+=b-1+37*(b-1),b=1,a=K+b+65535,b=Math.floor(a/65536),K=a-b*65536,a=Y+b+65535,b=Math.floor(a/65536),Y=a-b*65536,a=le+b+65535,b=Math.floor(a/65536),le=a-b*65536,a=be+b+65535,b=Math.floor(a/65536),be=a-b*65536,a=de+b+65535,b=Math.floor(a/65536),de=a-b*65536,a=we+b+65535,b=Math.floor(a/65536),we=a-b*65536,a=Te+b+65535,b=Math.floor(a/65536),Te=a-b*65536,a=Oe+b+65535,b=Math.floor(a/65536),Oe=a-b*65536,a=ye+b+65535,b=Math.floor(a/65536),ye=a-b*65536,a=pe+b+65535,b=Math.floor(a/65536),pe=a-b*65536,a=fe+b+65535,b=Math.floor(a/65536),fe=a-b*65536,a=he+b+65535,b=Math.floor(a/65536),he=a-b*65536,a=ce+b+65535,b=Math.floor(a/65536),ce=a-b*65536,a=oe+b+65535,b=Math.floor(a/65536),oe=a-b*65536,a=ae+b+65535,b=Math.floor(a/65536),ae=a-b*65536,a=ie+b+65535,b=Math.floor(a/65536),ie=a-b*65536,K+=b-1+37*(b-1),O[0]=K,O[1]=Y,O[2]=le,O[3]=be,O[4]=de,O[5]=we,O[6]=Te,O[7]=Oe,O[8]=ye,O[9]=pe,O[10]=fe,O[11]=he,O[12]=ce,O[13]=oe,O[14]=ae,O[15]=ie}function u(O,C){n(O,C,C)}function T(O,C){const w=s();let a;for(a=0;a<16;a++)w[a]=C[a];for(a=253;a>=0;a--)u(w,w),a!==2&&a!==4&&n(w,w,C);for(a=0;a<16;a++)O[a]=w[a]}function R(O,C){const w=s();let a;for(a=0;a<16;a++)w[a]=C[a];for(a=250;a>=0;a--)u(w,w),a!==1&&n(w,w,C);for(a=0;a<16;a++)O[a]=w[a]}function H(O,C){const w=s(),a=s(),b=s(),K=s(),Y=s(),le=s(),be=s(),de=s(),we=s();f(w,O[1],O[0]),f(we,C[1],C[0]),n(w,w,we),m(a,O[0],O[1]),m(we,C[0],C[1]),n(a,a,we),n(b,O[3],C[3]),n(b,b,p),n(K,O[2],C[2]),m(K,K,K),f(Y,a,w),f(le,K,b),m(be,K,b),m(de,a,w),n(O[0],Y,le),n(O[1],de,be),n(O[2],be,le),n(O[3],Y,de)}function G(O,C,w){for(let a=0;a<4;a++)N(O[a],C[a],w)}function X(O,C){const w=s(),a=s(),b=s();T(b,C[2]),n(w,C[0],b),n(a,C[1],b),$(O,a),O[31]^=D(w)<<7}function E(O,C,w){S(O[0],l),S(O[1],c),S(O[2],c),S(O[3],l);for(let a=255;a>=0;--a){const b=w[a/8|0]>>(a&7)&1;G(O,C,b),H(C,O),H(O,O),G(O,C,b)}}function P(O,C){const w=[s(),s(),s(),s()];S(w[0],y),S(w[1],I),S(w[2],c),n(w[3],y,I),E(O,w,C)}function k(O){if(O.length!==i.SEED_LENGTH)throw new Error(`ed25519: seed must be ${i.SEED_LENGTH} bytes`);const C=(0,t.hash)(O);C[0]&=248,C[31]&=127,C[31]|=64;const w=new Uint8Array(32),a=[s(),s(),s(),s()];P(a,C),X(w,a);const b=new Uint8Array(64);return b.set(O),b.set(w,32),{publicKey:w,secretKey:b}}i.generateKeyPairFromSeed=k;function j(O){const C=(0,e.randomBytes)(32,O),w=k(C);return(0,r.wipe)(C),w}i.generateKeyPair=j;function U(O){if(O.length!==i.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${i.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(O.subarray(32))}i.extractPublicKeyFromSecretKey=U;const M=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function F(O,C){let w,a,b,K;for(a=63;a>=32;--a){for(w=0,b=a-32,K=a-12;b<K;++b)C[b]+=w-16*C[a]*M[b-(a-32)],w=Math.floor((C[b]+128)/256),C[b]-=w*256;C[b]+=w,C[a]=0}for(w=0,b=0;b<32;b++)C[b]+=w-(C[31]>>4)*M[b],w=C[b]>>8,C[b]&=255;for(b=0;b<32;b++)C[b]-=w*M[b];for(a=0;a<32;a++)C[a+1]+=C[a]>>8,O[a]=C[a]&255}function q(O){const C=new Float64Array(64);for(let w=0;w<64;w++)C[w]=O[w];for(let w=0;w<64;w++)O[w]=0;F(O,C)}function te(O,C){const w=new Float64Array(64),a=[s(),s(),s(),s()],b=(0,t.hash)(O.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const K=new Uint8Array(64);K.set(b.subarray(32),32);const Y=new t.SHA512;Y.update(K.subarray(32)),Y.update(C);const le=Y.digest();Y.clean(),q(le),P(a,le),X(K,a),Y.reset(),Y.update(K.subarray(0,32)),Y.update(O.subarray(32)),Y.update(C);const be=Y.digest();q(be);for(let de=0;de<32;de++)w[de]=le[de];for(let de=0;de<32;de++)for(let we=0;we<32;we++)w[de+we]+=be[de]*b[we];return F(K.subarray(32),w),K}i.sign=te;function z(O,C){const w=s(),a=s(),b=s(),K=s(),Y=s(),le=s(),be=s();return S(O[2],c),g(O[1],C),u(b,O[1]),n(K,b,h),f(b,b,O[2]),m(K,O[2],K),u(Y,K),u(le,Y),n(be,le,Y),n(w,be,b),n(w,w,K),R(w,w),n(w,w,b),n(w,w,K),n(w,w,K),n(O[0],w,K),u(a,O[0]),n(a,a,K),_(a,b)&&n(O[0],O[0],A),u(a,O[0]),n(a,a,K),_(a,b)?-1:(D(O[0])===C[31]>>7&&f(O[0],l,O[0]),n(O[3],O[0],O[1]),0)}function Q(O,C,w){const a=new Uint8Array(32),b=[s(),s(),s(),s()],K=[s(),s(),s(),s()];if(w.length!==i.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${i.SIGNATURE_LENGTH} bytes`);if(z(K,O))return!1;const Y=new t.SHA512;Y.update(w.subarray(0,32)),Y.update(O),Y.update(C);const le=Y.digest();return q(le),E(b,K,le),P(K,w.subarray(32)),H(b,K),X(a,b),!B(w,a)}i.verify=Q;function W(O){let C=[s(),s(),s(),s()];if(z(C,O))throw new Error("Ed25519: invalid public key");let w=s(),a=s(),b=C[1];m(w,c,b),f(a,c,b),T(a,a),n(w,w,a);let K=new Uint8Array(32);return $(K,w),K}i.convertPublicKeyToX25519=W;function ee(O){const C=(0,t.hash)(O.subarray(0,32));C[0]&=248,C[31]&=127,C[31]|=64;const w=new Uint8Array(C.subarray(0,32));return(0,r.wipe)(C),w}i.convertSecretKeyToX25519=ee})(Xr);const dl="EdDSA",pl="JWT",fa=".",da="base64url",gl="utf8",yl="utf8",bl=":",ml="did",_l="key",Qs="base58btc",wl="z",vl="K36",El=32;function ji(i){return ot(nt($r(i),gl),da)}function pa(i){const e=nt(vl,Qs),t=wl+ot(Ir([e,i]),Qs);return[ml,_l,t].join(bl)}function Dl(i){return ot(i,da)}function Sl(i){return nt([ji(i.header),ji(i.payload)].join(fa),yl)}function Il(i){return[ji(i.header),ji(i.payload),Dl(i.signature)].join(fa)}function Zs(i=Zt.randomBytes(El)){return Xr.generateKeyPairFromSeed(i)}async function xl(i,e,t,r,s=Z.fromMiliseconds(Date.now())){const o={alg:dl,typ:pl},l=pa(r.publicKey),c=s+t,h={iss:l,sub:i,aud:e,iat:s,exp:c},p=Sl({header:o,payload:h}),y=Xr.sign(r.secretKey,p);return Il({header:o,payload:h,signature:y})}class Cl extends No{constructor(e){super(e),this.events=new ct.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(zi(e.method,e.params||[]),t)}async requestStrict(e,t){return new Promise(async(r,s)=>{if(!this.connection.connected)try{await this.open()}catch(o){s(o)}this.events.on(`${e.id}`,o=>{Dt(o)?s(o.error):r(o.result)});try{await this.connection.send(e,t)}catch(o){s(o)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Mr(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.hasRegisteredEventListeners=!0)}}const en=10,Ol=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),Pl=()=>typeof window<"u",Al=Ol();class Nl{constructor(e){if(this.url=e,this.events=new ct.EventEmitter,this.registering=!1,!fs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e,t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send($r(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!fs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((r,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,r)=>{const s=To.isReactNative()?void 0:{rejectUnauthorized:!Ro(e)},o=new Al(e,[],s);Pl()?o.onerror=l=>{const c=l;r(this.emitError(c.error))}:o.on("error",l=>{r(this.emitError(l))}),o.onopen=()=>{this.onOpen(o),t(o)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Nn(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const r=this.parseError(t),s=r.message||r.toString(),o=jr(e,s);this.events.emit("payload",o)}parseError(e,t=this.url){return Fo(e,t,"WS")}resetMaxListeners(){this.events.getMaxListeners()>en&&this.events.setMaxListeners(en)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",t),t}}var qi={},Tl={get exports(){return qi},set exports(i){qi=i}};(function(i,e){var t=200,r="__lodash_hash_undefined__",s=1,o=2,l=9007199254740991,c="[object Arguments]",h="[object Array]",p="[object AsyncFunction]",y="[object Boolean]",I="[object Date]",A="[object Error]",S="[object Function]",x="[object GeneratorFunction]",N="[object Map]",$="[object Number]",B="[object Null]",_="[object Object]",D="[object Promise]",g="[object Proxy]",m="[object RegExp]",f="[object Set]",n="[object String]",u="[object Symbol]",T="[object Undefined]",R="[object WeakMap]",H="[object ArrayBuffer]",G="[object DataView]",X="[object Float32Array]",E="[object Float64Array]",P="[object Int8Array]",k="[object Int16Array]",j="[object Int32Array]",U="[object Uint8Array]",M="[object Uint8ClampedArray]",F="[object Uint16Array]",q="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,z=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,W={};W[X]=W[E]=W[P]=W[k]=W[j]=W[U]=W[M]=W[F]=W[q]=!0,W[c]=W[h]=W[H]=W[y]=W[G]=W[I]=W[A]=W[S]=W[N]=W[$]=W[_]=W[m]=W[f]=W[n]=W[R]=!1;var ee=typeof Vt=="object"&&Vt&&Vt.Object===Object&&Vt,O=typeof self=="object"&&self&&self.Object===Object&&self,C=ee||O||Function("return this")(),w=e&&!e.nodeType&&e,a=w&&!0&&i&&!i.nodeType&&i,b=a&&a.exports===w,K=b&&ee.process,Y=function(){try{return K&&K.binding&&K.binding("util")}catch{}}(),le=Y&&Y.isTypedArray;function be(d,v){for(var L=-1,J=d==null?0:d.length,Ie=0,ne=[];++L<J;){var Ne=d[L];v(Ne,L,d)&&(ne[Ie++]=Ne)}return ne}function de(d,v){for(var L=-1,J=v.length,Ie=d.length;++L<J;)d[Ie+L]=v[L];return d}function we(d,v){for(var L=-1,J=d==null?0:d.length;++L<J;)if(v(d[L],L,d))return!0;return!1}function Te(d,v){for(var L=-1,J=Array(d);++L<d;)J[L]=v(L);return J}function Oe(d){return function(v){return d(v)}}function ye(d,v){return d.has(v)}function pe(d,v){return d==null?void 0:d[v]}function fe(d){var v=-1,L=Array(d.size);return d.forEach(function(J,Ie){L[++v]=[Ie,J]}),L}function he(d,v){return function(L){return d(v(L))}}function ce(d){var v=-1,L=Array(d.size);return d.forEach(function(J){L[++v]=J}),L}var oe=Array.prototype,ae=Function.prototype,ie=Object.prototype,ue=C["__core-js_shared__"],ge=ae.toString,re=ie.hasOwnProperty,me=function(){var d=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return d?"Symbol(src)_1."+d:""}(),_e=ie.toString,Ee=RegExp("^"+ge.call(re).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=b?C.Buffer:void 0,ve=C.Symbol,yt=C.Uint8Array,_t=ie.propertyIsEnumerable,Ct=oe.splice,ht=ve?ve.toStringTag:void 0,Lt=Object.getOwnPropertySymbols,ti=De?De.isBuffer:void 0,Di=he(Object.keys,Object),Ue=Wt(C,"DataView"),Pe=Wt(C,"Map"),Le=Wt(C,"Promise"),$e=Wt(C,"Set"),Me=Wt(C,"WeakMap"),Ae=Wt(Object,"create"),ze=Mt(Ue),He=Mt(Pe),Ke=Mt(Le),Be=Mt($e),Ve=Mt(Me),qe=ve?ve.prototype:void 0,je=qe?qe.valueOf:void 0;function xe(d){var v=-1,L=d==null?0:d.length;for(this.clear();++v<L;){var J=d[v];this.set(J[0],J[1])}}function Ge(){this.__data__=Ae?Ae(null):{},this.size=0}function ke(d){var v=this.has(d)&&delete this.__data__[d];return this.size-=v?1:0,v}function Fa(d){var v=this.__data__;if(Ae){var L=v[d];return L===r?void 0:L}return re.call(v,d)?v[d]:void 0}function Ua(d){var v=this.__data__;return Ae?v[d]!==void 0:re.call(v,d)}function La(d,v){var L=this.__data__;return this.size+=this.has(d)?0:1,L[d]=Ae&&v===void 0?r:v,this}xe.prototype.clear=Ge,xe.prototype.delete=ke,xe.prototype.get=Fa,xe.prototype.has=Ua,xe.prototype.set=La;function It(d){var v=-1,L=d==null?0:d.length;for(this.clear();++v<L;){var J=d[v];this.set(J[0],J[1])}}function $a(){this.__data__=[],this.size=0}function Ma(d){var v=this.__data__,L=Ii(v,d);if(L<0)return!1;var J=v.length-1;return L==J?v.pop():Ct.call(v,L,1),--this.size,!0}function ja(d){var v=this.__data__,L=Ii(v,d);return L<0?void 0:v[L][1]}function qa(d){return Ii(this.__data__,d)>-1}function za(d,v){var L=this.__data__,J=Ii(L,d);return J<0?(++this.size,L.push([d,v])):L[J][1]=v,this}It.prototype.clear=$a,It.prototype.delete=Ma,It.prototype.get=ja,It.prototype.has=qa,It.prototype.set=za;function $t(d){var v=-1,L=d==null?0:d.length;for(this.clear();++v<L;){var J=d[v];this.set(J[0],J[1])}}function Ha(){this.size=0,this.__data__={hash:new xe,map:new(Pe||It),string:new xe}}function Ka(d){var v=xi(this,d).delete(d);return this.size-=v?1:0,v}function Ba(d){return xi(this,d).get(d)}function Va(d){return xi(this,d).has(d)}function Ga(d,v){var L=xi(this,d),J=L.size;return L.set(d,v),this.size+=L.size==J?0:1,this}$t.prototype.clear=Ha,$t.prototype.delete=Ka,$t.prototype.get=Ba,$t.prototype.has=Va,$t.prototype.set=Ga;function Si(d){var v=-1,L=d==null?0:d.length;for(this.__data__=new $t;++v<L;)this.add(d[v])}function ka(d){return this.__data__.set(d,r),this}function Ya(d){return this.__data__.has(d)}Si.prototype.add=Si.prototype.push=ka,Si.prototype.has=Ya;function Ot(d){var v=this.__data__=new It(d);this.size=v.size}function Wa(){this.__data__=new It,this.size=0}function Ja(d){var v=this.__data__,L=v.delete(d);return this.size=v.size,L}function Xa(d){return this.__data__.get(d)}function Qa(d){return this.__data__.has(d)}function Za(d,v){var L=this.__data__;if(L instanceof It){var J=L.__data__;if(!Pe||J.length<t-1)return J.push([d,v]),this.size=++L.size,this;L=this.__data__=new $t(J)}return L.set(d,v),this.size=L.size,this}Ot.prototype.clear=Wa,Ot.prototype.delete=Ja,Ot.prototype.get=Xa,Ot.prototype.has=Qa,Ot.prototype.set=Za;function eo(d,v){var L=Ci(d),J=!L&&yo(d),Ie=!L&&!J&&tr(d),ne=!L&&!J&&!Ie&&us(d),Ne=L||J||Ie||ne,Ye=Ne?Te(d.length,String):[],Xe=Ye.length;for(var Ce in d)(v||re.call(d,Ce))&&!(Ne&&(Ce=="length"||Ie&&(Ce=="offset"||Ce=="parent")||ne&&(Ce=="buffer"||Ce=="byteLength"||Ce=="byteOffset")||uo(Ce,Xe)))&&Ye.push(Ce);return Ye}function Ii(d,v){for(var L=d.length;L--;)if(as(d[L][0],v))return L;return-1}function to(d,v,L){var J=v(d);return Ci(d)?J:de(J,L(d))}function ii(d){return d==null?d===void 0?T:B:ht&&ht in Object(d)?co(d):go(d)}function is(d){return ri(d)&&ii(d)==c}function rs(d,v,L,J,Ie){return d===v?!0:d==null||v==null||!ri(d)&&!ri(v)?d!==d&&v!==v:io(d,v,L,J,rs,Ie)}function io(d,v,L,J,Ie,ne){var Ne=Ci(d),Ye=Ci(v),Xe=Ne?h:Pt(d),Ce=Ye?h:Pt(v);Xe=Xe==c?_:Xe,Ce=Ce==c?_:Ce;var ut=Xe==_,bt=Ce==_,et=Xe==Ce;if(et&&tr(d)){if(!tr(v))return!1;Ne=!0,ut=!1}if(et&&!ut)return ne||(ne=new Ot),Ne||us(d)?ss(d,v,L,J,Ie,ne):ao(d,v,Xe,L,J,Ie,ne);if(!(L&s)){var ft=ut&&re.call(d,"__wrapped__"),dt=bt&&re.call(v,"__wrapped__");if(ft||dt){var At=ft?d.value():d,xt=dt?v.value():v;return ne||(ne=new Ot),Ie(At,xt,L,J,ne)}}return et?(ne||(ne=new Ot),oo(d,v,L,J,Ie,ne)):!1}function ro(d){if(!hs(d)||fo(d))return!1;var v=os(d)?Ee:z;return v.test(Mt(d))}function so(d){return ri(d)&&cs(d.length)&&!!W[ii(d)]}function no(d){if(!po(d))return Di(d);var v=[];for(var L in Object(d))re.call(d,L)&&L!="constructor"&&v.push(L);return v}function ss(d,v,L,J,Ie,ne){var Ne=L&s,Ye=d.length,Xe=v.length;if(Ye!=Xe&&!(Ne&&Xe>Ye))return!1;var Ce=ne.get(d);if(Ce&&ne.get(v))return Ce==v;var ut=-1,bt=!0,et=L&o?new Si:void 0;for(ne.set(d,v),ne.set(v,d);++ut<Ye;){var ft=d[ut],dt=v[ut];if(J)var At=Ne?J(dt,ft,ut,v,d,ne):J(ft,dt,ut,d,v,ne);if(At!==void 0){if(At)continue;bt=!1;break}if(et){if(!we(v,function(xt,jt){if(!ye(et,jt)&&(ft===xt||Ie(ft,xt,L,J,ne)))return et.push(jt)})){bt=!1;break}}else if(!(ft===dt||Ie(ft,dt,L,J,ne))){bt=!1;break}}return ne.delete(d),ne.delete(v),bt}function ao(d,v,L,J,Ie,ne,Ne){switch(L){case G:if(d.byteLength!=v.byteLength||d.byteOffset!=v.byteOffset)return!1;d=d.buffer,v=v.buffer;case H:return!(d.byteLength!=v.byteLength||!ne(new yt(d),new yt(v)));case y:case I:case $:return as(+d,+v);case A:return d.name==v.name&&d.message==v.message;case m:case n:return d==v+"";case N:var Ye=fe;case f:var Xe=J&s;if(Ye||(Ye=ce),d.size!=v.size&&!Xe)return!1;var Ce=Ne.get(d);if(Ce)return Ce==v;J|=o,Ne.set(d,v);var ut=ss(Ye(d),Ye(v),J,Ie,ne,Ne);return Ne.delete(d),ut;case u:if(je)return je.call(d)==je.call(v)}return!1}function oo(d,v,L,J,Ie,ne){var Ne=L&s,Ye=ns(d),Xe=Ye.length,Ce=ns(v),ut=Ce.length;if(Xe!=ut&&!Ne)return!1;for(var bt=Xe;bt--;){var et=Ye[bt];if(!(Ne?et in v:re.call(v,et)))return!1}var ft=ne.get(d);if(ft&&ne.get(v))return ft==v;var dt=!0;ne.set(d,v),ne.set(v,d);for(var At=Ne;++bt<Xe;){et=Ye[bt];var xt=d[et],jt=v[et];if(J)var ls=Ne?J(jt,xt,et,v,d,ne):J(xt,jt,et,d,v,ne);if(!(ls===void 0?xt===jt||Ie(xt,jt,L,J,ne):ls)){dt=!1;break}At||(At=et=="constructor")}if(dt&&!At){var Oi=d.constructor,Pi=v.constructor;Oi!=Pi&&"constructor"in d&&"constructor"in v&&!(typeof Oi=="function"&&Oi instanceof Oi&&typeof Pi=="function"&&Pi instanceof Pi)&&(dt=!1)}return ne.delete(d),ne.delete(v),dt}function ns(d){return to(d,_o,ho)}function xi(d,v){var L=d.__data__;return lo(v)?L[typeof v=="string"?"string":"hash"]:L.map}function Wt(d,v){var L=pe(d,v);return ro(L)?L:void 0}function co(d){var v=re.call(d,ht),L=d[ht];try{d[ht]=void 0;var J=!0}catch{}var Ie=_e.call(d);return J&&(v?d[ht]=L:delete d[ht]),Ie}var ho=Lt?function(d){return d==null?[]:(d=Object(d),be(Lt(d),function(v){return _t.call(d,v)}))}:wo,Pt=ii;(Ue&&Pt(new Ue(new ArrayBuffer(1)))!=G||Pe&&Pt(new Pe)!=N||Le&&Pt(Le.resolve())!=D||$e&&Pt(new $e)!=f||Me&&Pt(new Me)!=R)&&(Pt=function(d){var v=ii(d),L=v==_?d.constructor:void 0,J=L?Mt(L):"";if(J)switch(J){case ze:return G;case He:return N;case Ke:return D;case Be:return f;case Ve:return R}return v});function uo(d,v){return v=v??l,!!v&&(typeof d=="number"||Q.test(d))&&d>-1&&d%1==0&&d<v}function lo(d){var v=typeof d;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?d!=="__proto__":d===null}function fo(d){return!!me&&me in d}function po(d){var v=d&&d.constructor,L=typeof v=="function"&&v.prototype||ie;return d===L}function go(d){return _e.call(d)}function Mt(d){if(d!=null){try{return ge.call(d)}catch{}try{return d+""}catch{}}return""}function as(d,v){return d===v||d!==d&&v!==v}var yo=is(function(){return arguments}())?is:function(d){return ri(d)&&re.call(d,"callee")&&!_t.call(d,"callee")},Ci=Array.isArray;function bo(d){return d!=null&&cs(d.length)&&!os(d)}var tr=ti||vo;function mo(d,v){return rs(d,v)}function os(d){if(!hs(d))return!1;var v=ii(d);return v==S||v==x||v==p||v==g}function cs(d){return typeof d=="number"&&d>-1&&d%1==0&&d<=l}function hs(d){var v=typeof d;return d!=null&&(v=="object"||v=="function")}function ri(d){return d!=null&&typeof d=="object"}var us=le?Oe(le):so;function _o(d){return bo(d)?eo(d):no(d)}function wo(){return[]}function vo(){return!1}i.exports=mo})(Tl,qi);function Rl(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<i.length;s++){var o=i.charAt(s),l=o.charCodeAt(0);if(t[l]!==255)throw new TypeError(o+" is ambiguous");t[l]=s}var c=i.length,h=i.charAt(0),p=Math.log(c)/Math.log(256),y=Math.log(256)/Math.log(c);function I(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var N=0,$=0,B=0,_=x.length;B!==_&&x[B]===0;)B++,N++;for(var D=(_-B)*y+1>>>0,g=new Uint8Array(D);B!==_;){for(var m=x[B],f=0,n=D-1;(m!==0||f<$)&&n!==-1;n--,f++)m+=256*g[n]>>>0,g[n]=m%c>>>0,m=m/c>>>0;if(m!==0)throw new Error("Non-zero carry");$=f,B++}for(var u=D-$;u!==D&&g[u]===0;)u++;for(var T=h.repeat(N);u<D;++u)T+=i.charAt(g[u]);return T}function A(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var N=0;if(x[N]!==" "){for(var $=0,B=0;x[N]===h;)$++,N++;for(var _=(x.length-N)*p+1>>>0,D=new Uint8Array(_);x[N];){var g=t[x.charCodeAt(N)];if(g===255)return;for(var m=0,f=_-1;(g!==0||m<B)&&f!==-1;f--,m++)g+=c*D[f]>>>0,D[f]=g%256>>>0,g=g/256>>>0;if(g!==0)throw new Error("Non-zero carry");B=m,N++}if(x[N]!==" "){for(var n=_-B;n!==_&&D[n]===0;)n++;for(var u=new Uint8Array($+(_-n)),T=$;n!==_;)u[T++]=D[n++];return u}}}function S(x){var N=A(x);if(N)return N;throw new Error(`Non-${e} character`)}return{encode:I,decodeUnsafe:A,decode:S}}var Fl=Rl,Ul=Fl;const ga=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Ll=i=>new TextEncoder().encode(i),$l=i=>new TextDecoder().decode(i);class Ml{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class jl{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ya(this,e)}}class ql{constructor(e){this.decoders=e}or(e){return ya(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ya=(i,e)=>new ql({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class zl{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new Ml(e,t,r),this.decoder=new jl(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Qi=({name:i,prefix:e,encode:t,decode:r})=>new zl(i,e,t,r),vi=({prefix:i,name:e,alphabet:t})=>{const{encode:r,decode:s}=Ul(t,e);return Qi({prefix:i,name:e,encode:r,decode:o=>ga(s(o))})},Hl=(i,e,t,r)=>{const s={};for(let y=0;y<e.length;++y)s[e[y]]=y;let o=i.length;for(;i[o-1]==="=";)--o;const l=new Uint8Array(o*t/8|0);let c=0,h=0,p=0;for(let y=0;y<o;++y){const I=s[i[y]];if(I===void 0)throw new SyntaxError(`Non-${r} character`);h=h<<t|I,c+=t,c>=8&&(c-=8,l[p++]=255&h>>c)}if(c>=t||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return l},Kl=(i,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",l=0,c=0;for(let h=0;h<i.length;++h)for(c=c<<8|i[h],l+=8;l>t;)l-=t,o+=e[s&c>>l];if(l&&(o+=e[s&c<<t-l]),r)for(;o.length*t&7;)o+="=";return o},Ze=({name:i,prefix:e,bitsPerChar:t,alphabet:r})=>Qi({prefix:e,name:i,encode(s){return Kl(s,r,t)},decode(s){return Hl(s,r,t,i)}}),Bl=Qi({prefix:"\0",name:"identity",encode:i=>$l(i),decode:i=>Ll(i)});var Vl=Object.freeze({__proto__:null,identity:Bl});const Gl=Ze({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var kl=Object.freeze({__proto__:null,base2:Gl});const Yl=Ze({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Wl=Object.freeze({__proto__:null,base8:Yl});const Jl=vi({prefix:"9",name:"base10",alphabet:"0123456789"});var Xl=Object.freeze({__proto__:null,base10:Jl});const Ql=Ze({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Zl=Ze({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ef=Object.freeze({__proto__:null,base16:Ql,base16upper:Zl});const tf=Ze({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rf=Ze({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sf=Ze({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),nf=Ze({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),af=Ze({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),of=Ze({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cf=Ze({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hf=Ze({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),uf=Ze({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var lf=Object.freeze({__proto__:null,base32:tf,base32upper:rf,base32pad:sf,base32padupper:nf,base32hex:af,base32hexupper:of,base32hexpad:cf,base32hexpadupper:hf,base32z:uf});const ff=vi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),df=vi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var pf=Object.freeze({__proto__:null,base36:ff,base36upper:df});const gf=vi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),yf=vi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var bf=Object.freeze({__proto__:null,base58btc:gf,base58flickr:yf});const mf=Ze({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),_f=Ze({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),wf=Ze({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),vf=Ze({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ef=Object.freeze({__proto__:null,base64:mf,base64pad:_f,base64url:wf,base64urlpad:vf});const ba=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Df=ba.reduce((i,e,t)=>(i[t]=e,i),[]),Sf=ba.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function If(i){return i.reduce((e,t)=>(e+=Df[t],e),"")}function xf(i){const e=[];for(const t of i){const r=Sf[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const Cf=Qi({prefix:"🚀",name:"base256emoji",encode:If,decode:xf});var Of=Object.freeze({__proto__:null,base256emoji:Cf}),Pf=ma,tn=128,Af=127,Nf=~Af,Tf=Math.pow(2,31);function ma(i,e,t){e=e||[],t=t||0;for(var r=t;i>=Tf;)e[t++]=i&255|tn,i/=128;for(;i&Nf;)e[t++]=i&255|tn,i>>>=7;return e[t]=i|0,ma.bytes=t-r+1,e}var Rf=Nr,Ff=128,rn=127;function Nr(i,r){var t=0,r=r||0,s=0,o=r,l,c=i.length;do{if(o>=c)throw Nr.bytes=0,new RangeError("Could not decode varint");l=i[o++],t+=s<28?(l&rn)<<s:(l&rn)*Math.pow(2,s),s+=7}while(l>=Ff);return Nr.bytes=o-r,t}var Uf=Math.pow(2,7),Lf=Math.pow(2,14),$f=Math.pow(2,21),Mf=Math.pow(2,28),jf=Math.pow(2,35),qf=Math.pow(2,42),zf=Math.pow(2,49),Hf=Math.pow(2,56),Kf=Math.pow(2,63),Bf=function(i){return i<Uf?1:i<Lf?2:i<$f?3:i<Mf?4:i<jf?5:i<qf?6:i<zf?7:i<Hf?8:i<Kf?9:10},Vf={encode:Pf,decode:Rf,encodingLength:Bf},_a=Vf;const sn=(i,e,t=0)=>(_a.encode(i,e,t),e),nn=i=>_a.encodingLength(i),Tr=(i,e)=>{const t=e.byteLength,r=nn(i),s=r+nn(t),o=new Uint8Array(s+t);return sn(i,o,0),sn(t,o,r),o.set(e,s),new Gf(i,t,e,o)};class Gf{constructor(e,t,r,s){this.code=e,this.size=t,this.digest=r,this.bytes=s}}const wa=({name:i,code:e,encode:t})=>new kf(i,e,t);class kf{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Tr(this.code,t):t.then(r=>Tr(this.code,r))}else throw Error("Unknown type, must be binary type")}}const va=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),Yf=wa({name:"sha2-256",code:18,encode:va("SHA-256")}),Wf=wa({name:"sha2-512",code:19,encode:va("SHA-512")});var Jf=Object.freeze({__proto__:null,sha256:Yf,sha512:Wf});const Ea=0,Xf="identity",Da=ga,Qf=i=>Tr(Ea,Da(i)),Zf={code:Ea,name:Xf,encode:Da,digest:Qf};var ed=Object.freeze({__proto__:null,identity:Zf});new TextEncoder,new TextDecoder;const an={...Vl,...kl,...Wl,...Xl,...ef,...lf,...pf,...bf,...Ef,...Of};({...Jf,...ed});function td(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function Sa(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const on=Sa("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),dr=Sa("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=td(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),id={utf8:on,"utf-8":on,hex:an.base16,latin1:dr,ascii:dr,binary:dr,...an};function rd(i,e="utf8"){const t=id[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):t.decoder.decode(`${t.prefix}${i}`)}const Ia="wc",sd=2,Qr="core",Ft=`${Ia}@2:${Qr}:`,nd={name:Qr,logger:"error"},ad={database:":memory:"},od="crypto",cn="client_ed25519_seed",cd=Z.ONE_DAY,hd="keychain",ud="0.3",ld="messages",fd="0.3",dd=Z.SIX_HOURS,pd="publisher",xa="irn",gd="error",Ca="wss://relay.walletconnect.com",yd="relayer",We={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},bd="_subscription",Ai={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},hn=Z.ONE_SECOND,md="2.5.1",_d="0.3",Et={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},wd="subscription",vd="0.3",Ed=Z.FIVE_SECONDS*1e3,Dd="pairing",Sd="0.3",ui={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},vt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Id="history",xd="0.3",Cd="expirer",gt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Od="0.3";class Pd{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=hd,this.version=ud,this.initialized=!1,this.storagePrefix=Ft,this.init=async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}},this.has=r=>(this.isInitialized(),this.keychain.has(r)),this.set=async(r,s)=>{this.isInitialized(),this.keychain.set(r,s),await this.persist()},this.get=r=>{this.isInitialized();const s=this.keychain.get(r);if(typeof s>"u"){const{message:o}=V("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(o)}return s},this.del=async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ea(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ta(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ad{constructor(e,t,r){this.core=e,this.logger=t,this.name=od,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),o=Zs(s);return pa(o.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Th();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const o=await this.getClientSeed(),l=Zs(o),c=Or();return await xl(c,s,cd,l)},this.generateSharedKey=(s,o,l)=>{this.isInitialized();const c=this.getPrivateKey(s),h=Rh(c,o);return this.setSymKey(h,l)},this.setSymKey=async(s,o)=>{this.isInitialized();const l=o||Fh(s);return await this.keychain.set(l,s),l},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,o,l)=>{this.isInitialized();const c=Qn(l),h=$r(o);if(Os(c)){const A=c.senderPublicKey,S=c.receiverPublicKey;s=await this.generateSharedKey(A,S)}const p=this.getSymKey(s),{type:y,senderPublicKey:I}=c;return Lh({type:y,symKey:p,message:h,senderPublicKey:I})},this.decode=async(s,o,l)=>{this.isInitialized();const c=jh(o,l);if(Os(c)){const y=c.receiverPublicKey,I=c.senderPublicKey;s=await this.generateSharedKey(y,I)}const h=this.getSymKey(s),p=$h({symKey:h,encoded:o});return Nn(p)},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.keychain=r||new Pd(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const t=Yr(e);return mi(t.type)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(cn)}catch{e=Or(),await this.keychain.set(cn,e)}return rd(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Nd extends nl{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=ld,this.version=fd,this.initialized=!1,this.storagePrefix=Ft,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}},this.set=async(r,s)=>{this.isInitialized();const o=$i(s);let l=this.messages.get(r);return typeof l>"u"&&(l={}),typeof l[o]<"u"||(l[o]=s,this.messages.set(r,l),await this.persist()),o},this.get=r=>{this.isInitialized();let s=this.messages.get(r);return typeof s>"u"&&(s={}),s},this.has=(r,s)=>{this.isInitialized();const o=this.get(r),l=$i(s);return typeof o[l]<"u"},this.del=async r=>{this.isInitialized(),this.messages.delete(r),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=t}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ea(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ta(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Td extends al{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new ct.EventEmitter,this.name=pd,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(r,s,o)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:o}});try{const l=(o==null?void 0:o.ttl)||dd,c=Ar(o),h=(o==null?void 0:o.prompt)||!1,p=(o==null?void 0:o.tag)||0,y={topic:r,message:s,opts:{ttl:l,relay:c,prompt:h,tag:p}},I=$i(s);this.queue.set(I,y);try{await await Pr(this.rpcPublish(r,s,l,c,h,p),this.publishTimeout),this.relayer.events.emit(We.publish,y)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(We.connection_stalled);return}this.onPublish(I,y),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:o}})}catch(l){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(l),l}},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,t,r,s,o,l){var c,h,p,y;const I={method:Ri(s.protocol).publish,params:{topic:e,message:t,ttl:r,prompt:o,tag:l}};return rt((c=I.params)==null?void 0:c.prompt)&&((h=I.params)==null||delete h.prompt),rt((p=I.params)==null?void 0:p.tag)&&((y=I.params)==null||delete y.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:I}),this.relayer.provider.request(I)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:r,opts:s}=e;await this.publish(t,r,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(wi.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Rd{constructor(){this.map=new Map,this.set=(e,t)=>{const r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,t))return;const s=r.filter(o=>o!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Fd=Object.defineProperty,Ud=Object.defineProperties,Ld=Object.getOwnPropertyDescriptors,un=Object.getOwnPropertySymbols,$d=Object.prototype.hasOwnProperty,Md=Object.prototype.propertyIsEnumerable,ln=(i,e,t)=>e in i?Fd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,li=(i,e)=>{for(var t in e||(e={}))$d.call(e,t)&&ln(i,t,e[t]);if(un)for(var t of un(e))Md.call(e,t)&&ln(i,t,e[t]);return i},pr=(i,e)=>Ud(i,Ld(e));class jd extends hl{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Rd,this.events=new ct.EventEmitter,this.name=wd,this.version=vd,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Ft,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(r,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}});try{const o=Ar(s),l={topic:r,relay:o};this.pending.set(r,l);const c=await this.rpcSubscribe(r,o);return this.onSubscribe(c,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}}),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}},this.unsubscribe=async(r,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(r,s.id,s):await this.unsubscribeByTopic(r,s)},this.isSubscribed=async r=>this.topics.includes(r)?!0:await new Promise((s,o)=>{const l=new Z.Watch;l.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(r)&&this.topics.includes(r)&&(clearInterval(c),l.stop(this.pendingSubscriptionWatchLabel),s(!0)),l.elapsed(this.pendingSubscriptionWatchLabel)>=Ed&&(clearInterval(c),l.stop(this.pendingSubscriptionWatchLabel),o(!1))},this.pollingInterval)}),this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name),this.clientId=""}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const r=this.topicMap.get(e);await Promise.all(r.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{const s=Ar(r);await this.rpcUnsubscribe(e,t,s);const o=Fe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,o),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t){const r={method:Ri(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await Pr(this.relayer.provider.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(We.connection_stalled)}return $i(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,r={method:Ri(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{return await await Pr(this.relayer.provider.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(We.connection_stalled)}}rpcUnsubscribe(e,t,r){const s={method:Ri(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.provider.request(s)}onSubscribe(e,t){this.setSubscription(e,pr(li({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,li({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,li({},t)),this.topicMap.set(t.topic,e),this.events.emit(Et.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:r}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Et.deleted,pr(li({},r),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Et.sync)}async reset(){if(!this.cached.length)return;const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const r=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(r)}this.events.emit(Et.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);this.onBatchSubscribe(t.map((r,s)=>pr(li({},e[s]),{id:r})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(wi.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(We.connect,async()=>{await this.onConnect()}),this.relayer.on(We.disconnect,()=>{this.onDisconnect()}),this.events.on(Et.created,async e=>{const t=Et.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(Et.deleted,async e=>{const t=Et.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),e())},this.pollingInterval)})}}var qd=Object.defineProperty,fn=Object.getOwnPropertySymbols,zd=Object.prototype.hasOwnProperty,Hd=Object.prototype.propertyIsEnumerable,dn=(i,e,t)=>e in i?qd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Kd=(i,e)=>{for(var t in e||(e={}))zd.call(e,t)&&dn(i,t,e[t]);if(fn)for(var t of fn(e))Hd.call(e,t)&&dn(i,t,e[t]);return i};class Bd extends ol{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ct.EventEmitter,this.name=yd,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):Ji(Se.getDefaultLoggerOptions({level:e.logger||gd})),this.messages=new Nd(this.logger,e.core),this.subscriber=new jd(this,this.logger),this.publisher=new Td(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Ca,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){this.isInitialized();let r="";return await Promise.all([new Promise(s=>{this.subscriber.once(Et.created,o=>{o.topic===e&&s()})}),new Promise(async s=>{r=await this.subscriber.subscribe(e,t),s()})]),r}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(We.transport_closed))}async transportOpen(e){if(!this.reconnecting){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1,this.reconnecting=!0;try{await Promise.all([new Promise(t=>{this.initialized||t(),this.subscriber.once(Et.resubscribed,()=>{t()})}),await Promise.race([new Promise(async t=>{await this.provider.connect(),this.removeListener(We.transport_closed,this.rejectTransportOpen),t()}),new Promise(t=>this.once(We.transport_closed,this.rejectTransportOpen))])])}catch(t){const r=t;if(!/socket hang up/i.test(r.message))throw t;this.logger.error(t),this.events.emit(We.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(e){this.transportExplicitlyClosed||(await this.transportClose(),await new Promise(t=>setTimeout(t,hn)),await this.transportOpen(e))}rejectTransportOpen(){throw new Error("closeTransport called before connection was established")}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new Cl(new Nl(Zh({sdkVersion:md,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0})))}async recordMessageEvent(e){const{topic:t,message:r}=e;await this.messages.set(t,r)}async shouldIgnoreMessageEvent(e){const{topic:t,message:r}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,r):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),qr(e)){if(!e.method.endsWith(bd))return;const t=e.params,{topic:r,message:s,publishedAt:o}=t.data,l={topic:r,message:s,publishedAt:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Kd({type:"event",event:t.id},l)),this.events.emit(t.id,l),await this.acknowledgePayload(e),await this.onMessageEvent(l)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(We.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=zr(e.id,!0);await this.provider.connection.send(t)}registerEventListeners(){this.provider.on(Ai.payload,e=>this.onProviderPayload(e)),this.provider.on(Ai.connect,()=>{this.events.emit(We.connect)}),this.provider.on(Ai.disconnect,()=>{this.events.emit(We.disconnect),this.attemptToReconnect()}),this.provider.on(Ai.error,e=>{this.logger.error(e),this.events.emit(We.error,e)}),this.events.on(We.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},Z.toMiliseconds(hn))}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Vd=Object.defineProperty,pn=Object.getOwnPropertySymbols,Gd=Object.prototype.hasOwnProperty,kd=Object.prototype.propertyIsEnumerable,gn=(i,e,t)=>e in i?Vd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,yn=(i,e)=>{for(var t in e||(e={}))Gd.call(e,t)&&gn(i,t,e[t]);if(pn)for(var t of pn(e))kd.call(e,t)&&gn(i,t,e[t]);return i};class Zi extends cl{constructor(e,t,r,s=Ft,o=void 0){super(e,t,r,s),this.core=e,this.logger=t,this.name=r,this.map=new Map,this.version=_d,this.cached=[],this.initialized=!1,this.storagePrefix=Ft,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{wu(l)?this.map.set(l.id,l):vu(l)?this.map.set(l.topic,l):this.getKey&&l!==null&&!rt(l)&&this.map.set(this.getKey(l),l)}),this.cached=[],this.initialized=!0)},this.set=async(l,c)=>{this.isInitialized(),this.map.has(l)?await this.update(l,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:c}),this.map.set(l,c),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(c=>Object.keys(l).every(h=>qi(c[h],l[h]))):this.values),this.update=async(l,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:c});const h=yn(yn({},this.getData(l)),c);this.map.set(l,h),await this.persist()},this.delete=async(l,c)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:c}),this.map.delete(l),await this.persist())},this.logger=Se.generateChildLogger(t,this.name),this.storagePrefix=s,this.getKey=o}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:r}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Yd{constructor(e,t){this.core=e,this.logger=t,this.name=Dd,this.version=Sd,this.events=new ct,this.initialized=!1,this.storagePrefix=Ft,this.ignoredPayloadTypes=[kt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]},this.create=async()=>{this.isInitialized();const r=Or(),s=await this.core.crypto.setSymKey(r),o=St(Z.FIVE_MINUTES),l={protocol:xa},c={topic:s,expiry:o,relay:l,active:!1},h=uu({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:r,relay:l});return await this.pairings.set(s,c),await this.core.relayer.subscribe(s),this.core.expirer.set(s,o),{topic:s,uri:h}},this.pair=async r=>{this.isInitialized(),this.isValidPair(r);const{topic:s,symKey:o,relay:l}=cu(r.uri);if(this.pairings.keys.includes(s))throw new Error(`Pairing already exists: ${s}`);if(this.core.crypto.hasKeys(s))throw new Error(`Keychain already exists: ${s}`);const c=St(Z.FIVE_MINUTES),h={topic:s,relay:l,expiry:c,active:!1};return await this.pairings.set(s,h),await this.core.crypto.setSymKey(o,s),await this.core.relayer.subscribe(s,{relay:l}),this.core.expirer.set(s,c),r.activatePairing&&await this.activate({topic:s}),h},this.activate=async({topic:r})=>{this.isInitialized();const s=St(Z.THIRTY_DAYS);await this.pairings.update(r,{active:!0,expiry:s}),this.core.expirer.set(r,s)},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.pairings.keys.includes(s)){const o=await this.sendRequest(s,"wc_pairingPing",{}),{done:l,resolve:c,reject:h}=Bt();this.events.once(Re("pairing_ping",o),({error:p})=>{p?h(p):c()}),await l()}},this.updateExpiry=async({topic:r,expiry:s})=>{this.isInitialized(),await this.pairings.update(r,{expiry:s})},this.updateMetadata=async({topic:r,metadata:s})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Fe("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(r,s,o)=>{const l=zi(s,o),c=await this.core.crypto.encode(r,l),h=ui[s].req;return this.core.history.set(r,l),await this.core.relayer.publish(r,c,h),l.id},this.sendResult=async(r,s,o)=>{const l=zr(r,o),c=await this.core.crypto.encode(s,l),h=await this.core.history.get(s,r),p=ui[h.request.method].res;await this.core.relayer.publish(s,c,p),await this.core.history.resolve(l)},this.sendError=async(r,s,o)=>{const l=jr(r,o),c=await this.core.crypto.encode(s,l),h=await this.core.history.get(s,r),p=ui[h.request.method]?ui[h.request.method].res:ui.unregistered_method.res;await this.core.relayer.publish(s,c,p),await this.core.history.resolve(l)},this.deletePairing=async(r,s)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,Fe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),s?Promise.resolve():this.core.expirer.del(r)])},this.cleanup=async()=>{const r=this.pairings.getAll().filter(s=>Tt(s.expiry));await Promise.all(r.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=r=>{const{topic:s,payload:o}=r,l=o.method;if(this.pairings.keys.includes(s))switch(l){case"wc_pairingPing":return this.onPairingPingRequest(s,o);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,o);default:return this.onUnknownRpcMethodRequest(s,o)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,l=(await this.core.history.get(s,o.id)).request.method;if(this.pairings.keys.includes(s))switch(l){case"wc_pairingPing":return this.onPairingPingResponse(s,o);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult(o,r,!0),this.events.emit("pairing_ping",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.logger.error(l)}},this.onPairingPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{Nt(s)?this.events.emit(Re("pairing_ping",o),{}):Dt(s)&&this.events.emit(Re("pairing_ping",o),{error:s.error})},500)},this.onPairingDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit("pairing_delete",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(r,s)=>{const{id:o,method:l}=s;try{if(this.registeredMethods.includes(l))return;const c=Fe("WC_METHOD_UNSUPPORTED",l);await this.sendError(o,r,c),this.logger.error(c)}catch(c){await this.sendError(o,r,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=r=>{this.registeredMethods.includes(r)||this.logger.error(Fe("WC_METHOD_UNSUPPORTED",r))},this.isValidPair=r=>{if(!st(r)){const{message:s}=V("MISSING_OR_INVALID",`pair() params: ${r}`);throw new Error(s)}if(!_u(r.uri)){const{message:s}=V("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw new Error(s)}},this.isValidPing=async r=>{if(!st(r)){const{message:o}=V("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidPairingTopic(s)},this.isValidDisconnect=async r=>{if(!st(r)){const{message:o}=V("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async r=>{if(!Je(r,!1)){const{message:s}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(s)}if(!this.pairings.keys.includes(r)){const{message:s}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(s)}if(Tt(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:s}=V("EXPIRED",`pairing topic: ${r}`);throw new Error(s)}},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.pairings=new Zi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(We.message,async e=>{const{topic:t,message:r}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))return;const s=await this.core.crypto.decode(t,r);qr(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):Mr(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(gt.expired,async e=>{const{topic:t}=ra(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}class Wd extends sl{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new ct.EventEmitter,this.name=Id,this.version=xd,this.cached=[],this.initialized=!1,this.storagePrefix=Ft,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(r,s,o)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:s,chainId:o}),this.records.has(s.id))return;const l={id:s.id,topic:r,request:{method:s.method,params:s.params||null},chainId:o};this.records.set(l.id,l),this.events.emit(vt.created,l)},this.resolve=async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const s=await this.getRecord(r.id);typeof s.response>"u"&&(s.response=Dt(r)?{error:r.error}:{result:r.result},this.records.set(s.id,s),this.events.emit(vt.updated,s))},this.get=async(r,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:s}),await this.getRecord(s)),this.delete=(r,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(o=>{if(o.topic===r){if(typeof s<"u"&&o.id!==s)return;this.records.delete(o.id),this.events.emit(vt.deleted,o)}})},this.exists=async(r,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===r:!1),this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const r={topic:t.topic,request:zi(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:r}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(vt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(vt.created,e=>{const t=vt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(vt.updated,e=>{const t=vt.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(vt.deleted,e=>{const t=vt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Jd extends ul{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new ct.EventEmitter,this.name=Cd,this.version=Od,this.cached=[],this.initialized=!1,this.storagePrefix=Ft,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=r=>{try{const s=this.formatTarget(r);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(r,s)=>{this.isInitialized();const o=this.formatTarget(r),l={target:o,expiry:s};this.expirations.set(o,l),this.checkExpiry(o,l),this.events.emit(gt.created,{target:o,expiration:l})},this.get=r=>{this.isInitialized();const s=this.formatTarget(r);return this.getExpiration(s)},this.del=r=>{if(this.isInitialized(),this.has(r)){const s=this.formatTarget(r),o=this.getExpiration(s);this.expirations.delete(s),this.events.emit(gt.deleted,{target:s,expiration:o})}},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return eu(e);if(typeof e=="number")return tu(e);const{message:t}=V("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(gt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:r}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}checkExpiry(e,t){const{expiry:r}=t;Z.toMiliseconds(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(gt.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(wi.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(gt.created,e=>{const t=gt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(gt.expired,e=>{const t=gt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(gt.deleted,e=>{const t=gt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Xd=Object.defineProperty,bn=Object.getOwnPropertySymbols,Qd=Object.prototype.hasOwnProperty,Zd=Object.prototype.propertyIsEnumerable,mn=(i,e,t)=>e in i?Xd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,_n=(i,e)=>{for(var t in e||(e={}))Qd.call(e,t)&&mn(i,t,e[t]);if(bn)for(var t of bn(e))Zd.call(e,t)&&mn(i,t,e[t]);return i};let ep=class Oa extends rl{constructor(e){super(e),this.protocol=Ia,this.version=sd,this.name=Qr,this.events=new ct.EventEmitter,this.initialized=!1,this.on=(r,s)=>this.events.on(r,s),this.once=(r,s)=>this.events.once(r,s),this.off=(r,s)=>this.events.off(r,s),this.removeListener=(r,s)=>this.events.removeListener(r,s),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Ca;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Ji(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||nd.logger}));this.logger=Se.generateChildLogger(t,this.name),this.heartbeat=new wi.HeartBeat,this.crypto=new Ad(this,this.logger,e==null?void 0:e.keychain),this.history=new Wd(this,this.logger),this.expirer=new Jd(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Ju(_n(_n({},ad),e==null?void 0:e.storageOptions)),this.relayer=new Bd({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Yd(this,this.logger)}static async init(e){const t=new Oa(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const tp=ep,Pa="wc",Aa=2,Na="client",Zr=`${Pa}@${Aa}:${Na}:`,gr={name:Na,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},ip="proposal",Ta="Proposal expired",rp="session",Ni=Z.SEVEN_DAYS,sp="engine",fi={wc_sessionPropose:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1115}}},yr={min:Z.FIVE_MINUTES,max:Z.SEVEN_DAYS},np="request";var ap=Object.defineProperty,op=Object.defineProperties,cp=Object.getOwnPropertyDescriptors,wn=Object.getOwnPropertySymbols,hp=Object.prototype.hasOwnProperty,up=Object.prototype.propertyIsEnumerable,vn=(i,e,t)=>e in i?ap(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,pt=(i,e)=>{for(var t in e||(e={}))hp.call(e,t)&&vn(i,t,e[t]);if(wn)for(var t of wn(e))up.call(e,t)&&vn(i,t,e[t]);return i},br=(i,e)=>op(i,cp(e));class lp extends fl{constructor(e){super(e),this.name=sp,this.events=new ct,this.initialized=!1,this.ignoredPayloadTypes=[kt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(fi)}),this.initialized=!0)},this.connect=async t=>{this.isInitialized();const r=br(pt({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(r);const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:l,sessionProperties:c,relays:h}=r;let p=s,y,I=!1;if(p&&(I=this.client.core.pairing.pairings.get(p).active),!p||!I){const{topic:D,uri:g}=await this.client.core.pairing.create();p=D,y=g}const A=await this.client.core.crypto.generateKeyPair(),S=pt({requiredNamespaces:o,optionalNamespaces:l,relays:h??[{protocol:xa}],proposer:{publicKey:A,metadata:this.client.metadata}},c&&{sessionProperties:c}),{reject:x,resolve:N,done:$}=Bt(Z.FIVE_MINUTES,Ta);if(this.events.once(Re("session_connect"),async({error:D,session:g})=>{if(D)x(D);else if(g){g.self.publicKey=A;const m=br(pt({},g),{requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces});await this.client.session.set(g.topic,m),await this.setExpiry(g.topic,g.expiry),p&&await this.client.core.pairing.updateMetadata({topic:p,metadata:g.peer.metadata}),N(m)}}),!p){const{message:D}=V("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(D)}const B=await this.sendRequest(p,"wc_sessionPropose",S),_=St(Z.FIVE_MINUTES);return await this.setProposal(B,pt({id:B,expiry:_},S)),{uri:y,approval:$}},this.pair=async t=>(this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{this.isInitialized(),await this.isValidApprove(t);const{id:r,relayProtocol:s,namespaces:o,sessionProperties:l}=t,c=this.client.proposal.get(r);let{pairingTopic:h,proposer:p,requiredNamespaces:y,optionalNamespaces:I}=c;pi(y)||(y=pu(o,"approve()"));const A=await this.client.core.crypto.generateKeyPair(),S=p.publicKey,x=await this.client.core.crypto.generateSharedKey(A,S);h&&r&&(await this.client.core.pairing.updateMetadata({topic:h,metadata:p.metadata}),await this.sendResult(r,h,{relay:{protocol:s??"irn"},responderPublicKey:A}),await this.client.proposal.delete(r,Fe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:h}));const N=pt({relay:{protocol:s??"irn"},namespaces:o,requiredNamespaces:y,optionalNamespaces:I,controller:{publicKey:A,metadata:this.client.metadata},expiry:St(Ni)},l&&{sessionProperties:l});await this.client.core.relayer.subscribe(x);const $=await this.sendRequest(x,"wc_sessionSettle",N),{done:B,resolve:_,reject:D}=Bt();this.events.once(Re("session_approve",$),({error:m})=>{m?D(m):_(this.client.session.get(x))});const g=br(pt({},N),{topic:x,acknowledged:!1,self:N.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:A});return await this.client.session.set(x,g),await this.setExpiry(x,St(Ni)),{topic:x,acknowledged:B}},this.reject=async t=>{this.isInitialized(),await this.isValidReject(t);const{id:r,reason:s}=t,{pairingTopic:o}=this.client.proposal.get(r);o&&(await this.sendError(r,o,s),await this.client.proposal.delete(r,Fe("USER_DISCONNECTED")))},this.update=async t=>{this.isInitialized(),await this.isValidUpdate(t);const{topic:r,namespaces:s}=t,o=await this.sendRequest(r,"wc_sessionUpdate",{namespaces:s}),{done:l,resolve:c,reject:h}=Bt();return this.events.once(Re("session_update",o),({error:p})=>{p?h(p):c()}),await this.client.session.update(r,{namespaces:s}),{acknowledged:l}},this.extend=async t=>{this.isInitialized(),await this.isValidExtend(t);const{topic:r}=t,s=await this.sendRequest(r,"wc_sessionExtend",{}),{done:o,resolve:l,reject:c}=Bt();return this.events.once(Re("session_extend",s),({error:h})=>{h?c(h):l()}),await this.setExpiry(r,St(Ni)),{acknowledged:o}},this.request=async t=>{this.isInitialized(),await this.isValidRequest(t);const{chainId:r,request:s,topic:o,expiry:l}=t,c=await this.sendRequest(o,"wc_sessionRequest",{request:s,chainId:r},l),{done:h,resolve:p,reject:y}=Bt(l);return this.events.once(Re("session_request",c),({error:I,result:A})=>{I?y(I):p(A)}),this.client.events.emit("session_request_sent",{topic:o,request:s,chainId:r}),await h()},this.respond=async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:r,response:s}=t,{id:o}=s;Nt(s)?await this.sendResult(o,r,s.result):Dt(s)&&await this.sendError(o,r,s.error),this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0})},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:r}=t;if(this.client.session.keys.includes(r)){const s=await this.sendRequest(r,"wc_sessionPing",{}),{done:o,resolve:l,reject:c}=Bt();this.events.once(Re("session_ping",s),({error:h})=>{h?c(h):l()}),await o()}else this.client.core.pairing.pairings.keys.includes(r)&&await this.client.core.pairing.ping({topic:r})},this.emit=async t=>{this.isInitialized(),await this.isValidEmit(t);const{topic:r,event:s,chainId:o}=t;await this.sendRequest(r,"wc_sessionEvent",{event:s,chainId:o})},this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:r}=t;this.client.session.keys.includes(r)?(await this.sendRequest(r,"wc_sessionDelete",Fe("USER_DISCONNECTED")),await this.deleteSession(r)):await this.client.core.pairing.disconnect({topic:r})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(r=>bu(r,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(t,r)=>{const{self:s}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await Promise.all([this.client.session.delete(t,Fe("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(t),r?Promise.resolve():this.client.core.expirer.del(t)])},this.deleteProposal=async(t,r)=>{await Promise.all([this.client.proposal.delete(t,Fe("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,r,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,r),s?Promise.resolve():this.client.core.expirer.del(t)])},this.setExpiry=async(t,r)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:r}),this.client.core.expirer.set(t,r)},this.setProposal=async(t,r)=>{await this.client.proposal.set(t,r),this.client.core.expirer.set(t,r.expiry)},this.setPendingSessionRequest=async t=>{const r=fi.wc_sessionRequest.req.ttl,{id:s,topic:o,params:l}=t;await this.client.pendingRequest.set(s,{id:s,topic:o,params:l}),r&&this.client.core.expirer.set(s,St(r))},this.sendRequest=async(t,r,s,o)=>{const l=zi(r,s),c=await this.client.core.crypto.encode(t,l),h=fi[r].req;return o&&(h.ttl=o),this.client.core.history.set(t,l),this.client.core.relayer.publish(t,c,h),l.id},this.sendResult=async(t,r,s)=>{const o=zr(t,s),l=await this.client.core.crypto.encode(r,o),c=await this.client.core.history.get(r,t),h=fi[c.request.method].res;this.client.core.relayer.publish(r,l,h),await this.client.core.history.resolve(o)},this.sendError=async(t,r,s)=>{const o=jr(t,s),l=await this.client.core.crypto.encode(r,o),c=await this.client.core.history.get(r,t),h=fi[c.request.method].res;this.client.core.relayer.publish(r,l,h),await this.client.core.history.resolve(o)},this.cleanup=async()=>{const t=[],r=[];this.client.session.getAll().forEach(s=>{Tt(s.expiry)&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Tt(s.expiry)&&r.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession(s)),...r.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=t=>{const{topic:r,payload:s}=t,o=s.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeRequest(r,s);case"wc_sessionSettle":return this.onSessionSettleRequest(r,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(r,s);case"wc_sessionExtend":return this.onSessionExtendRequest(r,s);case"wc_sessionPing":return this.onSessionPingRequest(r,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(r,s);case"wc_sessionRequest":return this.onSessionRequest(r,s);case"wc_sessionEvent":return this.onSessionEventRequest(r,s);default:return this.client.logger.info(`Unsupported request method ${o}`)}},this.onRelayEventResponse=async t=>{const{topic:r,payload:s}=t,o=(await this.client.core.history.get(r,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,s);case"wc_sessionExtend":return this.onSessionExtendResponse(r,s);case"wc_sessionPing":return this.onSessionPingResponse(r,s);case"wc_sessionRequest":return this.onSessionRequestResponse(r,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}},this.onSessionProposeRequest=async(t,r)=>{const{params:s,id:o}=r;try{this.isValidConnect(pt({},r.params));const l=St(Z.FIVE_MINUTES),c=pt({id:o,pairingTopic:t,expiry:l},s);await this.setProposal(o,c),this.client.events.emit("session_proposal",{id:o,params:c})}catch(l){await this.sendError(o,t,l),this.client.logger.error(l)}},this.onSessionProposeResponse=async(t,r)=>{const{id:s}=r;if(Nt(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const l=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const c=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const p=await this.client.core.crypto.generateSharedKey(c,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:p});const y=await this.client.core.relayer.subscribe(p);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:y}),await this.client.core.pairing.activate({topic:t})}else Dt(r)&&(await this.client.proposal.delete(s,Fe("USER_DISCONNECTED")),this.events.emit(Re("session_connect"),{error:r.error}))},this.onSessionSettleRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidSessionSettleRequest(o);const{relay:l,controller:c,expiry:h,namespaces:p,requiredNamespaces:y,optionalNamespaces:I,sessionProperties:A}=r.params,S=pt({topic:t,relay:l,expiry:h,namespaces:p,acknowledged:!0,requiredNamespaces:y,optionalNamespaces:I,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},A&&{sessionProperties:A});await this.sendResult(r.id,t,!0),this.events.emit(Re("session_connect"),{session:S})}catch(l){await this.sendError(s,t,l),this.client.logger.error(l)}},this.onSessionSettleResponse=async(t,r)=>{const{id:s}=r;Nt(r)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Re("session_approve",s),{})):Dt(r)&&(await this.client.session.delete(t,Fe("USER_DISCONNECTED")),this.events.emit(Re("session_approve",s),{error:r.error}))},this.onSessionUpdateRequest=async(t,r)=>{const{params:s,id:o}=r;try{this.isValidUpdate(pt({topic:t},s)),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult(o,t,!0),this.client.events.emit("session_update",{id:o,topic:t,params:s})}catch(l){await this.sendError(o,t,l),this.client.logger.error(l)}},this.onSessionUpdateResponse=(t,r)=>{const{id:s}=r;Nt(r)?this.events.emit(Re("session_update",s),{}):Dt(r)&&this.events.emit(Re("session_update",s),{error:r.error})},this.onSessionExtendRequest=async(t,r)=>{const{id:s}=r;try{this.isValidExtend({topic:t}),await this.setExpiry(t,St(Ni)),await this.sendResult(s,t,!0),this.client.events.emit("session_extend",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionExtendResponse=(t,r)=>{const{id:s}=r;Nt(r)?this.events.emit(Re("session_extend",s),{}):Dt(r)&&this.events.emit(Re("session_extend",s),{error:r.error})},this.onSessionPingRequest=async(t,r)=>{const{id:s}=r;try{this.isValidPing({topic:t}),await this.sendResult(s,t,!0),this.client.events.emit("session_ping",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionPingResponse=(t,r)=>{const{id:s}=r;setTimeout(()=>{Nt(r)?this.events.emit(Re("session_ping",s),{}):Dt(r)&&this.events.emit(Re("session_ping",s),{error:r.error})},500)},this.onSessionDeleteRequest=async(t,r)=>{const{id:s}=r;try{this.isValidDisconnect({topic:t,reason:r.params}),this.client.core.relayer.once(We.publish,async()=>{await this.deleteSession(t)}),await this.sendResult(s,t,!0),this.client.events.emit("session_delete",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidRequest(pt({topic:t},o)),await this.setPendingSessionRequest({id:s,topic:t,params:o}),this.client.events.emit("session_request",{id:s,topic:t,params:o})}catch(l){await this.sendError(s,t,l),this.client.logger.error(l)}},this.onSessionRequestResponse=(t,r)=>{const{id:s}=r;Nt(r)?this.events.emit(Re("session_request",s),{result:r.result}):Dt(r)&&this.events.emit(Re("session_request",s),{error:r.error})},this.onSessionEventRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidEmit(pt({topic:t},o)),this.client.events.emit("session_event",{id:s,topic:t,params:o})}catch(l){await this.sendError(s,t,l),this.client.logger.error(l)}},this.isValidConnect=async t=>{if(!st(t)){const{message:h}=V("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(h)}const{pairingTopic:r,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:l,relays:c}=t;if(rt(r)||await this.isValidPairingTopic(r),!Pu(c,!0)){const{message:h}=V("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}!rt(s)&&pi(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!rt(o)&&pi(o)!==0&&this.validateNamespaces(o,"optionalNamespaces"),rt(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(t,r)=>{const s=Ou(t,"connect()",r);if(s)throw new Error(s.message)},this.isValidApprove=async t=>{if(!st(t))throw new Error(V("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:r,namespaces:s,relayProtocol:o,sessionProperties:l}=t;await this.isValidProposalId(r);const c=this.client.proposal.get(r),h=Fi(s,"approve()");if(h)throw new Error(h.message);const p=Ls(c.requiredNamespaces,s,"approve()");if(p)throw new Error(p.message);if(!Je(o,!0)){const{message:y}=V("MISSING_OR_INVALID",`approve() relayProtocol: ${o}`);throw new Error(y)}rt(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async t=>{if(!st(t)){const{message:o}=V("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(o)}const{id:r,reason:s}=t;if(await this.isValidProposalId(r),!Nu(s)){const{message:o}=V("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidSessionSettleRequest=t=>{if(!st(t)){const{message:p}=V("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(p)}const{relay:r,controller:s,namespaces:o,expiry:l}=t;if(!na(r)){const{message:p}=V("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(p)}const c=Eu(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);const h=Fi(o,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Tt(l)){const{message:p}=V("EXPIRED","onSessionSettleRequest()");throw new Error(p)}},this.isValidUpdate=async t=>{if(!st(t)){const{message:h}=V("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(h)}const{topic:r,namespaces:s}=t;await this.isValidSessionTopic(r);const o=this.client.session.get(r),l=Fi(s,"update()");if(l)throw new Error(l.message);const c=Ls(o.requiredNamespaces,s,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async t=>{if(!st(t)){const{message:s}=V("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionTopic(r)},this.isValidRequest=async t=>{if(!st(t)){const{message:h}=V("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(h)}const{topic:r,request:s,chainId:o,expiry:l}=t;await this.isValidSessionTopic(r);const{namespaces:c}=this.client.session.get(r);if(!Us(c,o)){const{message:h}=V("MISSING_OR_INVALID",`request() chainId: ${o}`);throw new Error(h)}if(!Tu(s)){const{message:h}=V("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(h)}if(!Uu(c,o,s.method)){const{message:h}=V("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(h)}if(l&&!ju(l,yr)){const{message:h}=V("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${yr.min} and ${yr.max}`);throw new Error(h)}},this.isValidRespond=async t=>{if(!st(t)){const{message:o}=V("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:r,response:s}=t;if(await this.isValidSessionTopic(r),!Ru(s)){const{message:o}=V("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidPing=async t=>{if(!st(t)){const{message:s}=V("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)},this.isValidEmit=async t=>{if(!st(t)){const{message:c}=V("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(c)}const{topic:r,event:s,chainId:o}=t;await this.isValidSessionTopic(r);const{namespaces:l}=this.client.session.get(r);if(!Us(l,o)){const{message:c}=V("MISSING_OR_INVALID",`emit() chainId: ${o}`);throw new Error(c)}if(!Fu(s)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}if(!Lu(l,o,s.name)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidDisconnect=async t=>{if(!st(t)){const{message:s}=V("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)},this.validateSessionProps=(t,r)=>{Object.values(t).forEach(s=>{if(!Je(s,!1)){const{message:o}=V("MISSING_OR_INVALID",`${r} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(o)}})}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(We.message,async e=>{const{topic:t,message:r}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(r)))return;const s=await this.client.core.crypto.decode(t,r);qr(s)?(this.client.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):Mr(s)&&(await this.client.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.client.core.expirer.on(gt.expired,async e=>{const{topic:t,id:r}=ra(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,V("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}isValidPairingTopic(e){if(!Je(e,!1)){const{message:t}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Tt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=V("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Je(e,!1)){const{message:t}=V("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=V("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Tt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=V("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Je(e,!1)){const{message:t}=V("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=V("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Au(e)){const{message:t}=V("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=V("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Tt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=V("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class fp extends Zi{constructor(e,t){super(e,t,ip,Zr),this.core=e,this.logger=t}}class dp extends Zi{constructor(e,t){super(e,t,rp,Zr),this.core=e,this.logger=t}}class pp extends Zi{constructor(e,t){super(e,t,np,Zr),this.core=e,this.logger=t}}let gp=class Ra extends ll{constructor(e){super(e),this.protocol=Pa,this.version=Aa,this.name=gr.name,this.events=new ct.EventEmitter,this.on=(r,s)=>this.events.on(r,s),this.once=(r,s)=>this.events.once(r,s),this.off=(r,s)=>this.events.off(r,s),this.removeListener=(r,s)=>this.events.removeListener(r,s),this.removeAllListeners=r=>this.events.removeAllListeners(r),this.connect=async r=>{try{return await this.engine.connect(r)}catch(s){throw this.logger.error(s.message),s}},this.pair=async r=>{try{return await this.engine.pair(r)}catch(s){throw this.logger.error(s.message),s}},this.approve=async r=>{try{return await this.engine.approve(r)}catch(s){throw this.logger.error(s.message),s}},this.reject=async r=>{try{return await this.engine.reject(r)}catch(s){throw this.logger.error(s.message),s}},this.update=async r=>{try{return await this.engine.update(r)}catch(s){throw this.logger.error(s.message),s}},this.extend=async r=>{try{return await this.engine.extend(r)}catch(s){throw this.logger.error(s.message),s}},this.request=async r=>{try{return await this.engine.request(r)}catch(s){throw this.logger.error(s.message),s}},this.respond=async r=>{try{return await this.engine.respond(r)}catch(s){throw this.logger.error(s.message),s}},this.ping=async r=>{try{return await this.engine.ping(r)}catch(s){throw this.logger.error(s.message),s}},this.emit=async r=>{try{return await this.engine.emit(r)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async r=>{try{return await this.engine.disconnect(r)}catch(s){throw this.logger.error(s.message),s}},this.find=r=>{try{return this.engine.find(r)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}},this.name=(e==null?void 0:e.name)||gr.name,this.metadata=(e==null?void 0:e.metadata)||Wh();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Ji(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||gr.logger}));this.core=(e==null?void 0:e.core)||new tp(e),this.logger=Se.generateChildLogger(t,this.name),this.session=new dp(this.core,this.logger),this.proposal=new fp(this.core,this.logger),this.pendingRequest=new pp(this.core,this.logger),this.engine=new lp(this)}static async init(e){const t=new Ra(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const En="error",yp="wss://relay.walletconnect.com",bp="wc",mp="universal_provider",Dn=`${bp}@2:${mp}:`,_p="https://rpc.walletconnect.com/v1",Ei={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function Qt(i,e,t){let r;const s=Rr(i);return e.rpcMap&&(r=e.rpcMap[s]),r||(r=`${_p}?chainId=eip155:${s}&projectId=${t}`),r}function Rr(i){return i.includes("eip155")?Number(i.split(":")[1]):Number(i)}function wp(i,e){if(!e.includes(i))throw new Error(`Chain '${i}' not approved. Please use one of the following: ${e.toString()}`)}function vp(i){return i.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}const er=(i,e)=>{const t=r=>{r.request!==e.request||r.topic!==e.topic||(i.events.removeListener("session_request_sent",t),Ep())};i.on("session_request_sent",t)};function Ep(){if(typeof window<"u")try{const i=window.localStorage.getItem("WALLETCONNECT_DEEPLINK_CHOICE");if(i){const e=JSON.parse(i);window.open(e.href,"_self","noreferrer noopener")}}catch(i){console.error(i)}}let Dp=class{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){var t;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return this.handleSwitchChain(e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0"),null;case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(e.request.method)?(er(this.client,e),await this.client.request(e)):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){const r=Rr(e);if(!this.httpProviders[r]){const s=t||Qt(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,s)}this.chainId=r,this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const r=t||Qt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new Hi(new Ki(r))}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const r=Rr(t);e[r]=this.createHttpProvider(r)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}handleSwitchChain(e){const t=parseInt(e,16),r=`${this.name}:${t}`;wp(r,this.namespace.chains),this.setDefaultChain(`${t}`)}},Sp=class{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?(er(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const r=t||Qt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.chainId=e,this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Qt(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new Hi(new Ki(r))}};class Ip{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?(er(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||Qt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||Qt(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new Hi(new Ki(r))}}class xp{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?(er(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||this.getCardanoRPCUrl(e);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(Ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const r=this.getCardanoRPCUrl(t);e[t]=this.createHttpProvider(t,r)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||this.getCardanoRPCUrl(e);return typeof r>"u"?void 0:new Hi(new Ki(r))}}var Cp=Object.defineProperty,Op=Object.defineProperties,Pp=Object.getOwnPropertyDescriptors,Sn=Object.getOwnPropertySymbols,Ap=Object.prototype.hasOwnProperty,Np=Object.prototype.propertyIsEnumerable,In=(i,e,t)=>e in i?Cp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ti=(i,e)=>{for(var t in e||(e={}))Ap.call(e,t)&&In(i,t,e[t]);if(Sn)for(var t of Sn(e))Np.call(e,t)&&In(i,t,e[t]);return i},mr=(i,e)=>Op(i,Pp(e));class es{constructor(e){this.events=new ct,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Ji(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||En}))}static async init(e){const t=new es(e);return await t.initialize(),t}async request(e,t){const[r,s]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(r).request({request:Ti({},e),chainId:`${r}:${s}`,topic:this.session.topic})}sendAsync(e,t,r){this.request(e,r).then(s=>t(null,s)).catch(s=>t(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Fe("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:r,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});r&&(this.uri=r,this.events.emit("display_uri",r)),await s().then(o=>{this.session=o}).catch(o=>{if(o.message!==Ta)throw o;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,t){try{const[r,s]=this.validateChain(e);this.getProvider(r).setDefaultChain(s,t)}catch(r){if(!/Please call connect/.test(r.message))throw r}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Rt(t)){for(const r of t)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await gp.init({logger:this.providerOpts.logger||En,relayUrl:this.providerOpts.relayUrl||yp,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{var t,r,s;const o=((t=this.session)==null?void 0:t.namespaces[e].accounts)||[],l=vp(o),c=mr(Ti({},Object.assign(this.namespaces[e],(s=(r=this.optionalNamespaces)==null?void 0:r[e])!=null?s:{})),{accounts:o,chains:l});switch(e){case"eip155":this.rpcProviders[e]=new Dp({client:this.client,namespace:c,events:this.events});break;case"solana":this.rpcProviders[e]=new Sp({client:this.client,namespace:c,events:this.events});break;case"cosmos":this.rpcProviders[e]=new Ip({client:this.client,namespace:c,events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new xp({client:this.client,namespace:c,events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:r}=t;r.name==="accountsChanged"?this.events.emit("accountsChanged",r.data):r.name==="chainChanged"?this.onChainChanged(t.chainId):this.events.emit(r.name,r.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var r;const{namespaces:s}=t,o=(r=this.client)==null?void 0:r.session.get(e);this.session=mr(Ti({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",mr(Ti({},Fe("USER_DISCONNECTED")),{data:e.topic}))}),this.on(Ei.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:r,sessionProperties:s}=e;if(!t||!Object.keys(t).length)throw new Error("Namespaces must be not empty");this.namespaces=t,this.optionalNamespaces=r,this.sessionProperties=s,this.persist("namespaces",t),this.persist("optionalNamespaces",r)}validateChain(e){const[t,r]=(e==null?void 0:e.split(":"))||["",""];if(t&&!Object.keys(this.namespaces).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&r)return[t,r];const s=Object.keys(this.namespaces)[0],o=this.rpcProviders[s].getDefaultChain();return[s,o]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){const[r,s]=this.validateChain(e);t||this.getProvider(r).setDefaultChain(s),this.namespaces[r].defaultChain=s,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",s)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${Dn}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${Dn}/${e}`)}}const Tp=es,Rp="wc",Fp="ethereum_provider",Up=`${Rp}@2:${Fp}:`,Lp="https://rpc.walletconnect.com/v1/",Fr=["eth_sendTransaction","personal_sign"],rg=["eth_accounts","eth_requestAccounts","eth_call","eth_getBalance","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Ur=["chainChanged","accountsChanged"],sg=["message","disconnect","connect"];var $p=Object.defineProperty,Mp=Object.defineProperties,jp=Object.getOwnPropertyDescriptors,xn=Object.getOwnPropertySymbols,qp=Object.prototype.hasOwnProperty,zp=Object.prototype.propertyIsEnumerable,Cn=(i,e,t)=>e in i?$p(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,On=(i,e)=>{for(var t in e||(e={}))qp.call(e,t)&&Cn(i,t,e[t]);if(xn)for(var t of xn(e))zp.call(e,t)&&Cn(i,t,e[t]);return i},Pn=(i,e)=>Mp(i,jp(e));function Lr(i){return Number(i[0].split(":")[1])}function _r(i){return`0x${i.toString(16)}`}function Hp(i){const{chains:e,optionalChains:t,methods:r,optionalMethods:s,events:o,optionalEvents:l,rpcMap:c}=i;if(!Rt(e))throw new Error("Invalid chains");const h=e,p=r||Fr,y=o||Ur,I={[Lr(h)]:c[Lr(h)]},A={chains:h,methods:p,events:y,rpcMap:I},S=o==null?void 0:o.filter(B=>!Ur.includes(B)),x=r==null?void 0:r.filter(B=>!Fr.includes(B));if(!t&&!l&&!s&&!(S!=null&&S.length)&&!(x!=null&&x.length))return{required:A};const N=(S==null?void 0:S.length)&&(x==null?void 0:x.length)||!t,$={chains:[...new Set(N?h.concat(t||[]):t)],methods:[...new Set(p.concat(s||[]))],events:[...new Set(y.concat(l||[]))],rpcMap:c};return{required:A,optional:$}}class ts{constructor(){this.events=new ct.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Up,this.on=(e,t)=>(this.events.on(e,t),this),this.once=(e,t)=>(this.events.once(e,t),this),this.removeListener=(e,t)=>(this.events.removeListener(e,t),this),this.off=(e,t)=>(this.events.off(e,t),this),this.parseAccount=e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e,this.signer={},this.rpc={}}static async init(e){const t=new ts;return await t.initialize(e),t}async request(e){return await this.signer.request(e,this.formatChainId(this.chainId))}sendAsync(e,t){this.signer.sendAsync(e,t,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:t,optional:r}=Hp(this.rpc);try{const s=await new Promise(async(l,c)=>{var h;this.rpc.showQrModal&&((h=this.modal)==null||h.subscribeModal(p=>{!p.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Pn(On({namespaces:{[this.namespace]:t}},r&&{optionalNamespaces:{[this.namespace]:r}}),{pairingTopic:e==null?void 0:e.pairingTopic})).then(p=>{l(p)}).catch(p=>{c(new Error(p.message))})});if(!s)return;this.setChainIds(this.rpc.chains);const o=Ah(s.namespaces,[this.namespace]);this.setAccounts(o),this.events.emit("connect",{chainId:_r(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:r}=t;r.name==="accountsChanged"?(this.accounts=this.parseAccounts(r.data),this.events.emit("accountsChanged",this.accounts)):r.name==="chainChanged"?this.setChainId(this.formatChainId(r.data)):this.events.emit(r.name,r.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",_r(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Pn(On({},Fe("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var t,r;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(r=this.modal)==null||r.openModal({uri:e})),this.events.emit("display_uri",e)})}setHttpProvider(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(r=>this.isCompatibleChainId(r)).map(r=>this.parseChainId(r));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",_r(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.setHttpProvider(t)}}parseAccountId(e){const[t,r,s]=e.split(":");return{chainId:`${t}:${r}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,r;return{chains:((t=e.chains)==null?void 0:t.map(s=>this.formatChainId(s)))||[`${this.namespace}:1`],optionalChains:e.optionalChains?e.optionalChains.map(s=>this.formatChainId(s)):void 0,methods:(e==null?void 0:e.methods)||Fr,events:(e==null?void 0:e.events)||Ur,optionalMethods:(e==null?void 0:e.optionalMethods)||[],optionalEvents:(e==null?void 0:e.optionalEvents)||[],rpcMap:(e==null?void 0:e.rpcMap)||this.buildRpcMap(e.chains.concat(e.optionalChains||[]),e.projectId),showQrModal:(r=e==null?void 0:e.showQrModal)!=null?r:!0,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const r={};return e.forEach(s=>{r[s]=this.getRpcUrl(s,t)}),r}async initialize(e){var t,r;if(this.rpc=this.getRpcConfig(e),this.chainId=Lr(this.rpc.chains),this.signer=await Tp.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal)try{const{Web3Modal:s}=await Eo(()=>import("./index.68655579.js"),["assets/chunks/index.68655579.js","assets/chunks/framework.3ce015e4.js","assets/app.77d96e20.js","assets/chunks/theme.334f1899.js"]);this.modal=new s({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains,themeMode:(t=this.rpc.qrModalOptions)==null?void 0:t.themeMode,themeVariables:(r=this.rpc.qrModalOptions)==null?void 0:r.themeVariables})}catch{throw new Error("To use QR modal, please install @web3modal/standalone package")}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:r,rpcMap:s}=e;t&&Rt(t)&&(this.rpc.chains=t.map(o=>this.formatChainId(o)),t.forEach(o=>{this.rpc.rpcMap[o]=(s==null?void 0:s[o])||this.getRpcUrl(o)})),r&&Rt(r)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=r==null?void 0:r.map(o=>this.formatChainId(o)),r.forEach(o=>{this.rpc.rpcMap[o]=(s==null?void 0:s[o])||this.getRpcUrl(o)}))}getRpcUrl(e,t){var r;return((r=this.rpc.rpcMap)==null?void 0:r[e])||`${Lp}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`);this.setChainIds(e?[this.formatChainId(e)]:this.session.namespaces[this.namespace].accounts),this.setAccounts(this.session.namespaces[this.namespace].accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const ng=ts;export{ng as EthereumProvider,sg as OPTIONAL_EVENTS,rg as OPTIONAL_METHODS,Ur as REQUIRED_EVENTS,Fr as REQUIRED_METHODS,ts as default};
