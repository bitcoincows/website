import{a1 as Po}from"./framework.da3b0f29.js";import{t as mt,s as Ao,f as No,a as To,d as Ro,g as Fo,b as Uo,c as Lo,e as $o,h as Un,i as ut,j as Kr,k as ms,l as Mo,m as jo,n as Ln,o as Br,p as qo,J as vi,q as Vr,r as Gr,u as Tt,v as Ct,w as $n,x as kr,H as Wi}from"./http.bbab2666.js";import{r as zo,c as Gt,g as Ho}from"../app.b8b298ad.js";import"./theme.80eb2a50.js";var Yr={},Ji={},ie={},Mn={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});function e(c,h){var d=c>>>16&65535,g=c&65535,E=h>>>16&65535,A=h&65535;return g*A+(d*A+g*E<<16>>>0)|0}i.mul=Math.imul||e;function t(c,h){return c+h|0}i.add=t;function r(c,h){return c-h|0}i.sub=r;function s(c,h){return c<<h|c>>>32-h}i.rotl=s;function o(c,h){return c<<32-h|c>>>h}i.rotr=o;function u(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}i.isInteger=Number.isInteger||u,i.MAX_SAFE_INTEGER=9007199254740991,i.isSafeInteger=function(c){return i.isInteger(c)&&c>=-i.MAX_SAFE_INTEGER&&c<=i.MAX_SAFE_INTEGER}})(Mn);Object.defineProperty(ie,"__esModule",{value:!0});var jn=Mn;function Ko(i,e){return e===void 0&&(e=0),(i[e+0]<<8|i[e+1])<<16>>16}ie.readInt16BE=Ko;function Bo(i,e){return e===void 0&&(e=0),(i[e+0]<<8|i[e+1])>>>0}ie.readUint16BE=Bo;function Vo(i,e){return e===void 0&&(e=0),(i[e+1]<<8|i[e])<<16>>16}ie.readInt16LE=Vo;function Go(i,e){return e===void 0&&(e=0),(i[e+1]<<8|i[e])>>>0}ie.readUint16LE=Go;function qn(i,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=i>>>8,e[t+1]=i>>>0,e}ie.writeUint16BE=qn;ie.writeInt16BE=qn;function zn(i,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=i>>>0,e[t+1]=i>>>8,e}ie.writeUint16LE=zn;ie.writeInt16LE=zn;function Ir(i,e){return e===void 0&&(e=0),i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}ie.readInt32BE=Ir;function xr(i,e){return e===void 0&&(e=0),(i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3])>>>0}ie.readUint32BE=xr;function Cr(i,e){return e===void 0&&(e=0),i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e]}ie.readInt32LE=Cr;function Or(i,e){return e===void 0&&(e=0),(i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e])>>>0}ie.readUint32LE=Or;function Ki(i,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=i>>>24,e[t+1]=i>>>16,e[t+2]=i>>>8,e[t+3]=i>>>0,e}ie.writeUint32BE=Ki;ie.writeInt32BE=Ki;function Bi(i,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=i>>>0,e[t+1]=i>>>8,e[t+2]=i>>>16,e[t+3]=i>>>24,e}ie.writeUint32LE=Bi;ie.writeInt32LE=Bi;function ko(i,e){e===void 0&&(e=0);var t=Ir(i,e),r=Ir(i,e+4);return t*4294967296+r-(r>>31)*4294967296}ie.readInt64BE=ko;function Yo(i,e){e===void 0&&(e=0);var t=xr(i,e),r=xr(i,e+4);return t*4294967296+r}ie.readUint64BE=Yo;function Wo(i,e){e===void 0&&(e=0);var t=Cr(i,e),r=Cr(i,e+4);return r*4294967296+t-(t>>31)*4294967296}ie.readInt64LE=Wo;function Jo(i,e){e===void 0&&(e=0);var t=Or(i,e),r=Or(i,e+4);return r*4294967296+t}ie.readUint64LE=Jo;function Hn(i,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Ki(i/4294967296>>>0,e,t),Ki(i>>>0,e,t+4),e}ie.writeUint64BE=Hn;ie.writeInt64BE=Hn;function Kn(i,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Bi(i>>>0,e,t),Bi(i/4294967296>>>0,e,t+4),e}ie.writeUint64LE=Kn;ie.writeInt64LE=Kn;function Xo(i,e,t){if(t===void 0&&(t=0),i%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(i/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var r=0,s=1,o=i/8+t-1;o>=t;o--)r+=e[o]*s,s*=256;return r}ie.readUintBE=Xo;function Zo(i,e,t){if(t===void 0&&(t=0),i%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(i/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var r=0,s=1,o=t;o<t+i/8;o++)r+=e[o]*s,s*=256;return r}ie.readUintLE=Zo;function Qo(i,e,t,r){if(t===void 0&&(t=new Uint8Array(i/8)),r===void 0&&(r=0),i%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!jn.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,o=i/8+r-1;o>=r;o--)t[o]=e/s&255,s*=256;return t}ie.writeUintBE=Qo;function ec(i,e,t,r){if(t===void 0&&(t=new Uint8Array(i/8)),r===void 0&&(r=0),i%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!jn.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,o=r;o<r+i/8;o++)t[o]=e/s&255,s*=256;return t}ie.writeUintLE=ec;function tc(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat32(e)}ie.readFloat32BE=tc;function ic(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat32(e,!0)}ie.readFloat32LE=ic;function rc(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat64(e)}ie.readFloat64BE=rc;function sc(i,e){e===void 0&&(e=0);var t=new DataView(i.buffer,i.byteOffset,i.byteLength);return t.getFloat64(e,!0)}ie.readFloat64LE=sc;function nc(i,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat32(t,i),e}ie.writeFloat32BE=nc;function ac(i,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat32(t,i,!0),e}ie.writeFloat32LE=ac;function oc(i,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat64(t,i),e}ie.writeFloat64BE=oc;function cc(i,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat64(t,i,!0),e}ie.writeFloat64LE=cc;var lt={};Object.defineProperty(lt,"__esModule",{value:!0});function hc(i){for(var e=0;e<i.length;e++)i[e]=0;return i}lt.wipe=hc;Object.defineProperty(Ji,"__esModule",{value:!0});var tt=ie,Pr=lt,uc=20;function lc(i,e,t){for(var r=1634760805,s=857760878,o=2036477234,u=1797285236,c=t[3]<<24|t[2]<<16|t[1]<<8|t[0],h=t[7]<<24|t[6]<<16|t[5]<<8|t[4],d=t[11]<<24|t[10]<<16|t[9]<<8|t[8],g=t[15]<<24|t[14]<<16|t[13]<<8|t[12],E=t[19]<<24|t[18]<<16|t[17]<<8|t[16],A=t[23]<<24|t[22]<<16|t[21]<<8|t[20],S=t[27]<<24|t[26]<<16|t[25]<<8|t[24],D=t[31]<<24|t[30]<<16|t[29]<<8|t[28],R=e[3]<<24|e[2]<<16|e[1]<<8|e[0],F=e[7]<<24|e[6]<<16|e[5]<<8|e[4],q=e[11]<<24|e[10]<<16|e[9]<<8|e[8],_=e[15]<<24|e[14]<<16|e[13]<<8|e[12],I=r,p=s,m=o,b=u,n=c,f=h,U=d,j=g,W=E,J=A,X=S,P=D,O=R,k=F,M=q,T=_,L=0;L<uc;L+=2)I=I+n|0,O^=I,O=O>>>32-16|O<<16,W=W+O|0,n^=W,n=n>>>32-12|n<<12,p=p+f|0,k^=p,k=k>>>32-16|k<<16,J=J+k|0,f^=J,f=f>>>32-12|f<<12,m=m+U|0,M^=m,M=M>>>32-16|M<<16,X=X+M|0,U^=X,U=U>>>32-12|U<<12,b=b+j|0,T^=b,T=T>>>32-16|T<<16,P=P+T|0,j^=P,j=j>>>32-12|j<<12,m=m+U|0,M^=m,M=M>>>32-8|M<<8,X=X+M|0,U^=X,U=U>>>32-7|U<<7,b=b+j|0,T^=b,T=T>>>32-8|T<<8,P=P+T|0,j^=P,j=j>>>32-7|j<<7,p=p+f|0,k^=p,k=k>>>32-8|k<<8,J=J+k|0,f^=J,f=f>>>32-7|f<<7,I=I+n|0,O^=I,O=O>>>32-8|O<<8,W=W+O|0,n^=W,n=n>>>32-7|n<<7,I=I+f|0,T^=I,T=T>>>32-16|T<<16,X=X+T|0,f^=X,f=f>>>32-12|f<<12,p=p+U|0,O^=p,O=O>>>32-16|O<<16,P=P+O|0,U^=P,U=U>>>32-12|U<<12,m=m+j|0,k^=m,k=k>>>32-16|k<<16,W=W+k|0,j^=W,j=j>>>32-12|j<<12,b=b+n|0,M^=b,M=M>>>32-16|M<<16,J=J+M|0,n^=J,n=n>>>32-12|n<<12,m=m+j|0,k^=m,k=k>>>32-8|k<<8,W=W+k|0,j^=W,j=j>>>32-7|j<<7,b=b+n|0,M^=b,M=M>>>32-8|M<<8,J=J+M|0,n^=J,n=n>>>32-7|n<<7,p=p+U|0,O^=p,O=O>>>32-8|O<<8,P=P+O|0,U^=P,U=U>>>32-7|U<<7,I=I+f|0,T^=I,T=T>>>32-8|T<<8,X=X+T|0,f^=X,f=f>>>32-7|f<<7;tt.writeUint32LE(I+r|0,i,0),tt.writeUint32LE(p+s|0,i,4),tt.writeUint32LE(m+o|0,i,8),tt.writeUint32LE(b+u|0,i,12),tt.writeUint32LE(n+c|0,i,16),tt.writeUint32LE(f+h|0,i,20),tt.writeUint32LE(U+d|0,i,24),tt.writeUint32LE(j+g|0,i,28),tt.writeUint32LE(W+E|0,i,32),tt.writeUint32LE(J+A|0,i,36),tt.writeUint32LE(X+S|0,i,40),tt.writeUint32LE(P+D|0,i,44),tt.writeUint32LE(O+R|0,i,48),tt.writeUint32LE(k+F|0,i,52),tt.writeUint32LE(M+q|0,i,56),tt.writeUint32LE(T+_|0,i,60)}function Bn(i,e,t,r,s){if(s===void 0&&(s=0),i.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(r.length<t.length)throw new Error("ChaCha: destination is shorter than source");var o,u;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");o=new Uint8Array(16),u=o.length-e.length,o.set(e,u)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");o=e,u=s}for(var c=new Uint8Array(64),h=0;h<t.length;h+=64){lc(c,o,i);for(var d=h;d<h+64&&d<t.length;d++)r[d]=t[d]^c[d-h];dc(o,0,u)}return Pr.wipe(c),s===0&&Pr.wipe(o),r}Ji.streamXOR=Bn;function fc(i,e,t,r){return r===void 0&&(r=0),Pr.wipe(t),Bn(i,e,t,t,r)}Ji.stream=fc;function dc(i,e,t){for(var r=1;t--;)r=r+(i[e]&255)|0,i[e]=r&255,r>>>=8,e++;if(r>0)throw new Error("ChaCha: counter overflow")}var Vn={},Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});function pc(i,e,t){return~(i-1)&e|i-1&t}Lt.select=pc;function gc(i,e){return(i|0)-(e|0)-1>>>31&1}Lt.lessOrEqual=gc;function Gn(i,e){if(i.length!==e.length)return 0;for(var t=0,r=0;r<i.length;r++)t|=i[r]^e[r];return 1&t-1>>>8}Lt.compare=Gn;function yc(i,e){return i.length===0||e.length===0?!1:Gn(i,e)!==0}Lt.equal=yc;(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=Lt,t=lt;i.DIGEST_LENGTH=16;var r=function(){function u(c){this.digestLength=i.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=c[0]|c[1]<<8;this._r[0]=h&8191;var d=c[2]|c[3]<<8;this._r[1]=(h>>>13|d<<3)&8191;var g=c[4]|c[5]<<8;this._r[2]=(d>>>10|g<<6)&7939;var E=c[6]|c[7]<<8;this._r[3]=(g>>>7|E<<9)&8191;var A=c[8]|c[9]<<8;this._r[4]=(E>>>4|A<<12)&255,this._r[5]=A>>>1&8190;var S=c[10]|c[11]<<8;this._r[6]=(A>>>14|S<<2)&8191;var D=c[12]|c[13]<<8;this._r[7]=(S>>>11|D<<5)&8065;var R=c[14]|c[15]<<8;this._r[8]=(D>>>8|R<<8)&8191,this._r[9]=R>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return u.prototype._blocks=function(c,h,d){for(var g=this._fin?0:2048,E=this._h[0],A=this._h[1],S=this._h[2],D=this._h[3],R=this._h[4],F=this._h[5],q=this._h[6],_=this._h[7],I=this._h[8],p=this._h[9],m=this._r[0],b=this._r[1],n=this._r[2],f=this._r[3],U=this._r[4],j=this._r[5],W=this._r[6],J=this._r[7],X=this._r[8],P=this._r[9];d>=16;){var O=c[h+0]|c[h+1]<<8;E+=O&8191;var k=c[h+2]|c[h+3]<<8;A+=(O>>>13|k<<3)&8191;var M=c[h+4]|c[h+5]<<8;S+=(k>>>10|M<<6)&8191;var T=c[h+6]|c[h+7]<<8;D+=(M>>>7|T<<9)&8191;var L=c[h+8]|c[h+9]<<8;R+=(T>>>4|L<<12)&8191,F+=L>>>1&8191;var $=c[h+10]|c[h+11]<<8;q+=(L>>>14|$<<2)&8191;var z=c[h+12]|c[h+13]<<8;_+=($>>>11|z<<5)&8191;var re=c[h+14]|c[h+15]<<8;I+=(z>>>8|re<<8)&8191,p+=re>>>5|g;var H=0,Q=H;Q+=E*m,Q+=A*(5*P),Q+=S*(5*X),Q+=D*(5*J),Q+=R*(5*W),H=Q>>>13,Q&=8191,Q+=F*(5*j),Q+=q*(5*U),Q+=_*(5*f),Q+=I*(5*n),Q+=p*(5*b),H+=Q>>>13,Q&=8191;var Y=H;Y+=E*b,Y+=A*m,Y+=S*(5*P),Y+=D*(5*X),Y+=R*(5*J),H=Y>>>13,Y&=8191,Y+=F*(5*W),Y+=q*(5*j),Y+=_*(5*U),Y+=I*(5*f),Y+=p*(5*n),H+=Y>>>13,Y&=8191;var oe=H;oe+=E*n,oe+=A*b,oe+=S*m,oe+=D*(5*P),oe+=R*(5*X),H=oe>>>13,oe&=8191,oe+=F*(5*J),oe+=q*(5*W),oe+=_*(5*j),oe+=I*(5*U),oe+=p*(5*f),H+=oe>>>13,oe&=8191;var C=H;C+=E*f,C+=A*n,C+=S*b,C+=D*m,C+=R*(5*P),H=C>>>13,C&=8191,C+=F*(5*X),C+=q*(5*J),C+=_*(5*W),C+=I*(5*j),C+=p*(5*U),H+=C>>>13,C&=8191;var x=H;x+=E*U,x+=A*f,x+=S*n,x+=D*b,x+=R*m,H=x>>>13,x&=8191,x+=F*(5*P),x+=q*(5*X),x+=_*(5*J),x+=I*(5*W),x+=p*(5*j),H+=x>>>13,x&=8191;var w=H;w+=E*j,w+=A*U,w+=S*f,w+=D*n,w+=R*b,H=w>>>13,w&=8191,w+=F*m,w+=q*(5*P),w+=_*(5*X),w+=I*(5*J),w+=p*(5*W),H+=w>>>13,w&=8191;var a=H;a+=E*W,a+=A*j,a+=S*U,a+=D*f,a+=R*n,H=a>>>13,a&=8191,a+=F*b,a+=q*m,a+=_*(5*P),a+=I*(5*X),a+=p*(5*J),H+=a>>>13,a&=8191;var y=H;y+=E*J,y+=A*W,y+=S*j,y+=D*U,y+=R*f,H=y>>>13,y&=8191,y+=F*n,y+=q*b,y+=_*m,y+=I*(5*P),y+=p*(5*X),H+=y>>>13,y&=8191;var K=H;K+=E*X,K+=A*J,K+=S*W,K+=D*j,K+=R*U,H=K>>>13,K&=8191,K+=F*f,K+=q*n,K+=_*b,K+=I*m,K+=p*(5*P),H+=K>>>13,K&=8191;var V=H;V+=E*P,V+=A*X,V+=S*J,V+=D*W,V+=R*j,H=V>>>13,V&=8191,V+=F*U,V+=q*f,V+=_*n,V+=I*b,V+=p*m,H+=V>>>13,V&=8191,H=(H<<2)+H|0,H=H+Q|0,Q=H&8191,H=H>>>13,Y+=H,E=Q,A=Y,S=oe,D=C,R=x,F=w,q=a,_=y,I=K,p=V,h+=16,d-=16}this._h[0]=E,this._h[1]=A,this._h[2]=S,this._h[3]=D,this._h[4]=R,this._h[5]=F,this._h[6]=q,this._h[7]=_,this._h[8]=I,this._h[9]=p},u.prototype.finish=function(c,h){h===void 0&&(h=0);var d=new Uint16Array(10),g,E,A,S;if(this._leftover){for(S=this._leftover,this._buffer[S++]=1;S<16;S++)this._buffer[S]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(g=this._h[1]>>>13,this._h[1]&=8191,S=2;S<10;S++)this._h[S]+=g,g=this._h[S]>>>13,this._h[S]&=8191;for(this._h[0]+=g*5,g=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=g,g=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=g,d[0]=this._h[0]+5,g=d[0]>>>13,d[0]&=8191,S=1;S<10;S++)d[S]=this._h[S]+g,g=d[S]>>>13,d[S]&=8191;for(d[9]-=1<<13,E=(g^1)-1,S=0;S<10;S++)d[S]&=E;for(E=~E,S=0;S<10;S++)this._h[S]=this._h[S]&E|d[S];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,A=this._h[0]+this._pad[0],this._h[0]=A&65535,S=1;S<8;S++)A=(this._h[S]+this._pad[S]|0)+(A>>>16)|0,this._h[S]=A&65535;return c[h+0]=this._h[0]>>>0,c[h+1]=this._h[0]>>>8,c[h+2]=this._h[1]>>>0,c[h+3]=this._h[1]>>>8,c[h+4]=this._h[2]>>>0,c[h+5]=this._h[2]>>>8,c[h+6]=this._h[3]>>>0,c[h+7]=this._h[3]>>>8,c[h+8]=this._h[4]>>>0,c[h+9]=this._h[4]>>>8,c[h+10]=this._h[5]>>>0,c[h+11]=this._h[5]>>>8,c[h+12]=this._h[6]>>>0,c[h+13]=this._h[6]>>>8,c[h+14]=this._h[7]>>>0,c[h+15]=this._h[7]>>>8,this._finished=!0,this},u.prototype.update=function(c){var h=0,d=c.length,g;if(this._leftover){g=16-this._leftover,g>d&&(g=d);for(var E=0;E<g;E++)this._buffer[this._leftover+E]=c[h+E];if(d-=g,h+=g,this._leftover+=g,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(d>=16&&(g=d-d%16,this._blocks(c,h,g),h+=g,d-=g),d){for(var E=0;E<d;E++)this._buffer[this._leftover+E]=c[h+E];this._leftover+=d}return this},u.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},u.prototype.clean=function(){return t.wipe(this._buffer),t.wipe(this._r),t.wipe(this._h),t.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},u}();i.Poly1305=r;function s(u,c){var h=new r(u);h.update(c);var d=h.digest();return h.clean(),d}i.oneTimeAuth=s;function o(u,c){return u.length!==i.DIGEST_LENGTH||c.length!==i.DIGEST_LENGTH?!1:e.equal(u,c)}i.equal=o})(Vn);(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=Ji,t=Vn,r=lt,s=ie,o=Lt;i.KEY_LENGTH=32,i.NONCE_LENGTH=12,i.TAG_LENGTH=16;var u=new Uint8Array(16),c=function(){function h(d){if(this.nonceLength=i.NONCE_LENGTH,this.tagLength=i.TAG_LENGTH,d.length!==i.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(d)}return h.prototype.seal=function(d,g,E,A){if(d.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var S=new Uint8Array(16);S.set(d,S.length-d.length);var D=new Uint8Array(32);e.stream(this._key,S,D,4);var R=g.length+this.tagLength,F;if(A){if(A.length!==R)throw new Error("ChaCha20Poly1305: incorrect destination length");F=A}else F=new Uint8Array(R);return e.streamXOR(this._key,S,g,F,4),this._authenticate(F.subarray(F.length-this.tagLength,F.length),D,F.subarray(0,F.length-this.tagLength),E),r.wipe(S),F},h.prototype.open=function(d,g,E,A){if(d.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(g.length<this.tagLength)return null;var S=new Uint8Array(16);S.set(d,S.length-d.length);var D=new Uint8Array(32);e.stream(this._key,S,D,4);var R=new Uint8Array(this.tagLength);if(this._authenticate(R,D,g.subarray(0,g.length-this.tagLength),E),!o.equal(R,g.subarray(g.length-this.tagLength,g.length)))return null;var F=g.length-this.tagLength,q;if(A){if(A.length!==F)throw new Error("ChaCha20Poly1305: incorrect destination length");q=A}else q=new Uint8Array(F);return e.streamXOR(this._key,S,g.subarray(0,g.length-this.tagLength),q,4),r.wipe(S),q},h.prototype.clean=function(){return r.wipe(this._key),this},h.prototype._authenticate=function(d,g,E,A){var S=new t.Poly1305(g);A&&(S.update(A),A.length%16>0&&S.update(u.subarray(A.length%16))),S.update(E),E.length%16>0&&S.update(u.subarray(E.length%16));var D=new Uint8Array(8);A&&s.writeUint64LE(A.length,D),S.update(D),s.writeUint64LE(E.length,D),S.update(D);for(var R=S.digest(),F=0;F<R.length;F++)d[F]=R[F];S.clean(),r.wipe(R),r.wipe(D)},h}();i.ChaCha20Poly1305=c})(Yr);var kn={},Ei={},Wr={};Object.defineProperty(Wr,"__esModule",{value:!0});function bc(i){return typeof i.saveState<"u"&&typeof i.restoreState<"u"&&typeof i.cleanSavedState<"u"}Wr.isSerializableHash=bc;Object.defineProperty(Ei,"__esModule",{value:!0});var wt=Wr,mc=Lt,_c=lt,Yn=function(){function i(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var r=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(r).clean():r.set(t);for(var s=0;s<r.length;s++)r[s]^=54;this._inner.update(r);for(var s=0;s<r.length;s++)r[s]^=106;this._outer.update(r),wt.isSerializableHash(this._inner)&&wt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),_c.wipe(r)}return i.prototype.reset=function(){if(!wt.isSerializableHash(this._inner)||!wt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},i.prototype.clean=function(){wt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),wt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},i.prototype.update=function(e){return this._inner.update(e),this},i.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},i.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},i.prototype.saveState=function(){if(!wt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},i.prototype.restoreState=function(e){if(!wt.isSerializableHash(this._inner)||!wt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},i.prototype.cleanSavedState=function(e){if(!wt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},i}();Ei.HMAC=Yn;function wc(i,e,t){var r=new Yn(i,e);r.update(t);var s=r.digest();return r.clean(),s}Ei.hmac=wc;Ei.equal=mc.equal;Object.defineProperty(kn,"__esModule",{value:!0});var _s=Ei,ws=lt,vc=function(){function i(e,t,r,s){r===void 0&&(r=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var o=_s.hmac(this._hash,r,t);this._hmac=new _s.HMAC(e,o),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return i.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},i.prototype.expand=function(e){for(var t=new Uint8Array(e),r=0;r<t.length;r++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[r]=this._buffer[this._bufpos++];return t},i.prototype.clean=function(){this._hmac.clean(),ws.wipe(this._buffer),ws.wipe(this._counter),this._bufpos=0},i}(),Ec=kn.HKDF=vc,ii={},Xi={},Zi={};Object.defineProperty(Zi,"__esModule",{value:!0});Zi.BrowserRandomSource=void 0;const vs=65536;class Dc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let r=0;r<t.length;r+=vs)this._crypto.getRandomValues(t.subarray(r,r+Math.min(t.length-r,vs)));return t}}Zi.BrowserRandomSource=Dc;function Sc(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Qi={};Object.defineProperty(Qi,"__esModule",{value:!0});Qi.NodeRandomSource=void 0;const Ic=lt;class xc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Sc<"u"){const e=zo;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const r=new Uint8Array(e);for(let s=0;s<r.length;s++)r[s]=t[s];return(0,Ic.wipe)(t),r}}Qi.NodeRandomSource=xc;Object.defineProperty(Xi,"__esModule",{value:!0});Xi.SystemRandomSource=void 0;const Cc=Zi,Oc=Qi;class Pc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Cc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Oc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Xi.SystemRandomSource=Pc;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.randomStringForEntropy=i.randomString=i.randomUint32=i.randomBytes=i.defaultRandomSource=void 0;const e=Xi,t=ie,r=lt;i.defaultRandomSource=new e.SystemRandomSource;function s(d,g=i.defaultRandomSource){return g.randomBytes(d)}i.randomBytes=s;function o(d=i.defaultRandomSource){const g=s(4,d),E=(0,t.readUint32LE)(g);return(0,r.wipe)(g),E}i.randomUint32=o;const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(d,g=u,E=i.defaultRandomSource){if(g.length<2)throw new Error("randomString charset is too short");if(g.length>256)throw new Error("randomString charset is too long");let A="";const S=g.length,D=256-256%S;for(;d>0;){const R=s(Math.ceil(d*256/D),E);for(let F=0;F<R.length&&d>0;F++){const q=R[F];q<D&&(A+=g.charAt(q%S),d--)}(0,r.wipe)(R)}return A}i.randomString=c;function h(d,g=u,E=i.defaultRandomSource){const A=Math.ceil(d/(Math.log(g.length)/Math.LN2));return c(A,g,E)}i.randomStringForEntropy=h})(ii);var er={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=ie,t=lt;i.DIGEST_LENGTH=32,i.BLOCK_SIZE=64;var r=function(){function c(){this.digestLength=i.DIGEST_LENGTH,this.blockSize=i.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._temp),this.reset()},c.prototype.update=function(h,d){if(d===void 0&&(d=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var g=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&d>0;)this._buffer[this._bufferLength++]=h[g++],d--;this._bufferLength===this.blockSize&&(o(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(g=o(this._temp,this._state,h,g,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=h[g++],d--;return this},c.prototype.finish=function(h){if(!this._finished){var d=this._bytesHashed,g=this._bufferLength,E=d/536870912|0,A=d<<3,S=d%64<56?64:128;this._buffer[g]=128;for(var D=g+1;D<S-8;D++)this._buffer[D]=0;e.writeUint32BE(E,this._buffer,S-8),e.writeUint32BE(A,this._buffer,S-4),o(this._temp,this._state,this._buffer,0,S),this._finished=!0}for(var D=0;D<this.digestLength/4;D++)e.writeUint32BE(this._state[D],h,D*4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){t.wipe(h.state),h.buffer&&t.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();i.SHA256=r;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function o(c,h,d,g,E){for(;E>=64;){for(var A=h[0],S=h[1],D=h[2],R=h[3],F=h[4],q=h[5],_=h[6],I=h[7],p=0;p<16;p++){var m=g+p*4;c[p]=e.readUint32BE(d,m)}for(var p=16;p<64;p++){var b=c[p-2],n=(b>>>17|b<<32-17)^(b>>>19|b<<32-19)^b>>>10;b=c[p-15];var f=(b>>>7|b<<32-7)^(b>>>18|b<<32-18)^b>>>3;c[p]=(n+c[p-7]|0)+(f+c[p-16]|0)}for(var p=0;p<64;p++){var n=(((F>>>6|F<<26)^(F>>>11|F<<21)^(F>>>25|F<<7))+(F&q^~F&_)|0)+(I+(s[p]+c[p]|0)|0)|0,f=((A>>>2|A<<32-2)^(A>>>13|A<<32-13)^(A>>>22|A<<32-22))+(A&S^A&D^S&D)|0;I=_,_=q,q=F,F=R+n|0,R=D,D=S,S=A,A=n+f|0}h[0]+=A,h[1]+=S,h[2]+=D,h[3]+=R,h[4]+=F,h[5]+=q,h[6]+=_,h[7]+=I,g+=64,E-=64}return g}function u(c){var h=new r;h.update(c);var d=h.digest();return h.clean(),d}i.hash=u})(er);var Jr={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.sharedKey=i.generateKeyPair=i.generateKeyPairFromSeed=i.scalarMultBase=i.scalarMult=i.SHARED_KEY_LENGTH=i.SECRET_KEY_LENGTH=i.PUBLIC_KEY_LENGTH=void 0;const e=ii,t=lt;i.PUBLIC_KEY_LENGTH=32,i.SECRET_KEY_LENGTH=32,i.SHARED_KEY_LENGTH=32;function r(p){const m=new Float64Array(16);if(p)for(let b=0;b<p.length;b++)m[b]=p[b];return m}const s=new Uint8Array(32);s[0]=9;const o=r([56129,1]);function u(p){let m=1;for(let b=0;b<16;b++){let n=p[b]+m+65535;m=Math.floor(n/65536),p[b]=n-m*65536}p[0]+=m-1+37*(m-1)}function c(p,m,b){const n=~(b-1);for(let f=0;f<16;f++){const U=n&(p[f]^m[f]);p[f]^=U,m[f]^=U}}function h(p,m){const b=r(),n=r();for(let f=0;f<16;f++)n[f]=m[f];u(n),u(n),u(n);for(let f=0;f<2;f++){b[0]=n[0]-65517;for(let j=1;j<15;j++)b[j]=n[j]-65535-(b[j-1]>>16&1),b[j-1]&=65535;b[15]=n[15]-32767-(b[14]>>16&1);const U=b[15]>>16&1;b[14]&=65535,c(n,b,1-U)}for(let f=0;f<16;f++)p[2*f]=n[f]&255,p[2*f+1]=n[f]>>8}function d(p,m){for(let b=0;b<16;b++)p[b]=m[2*b]+(m[2*b+1]<<8);p[15]&=32767}function g(p,m,b){for(let n=0;n<16;n++)p[n]=m[n]+b[n]}function E(p,m,b){for(let n=0;n<16;n++)p[n]=m[n]-b[n]}function A(p,m,b){let n,f,U=0,j=0,W=0,J=0,X=0,P=0,O=0,k=0,M=0,T=0,L=0,$=0,z=0,re=0,H=0,Q=0,Y=0,oe=0,C=0,x=0,w=0,a=0,y=0,K=0,V=0,le=0,be=0,de=0,we=0,Te=0,Oe=0,ye=b[0],pe=b[1],fe=b[2],he=b[3],ce=b[4],ae=b[5],ne=b[6],ee=b[7],ue=b[8],ge=b[9],te=b[10],me=b[11],_e=b[12],Ee=b[13],De=b[14],ve=b[15];n=m[0],U+=n*ye,j+=n*pe,W+=n*fe,J+=n*he,X+=n*ce,P+=n*ae,O+=n*ne,k+=n*ee,M+=n*ue,T+=n*ge,L+=n*te,$+=n*me,z+=n*_e,re+=n*Ee,H+=n*De,Q+=n*ve,n=m[1],j+=n*ye,W+=n*pe,J+=n*fe,X+=n*he,P+=n*ce,O+=n*ae,k+=n*ne,M+=n*ee,T+=n*ue,L+=n*ge,$+=n*te,z+=n*me,re+=n*_e,H+=n*Ee,Q+=n*De,Y+=n*ve,n=m[2],W+=n*ye,J+=n*pe,X+=n*fe,P+=n*he,O+=n*ce,k+=n*ae,M+=n*ne,T+=n*ee,L+=n*ue,$+=n*ge,z+=n*te,re+=n*me,H+=n*_e,Q+=n*Ee,Y+=n*De,oe+=n*ve,n=m[3],J+=n*ye,X+=n*pe,P+=n*fe,O+=n*he,k+=n*ce,M+=n*ae,T+=n*ne,L+=n*ee,$+=n*ue,z+=n*ge,re+=n*te,H+=n*me,Q+=n*_e,Y+=n*Ee,oe+=n*De,C+=n*ve,n=m[4],X+=n*ye,P+=n*pe,O+=n*fe,k+=n*he,M+=n*ce,T+=n*ae,L+=n*ne,$+=n*ee,z+=n*ue,re+=n*ge,H+=n*te,Q+=n*me,Y+=n*_e,oe+=n*Ee,C+=n*De,x+=n*ve,n=m[5],P+=n*ye,O+=n*pe,k+=n*fe,M+=n*he,T+=n*ce,L+=n*ae,$+=n*ne,z+=n*ee,re+=n*ue,H+=n*ge,Q+=n*te,Y+=n*me,oe+=n*_e,C+=n*Ee,x+=n*De,w+=n*ve,n=m[6],O+=n*ye,k+=n*pe,M+=n*fe,T+=n*he,L+=n*ce,$+=n*ae,z+=n*ne,re+=n*ee,H+=n*ue,Q+=n*ge,Y+=n*te,oe+=n*me,C+=n*_e,x+=n*Ee,w+=n*De,a+=n*ve,n=m[7],k+=n*ye,M+=n*pe,T+=n*fe,L+=n*he,$+=n*ce,z+=n*ae,re+=n*ne,H+=n*ee,Q+=n*ue,Y+=n*ge,oe+=n*te,C+=n*me,x+=n*_e,w+=n*Ee,a+=n*De,y+=n*ve,n=m[8],M+=n*ye,T+=n*pe,L+=n*fe,$+=n*he,z+=n*ce,re+=n*ae,H+=n*ne,Q+=n*ee,Y+=n*ue,oe+=n*ge,C+=n*te,x+=n*me,w+=n*_e,a+=n*Ee,y+=n*De,K+=n*ve,n=m[9],T+=n*ye,L+=n*pe,$+=n*fe,z+=n*he,re+=n*ce,H+=n*ae,Q+=n*ne,Y+=n*ee,oe+=n*ue,C+=n*ge,x+=n*te,w+=n*me,a+=n*_e,y+=n*Ee,K+=n*De,V+=n*ve,n=m[10],L+=n*ye,$+=n*pe,z+=n*fe,re+=n*he,H+=n*ce,Q+=n*ae,Y+=n*ne,oe+=n*ee,C+=n*ue,x+=n*ge,w+=n*te,a+=n*me,y+=n*_e,K+=n*Ee,V+=n*De,le+=n*ve,n=m[11],$+=n*ye,z+=n*pe,re+=n*fe,H+=n*he,Q+=n*ce,Y+=n*ae,oe+=n*ne,C+=n*ee,x+=n*ue,w+=n*ge,a+=n*te,y+=n*me,K+=n*_e,V+=n*Ee,le+=n*De,be+=n*ve,n=m[12],z+=n*ye,re+=n*pe,H+=n*fe,Q+=n*he,Y+=n*ce,oe+=n*ae,C+=n*ne,x+=n*ee,w+=n*ue,a+=n*ge,y+=n*te,K+=n*me,V+=n*_e,le+=n*Ee,be+=n*De,de+=n*ve,n=m[13],re+=n*ye,H+=n*pe,Q+=n*fe,Y+=n*he,oe+=n*ce,C+=n*ae,x+=n*ne,w+=n*ee,a+=n*ue,y+=n*ge,K+=n*te,V+=n*me,le+=n*_e,be+=n*Ee,de+=n*De,we+=n*ve,n=m[14],H+=n*ye,Q+=n*pe,Y+=n*fe,oe+=n*he,C+=n*ce,x+=n*ae,w+=n*ne,a+=n*ee,y+=n*ue,K+=n*ge,V+=n*te,le+=n*me,be+=n*_e,de+=n*Ee,we+=n*De,Te+=n*ve,n=m[15],Q+=n*ye,Y+=n*pe,oe+=n*fe,C+=n*he,x+=n*ce,w+=n*ae,a+=n*ne,y+=n*ee,K+=n*ue,V+=n*ge,le+=n*te,be+=n*me,de+=n*_e,we+=n*Ee,Te+=n*De,Oe+=n*ve,U+=38*Y,j+=38*oe,W+=38*C,J+=38*x,X+=38*w,P+=38*a,O+=38*y,k+=38*K,M+=38*V,T+=38*le,L+=38*be,$+=38*de,z+=38*we,re+=38*Te,H+=38*Oe,f=1,n=U+f+65535,f=Math.floor(n/65536),U=n-f*65536,n=j+f+65535,f=Math.floor(n/65536),j=n-f*65536,n=W+f+65535,f=Math.floor(n/65536),W=n-f*65536,n=J+f+65535,f=Math.floor(n/65536),J=n-f*65536,n=X+f+65535,f=Math.floor(n/65536),X=n-f*65536,n=P+f+65535,f=Math.floor(n/65536),P=n-f*65536,n=O+f+65535,f=Math.floor(n/65536),O=n-f*65536,n=k+f+65535,f=Math.floor(n/65536),k=n-f*65536,n=M+f+65535,f=Math.floor(n/65536),M=n-f*65536,n=T+f+65535,f=Math.floor(n/65536),T=n-f*65536,n=L+f+65535,f=Math.floor(n/65536),L=n-f*65536,n=$+f+65535,f=Math.floor(n/65536),$=n-f*65536,n=z+f+65535,f=Math.floor(n/65536),z=n-f*65536,n=re+f+65535,f=Math.floor(n/65536),re=n-f*65536,n=H+f+65535,f=Math.floor(n/65536),H=n-f*65536,n=Q+f+65535,f=Math.floor(n/65536),Q=n-f*65536,U+=f-1+37*(f-1),f=1,n=U+f+65535,f=Math.floor(n/65536),U=n-f*65536,n=j+f+65535,f=Math.floor(n/65536),j=n-f*65536,n=W+f+65535,f=Math.floor(n/65536),W=n-f*65536,n=J+f+65535,f=Math.floor(n/65536),J=n-f*65536,n=X+f+65535,f=Math.floor(n/65536),X=n-f*65536,n=P+f+65535,f=Math.floor(n/65536),P=n-f*65536,n=O+f+65535,f=Math.floor(n/65536),O=n-f*65536,n=k+f+65535,f=Math.floor(n/65536),k=n-f*65536,n=M+f+65535,f=Math.floor(n/65536),M=n-f*65536,n=T+f+65535,f=Math.floor(n/65536),T=n-f*65536,n=L+f+65535,f=Math.floor(n/65536),L=n-f*65536,n=$+f+65535,f=Math.floor(n/65536),$=n-f*65536,n=z+f+65535,f=Math.floor(n/65536),z=n-f*65536,n=re+f+65535,f=Math.floor(n/65536),re=n-f*65536,n=H+f+65535,f=Math.floor(n/65536),H=n-f*65536,n=Q+f+65535,f=Math.floor(n/65536),Q=n-f*65536,U+=f-1+37*(f-1),p[0]=U,p[1]=j,p[2]=W,p[3]=J,p[4]=X,p[5]=P,p[6]=O,p[7]=k,p[8]=M,p[9]=T,p[10]=L,p[11]=$,p[12]=z,p[13]=re,p[14]=H,p[15]=Q}function S(p,m){A(p,m,m)}function D(p,m){const b=r();for(let n=0;n<16;n++)b[n]=m[n];for(let n=253;n>=0;n--)S(b,b),n!==2&&n!==4&&A(b,b,m);for(let n=0;n<16;n++)p[n]=b[n]}function R(p,m){const b=new Uint8Array(32),n=new Float64Array(80),f=r(),U=r(),j=r(),W=r(),J=r(),X=r();for(let M=0;M<31;M++)b[M]=p[M];b[31]=p[31]&127|64,b[0]&=248,d(n,m);for(let M=0;M<16;M++)U[M]=n[M];f[0]=W[0]=1;for(let M=254;M>=0;--M){const T=b[M>>>3]>>>(M&7)&1;c(f,U,T),c(j,W,T),g(J,f,j),E(f,f,j),g(j,U,W),E(U,U,W),S(W,J),S(X,f),A(f,j,f),A(j,U,J),g(J,f,j),E(f,f,j),S(U,f),E(j,W,X),A(f,j,o),g(f,f,W),A(j,j,f),A(f,W,X),A(W,U,n),S(U,J),c(f,U,T),c(j,W,T)}for(let M=0;M<16;M++)n[M+16]=f[M],n[M+32]=j[M],n[M+48]=U[M],n[M+64]=W[M];const P=n.subarray(32),O=n.subarray(16);D(P,P),A(O,O,P);const k=new Uint8Array(32);return h(k,O),k}i.scalarMult=R;function F(p){return R(p,s)}i.scalarMultBase=F;function q(p){if(p.length!==i.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${i.SECRET_KEY_LENGTH} bytes`);const m=new Uint8Array(p);return{publicKey:F(m),secretKey:m}}i.generateKeyPairFromSeed=q;function _(p){const m=(0,e.randomBytes)(32,p),b=q(m);return(0,t.wipe)(m),b}i.generateKeyPair=_;function I(p,m,b=!1){if(p.length!==i.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(m.length!==i.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=R(p,m);if(b){let f=0;for(let U=0;U<n.length;U++)f|=n[U];if(f===0)throw new Error("X25519: invalid shared key")}return n}i.sharedKey=I})(Jr);function Xr(i){return globalThis.Buffer!=null?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i}function Wn(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Xr(globalThis.Buffer.allocUnsafe(i)):new Uint8Array(i)}function Ar(i,e){e||(e=i.reduce((s,o)=>s+o.length,0));const t=Wn(e);let r=0;for(const s of i)t.set(s,r),r+=s.length;return Xr(t)}function Ac(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<i.length;s++){var o=i.charAt(s),u=o.charCodeAt(0);if(t[u]!==255)throw new TypeError(o+" is ambiguous");t[u]=s}var c=i.length,h=i.charAt(0),d=Math.log(c)/Math.log(256),g=Math.log(256)/Math.log(c);function E(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var R=0,F=0,q=0,_=D.length;q!==_&&D[q]===0;)q++,R++;for(var I=(_-q)*g+1>>>0,p=new Uint8Array(I);q!==_;){for(var m=D[q],b=0,n=I-1;(m!==0||b<F)&&n!==-1;n--,b++)m+=256*p[n]>>>0,p[n]=m%c>>>0,m=m/c>>>0;if(m!==0)throw new Error("Non-zero carry");F=b,q++}for(var f=I-F;f!==I&&p[f]===0;)f++;for(var U=h.repeat(R);f<I;++f)U+=i.charAt(p[f]);return U}function A(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var R=0;if(D[R]!==" "){for(var F=0,q=0;D[R]===h;)F++,R++;for(var _=(D.length-R)*d+1>>>0,I=new Uint8Array(_);D[R];){var p=t[D.charCodeAt(R)];if(p===255)return;for(var m=0,b=_-1;(p!==0||m<q)&&b!==-1;b--,m++)p+=c*I[b]>>>0,I[b]=p%256>>>0,p=p/256>>>0;if(p!==0)throw new Error("Non-zero carry");q=m,R++}if(D[R]!==" "){for(var n=_-q;n!==_&&I[n]===0;)n++;for(var f=new Uint8Array(F+(_-n)),U=F;n!==_;)f[U++]=I[n++];return f}}}function S(D){var R=A(D);if(R)return R;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:A,decode:S}}var Nc=Ac,Tc=Nc;const Rc=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Fc=i=>new TextEncoder().encode(i),Uc=i=>new TextDecoder().decode(i);class Lc{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class $c{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Jn(this,e)}}class Mc{constructor(e){this.decoders=e}or(e){return Jn(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Jn=(i,e)=>new Mc({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class jc{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new Lc(e,t,r),this.decoder=new $c(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const tr=({name:i,prefix:e,encode:t,decode:r})=>new jc(i,e,t,r),Di=({prefix:i,name:e,alphabet:t})=>{const{encode:r,decode:s}=Tc(t,e);return tr({prefix:i,name:e,encode:r,decode:o=>Rc(s(o))})},qc=(i,e,t,r)=>{const s={};for(let g=0;g<e.length;++g)s[e[g]]=g;let o=i.length;for(;i[o-1]==="=";)--o;const u=new Uint8Array(o*t/8|0);let c=0,h=0,d=0;for(let g=0;g<o;++g){const E=s[i[g]];if(E===void 0)throw new SyntaxError(`Non-${r} character`);h=h<<t|E,c+=t,c>=8&&(c-=8,u[d++]=255&h>>c)}if(c>=t||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return u},zc=(i,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",u=0,c=0;for(let h=0;h<i.length;++h)for(c=c<<8|i[h],u+=8;u>t;)u-=t,o+=e[s&c>>u];if(u&&(o+=e[s&c<<t-u]),r)for(;o.length*t&7;)o+="=";return o},Ze=({name:i,prefix:e,bitsPerChar:t,alphabet:r})=>tr({prefix:e,name:i,encode(s){return zc(s,r,t)},decode(s){return qc(s,r,t,i)}}),Hc=tr({prefix:"\0",name:"identity",encode:i=>Uc(i),decode:i=>Fc(i)}),Kc=Object.freeze(Object.defineProperty({__proto__:null,identity:Hc},Symbol.toStringTag,{value:"Module"})),Bc=Ze({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Vc=Object.freeze(Object.defineProperty({__proto__:null,base2:Bc},Symbol.toStringTag,{value:"Module"})),Gc=Ze({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),kc=Object.freeze(Object.defineProperty({__proto__:null,base8:Gc},Symbol.toStringTag,{value:"Module"})),Yc=Di({prefix:"9",name:"base10",alphabet:"0123456789"}),Wc=Object.freeze(Object.defineProperty({__proto__:null,base10:Yc},Symbol.toStringTag,{value:"Module"})),Jc=Ze({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Xc=Ze({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Zc=Object.freeze(Object.defineProperty({__proto__:null,base16:Jc,base16upper:Xc},Symbol.toStringTag,{value:"Module"})),Qc=Ze({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),eh=Ze({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),th=Ze({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ih=Ze({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),rh=Ze({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sh=Ze({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),nh=Ze({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ah=Ze({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),oh=Ze({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ch=Object.freeze(Object.defineProperty({__proto__:null,base32:Qc,base32hex:rh,base32hexpad:nh,base32hexpadupper:ah,base32hexupper:sh,base32pad:th,base32padupper:ih,base32upper:eh,base32z:oh},Symbol.toStringTag,{value:"Module"})),hh=Di({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),uh=Di({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),lh=Object.freeze(Object.defineProperty({__proto__:null,base36:hh,base36upper:uh},Symbol.toStringTag,{value:"Module"})),fh=Di({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),dh=Di({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ph=Object.freeze(Object.defineProperty({__proto__:null,base58btc:fh,base58flickr:dh},Symbol.toStringTag,{value:"Module"})),gh=Ze({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),yh=Ze({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),bh=Ze({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),mh=Ze({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),_h=Object.freeze(Object.defineProperty({__proto__:null,base64:gh,base64pad:yh,base64url:bh,base64urlpad:mh},Symbol.toStringTag,{value:"Module"})),Xn=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),wh=Xn.reduce((i,e,t)=>(i[t]=e,i),[]),vh=Xn.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function Eh(i){return i.reduce((e,t)=>(e+=wh[t],e),"")}function Dh(i){const e=[];for(const t of i){const r=vh[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const Sh=tr({prefix:"🚀",name:"base256emoji",encode:Eh,decode:Dh}),Ih=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Sh},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Es={...Kc,...Vc,...kc,...Wc,...Zc,...ch,...lh,...ph,..._h,...Ih};function Zn(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const Ds=Zn("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),cr=Zn("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=Wn(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Qn={utf8:Ds,"utf-8":Ds,hex:Es.base16,latin1:cr,ascii:cr,binary:cr,...Es};function nt(i,e="utf8"){const t=Qn[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Xr(globalThis.Buffer.from(i,"utf-8")):t.decoder.decode(`${t.prefix}${i}`)}function ot(i,e="utf8"){const t=Qn[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}var Z={},hr={},oi={},Ss;function xh(){if(Ss)return oi;Ss=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.delay=void 0;function i(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return oi.delay=i,oi}var zt={},ur={},Ht={},Is;function Ch(){return Is||(Is=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.ONE_THOUSAND=Ht.ONE_HUNDRED=void 0,Ht.ONE_HUNDRED=100,Ht.ONE_THOUSAND=1e3),Ht}var lr={},xs;function Oh(){return xs||(xs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.ONE_YEAR=i.FOUR_WEEKS=i.THREE_WEEKS=i.TWO_WEEKS=i.ONE_WEEK=i.THIRTY_DAYS=i.SEVEN_DAYS=i.FIVE_DAYS=i.THREE_DAYS=i.ONE_DAY=i.TWENTY_FOUR_HOURS=i.TWELVE_HOURS=i.SIX_HOURS=i.THREE_HOURS=i.ONE_HOUR=i.SIXTY_MINUTES=i.THIRTY_MINUTES=i.TEN_MINUTES=i.FIVE_MINUTES=i.ONE_MINUTE=i.SIXTY_SECONDS=i.THIRTY_SECONDS=i.TEN_SECONDS=i.FIVE_SECONDS=i.ONE_SECOND=void 0,i.ONE_SECOND=1,i.FIVE_SECONDS=5,i.TEN_SECONDS=10,i.THIRTY_SECONDS=30,i.SIXTY_SECONDS=60,i.ONE_MINUTE=i.SIXTY_SECONDS,i.FIVE_MINUTES=i.ONE_MINUTE*5,i.TEN_MINUTES=i.ONE_MINUTE*10,i.THIRTY_MINUTES=i.ONE_MINUTE*30,i.SIXTY_MINUTES=i.ONE_MINUTE*60,i.ONE_HOUR=i.SIXTY_MINUTES,i.THREE_HOURS=i.ONE_HOUR*3,i.SIX_HOURS=i.ONE_HOUR*6,i.TWELVE_HOURS=i.ONE_HOUR*12,i.TWENTY_FOUR_HOURS=i.ONE_HOUR*24,i.ONE_DAY=i.TWENTY_FOUR_HOURS,i.THREE_DAYS=i.ONE_DAY*3,i.FIVE_DAYS=i.ONE_DAY*5,i.SEVEN_DAYS=i.ONE_DAY*7,i.THIRTY_DAYS=i.ONE_DAY*30,i.ONE_WEEK=i.SEVEN_DAYS,i.TWO_WEEKS=i.ONE_WEEK*2,i.THREE_WEEKS=i.ONE_WEEK*3,i.FOUR_WEEKS=i.ONE_WEEK*4,i.ONE_YEAR=i.ONE_DAY*365}(lr)),lr}var Cs;function ea(){return Cs||(Cs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=mt;e.__exportStar(Ch(),i),e.__exportStar(Oh(),i)}(ur)),ur}var Os;function Ph(){if(Os)return zt;Os=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.fromMiliseconds=zt.toMiliseconds=void 0;const i=ea();function e(r){return r*i.ONE_THOUSAND}zt.toMiliseconds=e;function t(r){return Math.floor(r/i.ONE_THOUSAND)}return zt.fromMiliseconds=t,zt}var Ps;function Ah(){return Ps||(Ps=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=mt;e.__exportStar(xh(),i),e.__exportStar(Ph(),i)}(hr)),hr}var Xt={},As;function Nh(){if(As)return Xt;As=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.Watch=void 0;class i{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const r=this.get(t);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-r.started;this.timestamps.set(t,{started:r.started,elapsed:s})}get(t){const r=this.timestamps.get(t);if(typeof r>"u")throw new Error(`No timestamp found for label: ${t}`);return r}elapsed(t){const r=this.get(t);return r.elapsed||Date.now()-r.started}}return Xt.Watch=i,Xt.default=i,Xt}var fr={},ci={},Ns;function Th(){if(Ns)return ci;Ns=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.IWatch=void 0;class i{}return ci.IWatch=i,ci}var Ts;function Rh(){return Ts||(Ts=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),mt.__exportStar(Th(),i)}(fr)),fr}(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=mt;e.__exportStar(Ah(),i),e.__exportStar(Nh(),i),e.__exportStar(Rh(),i),e.__exportStar(ea(),i)})(Z);var mi={};(function(i){const e=To,t=Ro,r=Ao,s=No,o=_=>_==null,u=Symbol("encodeFragmentIdentifier");function c(_){switch(_.arrayFormat){case"index":return I=>(p,m)=>{const b=p.length;return m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?p:m===null?[...p,[g(I,_),"[",b,"]"].join("")]:[...p,[g(I,_),"[",g(b,_),"]=",g(m,_)].join("")]};case"bracket":return I=>(p,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?p:m===null?[...p,[g(I,_),"[]"].join("")]:[...p,[g(I,_),"[]=",g(m,_)].join("")];case"colon-list-separator":return I=>(p,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?p:m===null?[...p,[g(I,_),":list="].join("")]:[...p,[g(I,_),":list=",g(m,_)].join("")];case"comma":case"separator":case"bracket-separator":{const I=_.arrayFormat==="bracket-separator"?"[]=":"=";return p=>(m,b)=>b===void 0||_.skipNull&&b===null||_.skipEmptyString&&b===""?m:(b=b===null?"":b,m.length===0?[[g(p,_),I,g(b,_)].join("")]:[[m,g(b,_)].join(_.arrayFormatSeparator)])}default:return I=>(p,m)=>m===void 0||_.skipNull&&m===null||_.skipEmptyString&&m===""?p:m===null?[...p,g(I,_)]:[...p,[g(I,_),"=",g(m,_)].join("")]}}function h(_){let I;switch(_.arrayFormat){case"index":return(p,m,b)=>{if(I=/\[(\d*)\]$/.exec(p),p=p.replace(/\[\d*\]$/,""),!I){b[p]=m;return}b[p]===void 0&&(b[p]={}),b[p][I[1]]=m};case"bracket":return(p,m,b)=>{if(I=/(\[\])$/.exec(p),p=p.replace(/\[\]$/,""),!I){b[p]=m;return}if(b[p]===void 0){b[p]=[m];return}b[p]=[].concat(b[p],m)};case"colon-list-separator":return(p,m,b)=>{if(I=/(:list)$/.exec(p),p=p.replace(/:list$/,""),!I){b[p]=m;return}if(b[p]===void 0){b[p]=[m];return}b[p]=[].concat(b[p],m)};case"comma":case"separator":return(p,m,b)=>{const n=typeof m=="string"&&m.includes(_.arrayFormatSeparator),f=typeof m=="string"&&!n&&E(m,_).includes(_.arrayFormatSeparator);m=f?E(m,_):m;const U=n||f?m.split(_.arrayFormatSeparator).map(j=>E(j,_)):m===null?m:E(m,_);b[p]=U};case"bracket-separator":return(p,m,b)=>{const n=/(\[\])$/.test(p);if(p=p.replace(/\[\]$/,""),!n){b[p]=m&&E(m,_);return}const f=m===null?[]:m.split(_.arrayFormatSeparator).map(U=>E(U,_));if(b[p]===void 0){b[p]=f;return}b[p]=[].concat(b[p],f)};default:return(p,m,b)=>{if(b[p]===void 0){b[p]=m;return}b[p]=[].concat(b[p],m)}}}function d(_){if(typeof _!="string"||_.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function g(_,I){return I.encode?I.strict?e(_):encodeURIComponent(_):_}function E(_,I){return I.decode?t(_):_}function A(_){return Array.isArray(_)?_.sort():typeof _=="object"?A(Object.keys(_)).sort((I,p)=>Number(I)-Number(p)).map(I=>_[I]):_}function S(_){const I=_.indexOf("#");return I!==-1&&(_=_.slice(0,I)),_}function D(_){let I="";const p=_.indexOf("#");return p!==-1&&(I=_.slice(p)),I}function R(_){_=S(_);const I=_.indexOf("?");return I===-1?"":_.slice(I+1)}function F(_,I){return I.parseNumbers&&!Number.isNaN(Number(_))&&typeof _=="string"&&_.trim()!==""?_=Number(_):I.parseBooleans&&_!==null&&(_.toLowerCase()==="true"||_.toLowerCase()==="false")&&(_=_.toLowerCase()==="true"),_}function q(_,I){I=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},I),d(I.arrayFormatSeparator);const p=h(I),m=Object.create(null);if(typeof _!="string"||(_=_.trim().replace(/^[?#&]/,""),!_))return m;for(const b of _.split("&")){if(b==="")continue;let[n,f]=r(I.decode?b.replace(/\+/g," "):b,"=");f=f===void 0?null:["comma","separator","bracket-separator"].includes(I.arrayFormat)?f:E(f,I),p(E(n,I),f,m)}for(const b of Object.keys(m)){const n=m[b];if(typeof n=="object"&&n!==null)for(const f of Object.keys(n))n[f]=F(n[f],I);else m[b]=F(n,I)}return I.sort===!1?m:(I.sort===!0?Object.keys(m).sort():Object.keys(m).sort(I.sort)).reduce((b,n)=>{const f=m[n];return f&&typeof f=="object"&&!Array.isArray(f)?b[n]=A(f):b[n]=f,b},Object.create(null))}i.extract=R,i.parse=q,i.stringify=(_,I)=>{if(!_)return"";I=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},I),d(I.arrayFormatSeparator);const p=f=>I.skipNull&&o(_[f])||I.skipEmptyString&&_[f]==="",m=c(I),b={};for(const f of Object.keys(_))p(f)||(b[f]=_[f]);const n=Object.keys(b);return I.sort!==!1&&n.sort(I.sort),n.map(f=>{const U=_[f];return U===void 0?"":U===null?g(f,I):Array.isArray(U)?U.length===0&&I.arrayFormat==="bracket-separator"?g(f,I)+"[]":U.reduce(m(f),[]).join("&"):g(f,I)+"="+g(U,I)}).filter(f=>f.length>0).join("&")},i.parseUrl=(_,I)=>{I=Object.assign({decode:!0},I);const[p,m]=r(_,"#");return Object.assign({url:p.split("?")[0]||"",query:q(R(_),I)},I&&I.parseFragmentIdentifier&&m?{fragmentIdentifier:E(m,I)}:{})},i.stringifyUrl=(_,I)=>{I=Object.assign({encode:!0,strict:!0,[u]:!0},I);const p=S(_.url).split("?")[0]||"",m=i.extract(_.url),b=i.parse(m,{sort:!1}),n=Object.assign(b,_.query);let f=i.stringify(n,I);f&&(f=`?${f}`);let U=D(_.url);return _.fragmentIdentifier&&(U=`#${I[u]?g(_.fragmentIdentifier,I):_.fragmentIdentifier}`),`${p}${f}${U}`},i.pick=(_,I,p)=>{p=Object.assign({parseFragmentIdentifier:!0,[u]:!1},p);const{url:m,query:b,fragmentIdentifier:n}=i.parseUrl(_,p);return i.stringifyUrl({url:m,query:s(b,I),fragmentIdentifier:n},p)},i.exclude=(_,I,p)=>{const m=Array.isArray(I)?b=>!I.includes(b):(b,n)=>!I(b,n);return i.pick(_,m,p)}})(mi);const Fh={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function Uh(i,e=[]){const t=[];return Object.keys(i).forEach(r=>{if(e.length&&!e.includes(r))return;const s=i[r];t.push(...s.accounts)}),t}function ta(i,e){return i.includes(":")?[i]:e.chains||[]}const ia="base10",at="base16",Nr="base64pad",Zr="utf8",ra=0,Yt=1,Lh=0,Rs=1,Tr=12,Qr=32;function $h(){const i=Jr.generateKeyPair();return{privateKey:ot(i.secretKey,at),publicKey:ot(i.publicKey,at)}}function Rr(){const i=ii.randomBytes(Qr);return ot(i,at)}function Mh(i,e){const t=Jr.sharedKey(nt(i,at),nt(e,at)),r=new Ec(er.SHA256,t).expand(Qr);return ot(r,at)}function jh(i){const e=er.hash(nt(i,at));return ot(e,at)}function Vi(i){const e=er.hash(nt(i,Zr));return ot(e,at)}function qh(i){return nt(`${i}`,ia)}function Si(i){return Number(ot(i,ia))}function zh(i){const e=qh(typeof i.type<"u"?i.type:ra);if(Si(e)===Yt&&typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof i.senderPublicKey<"u"?nt(i.senderPublicKey,at):void 0,r=typeof i.iv<"u"?nt(i.iv,at):ii.randomBytes(Tr),s=new Yr.ChaCha20Poly1305(nt(i.symKey,at)).seal(r,nt(i.message,Zr));return Kh({type:e,sealed:s,iv:r,senderPublicKey:t})}function Hh(i){const e=new Yr.ChaCha20Poly1305(nt(i.symKey,at)),{sealed:t,iv:r}=es(i.encoded),s=e.open(r,t);if(s===null)throw new Error("Failed to decrypt");return ot(s,Zr)}function Kh(i){if(Si(i.type)===Yt){if(typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ot(Ar([i.type,i.senderPublicKey,i.iv,i.sealed]),Nr)}return ot(Ar([i.type,i.iv,i.sealed]),Nr)}function es(i){const e=nt(i,Nr),t=e.slice(Lh,Rs),r=Rs;if(Si(t)===Yt){const c=r+Qr,h=c+Tr,d=e.slice(r,c),g=e.slice(c,h),E=e.slice(h);return{type:t,sealed:E,iv:g,senderPublicKey:d}}const s=r+Tr,o=e.slice(r,s),u=e.slice(s);return{type:t,sealed:u,iv:o}}function Bh(i,e){const t=es(i);return sa({type:Si(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?ot(t.senderPublicKey,at):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function sa(i){const e=(i==null?void 0:i.type)||ra;if(e===Yt){if(typeof(i==null?void 0:i.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(i==null?void 0:i.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:i==null?void 0:i.senderPublicKey,receiverPublicKey:i==null?void 0:i.receiverPublicKey}}function Fs(i){return i.type===Yt&&typeof i.senderPublicKey=="string"&&typeof i.receiverPublicKey=="string"}var Vh=Object.defineProperty,Us=Object.getOwnPropertySymbols,Gh=Object.prototype.hasOwnProperty,kh=Object.prototype.propertyIsEnumerable,Ls=(i,e,t)=>e in i?Vh(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$s=(i,e)=>{for(var t in e||(e={}))Gh.call(e,t)&&Ls(i,t,e[t]);if(Us)for(var t of Us(e))kh.call(e,t)&&Ls(i,t,e[t]);return i};const Yh="ReactNative",yi={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Wh="js";function na(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Jh(){return!$o()&&!!Un()&&navigator.product===Yh}function Xh(){return!na()&&!!Un()}function Zh(){return Jh()?yi.reactNative:na()?yi.node:Xh()?yi.browser:yi.unknown}function Qh(i,e){let t=mi.parse(i);return t=$s($s({},t),e),i=mi.stringify(t),i}function eu(){return Fo()||{name:"",description:"",url:"",icons:[""]}}function tu(){const i=Uo();if(i===null)return"unknown";const e=i.os?i.os.replace(" ","").toLowerCase():"unknown";return i.type==="browser"?[e,i.name,i.version].join("-"):[e,i.version].join("-")}function iu(){var i;const e=Zh();return e===yi.browser?[e,((i=Lo())==null?void 0:i.host)||"unknown"].join(":"):e}function ru(i,e,t){const r=tu(),s=iu();return[[i,e].join("-"),[Wh,t].join("-"),r,s].join("/")}function su({protocol:i,version:e,relayUrl:t,sdkVersion:r,auth:s,projectId:o,useOnCloseEvent:u}){const c=t.split("?"),h=ru(i,e,r),d={auth:s,ua:h,projectId:o,useOnCloseEvent:u||void 0},g=Qh(c[1]||"",d);return c[0]+"?"+g}function kt(i,e){return i.filter(t=>e.includes(t)).length===i.length}function aa(i){return Object.fromEntries(i.entries())}function oa(i){return new Map(Object.entries(i))}function Vt(i=Z.FIVE_MINUTES,e){const t=Z.toMiliseconds(i||Z.FIVE_MINUTES);let r,s,o;return{resolve:u=>{o&&r&&(clearTimeout(o),r(u))},reject:u=>{o&&s&&(clearTimeout(o),s(u))},done:()=>new Promise((u,c)=>{o=setTimeout(()=>{c(new Error(e))},t),r=u,s=c})}}function Fr(i,e){return new Promise(async(t,r)=>{const s=setTimeout(()=>r(),e),o=await i;clearTimeout(s),t(o)})}function ca(i,e){if(typeof e=="string"&&e.startsWith(`${i}:`))return e;if(i.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(i.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${i}`)}function nu(i){return ca("topic",i)}function au(i){return ca("id",i)}function ha(i){const[e,t]=i.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")r.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))r.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return r}function Dt(i,e){return Z.fromMiliseconds((e||Date.now())+Z.toMiliseconds(i))}function Rt(i){return Date.now()>=Z.toMiliseconds(i)}function Re(i,e){return`${i}${e?`:${e}`:""}`}const ou="irn";function Ur(i){return(i==null?void 0:i.relay)||{protocol:ou}}function zi(i){const e=Fh[i];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${i}`);return e}var cu=Object.defineProperty,Ms=Object.getOwnPropertySymbols,hu=Object.prototype.hasOwnProperty,uu=Object.prototype.propertyIsEnumerable,js=(i,e,t)=>e in i?cu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,lu=(i,e)=>{for(var t in e||(e={}))hu.call(e,t)&&js(i,t,e[t]);if(Ms)for(var t of Ms(e))uu.call(e,t)&&js(i,t,e[t]);return i};function fu(i,e="-"){const t={},r="relay"+e;return Object.keys(i).forEach(s=>{if(s.startsWith(r)){const o=s.replace(r,""),u=i[s];t[o]=u}}),t}function du(i){const e=i.indexOf(":"),t=i.indexOf("?")!==-1?i.indexOf("?"):void 0,r=i.substring(0,e),s=i.substring(e+1,t).split("@"),o=typeof t<"u"?i.substring(t):"",u=mi.parse(o);return{protocol:r,topic:s[0],version:parseInt(s[1],10),symKey:u.symKey,relay:fu(u)}}function pu(i,e="-"){const t="relay",r={};return Object.keys(i).forEach(s=>{const o=t+e+s;i[s]&&(r[o]=i[s])}),r}function gu(i){return`${i.protocol}:${i.topic}@${i.version}?`+mi.stringify(lu({symKey:i.symKey},pu(i.relay)))}function ri(i){const e=[];return i.forEach(t=>{const[r,s]=t.split(":");e.push(`${r}:${s}`)}),e}function yu(i){const e=[];return Object.values(i).forEach(t=>{e.push(...ri(t.accounts))}),e}function bu(i,e){const t=[];return Object.values(i).forEach(r=>{ri(r.accounts).includes(e)&&t.push(...r.methods)}),t}function mu(i,e){const t=[];return Object.values(i).forEach(r=>{ri(r.accounts).includes(e)&&t.push(...r.events)}),t}function _u(i,e){const t=Hi(i,e);if(t)throw new Error(t.message);const r={};for(const[s,o]of Object.entries(i))r[s]={methods:o.methods,events:o.events,chains:o.accounts.map(u=>`${u.split(":")[0]}:${u.split(":")[1]}`)};return r}const wu={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},vu={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function B(i,e){const{message:t,code:r}=vu[i];return{message:e?`${t} ${e}`:t,code:r}}function Fe(i,e){const{message:t,code:r}=wu[i];return{message:e?`${t} ${e}`:t,code:r}}function Ft(i,e){return Array.isArray(i)?typeof e<"u"&&i.length?i.every(e):!0:!1}function bi(i){return Object.getPrototypeOf(i)===Object.prototype&&Object.keys(i).length}function rt(i){return typeof i>"u"}function Je(i,e){return e&&rt(i)?!0:typeof i=="string"&&!!i.trim().length}function ts(i,e){return e&&rt(i)?!0:typeof i=="number"&&!isNaN(i)}function Eu(i,e){const{requiredNamespaces:t}=e,r=Object.keys(i.namespaces),s=Object.keys(t);let o=!0;return kt(s,r)?(r.forEach(u=>{const{accounts:c,methods:h,events:d}=i.namespaces[u],g=ri(c),E=t[u];(!kt(ta(u,E),g)||!kt(E.methods,h)||!kt(E.events,d))&&(o=!1)}),o):!1}function is(i){return Je(i,!1)&&i.includes(":")?i.split(":").length===2:!1}function Du(i){if(Je(i,!1)&&i.includes(":")){const e=i.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&is(t)}}return!1}function Su(i){if(Je(i,!1))try{return typeof new URL(i)<"u"}catch{return!1}return!1}function Iu(i){var e;return(e=i==null?void 0:i.proposer)==null?void 0:e.publicKey}function xu(i){return i==null?void 0:i.topic}function Cu(i,e){let t=null;return Je(i==null?void 0:i.publicKey,!1)||(t=B("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function qs(i){let e=!0;return Ft(i)?i.length&&(e=i.every(t=>Je(t,!1))):e=!1,e}function Ou(i,e,t){let r=null;return Ft(e)?e.forEach(s=>{r||(!is(s)||!s.includes(i))&&(r=Fe("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):r=Fe("UNSUPPORTED_CHAINS",`${t}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),r}function Pu(i,e){let t=null;return Object.entries(i).forEach(([r,s])=>{if(t)return;const o=Ou(r,ta(r,s),`${e} requiredNamespace`);o&&(t=o)}),t}function Au(i,e){let t=null;return Ft(i)?i.forEach(r=>{t||Du(r)||(t=Fe("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):t=Fe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function Nu(i,e){let t=null;return Object.values(i).forEach(r=>{if(t)return;const s=Au(r==null?void 0:r.accounts,`${e} namespace`);s&&(t=s)}),t}function Tu(i,e){let t=null;return qs(i==null?void 0:i.methods)?qs(i==null?void 0:i.events)||(t=Fe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=Fe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function ua(i,e){let t=null;return Object.values(i).forEach(r=>{if(t)return;const s=Tu(r,`${e}, namespace`);s&&(t=s)}),t}function Ru(i,e,t){let r=null;if(i&&bi(i)){const s=ua(i,e);s&&(r=s);const o=Pu(i,e);o&&(r=o)}else r=B("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return r}function Hi(i,e){let t=null;if(i&&bi(i)){const r=ua(i,e);r&&(t=r);const s=Nu(i,e);s&&(t=s)}else t=B("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function la(i){return Je(i.protocol,!0)}function Fu(i,e){let t=!1;return e&&!i?t=!0:i&&Ft(i)&&i.length&&i.forEach(r=>{t=la(r)}),t}function Uu(i){return typeof i=="number"}function st(i){return typeof i<"u"&&typeof i!==null}function Lu(i){return!(!i||typeof i!="object"||!i.code||!ts(i.code,!1)||!i.message||!Je(i.message,!1))}function $u(i){return!(rt(i)||!Je(i.method,!1))}function Mu(i){return!(rt(i)||rt(i.result)&&rt(i.error)||!ts(i.id,!1)||!Je(i.jsonrpc,!1))}function ju(i){return!(rt(i)||!Je(i.name,!1))}function zs(i,e){return!(!is(e)||!yu(i).includes(e))}function qu(i,e,t){return Je(t,!1)?bu(i,e).includes(t):!1}function zu(i,e,t){return Je(t,!1)?mu(i,e).includes(t):!1}function Hs(i,e,t){let r=null;const s=Hu(i),o=Ku(e),u=Object.keys(s),c=Object.keys(o),h=Ks(Object.keys(i)),d=Ks(Object.keys(e)),g=h.filter(E=>!d.includes(E));return g.length&&(r=B("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${g.toString()}
      Received: ${Object.keys(e).toString()}`)),kt(u,c)||(r=B("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${u.toString()}
      Approved: ${c.toString()}`)),Object.keys(e).forEach(E=>{if(!E.includes(":")||r)return;const A=ri(e[E].accounts);A.includes(E)||(r=B("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${E}
        Required: ${E}
        Approved: ${A.toString()}`))}),u.forEach(E=>{r||(kt(s[E].methods,o[E].methods)?kt(s[E].events,o[E].events)||(r=B("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${E}`)):r=B("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${E}`))}),r}function Hu(i){const e={};return Object.keys(i).forEach(t=>{var r;t.includes(":")?e[t]=i[t]:(r=i[t].chains)==null||r.forEach(s=>{e[s]={methods:i[t].methods,events:i[t].events}})}),e}function Ks(i){return[...new Set(i.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Ku(i){const e={};return Object.keys(i).forEach(t=>{if(t.includes(":"))e[t]=i[t];else{const r=ri(i[t].accounts);r==null||r.forEach(s=>{e[s]={accounts:i[t].accounts.filter(o=>o.includes(`${s}:`)),methods:i[t].methods,events:i[t].events}})}}),e}function Bu(i,e){return ts(i,!1)&&i<=e.max&&i>=e.min}function Vu(i){try{return JSON.stringify(i)}catch{return'"[Circular]"'}}var Gu=ku;function ku(i,e,t){var r=t&&t.stringify||Vu,s=1;if(typeof i=="object"&&i!==null){var o=e.length+s;if(o===1)return i;var u=new Array(o);u[0]=r(i);for(var c=1;c<o;c++)u[c]=r(e[c]);return u.join(" ")}if(typeof i!="string")return i;var h=e.length;if(h===0)return i;for(var d="",g=1-s,E=-1,A=i&&i.length||0,S=0;S<A;){if(i.charCodeAt(S)===37&&S+1<A){switch(E=E>-1?E:0,i.charCodeAt(S+1)){case 100:case 102:if(g>=h||e[g]==null)break;E<S&&(d+=i.slice(E,S)),d+=Number(e[g]),E=S+2,S++;break;case 105:if(g>=h||e[g]==null)break;E<S&&(d+=i.slice(E,S)),d+=Math.floor(Number(e[g])),E=S+2,S++;break;case 79:case 111:case 106:if(g>=h||e[g]===void 0)break;E<S&&(d+=i.slice(E,S));var D=typeof e[g];if(D==="string"){d+="'"+e[g]+"'",E=S+2,S++;break}if(D==="function"){d+=e[g].name||"<anonymous>",E=S+2,S++;break}d+=r(e[g]),E=S+2,S++;break;case 115:if(g>=h)break;E<S&&(d+=i.slice(E,S)),d+=String(e[g]),E=S+2,S++;break;case 37:E<S&&(d+=i.slice(E,S)),d+="%",E=S+2,S++,g--;break}++g}++S}return E===-1?i:(E<A&&(d+=i.slice(E)),d)}const Bs=Gu;var Ii=St;const _i=rl().console||{},Yu={mapHttpRequest:$i,mapHttpResponse:$i,wrapRequestSerializer:dr,wrapResponseSerializer:dr,wrapErrorSerializer:dr,req:$i,res:$i,err:Qu};function Wu(i,e){return Array.isArray(i)?i.filter(function(r){return r!=="!stdSerializers.err"}):i===!0?Object.keys(e):!1}function St(i){i=i||{},i.browser=i.browser||{};const e=i.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const t=i.browser.write||_i;i.browser.write&&(i.browser.asObject=!0);const r=i.serializers||{},s=Wu(i.browser.serialize,r);let o=i.browser.serialize;Array.isArray(i.browser.serialize)&&i.browser.serialize.indexOf("!stdSerializers.err")>-1&&(o=!1);const u=["error","fatal","warn","info","debug","trace"];typeof t=="function"&&(t.error=t.fatal=t.warn=t.info=t.debug=t.trace=t),i.enabled===!1&&(i.level="silent");const c=i.level||"info",h=Object.create(t);h.log||(h.log=wi),Object.defineProperty(h,"levelVal",{get:g}),Object.defineProperty(h,"level",{get:E,set:A});const d={transmit:e,serialize:s,asObject:i.browser.asObject,levels:u,timestamp:el(i)};h.levels=St.levels,h.level=c,h.setMaxListeners=h.getMaxListeners=h.emit=h.addListener=h.on=h.prependListener=h.once=h.prependOnceListener=h.removeListener=h.removeAllListeners=h.listeners=h.listenerCount=h.eventNames=h.write=h.flush=wi,h.serializers=r,h._serialize=s,h._stdErrSerialize=o,h.child=S,e&&(h._logEvent=Lr());function g(){return this.level==="silent"?1/0:this.levels.values[this.level]}function E(){return this._level}function A(D){if(D!=="silent"&&!this.levels.values[D])throw Error("unknown level "+D);this._level=D,Zt(d,h,"error","log"),Zt(d,h,"fatal","error"),Zt(d,h,"warn","error"),Zt(d,h,"info","log"),Zt(d,h,"debug","log"),Zt(d,h,"trace","log")}function S(D,R){if(!D)throw new Error("missing bindings for child Pino");R=R||{},s&&D.serializers&&(R.serializers=D.serializers);const F=R.serializers;if(s&&F){var q=Object.assign({},r,F),_=i.browser.serialize===!0?Object.keys(q):s;delete D.serializers,ir([D],_,q,this._stdErrSerialize)}function I(p){this._childLevel=(p._childLevel|0)+1,this.error=Qt(p,D,"error"),this.fatal=Qt(p,D,"fatal"),this.warn=Qt(p,D,"warn"),this.info=Qt(p,D,"info"),this.debug=Qt(p,D,"debug"),this.trace=Qt(p,D,"trace"),q&&(this.serializers=q,this._serialize=_),e&&(this._logEvent=Lr([].concat(p._logEvent.bindings,D)))}return I.prototype=this,new I(this)}return h}St.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};St.stdSerializers=Yu;St.stdTimeFunctions=Object.assign({},{nullTime:fa,epochTime:da,unixTime:tl,isoTime:il});function Zt(i,e,t,r){const s=Object.getPrototypeOf(e);e[t]=e.levelVal>e.levels.values[t]?wi:s[t]?s[t]:_i[t]||_i[r]||wi,Ju(i,e,t)}function Ju(i,e,t){!i.transmit&&e[t]===wi||(e[t]=function(r){return function(){const o=i.timestamp(),u=new Array(arguments.length),c=Object.getPrototypeOf&&Object.getPrototypeOf(this)===_i?_i:this;for(var h=0;h<u.length;h++)u[h]=arguments[h];if(i.serialize&&!i.asObject&&ir(u,this._serialize,this.serializers,this._stdErrSerialize),i.asObject?r.call(c,Xu(this,t,u,o)):r.apply(c,u),i.transmit){const d=i.transmit.level||e.level,g=St.levels.values[d],E=St.levels.values[t];if(E<g)return;Zu(this,{ts:o,methodLevel:t,methodValue:E,transmitLevel:d,transmitValue:St.levels.values[i.transmit.level||e.level],send:i.transmit.send,val:e.levelVal},u)}}}(e[t]))}function Xu(i,e,t,r){i._serialize&&ir(t,i._serialize,i.serializers,i._stdErrSerialize);const s=t.slice();let o=s[0];const u={};r&&(u.time=r),u.level=St.levels.values[e];let c=(i._childLevel|0)+1;if(c<1&&(c=1),o!==null&&typeof o=="object"){for(;c--&&typeof s[0]=="object";)Object.assign(u,s.shift());o=s.length?Bs(s.shift(),s):void 0}else typeof o=="string"&&(o=Bs(s.shift(),s));return o!==void 0&&(u.msg=o),u}function ir(i,e,t,r){for(const s in i)if(r&&i[s]instanceof Error)i[s]=St.stdSerializers.err(i[s]);else if(typeof i[s]=="object"&&!Array.isArray(i[s]))for(const o in i[s])e&&e.indexOf(o)>-1&&o in t&&(i[s][o]=t[o](i[s][o]))}function Qt(i,e,t){return function(){const r=new Array(1+arguments.length);r[0]=e;for(var s=1;s<r.length;s++)r[s]=arguments[s-1];return i[t].apply(this,r)}}function Zu(i,e,t){const r=e.send,s=e.ts,o=e.methodLevel,u=e.methodValue,c=e.val,h=i._logEvent.bindings;ir(t,i._serialize||Object.keys(i.serializers),i.serializers,i._stdErrSerialize===void 0?!0:i._stdErrSerialize),i._logEvent.ts=s,i._logEvent.messages=t.filter(function(d){return h.indexOf(d)===-1}),i._logEvent.level.label=o,i._logEvent.level.value=u,r(o,i._logEvent,c),i._logEvent=Lr(h)}function Lr(i){return{ts:0,messages:[],bindings:i||[],level:{label:"",value:0}}}function Qu(i){const e={type:i.constructor.name,msg:i.message,stack:i.stack};for(const t in i)e[t]===void 0&&(e[t]=i[t]);return e}function el(i){return typeof i.timestamp=="function"?i.timestamp:i.timestamp===!1?fa:da}function $i(){return{}}function dr(i){return i}function wi(){}function fa(){return!1}function da(){return Date.now()}function tl(){return Math.round(Date.now()/1e3)}function il(){return new Date(Date.now()).toISOString()}function rl(){function i(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return i(self)||i(window)||i(this)||{}}}var rr={},xi={};Object.defineProperty(xi,"__esModule",{value:!0});function sl(i){if(typeof i!="string")throw new Error(`Cannot safe json parse value of type ${typeof i}`);try{return JSON.parse(i)}catch{return i}}xi.safeJsonParse=sl;function nl(i){return typeof i=="string"?i:JSON.stringify(i,(e,t)=>typeof t>"u"?null:t)}xi.safeJsonStringify=nl;var Gi={},pr={get exports(){return Gi},set exports(i){Gi=i}},Vs;function al(){return Vs||(Vs=1,function(){let i;function e(){}i=e,i.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},i.prototype.setItem=function(t,r){this[t]=String(r)},i.prototype.removeItem=function(t){delete this[t]},i.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(r){t[r]=void 0,delete t[r]})},i.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},i.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Gt<"u"&&Gt.localStorage?pr.exports=Gt.localStorage:typeof window<"u"&&window.localStorage?pr.exports=window.localStorage:pr.exports=new e}()),Gi}var gr={},hi={},Gs;function ol(){if(Gs)return hi;Gs=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.IKeyValueStorage=void 0;class i{}return hi.IKeyValueStorage=i,hi}var ui={},ks;function cl(){if(ks)return ui;ks=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.parseEntry=void 0;const i=xi;function e(t){var r;return[t[0],i.safeJsonParse((r=t[1])!==null&&r!==void 0?r:"")]}return ui.parseEntry=e,ui}var Ys;function hl(){return Ys||(Ys=1,function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=mt;e.__exportStar(ol(),i),e.__exportStar(cl(),i)}(gr)),gr}Object.defineProperty(rr,"__esModule",{value:!0});rr.KeyValueStorage=void 0;const ei=mt,Ws=xi,ul=ei.__importDefault(al()),ll=hl();class pa{constructor(){this.localStorage=ul.default}getKeys(){return ei.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return ei.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(ll.parseEntry)})}getItem(e){return ei.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(e);if(t!==null)return Ws.safeJsonParse(t)})}setItem(e,t){return ei.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,Ws.safeJsonStringify(t))})}removeItem(e){return ei.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}rr.KeyValueStorage=pa;var fl=rr.default=pa,Ci={},li={},yr={},fi={};class Wt{}const dl=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Wt},Symbol.toStringTag,{value:"Module"})),pl=Ho(dl);var Js;function gl(){if(Js)return fi;Js=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.IHeartBeat=void 0;const i=pl;class e extends i.IEvents{constructor(r){super()}}return fi.IHeartBeat=e,fi}var Xs;function ga(){return Xs||(Xs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),mt.__exportStar(gl(),i)}(yr)),yr}var br={},Kt={},Zs;function yl(){if(Zs)return Kt;Zs=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.HEARTBEAT_EVENTS=Kt.HEARTBEAT_INTERVAL=void 0;const i=Z;return Kt.HEARTBEAT_INTERVAL=i.FIVE_SECONDS,Kt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Kt}var Qs;function ya(){return Qs||(Qs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),mt.__exportStar(yl(),i)}(br)),br}var en;function bl(){if(en)return li;en=1,Object.defineProperty(li,"__esModule",{value:!0}),li.HeartBeat=void 0;const i=mt,e=ut,t=Z,r=ga(),s=ya();class o extends r.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(c==null?void 0:c.interval)||s.HEARTBEAT_INTERVAL}static init(c){return i.__awaiter(this,void 0,void 0,function*(){const h=new o(c);return yield h.init(),h})}init(){return i.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,h){this.events.on(c,h)}once(c,h){this.events.once(c,h)}off(c,h){this.events.off(c,h)}removeListener(c,h){this.events.removeListener(c,h)}initialize(){return i.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return li.HeartBeat=o,li}(function(i){Object.defineProperty(i,"__esModule",{value:!0});const e=mt;e.__exportStar(bl(),i),e.__exportStar(ga(),i),e.__exportStar(ya(),i)})(Ci);var Se={},Bt={},tn;function ba(){return tn||(tn=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.PINO_CUSTOM_CONTEXT_KEY=Bt.PINO_LOGGER_DEFAULTS=void 0,Bt.PINO_LOGGER_DEFAULTS={level:"info"},Bt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Bt}var it={},rn;function ml(){if(rn)return it;rn=1,Object.defineProperty(it,"__esModule",{value:!0}),it.generateChildLogger=it.formatChildLoggerContext=it.getLoggerContext=it.setBrowserLoggerContext=it.getBrowserLoggerContext=it.getDefaultLoggerOptions=void 0;const i=ba();function e(c){return Object.assign(Object.assign({},c),{level:(c==null?void 0:c.level)||i.PINO_LOGGER_DEFAULTS.level})}it.getDefaultLoggerOptions=e;function t(c,h=i.PINO_CUSTOM_CONTEXT_KEY){return c[h]||""}it.getBrowserLoggerContext=t;function r(c,h,d=i.PINO_CUSTOM_CONTEXT_KEY){return c[d]=h,c}it.setBrowserLoggerContext=r;function s(c,h=i.PINO_CUSTOM_CONTEXT_KEY){let d="";return typeof c.bindings>"u"?d=t(c,h):d=c.bindings().context||"",d}it.getLoggerContext=s;function o(c,h,d=i.PINO_CUSTOM_CONTEXT_KEY){const g=s(c,d);return g.trim()?`${g}/${h}`:h}it.formatChildLoggerContext=o;function u(c,h,d=i.PINO_CUSTOM_CONTEXT_KEY){const g=o(c,h,d),E=c.child({context:g});return r(E,g,d)}return it.generateChildLogger=u,it}(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.pino=void 0;const e=mt,t=e.__importDefault(Ii);Object.defineProperty(i,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(ba(),i),e.__exportStar(ml(),i)})(Se);class _l extends Wt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class wl extends Wt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}}let vl=class{constructor(e,t){this.logger=e,this.core=t}},El=class extends Wt{constructor(e,t){super(),this.relayer=e,this.logger=t}},Dl=class extends Wt{constructor(e){super()}},Sl=class{constructor(e,t,r,s){this.core=e,this.logger=t,this.name=r}},Il=class extends Wt{constructor(e,t){super(),this.relayer=e,this.logger=t}},xl=class extends Wt{constructor(e,t){super(),this.core=e,this.logger=t}},Cl=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},Ol=class{constructor(e){this.client=e}};var rs={},ma={};(function(i){Object.defineProperty(i,"__esModule",{value:!0});var e=ie,t=lt;i.DIGEST_LENGTH=64,i.BLOCK_SIZE=128;var r=function(){function c(){this.digestLength=i.DIGEST_LENGTH,this.blockSize=i.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},c.prototype.update=function(h,d){if(d===void 0&&(d=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var g=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<i.BLOCK_SIZE&&d>0;)this._buffer[this._bufferLength++]=h[g++],d--;this._bufferLength===this.blockSize&&(o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(g=o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,g,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=h[g++],d--;return this},c.prototype.finish=function(h){if(!this._finished){var d=this._bytesHashed,g=this._bufferLength,E=d/536870912|0,A=d<<3,S=d%128<112?128:256;this._buffer[g]=128;for(var D=g+1;D<S-8;D++)this._buffer[D]=0;e.writeUint32BE(E,this._buffer,S-8),e.writeUint32BE(A,this._buffer,S-4),o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,S),this._finished=!0}for(var D=0;D<this.digestLength/8;D++)e.writeUint32BE(this._stateHi[D],h,D*8),e.writeUint32BE(this._stateLo[D],h,D*8+4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){t.wipe(h.stateHi),t.wipe(h.stateLo),h.buffer&&t.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();i.SHA512=r;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function o(c,h,d,g,E,A,S){for(var D=d[0],R=d[1],F=d[2],q=d[3],_=d[4],I=d[5],p=d[6],m=d[7],b=g[0],n=g[1],f=g[2],U=g[3],j=g[4],W=g[5],J=g[6],X=g[7],P,O,k,M,T,L,$,z;S>=128;){for(var re=0;re<16;re++){var H=8*re+A;c[re]=e.readUint32BE(E,H),h[re]=e.readUint32BE(E,H+4)}for(var re=0;re<80;re++){var Q=D,Y=R,oe=F,C=q,x=_,w=I,a=p,y=m,K=b,V=n,le=f,be=U,de=j,we=W,Te=J,Oe=X;if(P=m,O=X,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=(_>>>14|j<<32-14)^(_>>>18|j<<32-18)^(j>>>41-32|_<<32-(41-32)),O=(j>>>14|_<<32-14)^(j>>>18|_<<32-18)^(_>>>41-32|j<<32-(41-32)),T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,P=_&I^~_&p,O=j&W^~j&J,T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,P=s[re*2],O=s[re*2+1],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,P=c[re%16],O=h[re%16],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,k=$&65535|z<<16,M=T&65535|L<<16,P=k,O=M,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=(D>>>28|b<<32-28)^(b>>>34-32|D<<32-(34-32))^(b>>>39-32|D<<32-(39-32)),O=(b>>>28|D<<32-28)^(D>>>34-32|b<<32-(34-32))^(D>>>39-32|b<<32-(39-32)),T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,P=D&R^D&F^R&F,O=b&n^b&f^n&f,T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,y=$&65535|z<<16,Oe=T&65535|L<<16,P=C,O=be,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=k,O=M,T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,C=$&65535|z<<16,be=T&65535|L<<16,R=Q,F=Y,q=oe,_=C,I=x,p=w,m=a,D=y,n=K,f=V,U=le,j=be,W=de,J=we,X=Te,b=Oe,re%16===15)for(var H=0;H<16;H++)P=c[H],O=h[H],T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=c[(H+9)%16],O=h[(H+9)%16],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,k=c[(H+1)%16],M=h[(H+1)%16],P=(k>>>1|M<<32-1)^(k>>>8|M<<32-8)^k>>>7,O=(M>>>1|k<<32-1)^(M>>>8|k<<32-8)^(M>>>7|k<<32-7),T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,k=c[(H+14)%16],M=h[(H+14)%16],P=(k>>>19|M<<32-19)^(M>>>61-32|k<<32-(61-32))^k>>>6,O=(M>>>19|k<<32-19)^(k>>>61-32|M<<32-(61-32))^(M>>>6|k<<32-6),T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,c[H]=$&65535|z<<16,h[H]=T&65535|L<<16}P=D,O=b,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=d[0],O=g[0],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,d[0]=D=$&65535|z<<16,g[0]=b=T&65535|L<<16,P=R,O=n,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=d[1],O=g[1],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,d[1]=R=$&65535|z<<16,g[1]=n=T&65535|L<<16,P=F,O=f,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=d[2],O=g[2],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,d[2]=F=$&65535|z<<16,g[2]=f=T&65535|L<<16,P=q,O=U,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=d[3],O=g[3],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,d[3]=q=$&65535|z<<16,g[3]=U=T&65535|L<<16,P=_,O=j,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=d[4],O=g[4],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,d[4]=_=$&65535|z<<16,g[4]=j=T&65535|L<<16,P=I,O=W,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=d[5],O=g[5],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,d[5]=I=$&65535|z<<16,g[5]=W=T&65535|L<<16,P=p,O=J,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=d[6],O=g[6],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,d[6]=p=$&65535|z<<16,g[6]=J=T&65535|L<<16,P=m,O=X,T=O&65535,L=O>>>16,$=P&65535,z=P>>>16,P=d[7],O=g[7],T+=O&65535,L+=O>>>16,$+=P&65535,z+=P>>>16,L+=T>>>16,$+=L>>>16,z+=$>>>16,d[7]=m=$&65535|z<<16,g[7]=X=T&65535|L<<16,A+=128,S-=128}return A}function u(c){var h=new r;h.update(c);var d=h.digest();return h.clean(),d}i.hash=u})(ma);(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.convertSecretKeyToX25519=i.convertPublicKeyToX25519=i.verify=i.sign=i.extractPublicKeyFromSecretKey=i.generateKeyPair=i.generateKeyPairFromSeed=i.SEED_LENGTH=i.SECRET_KEY_LENGTH=i.PUBLIC_KEY_LENGTH=i.SIGNATURE_LENGTH=void 0;const e=ii,t=ma,r=lt;i.SIGNATURE_LENGTH=64,i.PUBLIC_KEY_LENGTH=32,i.SECRET_KEY_LENGTH=64,i.SEED_LENGTH=32;function s(C){const x=new Float64Array(16);if(C)for(let w=0;w<C.length;w++)x[w]=C[w];return x}const o=new Uint8Array(32);o[0]=9;const u=s(),c=s([1]),h=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),d=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),g=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),E=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),A=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function S(C,x){for(let w=0;w<16;w++)C[w]=x[w]|0}function D(C){let x=1;for(let w=0;w<16;w++){let a=C[w]+x+65535;x=Math.floor(a/65536),C[w]=a-x*65536}C[0]+=x-1+37*(x-1)}function R(C,x,w){const a=~(w-1);for(let y=0;y<16;y++){const K=a&(C[y]^x[y]);C[y]^=K,x[y]^=K}}function F(C,x){const w=s(),a=s();for(let y=0;y<16;y++)a[y]=x[y];D(a),D(a),D(a);for(let y=0;y<2;y++){w[0]=a[0]-65517;for(let V=1;V<15;V++)w[V]=a[V]-65535-(w[V-1]>>16&1),w[V-1]&=65535;w[15]=a[15]-32767-(w[14]>>16&1);const K=w[15]>>16&1;w[14]&=65535,R(a,w,1-K)}for(let y=0;y<16;y++)C[2*y]=a[y]&255,C[2*y+1]=a[y]>>8}function q(C,x){let w=0;for(let a=0;a<32;a++)w|=C[a]^x[a];return(1&w-1>>>8)-1}function _(C,x){const w=new Uint8Array(32),a=new Uint8Array(32);return F(w,C),F(a,x),q(w,a)}function I(C){const x=new Uint8Array(32);return F(x,C),x[0]&1}function p(C,x){for(let w=0;w<16;w++)C[w]=x[2*w]+(x[2*w+1]<<8);C[15]&=32767}function m(C,x,w){for(let a=0;a<16;a++)C[a]=x[a]+w[a]}function b(C,x,w){for(let a=0;a<16;a++)C[a]=x[a]-w[a]}function n(C,x,w){let a,y,K=0,V=0,le=0,be=0,de=0,we=0,Te=0,Oe=0,ye=0,pe=0,fe=0,he=0,ce=0,ae=0,ne=0,ee=0,ue=0,ge=0,te=0,me=0,_e=0,Ee=0,De=0,ve=0,yt=0,_t=0,Ot=0,ct=0,$t=0,si=0,Ai=0,Ue=w[0],Pe=w[1],Le=w[2],$e=w[3],Me=w[4],Ae=w[5],ze=w[6],He=w[7],Ke=w[8],Be=w[9],Ve=w[10],qe=w[11],je=w[12],xe=w[13],Ge=w[14],ke=w[15];a=x[0],K+=a*Ue,V+=a*Pe,le+=a*Le,be+=a*$e,de+=a*Me,we+=a*Ae,Te+=a*ze,Oe+=a*He,ye+=a*Ke,pe+=a*Be,fe+=a*Ve,he+=a*qe,ce+=a*je,ae+=a*xe,ne+=a*Ge,ee+=a*ke,a=x[1],V+=a*Ue,le+=a*Pe,be+=a*Le,de+=a*$e,we+=a*Me,Te+=a*Ae,Oe+=a*ze,ye+=a*He,pe+=a*Ke,fe+=a*Be,he+=a*Ve,ce+=a*qe,ae+=a*je,ne+=a*xe,ee+=a*Ge,ue+=a*ke,a=x[2],le+=a*Ue,be+=a*Pe,de+=a*Le,we+=a*$e,Te+=a*Me,Oe+=a*Ae,ye+=a*ze,pe+=a*He,fe+=a*Ke,he+=a*Be,ce+=a*Ve,ae+=a*qe,ne+=a*je,ee+=a*xe,ue+=a*Ge,ge+=a*ke,a=x[3],be+=a*Ue,de+=a*Pe,we+=a*Le,Te+=a*$e,Oe+=a*Me,ye+=a*Ae,pe+=a*ze,fe+=a*He,he+=a*Ke,ce+=a*Be,ae+=a*Ve,ne+=a*qe,ee+=a*je,ue+=a*xe,ge+=a*Ge,te+=a*ke,a=x[4],de+=a*Ue,we+=a*Pe,Te+=a*Le,Oe+=a*$e,ye+=a*Me,pe+=a*Ae,fe+=a*ze,he+=a*He,ce+=a*Ke,ae+=a*Be,ne+=a*Ve,ee+=a*qe,ue+=a*je,ge+=a*xe,te+=a*Ge,me+=a*ke,a=x[5],we+=a*Ue,Te+=a*Pe,Oe+=a*Le,ye+=a*$e,pe+=a*Me,fe+=a*Ae,he+=a*ze,ce+=a*He,ae+=a*Ke,ne+=a*Be,ee+=a*Ve,ue+=a*qe,ge+=a*je,te+=a*xe,me+=a*Ge,_e+=a*ke,a=x[6],Te+=a*Ue,Oe+=a*Pe,ye+=a*Le,pe+=a*$e,fe+=a*Me,he+=a*Ae,ce+=a*ze,ae+=a*He,ne+=a*Ke,ee+=a*Be,ue+=a*Ve,ge+=a*qe,te+=a*je,me+=a*xe,_e+=a*Ge,Ee+=a*ke,a=x[7],Oe+=a*Ue,ye+=a*Pe,pe+=a*Le,fe+=a*$e,he+=a*Me,ce+=a*Ae,ae+=a*ze,ne+=a*He,ee+=a*Ke,ue+=a*Be,ge+=a*Ve,te+=a*qe,me+=a*je,_e+=a*xe,Ee+=a*Ge,De+=a*ke,a=x[8],ye+=a*Ue,pe+=a*Pe,fe+=a*Le,he+=a*$e,ce+=a*Me,ae+=a*Ae,ne+=a*ze,ee+=a*He,ue+=a*Ke,ge+=a*Be,te+=a*Ve,me+=a*qe,_e+=a*je,Ee+=a*xe,De+=a*Ge,ve+=a*ke,a=x[9],pe+=a*Ue,fe+=a*Pe,he+=a*Le,ce+=a*$e,ae+=a*Me,ne+=a*Ae,ee+=a*ze,ue+=a*He,ge+=a*Ke,te+=a*Be,me+=a*Ve,_e+=a*qe,Ee+=a*je,De+=a*xe,ve+=a*Ge,yt+=a*ke,a=x[10],fe+=a*Ue,he+=a*Pe,ce+=a*Le,ae+=a*$e,ne+=a*Me,ee+=a*Ae,ue+=a*ze,ge+=a*He,te+=a*Ke,me+=a*Be,_e+=a*Ve,Ee+=a*qe,De+=a*je,ve+=a*xe,yt+=a*Ge,_t+=a*ke,a=x[11],he+=a*Ue,ce+=a*Pe,ae+=a*Le,ne+=a*$e,ee+=a*Me,ue+=a*Ae,ge+=a*ze,te+=a*He,me+=a*Ke,_e+=a*Be,Ee+=a*Ve,De+=a*qe,ve+=a*je,yt+=a*xe,_t+=a*Ge,Ot+=a*ke,a=x[12],ce+=a*Ue,ae+=a*Pe,ne+=a*Le,ee+=a*$e,ue+=a*Me,ge+=a*Ae,te+=a*ze,me+=a*He,_e+=a*Ke,Ee+=a*Be,De+=a*Ve,ve+=a*qe,yt+=a*je,_t+=a*xe,Ot+=a*Ge,ct+=a*ke,a=x[13],ae+=a*Ue,ne+=a*Pe,ee+=a*Le,ue+=a*$e,ge+=a*Me,te+=a*Ae,me+=a*ze,_e+=a*He,Ee+=a*Ke,De+=a*Be,ve+=a*Ve,yt+=a*qe,_t+=a*je,Ot+=a*xe,ct+=a*Ge,$t+=a*ke,a=x[14],ne+=a*Ue,ee+=a*Pe,ue+=a*Le,ge+=a*$e,te+=a*Me,me+=a*Ae,_e+=a*ze,Ee+=a*He,De+=a*Ke,ve+=a*Be,yt+=a*Ve,_t+=a*qe,Ot+=a*je,ct+=a*xe,$t+=a*Ge,si+=a*ke,a=x[15],ee+=a*Ue,ue+=a*Pe,ge+=a*Le,te+=a*$e,me+=a*Me,_e+=a*Ae,Ee+=a*ze,De+=a*He,ve+=a*Ke,yt+=a*Be,_t+=a*Ve,Ot+=a*qe,ct+=a*je,$t+=a*xe,si+=a*Ge,Ai+=a*ke,K+=38*ue,V+=38*ge,le+=38*te,be+=38*me,de+=38*_e,we+=38*Ee,Te+=38*De,Oe+=38*ve,ye+=38*yt,pe+=38*_t,fe+=38*Ot,he+=38*ct,ce+=38*$t,ae+=38*si,ne+=38*Ai,y=1,a=K+y+65535,y=Math.floor(a/65536),K=a-y*65536,a=V+y+65535,y=Math.floor(a/65536),V=a-y*65536,a=le+y+65535,y=Math.floor(a/65536),le=a-y*65536,a=be+y+65535,y=Math.floor(a/65536),be=a-y*65536,a=de+y+65535,y=Math.floor(a/65536),de=a-y*65536,a=we+y+65535,y=Math.floor(a/65536),we=a-y*65536,a=Te+y+65535,y=Math.floor(a/65536),Te=a-y*65536,a=Oe+y+65535,y=Math.floor(a/65536),Oe=a-y*65536,a=ye+y+65535,y=Math.floor(a/65536),ye=a-y*65536,a=pe+y+65535,y=Math.floor(a/65536),pe=a-y*65536,a=fe+y+65535,y=Math.floor(a/65536),fe=a-y*65536,a=he+y+65535,y=Math.floor(a/65536),he=a-y*65536,a=ce+y+65535,y=Math.floor(a/65536),ce=a-y*65536,a=ae+y+65535,y=Math.floor(a/65536),ae=a-y*65536,a=ne+y+65535,y=Math.floor(a/65536),ne=a-y*65536,a=ee+y+65535,y=Math.floor(a/65536),ee=a-y*65536,K+=y-1+37*(y-1),y=1,a=K+y+65535,y=Math.floor(a/65536),K=a-y*65536,a=V+y+65535,y=Math.floor(a/65536),V=a-y*65536,a=le+y+65535,y=Math.floor(a/65536),le=a-y*65536,a=be+y+65535,y=Math.floor(a/65536),be=a-y*65536,a=de+y+65535,y=Math.floor(a/65536),de=a-y*65536,a=we+y+65535,y=Math.floor(a/65536),we=a-y*65536,a=Te+y+65535,y=Math.floor(a/65536),Te=a-y*65536,a=Oe+y+65535,y=Math.floor(a/65536),Oe=a-y*65536,a=ye+y+65535,y=Math.floor(a/65536),ye=a-y*65536,a=pe+y+65535,y=Math.floor(a/65536),pe=a-y*65536,a=fe+y+65535,y=Math.floor(a/65536),fe=a-y*65536,a=he+y+65535,y=Math.floor(a/65536),he=a-y*65536,a=ce+y+65535,y=Math.floor(a/65536),ce=a-y*65536,a=ae+y+65535,y=Math.floor(a/65536),ae=a-y*65536,a=ne+y+65535,y=Math.floor(a/65536),ne=a-y*65536,a=ee+y+65535,y=Math.floor(a/65536),ee=a-y*65536,K+=y-1+37*(y-1),C[0]=K,C[1]=V,C[2]=le,C[3]=be,C[4]=de,C[5]=we,C[6]=Te,C[7]=Oe,C[8]=ye,C[9]=pe,C[10]=fe,C[11]=he,C[12]=ce,C[13]=ae,C[14]=ne,C[15]=ee}function f(C,x){n(C,x,x)}function U(C,x){const w=s();let a;for(a=0;a<16;a++)w[a]=x[a];for(a=253;a>=0;a--)f(w,w),a!==2&&a!==4&&n(w,w,x);for(a=0;a<16;a++)C[a]=w[a]}function j(C,x){const w=s();let a;for(a=0;a<16;a++)w[a]=x[a];for(a=250;a>=0;a--)f(w,w),a!==1&&n(w,w,x);for(a=0;a<16;a++)C[a]=w[a]}function W(C,x){const w=s(),a=s(),y=s(),K=s(),V=s(),le=s(),be=s(),de=s(),we=s();b(w,C[1],C[0]),b(we,x[1],x[0]),n(w,w,we),m(a,C[0],C[1]),m(we,x[0],x[1]),n(a,a,we),n(y,C[3],x[3]),n(y,y,d),n(K,C[2],x[2]),m(K,K,K),b(V,a,w),b(le,K,y),m(be,K,y),m(de,a,w),n(C[0],V,le),n(C[1],de,be),n(C[2],be,le),n(C[3],V,de)}function J(C,x,w){for(let a=0;a<4;a++)R(C[a],x[a],w)}function X(C,x){const w=s(),a=s(),y=s();U(y,x[2]),n(w,x[0],y),n(a,x[1],y),F(C,a),C[31]^=I(w)<<7}function P(C,x,w){S(C[0],u),S(C[1],c),S(C[2],c),S(C[3],u);for(let a=255;a>=0;--a){const y=w[a/8|0]>>(a&7)&1;J(C,x,y),W(x,C),W(C,C),J(C,x,y)}}function O(C,x){const w=[s(),s(),s(),s()];S(w[0],g),S(w[1],E),S(w[2],c),n(w[3],g,E),P(C,w,x)}function k(C){if(C.length!==i.SEED_LENGTH)throw new Error(`ed25519: seed must be ${i.SEED_LENGTH} bytes`);const x=(0,t.hash)(C);x[0]&=248,x[31]&=127,x[31]|=64;const w=new Uint8Array(32),a=[s(),s(),s(),s()];O(a,x),X(w,a);const y=new Uint8Array(64);return y.set(C),y.set(w,32),{publicKey:w,secretKey:y}}i.generateKeyPairFromSeed=k;function M(C){const x=(0,e.randomBytes)(32,C),w=k(x);return(0,r.wipe)(x),w}i.generateKeyPair=M;function T(C){if(C.length!==i.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${i.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(C.subarray(32))}i.extractPublicKeyFromSecretKey=T;const L=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function $(C,x){let w,a,y,K;for(a=63;a>=32;--a){for(w=0,y=a-32,K=a-12;y<K;++y)x[y]+=w-16*x[a]*L[y-(a-32)],w=Math.floor((x[y]+128)/256),x[y]-=w*256;x[y]+=w,x[a]=0}for(w=0,y=0;y<32;y++)x[y]+=w-(x[31]>>4)*L[y],w=x[y]>>8,x[y]&=255;for(y=0;y<32;y++)x[y]-=w*L[y];for(a=0;a<32;a++)x[a+1]+=x[a]>>8,C[a]=x[a]&255}function z(C){const x=new Float64Array(64);for(let w=0;w<64;w++)x[w]=C[w];for(let w=0;w<64;w++)C[w]=0;$(C,x)}function re(C,x){const w=new Float64Array(64),a=[s(),s(),s(),s()],y=(0,t.hash)(C.subarray(0,32));y[0]&=248,y[31]&=127,y[31]|=64;const K=new Uint8Array(64);K.set(y.subarray(32),32);const V=new t.SHA512;V.update(K.subarray(32)),V.update(x);const le=V.digest();V.clean(),z(le),O(a,le),X(K,a),V.reset(),V.update(K.subarray(0,32)),V.update(C.subarray(32)),V.update(x);const be=V.digest();z(be);for(let de=0;de<32;de++)w[de]=le[de];for(let de=0;de<32;de++)for(let we=0;we<32;we++)w[de+we]+=be[de]*y[we];return $(K.subarray(32),w),K}i.sign=re;function H(C,x){const w=s(),a=s(),y=s(),K=s(),V=s(),le=s(),be=s();return S(C[2],c),p(C[1],x),f(y,C[1]),n(K,y,h),b(y,y,C[2]),m(K,C[2],K),f(V,K),f(le,V),n(be,le,V),n(w,be,y),n(w,w,K),j(w,w),n(w,w,y),n(w,w,K),n(w,w,K),n(C[0],w,K),f(a,C[0]),n(a,a,K),_(a,y)&&n(C[0],C[0],A),f(a,C[0]),n(a,a,K),_(a,y)?-1:(I(C[0])===x[31]>>7&&b(C[0],u,C[0]),n(C[3],C[0],C[1]),0)}function Q(C,x,w){const a=new Uint8Array(32),y=[s(),s(),s(),s()],K=[s(),s(),s(),s()];if(w.length!==i.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${i.SIGNATURE_LENGTH} bytes`);if(H(K,C))return!1;const V=new t.SHA512;V.update(w.subarray(0,32)),V.update(C),V.update(x);const le=V.digest();return z(le),P(y,K,le),O(K,w.subarray(32)),W(y,K),X(a,y),!q(w,a)}i.verify=Q;function Y(C){let x=[s(),s(),s(),s()];if(H(x,C))throw new Error("Ed25519: invalid public key");let w=s(),a=s(),y=x[1];m(w,c,y),b(a,c,y),U(a,a),n(w,w,a);let K=new Uint8Array(32);return F(K,w),K}i.convertPublicKeyToX25519=Y;function oe(C){const x=(0,t.hash)(C.subarray(0,32));x[0]&=248,x[31]&=127,x[31]|=64;const w=new Uint8Array(x.subarray(0,32));return(0,r.wipe)(x),w}i.convertSecretKeyToX25519=oe})(rs);const Pl="EdDSA",Al="JWT",_a=".",wa="base64url",Nl="utf8",Tl="utf8",Rl=":",Fl="did",Ul="key",sn="base58btc",Ll="z",$l="K36",Ml=32;function ki(i){return ot(nt(Kr(i),Nl),wa)}function va(i){const e=nt($l,sn),t=Ll+ot(Ar([e,i]),sn);return[Fl,Ul,t].join(Rl)}function jl(i){return ot(i,wa)}function ql(i){return nt([ki(i.header),ki(i.payload)].join(_a),Tl)}function zl(i){return[ki(i.header),ki(i.payload),jl(i.signature)].join(_a)}function nn(i=ii.randomBytes(Ml)){return rs.generateKeyPairFromSeed(i)}async function Hl(i,e,t,r,s=Z.fromMiliseconds(Date.now())){const o={alg:Pl,typ:Al},u=va(r.publicKey),c=s+t,h={iss:u,sub:i,aud:e,iat:s,exp:c},d=ql({header:o,payload:h}),g=rs.sign(r.secretKey,d);return zl({header:o,payload:h,signature:g})}const an=10,Kl=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),Bl=()=>typeof window<"u",Vl=Kl();class Gl{constructor(e){if(this.url=e,this.events=new ut.EventEmitter,this.registering=!1,!ms(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e,t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Kr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!ms(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((r,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,r)=>{const s=Mo.isReactNative()?void 0:{rejectUnauthorized:!jo(e)},o=new Vl(e,[],s);Bl()?o.onerror=u=>{const c=u;r(this.emitError(c.error))}:o.on("error",u=>{r(this.emitError(u))}),o.onopen=()=>{this.onOpen(o),t(o)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Ln(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const r=this.parseError(t),s=r.message||r.toString(),o=Br(e,s);this.events.emit("payload",o)}parseError(e,t=this.url){return qo(e,t,"WS")}resetMaxListeners(){this.events.getMaxListeners()>an&&this.events.setMaxListeners(an)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",t),t}}var Yi={},kl={get exports(){return Yi},set exports(i){Yi=i}};(function(i,e){var t=200,r="__lodash_hash_undefined__",s=1,o=2,u=9007199254740991,c="[object Arguments]",h="[object Array]",d="[object AsyncFunction]",g="[object Boolean]",E="[object Date]",A="[object Error]",S="[object Function]",D="[object GeneratorFunction]",R="[object Map]",F="[object Number]",q="[object Null]",_="[object Object]",I="[object Promise]",p="[object Proxy]",m="[object RegExp]",b="[object Set]",n="[object String]",f="[object Symbol]",U="[object Undefined]",j="[object WeakMap]",W="[object ArrayBuffer]",J="[object DataView]",X="[object Float32Array]",P="[object Float64Array]",O="[object Int8Array]",k="[object Int16Array]",M="[object Int32Array]",T="[object Uint8Array]",L="[object Uint8ClampedArray]",$="[object Uint16Array]",z="[object Uint32Array]",re=/[\\^$.*+?()[\]{}|]/g,H=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,Y={};Y[X]=Y[P]=Y[O]=Y[k]=Y[M]=Y[T]=Y[L]=Y[$]=Y[z]=!0,Y[c]=Y[h]=Y[W]=Y[g]=Y[J]=Y[E]=Y[A]=Y[S]=Y[R]=Y[F]=Y[_]=Y[m]=Y[b]=Y[n]=Y[j]=!1;var oe=typeof Gt=="object"&&Gt&&Gt.Object===Object&&Gt,C=typeof self=="object"&&self&&self.Object===Object&&self,x=oe||C||Function("return this")(),w=e&&!e.nodeType&&e,a=w&&!0&&i&&!i.nodeType&&i,y=a&&a.exports===w,K=y&&oe.process,V=function(){try{return K&&K.binding&&K.binding("util")}catch{}}(),le=V&&V.isTypedArray;function be(l,v){for(var N=-1,G=l==null?0:l.length,Ie=0,se=[];++N<G;){var Ne=l[N];v(Ne,N,l)&&(se[Ie++]=Ne)}return se}function de(l,v){for(var N=-1,G=v.length,Ie=l.length;++N<G;)l[Ie+N]=v[N];return l}function we(l,v){for(var N=-1,G=l==null?0:l.length;++N<G;)if(v(l[N],N,l))return!0;return!1}function Te(l,v){for(var N=-1,G=Array(l);++N<l;)G[N]=v(N);return G}function Oe(l){return function(v){return l(v)}}function ye(l,v){return l.has(v)}function pe(l,v){return l==null?void 0:l[v]}function fe(l){var v=-1,N=Array(l.size);return l.forEach(function(G,Ie){N[++v]=[Ie,G]}),N}function he(l,v){return function(N){return l(v(N))}}function ce(l){var v=-1,N=Array(l.size);return l.forEach(function(G){N[++v]=G}),N}var ae=Array.prototype,ne=Function.prototype,ee=Object.prototype,ue=x["__core-js_shared__"],ge=ne.toString,te=ee.hasOwnProperty,me=function(){var l=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return l?"Symbol(src)_1."+l:""}(),_e=ee.toString,Ee=RegExp("^"+ge.call(te).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=y?x.Buffer:void 0,ve=x.Symbol,yt=x.Uint8Array,_t=ee.propertyIsEnumerable,Ot=ae.splice,ct=ve?ve.toStringTag:void 0,$t=Object.getOwnPropertySymbols,si=De?De.isBuffer:void 0,Ai=he(Object.keys,Object),Ue=Jt(x,"DataView"),Pe=Jt(x,"Map"),Le=Jt(x,"Promise"),$e=Jt(x,"Set"),Me=Jt(x,"WeakMap"),Ae=Jt(Object,"create"),ze=jt(Ue),He=jt(Pe),Ke=jt(Le),Be=jt($e),Ve=jt(Me),qe=ve?ve.prototype:void 0,je=qe?qe.valueOf:void 0;function xe(l){var v=-1,N=l==null?0:l.length;for(this.clear();++v<N;){var G=l[v];this.set(G[0],G[1])}}function Ge(){this.__data__=Ae?Ae(null):{},this.size=0}function ke(l){var v=this.has(l)&&delete this.__data__[l];return this.size-=v?1:0,v}function za(l){var v=this.__data__;if(Ae){var N=v[l];return N===r?void 0:N}return te.call(v,l)?v[l]:void 0}function Ha(l){var v=this.__data__;return Ae?v[l]!==void 0:te.call(v,l)}function Ka(l,v){var N=this.__data__;return this.size+=this.has(l)?0:1,N[l]=Ae&&v===void 0?r:v,this}xe.prototype.clear=Ge,xe.prototype.delete=ke,xe.prototype.get=za,xe.prototype.has=Ha,xe.prototype.set=Ka;function It(l){var v=-1,N=l==null?0:l.length;for(this.clear();++v<N;){var G=l[v];this.set(G[0],G[1])}}function Ba(){this.__data__=[],this.size=0}function Va(l){var v=this.__data__,N=Ti(v,l);if(N<0)return!1;var G=v.length-1;return N==G?v.pop():Ot.call(v,N,1),--this.size,!0}function Ga(l){var v=this.__data__,N=Ti(v,l);return N<0?void 0:v[N][1]}function ka(l){return Ti(this.__data__,l)>-1}function Ya(l,v){var N=this.__data__,G=Ti(N,l);return G<0?(++this.size,N.push([l,v])):N[G][1]=v,this}It.prototype.clear=Ba,It.prototype.delete=Va,It.prototype.get=Ga,It.prototype.has=ka,It.prototype.set=Ya;function Mt(l){var v=-1,N=l==null?0:l.length;for(this.clear();++v<N;){var G=l[v];this.set(G[0],G[1])}}function Wa(){this.size=0,this.__data__={hash:new xe,map:new(Pe||It),string:new xe}}function Ja(l){var v=Ri(this,l).delete(l);return this.size-=v?1:0,v}function Xa(l){return Ri(this,l).get(l)}function Za(l){return Ri(this,l).has(l)}function Qa(l,v){var N=Ri(this,l),G=N.size;return N.set(l,v),this.size+=N.size==G?0:1,this}Mt.prototype.clear=Wa,Mt.prototype.delete=Ja,Mt.prototype.get=Xa,Mt.prototype.has=Za,Mt.prototype.set=Qa;function Ni(l){var v=-1,N=l==null?0:l.length;for(this.__data__=new Mt;++v<N;)this.add(l[v])}function eo(l){return this.__data__.set(l,r),this}function to(l){return this.__data__.has(l)}Ni.prototype.add=Ni.prototype.push=eo,Ni.prototype.has=to;function Pt(l){var v=this.__data__=new It(l);this.size=v.size}function io(){this.__data__=new It,this.size=0}function ro(l){var v=this.__data__,N=v.delete(l);return this.size=v.size,N}function so(l){return this.__data__.get(l)}function no(l){return this.__data__.has(l)}function ao(l,v){var N=this.__data__;if(N instanceof It){var G=N.__data__;if(!Pe||G.length<t-1)return G.push([l,v]),this.size=++N.size,this;N=this.__data__=new Mt(G)}return N.set(l,v),this.size=N.size,this}Pt.prototype.clear=io,Pt.prototype.delete=ro,Pt.prototype.get=so,Pt.prototype.has=no,Pt.prototype.set=ao;function oo(l,v){var N=Fi(l),G=!N&&Do(l),Ie=!N&&!G&&or(l),se=!N&&!G&&!Ie&&ys(l),Ne=N||G||Ie||se,Ye=Ne?Te(l.length,String):[],Xe=Ye.length;for(var Ce in l)(v||te.call(l,Ce))&&!(Ne&&(Ce=="length"||Ie&&(Ce=="offset"||Ce=="parent")||se&&(Ce=="buffer"||Ce=="byteLength"||Ce=="byteOffset")||mo(Ce,Xe)))&&Ye.push(Ce);return Ye}function Ti(l,v){for(var N=l.length;N--;)if(fs(l[N][0],v))return N;return-1}function co(l,v,N){var G=v(l);return Fi(l)?G:de(G,N(l))}function ni(l){return l==null?l===void 0?U:q:ct&&ct in Object(l)?yo(l):Eo(l)}function cs(l){return ai(l)&&ni(l)==c}function hs(l,v,N,G,Ie){return l===v?!0:l==null||v==null||!ai(l)&&!ai(v)?l!==l&&v!==v:ho(l,v,N,G,hs,Ie)}function ho(l,v,N,G,Ie,se){var Ne=Fi(l),Ye=Fi(v),Xe=Ne?h:At(l),Ce=Ye?h:At(v);Xe=Xe==c?_:Xe,Ce=Ce==c?_:Ce;var ht=Xe==_,bt=Ce==_,et=Xe==Ce;if(et&&or(l)){if(!or(v))return!1;Ne=!0,ht=!1}if(et&&!ht)return se||(se=new Pt),Ne||ys(l)?us(l,v,N,G,Ie,se):po(l,v,Xe,N,G,Ie,se);if(!(N&s)){var ft=ht&&te.call(l,"__wrapped__"),dt=bt&&te.call(v,"__wrapped__");if(ft||dt){var Nt=ft?l.value():l,xt=dt?v.value():v;return se||(se=new Pt),Ie(Nt,xt,N,G,se)}}return et?(se||(se=new Pt),go(l,v,N,G,Ie,se)):!1}function uo(l){if(!gs(l)||wo(l))return!1;var v=ds(l)?Ee:H;return v.test(jt(l))}function lo(l){return ai(l)&&ps(l.length)&&!!Y[ni(l)]}function fo(l){if(!vo(l))return Ai(l);var v=[];for(var N in Object(l))te.call(l,N)&&N!="constructor"&&v.push(N);return v}function us(l,v,N,G,Ie,se){var Ne=N&s,Ye=l.length,Xe=v.length;if(Ye!=Xe&&!(Ne&&Xe>Ye))return!1;var Ce=se.get(l);if(Ce&&se.get(v))return Ce==v;var ht=-1,bt=!0,et=N&o?new Ni:void 0;for(se.set(l,v),se.set(v,l);++ht<Ye;){var ft=l[ht],dt=v[ht];if(G)var Nt=Ne?G(dt,ft,ht,v,l,se):G(ft,dt,ht,l,v,se);if(Nt!==void 0){if(Nt)continue;bt=!1;break}if(et){if(!we(v,function(xt,qt){if(!ye(et,qt)&&(ft===xt||Ie(ft,xt,N,G,se)))return et.push(qt)})){bt=!1;break}}else if(!(ft===dt||Ie(ft,dt,N,G,se))){bt=!1;break}}return se.delete(l),se.delete(v),bt}function po(l,v,N,G,Ie,se,Ne){switch(N){case J:if(l.byteLength!=v.byteLength||l.byteOffset!=v.byteOffset)return!1;l=l.buffer,v=v.buffer;case W:return!(l.byteLength!=v.byteLength||!se(new yt(l),new yt(v)));case g:case E:case F:return fs(+l,+v);case A:return l.name==v.name&&l.message==v.message;case m:case n:return l==v+"";case R:var Ye=fe;case b:var Xe=G&s;if(Ye||(Ye=ce),l.size!=v.size&&!Xe)return!1;var Ce=Ne.get(l);if(Ce)return Ce==v;G|=o,Ne.set(l,v);var ht=us(Ye(l),Ye(v),G,Ie,se,Ne);return Ne.delete(l),ht;case f:if(je)return je.call(l)==je.call(v)}return!1}function go(l,v,N,G,Ie,se){var Ne=N&s,Ye=ls(l),Xe=Ye.length,Ce=ls(v),ht=Ce.length;if(Xe!=ht&&!Ne)return!1;for(var bt=Xe;bt--;){var et=Ye[bt];if(!(Ne?et in v:te.call(v,et)))return!1}var ft=se.get(l);if(ft&&se.get(v))return ft==v;var dt=!0;se.set(l,v),se.set(v,l);for(var Nt=Ne;++bt<Xe;){et=Ye[bt];var xt=l[et],qt=v[et];if(G)var bs=Ne?G(qt,xt,et,v,l,se):G(xt,qt,et,l,v,se);if(!(bs===void 0?xt===qt||Ie(xt,qt,N,G,se):bs)){dt=!1;break}Nt||(Nt=et=="constructor")}if(dt&&!Nt){var Ui=l.constructor,Li=v.constructor;Ui!=Li&&"constructor"in l&&"constructor"in v&&!(typeof Ui=="function"&&Ui instanceof Ui&&typeof Li=="function"&&Li instanceof Li)&&(dt=!1)}return se.delete(l),se.delete(v),dt}function ls(l){return co(l,xo,bo)}function Ri(l,v){var N=l.__data__;return _o(v)?N[typeof v=="string"?"string":"hash"]:N.map}function Jt(l,v){var N=pe(l,v);return uo(N)?N:void 0}function yo(l){var v=te.call(l,ct),N=l[ct];try{l[ct]=void 0;var G=!0}catch{}var Ie=_e.call(l);return G&&(v?l[ct]=N:delete l[ct]),Ie}var bo=$t?function(l){return l==null?[]:(l=Object(l),be($t(l),function(v){return _t.call(l,v)}))}:Co,At=ni;(Ue&&At(new Ue(new ArrayBuffer(1)))!=J||Pe&&At(new Pe)!=R||Le&&At(Le.resolve())!=I||$e&&At(new $e)!=b||Me&&At(new Me)!=j)&&(At=function(l){var v=ni(l),N=v==_?l.constructor:void 0,G=N?jt(N):"";if(G)switch(G){case ze:return J;case He:return R;case Ke:return I;case Be:return b;case Ve:return j}return v});function mo(l,v){return v=v??u,!!v&&(typeof l=="number"||Q.test(l))&&l>-1&&l%1==0&&l<v}function _o(l){var v=typeof l;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?l!=="__proto__":l===null}function wo(l){return!!me&&me in l}function vo(l){var v=l&&l.constructor,N=typeof v=="function"&&v.prototype||ee;return l===N}function Eo(l){return _e.call(l)}function jt(l){if(l!=null){try{return ge.call(l)}catch{}try{return l+""}catch{}}return""}function fs(l,v){return l===v||l!==l&&v!==v}var Do=cs(function(){return arguments}())?cs:function(l){return ai(l)&&te.call(l,"callee")&&!_t.call(l,"callee")},Fi=Array.isArray;function So(l){return l!=null&&ps(l.length)&&!ds(l)}var or=si||Oo;function Io(l,v){return hs(l,v)}function ds(l){if(!gs(l))return!1;var v=ni(l);return v==S||v==D||v==d||v==p}function ps(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=u}function gs(l){var v=typeof l;return l!=null&&(v=="object"||v=="function")}function ai(l){return l!=null&&typeof l=="object"}var ys=le?Oe(le):lo;function xo(l){return So(l)?oo(l):fo(l)}function Co(){return[]}function Oo(){return!1}i.exports=Io})(kl,Yi);function Yl(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<i.length;s++){var o=i.charAt(s),u=o.charCodeAt(0);if(t[u]!==255)throw new TypeError(o+" is ambiguous");t[u]=s}var c=i.length,h=i.charAt(0),d=Math.log(c)/Math.log(256),g=Math.log(256)/Math.log(c);function E(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var R=0,F=0,q=0,_=D.length;q!==_&&D[q]===0;)q++,R++;for(var I=(_-q)*g+1>>>0,p=new Uint8Array(I);q!==_;){for(var m=D[q],b=0,n=I-1;(m!==0||b<F)&&n!==-1;n--,b++)m+=256*p[n]>>>0,p[n]=m%c>>>0,m=m/c>>>0;if(m!==0)throw new Error("Non-zero carry");F=b,q++}for(var f=I-F;f!==I&&p[f]===0;)f++;for(var U=h.repeat(R);f<I;++f)U+=i.charAt(p[f]);return U}function A(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var R=0;if(D[R]!==" "){for(var F=0,q=0;D[R]===h;)F++,R++;for(var _=(D.length-R)*d+1>>>0,I=new Uint8Array(_);D[R];){var p=t[D.charCodeAt(R)];if(p===255)return;for(var m=0,b=_-1;(p!==0||m<q)&&b!==-1;b--,m++)p+=c*I[b]>>>0,I[b]=p%256>>>0,p=p/256>>>0;if(p!==0)throw new Error("Non-zero carry");q=m,R++}if(D[R]!==" "){for(var n=_-q;n!==_&&I[n]===0;)n++;for(var f=new Uint8Array(F+(_-n)),U=F;n!==_;)f[U++]=I[n++];return f}}}function S(D){var R=A(D);if(R)return R;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:A,decode:S}}var Wl=Yl,Jl=Wl;const Ea=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Xl=i=>new TextEncoder().encode(i),Zl=i=>new TextDecoder().decode(i);class Ql{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ef{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Da(this,e)}}class tf{constructor(e){this.decoders=e}or(e){return Da(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Da=(i,e)=>new tf({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class rf{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new Ql(e,t,r),this.decoder=new ef(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const sr=({name:i,prefix:e,encode:t,decode:r})=>new rf(i,e,t,r),Oi=({prefix:i,name:e,alphabet:t})=>{const{encode:r,decode:s}=Jl(t,e);return sr({prefix:i,name:e,encode:r,decode:o=>Ea(s(o))})},sf=(i,e,t,r)=>{const s={};for(let g=0;g<e.length;++g)s[e[g]]=g;let o=i.length;for(;i[o-1]==="=";)--o;const u=new Uint8Array(o*t/8|0);let c=0,h=0,d=0;for(let g=0;g<o;++g){const E=s[i[g]];if(E===void 0)throw new SyntaxError(`Non-${r} character`);h=h<<t|E,c+=t,c>=8&&(c-=8,u[d++]=255&h>>c)}if(c>=t||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return u},nf=(i,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",u=0,c=0;for(let h=0;h<i.length;++h)for(c=c<<8|i[h],u+=8;u>t;)u-=t,o+=e[s&c>>u];if(u&&(o+=e[s&c<<t-u]),r)for(;o.length*t&7;)o+="=";return o},Qe=({name:i,prefix:e,bitsPerChar:t,alphabet:r})=>sr({prefix:e,name:i,encode(s){return nf(s,r,t)},decode(s){return sf(s,r,t,i)}}),af=sr({prefix:"\0",name:"identity",encode:i=>Zl(i),decode:i=>Xl(i)});var of=Object.freeze({__proto__:null,identity:af});const cf=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var hf=Object.freeze({__proto__:null,base2:cf});const uf=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var lf=Object.freeze({__proto__:null,base8:uf});const ff=Oi({prefix:"9",name:"base10",alphabet:"0123456789"});var df=Object.freeze({__proto__:null,base10:ff});const pf=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),gf=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var yf=Object.freeze({__proto__:null,base16:pf,base16upper:gf});const bf=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mf=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_f=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),wf=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),vf=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ef=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Df=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Sf=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),If=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var xf=Object.freeze({__proto__:null,base32:bf,base32upper:mf,base32pad:_f,base32padupper:wf,base32hex:vf,base32hexupper:Ef,base32hexpad:Df,base32hexpadupper:Sf,base32z:If});const Cf=Oi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Of=Oi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Pf=Object.freeze({__proto__:null,base36:Cf,base36upper:Of});const Af=Oi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Nf=Oi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Tf=Object.freeze({__proto__:null,base58btc:Af,base58flickr:Nf});const Rf=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ff=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Uf=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Lf=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var $f=Object.freeze({__proto__:null,base64:Rf,base64pad:Ff,base64url:Uf,base64urlpad:Lf});const Sa=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Mf=Sa.reduce((i,e,t)=>(i[t]=e,i),[]),jf=Sa.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function qf(i){return i.reduce((e,t)=>(e+=Mf[t],e),"")}function zf(i){const e=[];for(const t of i){const r=jf[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const Hf=sr({prefix:"🚀",name:"base256emoji",encode:qf,decode:zf});var Kf=Object.freeze({__proto__:null,base256emoji:Hf}),Bf=Ia,on=128,Vf=127,Gf=~Vf,kf=Math.pow(2,31);function Ia(i,e,t){e=e||[],t=t||0;for(var r=t;i>=kf;)e[t++]=i&255|on,i/=128;for(;i&Gf;)e[t++]=i&255|on,i>>>=7;return e[t]=i|0,Ia.bytes=t-r+1,e}var Yf=$r,Wf=128,cn=127;function $r(i,r){var t=0,r=r||0,s=0,o=r,u,c=i.length;do{if(o>=c)throw $r.bytes=0,new RangeError("Could not decode varint");u=i[o++],t+=s<28?(u&cn)<<s:(u&cn)*Math.pow(2,s),s+=7}while(u>=Wf);return $r.bytes=o-r,t}var Jf=Math.pow(2,7),Xf=Math.pow(2,14),Zf=Math.pow(2,21),Qf=Math.pow(2,28),ed=Math.pow(2,35),td=Math.pow(2,42),id=Math.pow(2,49),rd=Math.pow(2,56),sd=Math.pow(2,63),nd=function(i){return i<Jf?1:i<Xf?2:i<Zf?3:i<Qf?4:i<ed?5:i<td?6:i<id?7:i<rd?8:i<sd?9:10},ad={encode:Bf,decode:Yf,encodingLength:nd},xa=ad;const hn=(i,e,t=0)=>(xa.encode(i,e,t),e),un=i=>xa.encodingLength(i),Mr=(i,e)=>{const t=e.byteLength,r=un(i),s=r+un(t),o=new Uint8Array(s+t);return hn(i,o,0),hn(t,o,r),o.set(e,s),new od(i,t,e,o)};class od{constructor(e,t,r,s){this.code=e,this.size=t,this.digest=r,this.bytes=s}}const Ca=({name:i,code:e,encode:t})=>new cd(i,e,t);class cd{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Mr(this.code,t):t.then(r=>Mr(this.code,r))}else throw Error("Unknown type, must be binary type")}}const Oa=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),hd=Ca({name:"sha2-256",code:18,encode:Oa("SHA-256")}),ud=Ca({name:"sha2-512",code:19,encode:Oa("SHA-512")});var ld=Object.freeze({__proto__:null,sha256:hd,sha512:ud});const Pa=0,fd="identity",Aa=Ea,dd=i=>Mr(Pa,Aa(i)),pd={code:Pa,name:fd,encode:Aa,digest:dd};var gd=Object.freeze({__proto__:null,identity:pd});new TextEncoder,new TextDecoder;const ln={...of,...hf,...lf,...df,...yf,...xf,...Pf,...Tf,...$f,...Kf};({...ld,...gd});function yd(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function Na(i,e,t,r){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:r}}}const fn=Na("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),mr=Na("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=yd(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),bd={utf8:fn,"utf-8":fn,hex:ln.base16,latin1:mr,ascii:mr,binary:mr,...ln};function md(i,e="utf8"){const t=bd[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):t.decoder.decode(`${t.prefix}${i}`)}const Ta="wc",_d=2,ss="core",Ut=`${Ta}@2:${ss}:`,wd={name:ss,logger:"error"},vd={database:":memory:"},Ed="crypto",dn="client_ed25519_seed",Dd=Z.ONE_DAY,Sd="keychain",Id="0.3",xd="messages",Cd="0.3",Od=Z.SIX_HOURS,Pd="publisher",Ra="irn",Ad="error",Fa="wss://relay.walletconnect.com",Nd="relayer",We={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Td="_subscription",Mi={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},pn=Z.ONE_SECOND,Rd="2.5.1",Fd="0.3",Et={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Ud="subscription",Ld="0.3",$d=Z.FIVE_SECONDS*1e3,Md="pairing",jd="0.3",di={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},vt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},qd="history",zd="0.3",Hd="expirer",gt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Kd="0.3";class Bd{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=Sd,this.version=Id,this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}},this.has=r=>(this.isInitialized(),this.keychain.has(r)),this.set=async(r,s)=>{this.isInitialized(),this.keychain.set(r,s),await this.persist()},this.get=r=>{this.isInitialized();const s=this.keychain.get(r);if(typeof s>"u"){const{message:o}=B("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(o)}return s},this.del=async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,aa(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?oa(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Vd{constructor(e,t,r){this.core=e,this.logger=t,this.name=Ed,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),o=nn(s);return va(o.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=$h();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const o=await this.getClientSeed(),u=nn(o),c=Rr();return await Hl(c,s,Dd,u)},this.generateSharedKey=(s,o,u)=>{this.isInitialized();const c=this.getPrivateKey(s),h=Mh(c,o);return this.setSymKey(h,u)},this.setSymKey=async(s,o)=>{this.isInitialized();const u=o||jh(s);return await this.keychain.set(u,s),u},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,o,u)=>{this.isInitialized();const c=sa(u),h=Kr(o);if(Fs(c)){const A=c.senderPublicKey,S=c.receiverPublicKey;s=await this.generateSharedKey(A,S)}const d=this.getSymKey(s),{type:g,senderPublicKey:E}=c;return zh({type:g,symKey:d,message:h,senderPublicKey:E})},this.decode=async(s,o,u)=>{this.isInitialized();const c=Bh(o,u);if(Fs(c)){const g=c.receiverPublicKey,E=c.senderPublicKey;s=await this.generateSharedKey(g,E)}const h=this.getSymKey(s),d=Hh({symKey:h,encoded:o});return Ln(d)},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.keychain=r||new Bd(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const t=es(e);return Si(t.type)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(dn)}catch{e=Rr(),await this.keychain.set(dn,e)}return md(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Gd extends vl{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=xd,this.version=Cd,this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}},this.set=async(r,s)=>{this.isInitialized();const o=Vi(s);let u=this.messages.get(r);return typeof u>"u"&&(u={}),typeof u[o]<"u"||(u[o]=s,this.messages.set(r,u),await this.persist()),o},this.get=r=>{this.isInitialized();let s=this.messages.get(r);return typeof s>"u"&&(s={}),s},this.has=(r,s)=>{this.isInitialized();const o=this.get(r),u=Vi(s);return typeof o[u]<"u"},this.del=async r=>{this.isInitialized(),this.messages.delete(r),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=t}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,aa(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?oa(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class kd extends El{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new ut.EventEmitter,this.name=Pd,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(r,s,o)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:o}});try{const u=(o==null?void 0:o.ttl)||Od,c=Ur(o),h=(o==null?void 0:o.prompt)||!1,d=(o==null?void 0:o.tag)||0,g={topic:r,message:s,opts:{ttl:u,relay:c,prompt:h,tag:d}},E=Vi(s);this.queue.set(E,g);try{await await Fr(this.rpcPublish(r,s,u,c,h,d),this.publishTimeout),this.relayer.events.emit(We.publish,g)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(We.connection_stalled);return}this.onPublish(E,g),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:o}})}catch(u){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(u),u}},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,t,r,s,o,u){var c,h,d,g;const E={method:zi(s.protocol).publish,params:{topic:e,message:t,ttl:r,prompt:o,tag:u}};return rt((c=E.params)==null?void 0:c.prompt)&&((h=E.params)==null||delete h.prompt),rt((d=E.params)==null?void 0:d.tag)&&((g=E.params)==null||delete g.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:E}),this.relayer.provider.request(E)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:r,opts:s}=e;await this.publish(t,r,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ci.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Yd{constructor(){this.map=new Map,this.set=(e,t)=>{const r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,t))return;const s=r.filter(o=>o!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Wd=Object.defineProperty,Jd=Object.defineProperties,Xd=Object.getOwnPropertyDescriptors,gn=Object.getOwnPropertySymbols,Zd=Object.prototype.hasOwnProperty,Qd=Object.prototype.propertyIsEnumerable,yn=(i,e,t)=>e in i?Wd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,pi=(i,e)=>{for(var t in e||(e={}))Zd.call(e,t)&&yn(i,t,e[t]);if(gn)for(var t of gn(e))Qd.call(e,t)&&yn(i,t,e[t]);return i},_r=(i,e)=>Jd(i,Xd(e));class ep extends Il{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Yd,this.events=new ut.EventEmitter,this.name=Ud,this.version=Ld,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Ut,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(r,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}});try{const o=Ur(s),u={topic:r,relay:o};this.pending.set(r,u);const c=await this.rpcSubscribe(r,o);return this.onSubscribe(c,u),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}}),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}},this.unsubscribe=async(r,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(r,s.id,s):await this.unsubscribeByTopic(r,s)},this.isSubscribed=async r=>this.topics.includes(r)?!0:await new Promise((s,o)=>{const u=new Z.Watch;u.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(r)&&this.topics.includes(r)&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),s(!0)),u.elapsed(this.pendingSubscriptionWatchLabel)>=$d&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),o(!1))},this.pollingInterval)}),this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name),this.clientId=""}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const r=this.topicMap.get(e);await Promise.all(r.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{const s=Ur(r);await this.rpcUnsubscribe(e,t,s);const o=Fe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,o),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t){const r={method:zi(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await Fr(this.relayer.provider.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(We.connection_stalled)}return Vi(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,r={method:zi(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{return await await Fr(this.relayer.provider.request(r),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(We.connection_stalled)}}rpcUnsubscribe(e,t,r){const s={method:zi(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.provider.request(s)}onSubscribe(e,t){this.setSubscription(e,_r(pi({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,pi({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,pi({},t)),this.topicMap.set(t.topic,e),this.events.emit(Et.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:r}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Et.deleted,_r(pi({},r),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Et.sync)}async reset(){if(!this.cached.length)return;const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const r=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(r)}this.events.emit(Et.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);this.onBatchSubscribe(t.map((r,s)=>_r(pi({},e[s]),{id:r})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Ci.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(We.connect,async()=>{await this.onConnect()}),this.relayer.on(We.disconnect,()=>{this.onDisconnect()}),this.events.on(Et.created,async e=>{const t=Et.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(Et.deleted,async e=>{const t=Et.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),e())},this.pollingInterval)})}}var tp=Object.defineProperty,bn=Object.getOwnPropertySymbols,ip=Object.prototype.hasOwnProperty,rp=Object.prototype.propertyIsEnumerable,mn=(i,e,t)=>e in i?tp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,sp=(i,e)=>{for(var t in e||(e={}))ip.call(e,t)&&mn(i,t,e[t]);if(bn)for(var t of bn(e))rp.call(e,t)&&mn(i,t,e[t]);return i};class np extends Dl{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ut.EventEmitter,this.name=Nd,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):Ii(Se.getDefaultLoggerOptions({level:e.logger||Ad})),this.messages=new Gd(this.logger,e.core),this.subscriber=new ep(this,this.logger),this.publisher=new kd(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Fa,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){this.isInitialized();let r="";return await Promise.all([new Promise(s=>{this.subscriber.once(Et.created,o=>{o.topic===e&&s()})}),new Promise(async s=>{r=await this.subscriber.subscribe(e,t),s()})]),r}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(We.transport_closed))}async transportOpen(e){if(!this.reconnecting){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1,this.reconnecting=!0;try{await Promise.all([new Promise(t=>{this.initialized||t(),this.subscriber.once(Et.resubscribed,()=>{t()})}),await Promise.race([new Promise(async t=>{await this.provider.connect(),this.removeListener(We.transport_closed,this.rejectTransportOpen),t()}),new Promise(t=>this.once(We.transport_closed,this.rejectTransportOpen))])])}catch(t){const r=t;if(!/socket hang up/i.test(r.message))throw t;this.logger.error(t),this.events.emit(We.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(e){this.transportExplicitlyClosed||(await this.transportClose(),await new Promise(t=>setTimeout(t,pn)),await this.transportOpen(e))}rejectTransportOpen(){throw new Error("closeTransport called before connection was established")}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new vi(new Gl(su({sdkVersion:Rd,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0})))}async recordMessageEvent(e){const{topic:t,message:r}=e;await this.messages.set(t,r)}async shouldIgnoreMessageEvent(e){const{topic:t,message:r}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,r):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Vr(e)){if(!e.method.endsWith(Td))return;const t=e.params,{topic:r,message:s,publishedAt:o}=t.data,u={topic:r,message:s,publishedAt:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(sp({type:"event",event:t.id},u)),this.events.emit(t.id,u),await this.acknowledgePayload(e),await this.onMessageEvent(u)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(We.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=Gr(e.id,!0);await this.provider.connection.send(t)}registerEventListeners(){this.provider.on(Mi.payload,e=>this.onProviderPayload(e)),this.provider.on(Mi.connect,()=>{this.events.emit(We.connect)}),this.provider.on(Mi.disconnect,()=>{this.events.emit(We.disconnect),this.attemptToReconnect()}),this.provider.on(Mi.error,e=>{this.logger.error(e),this.events.emit(We.error,e)}),this.events.on(We.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},Z.toMiliseconds(pn))}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var ap=Object.defineProperty,_n=Object.getOwnPropertySymbols,op=Object.prototype.hasOwnProperty,cp=Object.prototype.propertyIsEnumerable,wn=(i,e,t)=>e in i?ap(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,vn=(i,e)=>{for(var t in e||(e={}))op.call(e,t)&&wn(i,t,e[t]);if(_n)for(var t of _n(e))cp.call(e,t)&&wn(i,t,e[t]);return i};class nr extends Sl{constructor(e,t,r,s=Ut,o=void 0){super(e,t,r,s),this.core=e,this.logger=t,this.name=r,this.map=new Map,this.version=Fd,this.cached=[],this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(u=>{Iu(u)?this.map.set(u.id,u):xu(u)?this.map.set(u.topic,u):this.getKey&&u!==null&&!rt(u)&&this.map.set(this.getKey(u),u)}),this.cached=[],this.initialized=!0)},this.set=async(u,c)=>{this.isInitialized(),this.map.has(u)?await this.update(u,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:u,value:c}),this.map.set(u,c),await this.persist())},this.get=u=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:u}),this.getData(u)),this.getAll=u=>(this.isInitialized(),u?this.values.filter(c=>Object.keys(u).every(h=>Yi(c[h],u[h]))):this.values),this.update=async(u,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:u,update:c});const h=vn(vn({},this.getData(u)),c);this.map.set(u,h),await this.persist()},this.delete=async(u,c)=>{this.isInitialized(),this.map.has(u)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:u,reason:c}),this.map.delete(u),await this.persist())},this.logger=Se.generateChildLogger(t,this.name),this.storagePrefix=s,this.getKey=o}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:r}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class hp{constructor(e,t){this.core=e,this.logger=t,this.name=Md,this.version=jd,this.events=new ut,this.initialized=!1,this.storagePrefix=Ut,this.ignoredPayloadTypes=[Yt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]},this.create=async()=>{this.isInitialized();const r=Rr(),s=await this.core.crypto.setSymKey(r),o=Dt(Z.FIVE_MINUTES),u={protocol:Ra},c={topic:s,expiry:o,relay:u,active:!1},h=gu({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:r,relay:u});return await this.pairings.set(s,c),await this.core.relayer.subscribe(s),this.core.expirer.set(s,o),{topic:s,uri:h}},this.pair=async r=>{this.isInitialized(),this.isValidPair(r);const{topic:s,symKey:o,relay:u}=du(r.uri);if(this.pairings.keys.includes(s))throw new Error(`Pairing already exists: ${s}`);if(this.core.crypto.hasKeys(s))throw new Error(`Keychain already exists: ${s}`);const c=Dt(Z.FIVE_MINUTES),h={topic:s,relay:u,expiry:c,active:!1};return await this.pairings.set(s,h),await this.core.crypto.setSymKey(o,s),await this.core.relayer.subscribe(s,{relay:u}),this.core.expirer.set(s,c),r.activatePairing&&await this.activate({topic:s}),h},this.activate=async({topic:r})=>{this.isInitialized();const s=Dt(Z.THIRTY_DAYS);await this.pairings.update(r,{active:!0,expiry:s}),this.core.expirer.set(r,s)},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.pairings.keys.includes(s)){const o=await this.sendRequest(s,"wc_pairingPing",{}),{done:u,resolve:c,reject:h}=Vt();this.events.once(Re("pairing_ping",o),({error:d})=>{d?h(d):c()}),await u()}},this.updateExpiry=async({topic:r,expiry:s})=>{this.isInitialized(),await this.pairings.update(r,{expiry:s})},this.updateMetadata=async({topic:r,metadata:s})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Fe("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(r,s,o)=>{const u=kr(s,o),c=await this.core.crypto.encode(r,u),h=di[s].req;return this.core.history.set(r,u),await this.core.relayer.publish(r,c,h),u.id},this.sendResult=async(r,s,o)=>{const u=Gr(r,o),c=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,r),d=di[h.request.method].res;await this.core.relayer.publish(s,c,d),await this.core.history.resolve(u)},this.sendError=async(r,s,o)=>{const u=Br(r,o),c=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,r),d=di[h.request.method]?di[h.request.method].res:di.unregistered_method.res;await this.core.relayer.publish(s,c,d),await this.core.history.resolve(u)},this.deletePairing=async(r,s)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,Fe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),s?Promise.resolve():this.core.expirer.del(r)])},this.cleanup=async()=>{const r=this.pairings.getAll().filter(s=>Rt(s.expiry));await Promise.all(r.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=r=>{const{topic:s,payload:o}=r,u=o.method;if(this.pairings.keys.includes(s))switch(u){case"wc_pairingPing":return this.onPairingPingRequest(s,o);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,o);default:return this.onUnknownRpcMethodRequest(s,o)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,u=(await this.core.history.get(s,o.id)).request.method;if(this.pairings.keys.includes(s))switch(u){case"wc_pairingPing":return this.onPairingPingResponse(s,o);default:return this.onUnknownRpcMethodResponse(u)}},this.onPairingPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult(o,r,!0),this.events.emit("pairing_ping",{id:o,topic:r})}catch(u){await this.sendError(o,r,u),this.logger.error(u)}},this.onPairingPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{Tt(s)?this.events.emit(Re("pairing_ping",o),{}):Ct(s)&&this.events.emit(Re("pairing_ping",o),{error:s.error})},500)},this.onPairingDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit("pairing_delete",{id:o,topic:r})}catch(u){await this.sendError(o,r,u),this.logger.error(u)}},this.onUnknownRpcMethodRequest=async(r,s)=>{const{id:o,method:u}=s;try{if(this.registeredMethods.includes(u))return;const c=Fe("WC_METHOD_UNSUPPORTED",u);await this.sendError(o,r,c),this.logger.error(c)}catch(c){await this.sendError(o,r,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=r=>{this.registeredMethods.includes(r)||this.logger.error(Fe("WC_METHOD_UNSUPPORTED",r))},this.isValidPair=r=>{if(!st(r)){const{message:s}=B("MISSING_OR_INVALID",`pair() params: ${r}`);throw new Error(s)}if(!Su(r.uri)){const{message:s}=B("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw new Error(s)}},this.isValidPing=async r=>{if(!st(r)){const{message:o}=B("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidPairingTopic(s)},this.isValidDisconnect=async r=>{if(!st(r)){const{message:o}=B("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async r=>{if(!Je(r,!1)){const{message:s}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(s)}if(!this.pairings.keys.includes(r)){const{message:s}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(s)}if(Rt(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:s}=B("EXPIRED",`pairing topic: ${r}`);throw new Error(s)}},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.pairings=new nr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(We.message,async e=>{const{topic:t,message:r}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))return;const s=await this.core.crypto.decode(t,r);Vr(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):$n(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(gt.expired,async e=>{const{topic:t}=ha(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}class up extends wl{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new ut.EventEmitter,this.name=qd,this.version=zd,this.cached=[],this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(r,s,o)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:s,chainId:o}),this.records.has(s.id))return;const u={id:s.id,topic:r,request:{method:s.method,params:s.params||null},chainId:o};this.records.set(u.id,u),this.events.emit(vt.created,u)},this.resolve=async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const s=await this.getRecord(r.id);typeof s.response>"u"&&(s.response=Ct(r)?{error:r.error}:{result:r.result},this.records.set(s.id,s),this.events.emit(vt.updated,s))},this.get=async(r,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:s}),await this.getRecord(s)),this.delete=(r,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(o=>{if(o.topic===r){if(typeof s<"u"&&o.id!==s)return;this.records.delete(o.id),this.events.emit(vt.deleted,o)}})},this.exists=async(r,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===r:!1),this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const r={topic:t.topic,request:kr(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:r}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(vt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(vt.created,e=>{const t=vt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(vt.updated,e=>{const t=vt.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(vt.deleted,e=>{const t=vt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}class lp extends xl{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new ut.EventEmitter,this.name=Hd,this.version=Kd,this.cached=[],this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=r=>{try{const s=this.formatTarget(r);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(r,s)=>{this.isInitialized();const o=this.formatTarget(r),u={target:o,expiry:s};this.expirations.set(o,u),this.checkExpiry(o,u),this.events.emit(gt.created,{target:o,expiration:u})},this.get=r=>{this.isInitialized();const s=this.formatTarget(r);return this.getExpiration(s)},this.del=r=>{if(this.isInitialized(),this.has(r)){const s=this.formatTarget(r),o=this.getExpiration(s);this.expirations.delete(s),this.events.emit(gt.deleted,{target:s,expiration:o})}},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return nu(e);if(typeof e=="number")return au(e);const{message:t}=B("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(gt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:r}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}checkExpiry(e,t){const{expiry:r}=t;Z.toMiliseconds(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(gt.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Ci.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(gt.created,e=>{const t=gt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(gt.expired,e=>{const t=gt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(gt.deleted,e=>{const t=gt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var fp=Object.defineProperty,En=Object.getOwnPropertySymbols,dp=Object.prototype.hasOwnProperty,pp=Object.prototype.propertyIsEnumerable,Dn=(i,e,t)=>e in i?fp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Sn=(i,e)=>{for(var t in e||(e={}))dp.call(e,t)&&Dn(i,t,e[t]);if(En)for(var t of En(e))pp.call(e,t)&&Dn(i,t,e[t]);return i};let gp=class Ua extends _l{constructor(e){super(e),this.protocol=Ta,this.version=_d,this.name=ss,this.events=new ut.EventEmitter,this.initialized=!1,this.on=(r,s)=>this.events.on(r,s),this.once=(r,s)=>this.events.once(r,s),this.off=(r,s)=>this.events.off(r,s),this.removeListener=(r,s)=>this.events.removeListener(r,s),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Fa;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Ii(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||wd.logger}));this.logger=Se.generateChildLogger(t,this.name),this.heartbeat=new Ci.HeartBeat,this.crypto=new Vd(this,this.logger,e==null?void 0:e.keychain),this.history=new up(this,this.logger),this.expirer=new lp(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new fl(Sn(Sn({},vd),e==null?void 0:e.storageOptions)),this.relayer=new np({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new hp(this,this.logger)}static async init(e){const t=new Ua(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const yp=gp,La="wc",$a=2,Ma="client",ns=`${La}@${$a}:${Ma}:`,wr={name:Ma,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},bp="proposal",ja="Proposal expired",mp="session",ji=Z.SEVEN_DAYS,_p="engine",gi={wc_sessionPropose:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1115}}},vr={min:Z.FIVE_MINUTES,max:Z.SEVEN_DAYS},wp="request";var vp=Object.defineProperty,Ep=Object.defineProperties,Dp=Object.getOwnPropertyDescriptors,In=Object.getOwnPropertySymbols,Sp=Object.prototype.hasOwnProperty,Ip=Object.prototype.propertyIsEnumerable,xn=(i,e,t)=>e in i?vp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,pt=(i,e)=>{for(var t in e||(e={}))Sp.call(e,t)&&xn(i,t,e[t]);if(In)for(var t of In(e))Ip.call(e,t)&&xn(i,t,e[t]);return i},Er=(i,e)=>Ep(i,Dp(e));class xp extends Ol{constructor(e){super(e),this.name=_p,this.events=new ut,this.initialized=!1,this.ignoredPayloadTypes=[Yt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(gi)}),this.initialized=!0)},this.connect=async t=>{this.isInitialized();const r=Er(pt({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(r);const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:u,sessionProperties:c,relays:h}=r;let d=s,g,E=!1;if(d&&(E=this.client.core.pairing.pairings.get(d).active),!d||!E){const{topic:I,uri:p}=await this.client.core.pairing.create();d=I,g=p}const A=await this.client.core.crypto.generateKeyPair(),S=pt({requiredNamespaces:o,optionalNamespaces:u,relays:h??[{protocol:Ra}],proposer:{publicKey:A,metadata:this.client.metadata}},c&&{sessionProperties:c}),{reject:D,resolve:R,done:F}=Vt(Z.FIVE_MINUTES,ja);if(this.events.once(Re("session_connect"),async({error:I,session:p})=>{if(I)D(I);else if(p){p.self.publicKey=A;const m=Er(pt({},p),{requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces});await this.client.session.set(p.topic,m),await this.setExpiry(p.topic,p.expiry),d&&await this.client.core.pairing.updateMetadata({topic:d,metadata:p.peer.metadata}),R(m)}}),!d){const{message:I}=B("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(I)}const q=await this.sendRequest(d,"wc_sessionPropose",S),_=Dt(Z.FIVE_MINUTES);return await this.setProposal(q,pt({id:q,expiry:_},S)),{uri:g,approval:F}},this.pair=async t=>(this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{this.isInitialized(),await this.isValidApprove(t);const{id:r,relayProtocol:s,namespaces:o,sessionProperties:u}=t,c=this.client.proposal.get(r);let{pairingTopic:h,proposer:d,requiredNamespaces:g,optionalNamespaces:E}=c;bi(g)||(g=_u(o,"approve()"));const A=await this.client.core.crypto.generateKeyPair(),S=d.publicKey,D=await this.client.core.crypto.generateSharedKey(A,S);h&&r&&(await this.client.core.pairing.updateMetadata({topic:h,metadata:d.metadata}),await this.sendResult(r,h,{relay:{protocol:s??"irn"},responderPublicKey:A}),await this.client.proposal.delete(r,Fe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:h}));const R=pt({relay:{protocol:s??"irn"},namespaces:o,requiredNamespaces:g,optionalNamespaces:E,controller:{publicKey:A,metadata:this.client.metadata},expiry:Dt(ji)},u&&{sessionProperties:u});await this.client.core.relayer.subscribe(D);const F=await this.sendRequest(D,"wc_sessionSettle",R),{done:q,resolve:_,reject:I}=Vt();this.events.once(Re("session_approve",F),({error:m})=>{m?I(m):_(this.client.session.get(D))});const p=Er(pt({},R),{topic:D,acknowledged:!1,self:R.controller,peer:{publicKey:d.publicKey,metadata:d.metadata},controller:A});return await this.client.session.set(D,p),await this.setExpiry(D,Dt(ji)),{topic:D,acknowledged:q}},this.reject=async t=>{this.isInitialized(),await this.isValidReject(t);const{id:r,reason:s}=t,{pairingTopic:o}=this.client.proposal.get(r);o&&(await this.sendError(r,o,s),await this.client.proposal.delete(r,Fe("USER_DISCONNECTED")))},this.update=async t=>{this.isInitialized(),await this.isValidUpdate(t);const{topic:r,namespaces:s}=t,o=await this.sendRequest(r,"wc_sessionUpdate",{namespaces:s}),{done:u,resolve:c,reject:h}=Vt();return this.events.once(Re("session_update",o),({error:d})=>{d?h(d):c()}),await this.client.session.update(r,{namespaces:s}),{acknowledged:u}},this.extend=async t=>{this.isInitialized(),await this.isValidExtend(t);const{topic:r}=t,s=await this.sendRequest(r,"wc_sessionExtend",{}),{done:o,resolve:u,reject:c}=Vt();return this.events.once(Re("session_extend",s),({error:h})=>{h?c(h):u()}),await this.setExpiry(r,Dt(ji)),{acknowledged:o}},this.request=async t=>{this.isInitialized(),await this.isValidRequest(t);const{chainId:r,request:s,topic:o,expiry:u}=t,c=await this.sendRequest(o,"wc_sessionRequest",{request:s,chainId:r},u),{done:h,resolve:d,reject:g}=Vt(u);return this.events.once(Re("session_request",c),({error:E,result:A})=>{E?g(E):d(A)}),this.client.events.emit("session_request_sent",{topic:o,request:s,chainId:r}),await h()},this.respond=async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:r,response:s}=t,{id:o}=s;Tt(s)?await this.sendResult(o,r,s.result):Ct(s)&&await this.sendError(o,r,s.error),this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0})},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:r}=t;if(this.client.session.keys.includes(r)){const s=await this.sendRequest(r,"wc_sessionPing",{}),{done:o,resolve:u,reject:c}=Vt();this.events.once(Re("session_ping",s),({error:h})=>{h?c(h):u()}),await o()}else this.client.core.pairing.pairings.keys.includes(r)&&await this.client.core.pairing.ping({topic:r})},this.emit=async t=>{this.isInitialized(),await this.isValidEmit(t);const{topic:r,event:s,chainId:o}=t;await this.sendRequest(r,"wc_sessionEvent",{event:s,chainId:o})},this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:r}=t;this.client.session.keys.includes(r)?(await this.sendRequest(r,"wc_sessionDelete",Fe("USER_DISCONNECTED")),await this.deleteSession(r)):await this.client.core.pairing.disconnect({topic:r})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(r=>Eu(r,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(t,r)=>{const{self:s}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await Promise.all([this.client.session.delete(t,Fe("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(t),r?Promise.resolve():this.client.core.expirer.del(t)])},this.deleteProposal=async(t,r)=>{await Promise.all([this.client.proposal.delete(t,Fe("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,r,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,r),s?Promise.resolve():this.client.core.expirer.del(t)])},this.setExpiry=async(t,r)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:r}),this.client.core.expirer.set(t,r)},this.setProposal=async(t,r)=>{await this.client.proposal.set(t,r),this.client.core.expirer.set(t,r.expiry)},this.setPendingSessionRequest=async t=>{const r=gi.wc_sessionRequest.req.ttl,{id:s,topic:o,params:u}=t;await this.client.pendingRequest.set(s,{id:s,topic:o,params:u}),r&&this.client.core.expirer.set(s,Dt(r))},this.sendRequest=async(t,r,s,o)=>{const u=kr(r,s),c=await this.client.core.crypto.encode(t,u),h=gi[r].req;return o&&(h.ttl=o),this.client.core.history.set(t,u),this.client.core.relayer.publish(t,c,h),u.id},this.sendResult=async(t,r,s)=>{const o=Gr(t,s),u=await this.client.core.crypto.encode(r,o),c=await this.client.core.history.get(r,t),h=gi[c.request.method].res;this.client.core.relayer.publish(r,u,h),await this.client.core.history.resolve(o)},this.sendError=async(t,r,s)=>{const o=Br(t,s),u=await this.client.core.crypto.encode(r,o),c=await this.client.core.history.get(r,t),h=gi[c.request.method].res;this.client.core.relayer.publish(r,u,h),await this.client.core.history.resolve(o)},this.cleanup=async()=>{const t=[],r=[];this.client.session.getAll().forEach(s=>{Rt(s.expiry)&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Rt(s.expiry)&&r.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession(s)),...r.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=t=>{const{topic:r,payload:s}=t,o=s.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeRequest(r,s);case"wc_sessionSettle":return this.onSessionSettleRequest(r,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(r,s);case"wc_sessionExtend":return this.onSessionExtendRequest(r,s);case"wc_sessionPing":return this.onSessionPingRequest(r,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(r,s);case"wc_sessionRequest":return this.onSessionRequest(r,s);case"wc_sessionEvent":return this.onSessionEventRequest(r,s);default:return this.client.logger.info(`Unsupported request method ${o}`)}},this.onRelayEventResponse=async t=>{const{topic:r,payload:s}=t,o=(await this.client.core.history.get(r,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,s);case"wc_sessionExtend":return this.onSessionExtendResponse(r,s);case"wc_sessionPing":return this.onSessionPingResponse(r,s);case"wc_sessionRequest":return this.onSessionRequestResponse(r,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}},this.onSessionProposeRequest=async(t,r)=>{const{params:s,id:o}=r;try{this.isValidConnect(pt({},r.params));const u=Dt(Z.FIVE_MINUTES),c=pt({id:o,pairingTopic:t,expiry:u},s);await this.setProposal(o,c),this.client.events.emit("session_proposal",{id:o,params:c})}catch(u){await this.sendError(o,t,u),this.client.logger.error(u)}},this.onSessionProposeResponse=async(t,r)=>{const{id:s}=r;if(Tt(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const u=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:u});const c=u.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const d=await this.client.core.crypto.generateSharedKey(c,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:d});const g=await this.client.core.relayer.subscribe(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:g}),await this.client.core.pairing.activate({topic:t})}else Ct(r)&&(await this.client.proposal.delete(s,Fe("USER_DISCONNECTED")),this.events.emit(Re("session_connect"),{error:r.error}))},this.onSessionSettleRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidSessionSettleRequest(o);const{relay:u,controller:c,expiry:h,namespaces:d,requiredNamespaces:g,optionalNamespaces:E,sessionProperties:A}=r.params,S=pt({topic:t,relay:u,expiry:h,namespaces:d,acknowledged:!0,requiredNamespaces:g,optionalNamespaces:E,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},A&&{sessionProperties:A});await this.sendResult(r.id,t,!0),this.events.emit(Re("session_connect"),{session:S})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.onSessionSettleResponse=async(t,r)=>{const{id:s}=r;Tt(r)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Re("session_approve",s),{})):Ct(r)&&(await this.client.session.delete(t,Fe("USER_DISCONNECTED")),this.events.emit(Re("session_approve",s),{error:r.error}))},this.onSessionUpdateRequest=async(t,r)=>{const{params:s,id:o}=r;try{this.isValidUpdate(pt({topic:t},s)),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult(o,t,!0),this.client.events.emit("session_update",{id:o,topic:t,params:s})}catch(u){await this.sendError(o,t,u),this.client.logger.error(u)}},this.onSessionUpdateResponse=(t,r)=>{const{id:s}=r;Tt(r)?this.events.emit(Re("session_update",s),{}):Ct(r)&&this.events.emit(Re("session_update",s),{error:r.error})},this.onSessionExtendRequest=async(t,r)=>{const{id:s}=r;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Dt(ji)),await this.sendResult(s,t,!0),this.client.events.emit("session_extend",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionExtendResponse=(t,r)=>{const{id:s}=r;Tt(r)?this.events.emit(Re("session_extend",s),{}):Ct(r)&&this.events.emit(Re("session_extend",s),{error:r.error})},this.onSessionPingRequest=async(t,r)=>{const{id:s}=r;try{this.isValidPing({topic:t}),await this.sendResult(s,t,!0),this.client.events.emit("session_ping",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionPingResponse=(t,r)=>{const{id:s}=r;setTimeout(()=>{Tt(r)?this.events.emit(Re("session_ping",s),{}):Ct(r)&&this.events.emit(Re("session_ping",s),{error:r.error})},500)},this.onSessionDeleteRequest=async(t,r)=>{const{id:s}=r;try{this.isValidDisconnect({topic:t,reason:r.params}),this.client.core.relayer.once(We.publish,async()=>{await this.deleteSession(t)}),await this.sendResult(s,t,!0),this.client.events.emit("session_delete",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidRequest(pt({topic:t},o)),await this.setPendingSessionRequest({id:s,topic:t,params:o}),this.client.events.emit("session_request",{id:s,topic:t,params:o})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.onSessionRequestResponse=(t,r)=>{const{id:s}=r;Tt(r)?this.events.emit(Re("session_request",s),{result:r.result}):Ct(r)&&this.events.emit(Re("session_request",s),{error:r.error})},this.onSessionEventRequest=async(t,r)=>{const{id:s,params:o}=r;try{this.isValidEmit(pt({topic:t},o)),this.client.events.emit("session_event",{id:s,topic:t,params:o})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.isValidConnect=async t=>{if(!st(t)){const{message:h}=B("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(h)}const{pairingTopic:r,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:u,relays:c}=t;if(rt(r)||await this.isValidPairingTopic(r),!Fu(c,!0)){const{message:h}=B("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}!rt(s)&&bi(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!rt(o)&&bi(o)!==0&&this.validateNamespaces(o,"optionalNamespaces"),rt(u)||this.validateSessionProps(u,"sessionProperties")},this.validateNamespaces=(t,r)=>{const s=Ru(t,"connect()",r);if(s)throw new Error(s.message)},this.isValidApprove=async t=>{if(!st(t))throw new Error(B("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:r,namespaces:s,relayProtocol:o,sessionProperties:u}=t;await this.isValidProposalId(r);const c=this.client.proposal.get(r),h=Hi(s,"approve()");if(h)throw new Error(h.message);const d=Hs(c.requiredNamespaces,s,"approve()");if(d)throw new Error(d.message);if(!Je(o,!0)){const{message:g}=B("MISSING_OR_INVALID",`approve() relayProtocol: ${o}`);throw new Error(g)}rt(u)||this.validateSessionProps(u,"sessionProperties")},this.isValidReject=async t=>{if(!st(t)){const{message:o}=B("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(o)}const{id:r,reason:s}=t;if(await this.isValidProposalId(r),!Lu(s)){const{message:o}=B("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidSessionSettleRequest=t=>{if(!st(t)){const{message:d}=B("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(d)}const{relay:r,controller:s,namespaces:o,expiry:u}=t;if(!la(r)){const{message:d}=B("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(d)}const c=Cu(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);const h=Hi(o,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Rt(u)){const{message:d}=B("EXPIRED","onSessionSettleRequest()");throw new Error(d)}},this.isValidUpdate=async t=>{if(!st(t)){const{message:h}=B("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(h)}const{topic:r,namespaces:s}=t;await this.isValidSessionTopic(r);const o=this.client.session.get(r),u=Hi(s,"update()");if(u)throw new Error(u.message);const c=Hs(o.requiredNamespaces,s,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async t=>{if(!st(t)){const{message:s}=B("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionTopic(r)},this.isValidRequest=async t=>{if(!st(t)){const{message:h}=B("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(h)}const{topic:r,request:s,chainId:o,expiry:u}=t;await this.isValidSessionTopic(r);const{namespaces:c}=this.client.session.get(r);if(!zs(c,o)){const{message:h}=B("MISSING_OR_INVALID",`request() chainId: ${o}`);throw new Error(h)}if(!$u(s)){const{message:h}=B("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(h)}if(!qu(c,o,s.method)){const{message:h}=B("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(h)}if(u&&!Bu(u,vr)){const{message:h}=B("MISSING_OR_INVALID",`request() expiry: ${u}. Expiry must be a number (in seconds) between ${vr.min} and ${vr.max}`);throw new Error(h)}},this.isValidRespond=async t=>{if(!st(t)){const{message:o}=B("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:r,response:s}=t;if(await this.isValidSessionTopic(r),!Mu(s)){const{message:o}=B("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidPing=async t=>{if(!st(t)){const{message:s}=B("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)},this.isValidEmit=async t=>{if(!st(t)){const{message:c}=B("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(c)}const{topic:r,event:s,chainId:o}=t;await this.isValidSessionTopic(r);const{namespaces:u}=this.client.session.get(r);if(!zs(u,o)){const{message:c}=B("MISSING_OR_INVALID",`emit() chainId: ${o}`);throw new Error(c)}if(!ju(s)){const{message:c}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}if(!zu(u,o,s.name)){const{message:c}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidDisconnect=async t=>{if(!st(t)){const{message:s}=B("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:r}=t;await this.isValidSessionOrPairingTopic(r)},this.validateSessionProps=(t,r)=>{Object.values(t).forEach(s=>{if(!Je(s,!1)){const{message:o}=B("MISSING_OR_INVALID",`${r} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(o)}})}}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(We.message,async e=>{const{topic:t,message:r}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(r)))return;const s=await this.client.core.crypto.decode(t,r);Vr(s)?(this.client.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):$n(s)&&(await this.client.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.client.core.expirer.on(gt.expired,async e=>{const{topic:t,id:r}=ha(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,B("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}isValidPairingTopic(e){if(!Je(e,!1)){const{message:t}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Rt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=B("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Je(e,!1)){const{message:t}=B("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=B("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Rt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=B("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Je(e,!1)){const{message:t}=B("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=B("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Uu(e)){const{message:t}=B("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=B("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Rt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=B("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class Cp extends nr{constructor(e,t){super(e,t,bp,ns),this.core=e,this.logger=t}}class Op extends nr{constructor(e,t){super(e,t,mp,ns),this.core=e,this.logger=t}}class Pp extends nr{constructor(e,t){super(e,t,wp,ns),this.core=e,this.logger=t}}let Ap=class qa extends Cl{constructor(e){super(e),this.protocol=La,this.version=$a,this.name=wr.name,this.events=new ut.EventEmitter,this.on=(r,s)=>this.events.on(r,s),this.once=(r,s)=>this.events.once(r,s),this.off=(r,s)=>this.events.off(r,s),this.removeListener=(r,s)=>this.events.removeListener(r,s),this.removeAllListeners=r=>this.events.removeAllListeners(r),this.connect=async r=>{try{return await this.engine.connect(r)}catch(s){throw this.logger.error(s.message),s}},this.pair=async r=>{try{return await this.engine.pair(r)}catch(s){throw this.logger.error(s.message),s}},this.approve=async r=>{try{return await this.engine.approve(r)}catch(s){throw this.logger.error(s.message),s}},this.reject=async r=>{try{return await this.engine.reject(r)}catch(s){throw this.logger.error(s.message),s}},this.update=async r=>{try{return await this.engine.update(r)}catch(s){throw this.logger.error(s.message),s}},this.extend=async r=>{try{return await this.engine.extend(r)}catch(s){throw this.logger.error(s.message),s}},this.request=async r=>{try{return await this.engine.request(r)}catch(s){throw this.logger.error(s.message),s}},this.respond=async r=>{try{return await this.engine.respond(r)}catch(s){throw this.logger.error(s.message),s}},this.ping=async r=>{try{return await this.engine.ping(r)}catch(s){throw this.logger.error(s.message),s}},this.emit=async r=>{try{return await this.engine.emit(r)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async r=>{try{return await this.engine.disconnect(r)}catch(s){throw this.logger.error(s.message),s}},this.find=r=>{try{return this.engine.find(r)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}},this.name=(e==null?void 0:e.name)||wr.name,this.metadata=(e==null?void 0:e.metadata)||eu();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Ii(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||wr.logger}));this.core=(e==null?void 0:e.core)||new yp(e),this.logger=Se.generateChildLogger(t,this.name),this.session=new Op(this.core,this.logger),this.proposal=new Cp(this.core,this.logger),this.pendingRequest=new Pp(this.core,this.logger),this.engine=new xp(this)}static async init(e){const t=new qa(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const Cn="error",Np="wss://relay.walletconnect.com",Tp="wc",Rp="universal_provider",On=`${Tp}@2:${Rp}:`,Fp="https://rpc.walletconnect.com/v1",Pi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function ti(i,e,t){let r;const s=jr(i);return e.rpcMap&&(r=e.rpcMap[s]),r||(r=`${Fp}?chainId=eip155:${s}&projectId=${t}`),r}function jr(i){return i.includes("eip155")?Number(i.split(":")[1]):Number(i)}function Up(i,e){if(!e.includes(i))throw new Error(`Chain '${i}' not approved. Please use one of the following: ${e.toString()}`)}function Lp(i){return i.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}const ar=(i,e)=>{const t=r=>{r.request!==e.request||r.topic!==e.topic||(i.events.removeListener("session_request_sent",t),$p())};i.on("session_request_sent",t)};function $p(){if(typeof window<"u")try{const i=window.localStorage.getItem("WALLETCONNECT_DEEPLINK_CHOICE");if(i){const e=JSON.parse(i);window.open(e.href,"_self","noreferrer noopener")}}catch(i){console.error(i)}}let Mp=class{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){var t;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return this.handleSwitchChain(e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0"),null;case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(e.request.method)?(ar(this.client,e),await this.client.request(e)):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){const r=jr(e);if(!this.httpProviders[r]){const s=t||ti(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,s)}this.chainId=r,this.events.emit(Pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const r=t||ti(`${this.name}:${e}`,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new vi(new Wi(r))}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const r=jr(t);e[r]=this.createHttpProvider(r)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}handleSwitchChain(e){const t=parseInt(e,16),r=`${this.name}:${t}`;Up(r,this.namespace.chains),this.setDefaultChain(`${t}`)}},jp=class{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?(ar(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const r=t||ti(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.chainId=e,this.events.emit(Pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||ti(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new vi(new Wi(r))}};class qp{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?(ar(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||ti(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(Pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||ti(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new vi(new Wi(r))}}class zp{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?(ar(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const r=t||this.getCardanoRPCUrl(e);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(Pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const r=this.getCardanoRPCUrl(t);e[t]=this.createHttpProvider(t,r)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){const r=t||this.getCardanoRPCUrl(e);return typeof r>"u"?void 0:new vi(new Wi(r))}}var Hp=Object.defineProperty,Kp=Object.defineProperties,Bp=Object.getOwnPropertyDescriptors,Pn=Object.getOwnPropertySymbols,Vp=Object.prototype.hasOwnProperty,Gp=Object.prototype.propertyIsEnumerable,An=(i,e,t)=>e in i?Hp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qi=(i,e)=>{for(var t in e||(e={}))Vp.call(e,t)&&An(i,t,e[t]);if(Pn)for(var t of Pn(e))Gp.call(e,t)&&An(i,t,e[t]);return i},Dr=(i,e)=>Kp(i,Bp(e));class as{constructor(e){this.events=new ut,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Ii(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Cn}))}static async init(e){const t=new as(e);return await t.initialize(),t}async request(e,t){const[r,s]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(r).request({request:qi({},e),chainId:`${r}:${s}`,topic:this.session.topic})}sendAsync(e,t,r){this.request(e,r).then(s=>t(null,s)).catch(s=>t(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Fe("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:r,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});r&&(this.uri=r,this.events.emit("display_uri",r)),await s().then(o=>{this.session=o}).catch(o=>{if(o.message!==ja)throw o;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,t){try{const[r,s]=this.validateChain(e);this.getProvider(r).setDefaultChain(s,t)}catch(r){if(!/Please call connect/.test(r.message))throw r}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Ft(t)){for(const r of t)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Ap.init({logger:this.providerOpts.logger||Cn,relayUrl:this.providerOpts.relayUrl||Np,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{var t,r,s;const o=((t=this.session)==null?void 0:t.namespaces[e].accounts)||[],u=Lp(o),c=Dr(qi({},Object.assign(this.namespaces[e],(s=(r=this.optionalNamespaces)==null?void 0:r[e])!=null?s:{})),{accounts:o,chains:u});switch(e){case"eip155":this.rpcProviders[e]=new Mp({client:this.client,namespace:c,events:this.events});break;case"solana":this.rpcProviders[e]=new jp({client:this.client,namespace:c,events:this.events});break;case"cosmos":this.rpcProviders[e]=new qp({client:this.client,namespace:c,events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new zp({client:this.client,namespace:c,events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:r}=t;r.name==="accountsChanged"?this.events.emit("accountsChanged",r.data):r.name==="chainChanged"?this.onChainChanged(t.chainId):this.events.emit(r.name,r.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var r;const{namespaces:s}=t,o=(r=this.client)==null?void 0:r.session.get(e);this.session=Dr(qi({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Dr(qi({},Fe("USER_DISCONNECTED")),{data:e.topic}))}),this.on(Pi.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:r,sessionProperties:s}=e;if(!t||!Object.keys(t).length)throw new Error("Namespaces must be not empty");this.namespaces=t,this.optionalNamespaces=r,this.sessionProperties=s,this.persist("namespaces",t),this.persist("optionalNamespaces",r)}validateChain(e){const[t,r]=(e==null?void 0:e.split(":"))||["",""];if(t&&!Object.keys(this.namespaces).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&r)return[t,r];const s=Object.keys(this.namespaces)[0],o=this.rpcProviders[s].getDefaultChain();return[s,o]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){const[r,s]=this.validateChain(e);t||this.getProvider(r).setDefaultChain(s),this.namespaces[r].defaultChain=s,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",s)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${On}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${On}/${e}`)}}const kp=as,Yp="wc",Wp="ethereum_provider",Jp=`${Yp}@2:${Wp}:`,Xp="https://rpc.walletconnect.com/v1/",qr=["eth_sendTransaction","personal_sign"],mg=["eth_accounts","eth_requestAccounts","eth_call","eth_getBalance","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],zr=["chainChanged","accountsChanged"],_g=["message","disconnect","connect"];var Zp=Object.defineProperty,Qp=Object.defineProperties,eg=Object.getOwnPropertyDescriptors,Nn=Object.getOwnPropertySymbols,tg=Object.prototype.hasOwnProperty,ig=Object.prototype.propertyIsEnumerable,Tn=(i,e,t)=>e in i?Zp(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Rn=(i,e)=>{for(var t in e||(e={}))tg.call(e,t)&&Tn(i,t,e[t]);if(Nn)for(var t of Nn(e))ig.call(e,t)&&Tn(i,t,e[t]);return i},Fn=(i,e)=>Qp(i,eg(e));function Hr(i){return Number(i[0].split(":")[1])}function Sr(i){return`0x${i.toString(16)}`}function rg(i){const{chains:e,optionalChains:t,methods:r,optionalMethods:s,events:o,optionalEvents:u,rpcMap:c}=i;if(!Ft(e))throw new Error("Invalid chains");const h=e,d=r||qr,g=o||zr,E={[Hr(h)]:c[Hr(h)]},A={chains:h,methods:d,events:g,rpcMap:E},S=o==null?void 0:o.filter(q=>!zr.includes(q)),D=r==null?void 0:r.filter(q=>!qr.includes(q));if(!t&&!u&&!s&&!(S!=null&&S.length)&&!(D!=null&&D.length))return{required:A};const R=(S==null?void 0:S.length)&&(D==null?void 0:D.length)||!t,F={chains:[...new Set(R?h.concat(t||[]):t)],methods:[...new Set(d.concat(s||[]))],events:[...new Set(g.concat(u||[]))],rpcMap:c};return{required:A,optional:F}}class os{constructor(){this.events=new ut.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Jp,this.on=(e,t)=>(this.events.on(e,t),this),this.once=(e,t)=>(this.events.once(e,t),this),this.removeListener=(e,t)=>(this.events.removeListener(e,t),this),this.off=(e,t)=>(this.events.off(e,t),this),this.parseAccount=e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e,this.signer={},this.rpc={}}static async init(e){const t=new os;return await t.initialize(e),t}async request(e){return await this.signer.request(e,this.formatChainId(this.chainId))}sendAsync(e,t){this.signer.sendAsync(e,t,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:t,optional:r}=rg(this.rpc);try{const s=await new Promise(async(u,c)=>{var h;this.rpc.showQrModal&&((h=this.modal)==null||h.subscribeModal(d=>{!d.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Fn(Rn({namespaces:{[this.namespace]:t}},r&&{optionalNamespaces:{[this.namespace]:r}}),{pairingTopic:e==null?void 0:e.pairingTopic})).then(d=>{u(d)}).catch(d=>{c(new Error(d.message))})});if(!s)return;this.setChainIds(this.rpc.chains);const o=Uh(s.namespaces,[this.namespace]);this.setAccounts(o),this.events.emit("connect",{chainId:Sr(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:r}=t;r.name==="accountsChanged"?(this.accounts=this.parseAccounts(r.data),this.events.emit("accountsChanged",this.accounts)):r.name==="chainChanged"?this.setChainId(this.formatChainId(r.data)):this.events.emit(r.name,r.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",Sr(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Fn(Rn({},Fe("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var t,r;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(r=this.modal)==null||r.openModal({uri:e})),this.events.emit("display_uri",e)})}setHttpProvider(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(r=>this.isCompatibleChainId(r)).map(r=>this.parseChainId(r));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",Sr(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.setHttpProvider(t)}}parseAccountId(e){const[t,r,s]=e.split(":");return{chainId:`${t}:${r}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,r;return{chains:((t=e.chains)==null?void 0:t.map(s=>this.formatChainId(s)))||[`${this.namespace}:1`],optionalChains:e.optionalChains?e.optionalChains.map(s=>this.formatChainId(s)):void 0,methods:(e==null?void 0:e.methods)||qr,events:(e==null?void 0:e.events)||zr,optionalMethods:(e==null?void 0:e.optionalMethods)||[],optionalEvents:(e==null?void 0:e.optionalEvents)||[],rpcMap:(e==null?void 0:e.rpcMap)||this.buildRpcMap(e.chains.concat(e.optionalChains||[]),e.projectId),showQrModal:(r=e==null?void 0:e.showQrModal)!=null?r:!0,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const r={};return e.forEach(s=>{r[s]=this.getRpcUrl(s,t)}),r}async initialize(e){var t,r;if(this.rpc=this.getRpcConfig(e),this.chainId=Hr(this.rpc.chains),this.signer=await kp.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal)try{const{Web3Modal:s}=await Po(()=>import("./index.8ab1946c.js"),["assets/chunks/index.8ab1946c.js","assets/chunks/framework.da3b0f29.js","assets/app.b8b298ad.js","assets/chunks/theme.80eb2a50.js"]);this.modal=new s({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains,themeMode:(t=this.rpc.qrModalOptions)==null?void 0:t.themeMode,themeVariables:(r=this.rpc.qrModalOptions)==null?void 0:r.themeVariables})}catch{throw new Error("To use QR modal, please install @web3modal/standalone package")}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:r,rpcMap:s}=e;t&&Ft(t)&&(this.rpc.chains=t.map(o=>this.formatChainId(o)),t.forEach(o=>{this.rpc.rpcMap[o]=(s==null?void 0:s[o])||this.getRpcUrl(o)})),r&&Ft(r)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=r==null?void 0:r.map(o=>this.formatChainId(o)),r.forEach(o=>{this.rpc.rpcMap[o]=(s==null?void 0:s[o])||this.getRpcUrl(o)}))}getRpcUrl(e,t){var r;return((r=this.rpc.rpcMap)==null?void 0:r[e])||`${Xp}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`);this.setChainIds(e?[this.formatChainId(e)]:this.session.namespaces[this.namespace].accounts),this.setAccounts(this.session.namespaces[this.namespace].accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const wg=os;export{wg as EthereumProvider,_g as OPTIONAL_EVENTS,mg as OPTIONAL_METHODS,zr as REQUIRED_EVENTS,qr as REQUIRED_METHODS,os as default};
